{"file_contents":{"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","size_bytes":80},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","size_bytes":1977},"client/src/components/app-sidebar.tsx":{"content":"import { ChartBarIcon, ChatBubbleLeftRightIcon, Cog6ToothIcon, CpuChipIcon, PresentationChartLineIcon, ShieldCheckIcon, BoltIcon, Square3Stack3DIcon, RocketLaunchIcon, SpeakerWaveIcon, CircleStackIcon } from \"@heroicons/react/24/outline\";\nimport { SiTwitch } from \"react-icons/si\";\nimport {\n  Sidebar,\n  SidebarContent,\n  SidebarGroup,\n  SidebarGroupContent,\n  SidebarHeader,\n  SidebarMenu,\n  SidebarMenuButton,\n  SidebarMenuItem,\n} from \"@/components/ui/sidebar\";\nimport { Link, useLocation } from \"wouter\";\n\nconst menuItems = [\n  {\n    title: \"Dashboard\",\n    url: \"/\",\n    icon: ChartBarIcon,\n  },\n  {\n    title: \"Monitor\",\n    url: \"/monitor\",\n    icon: Square3Stack3DIcon,\n  },\n  {\n    title: \"Live Chat\",\n    url: \"/live-chat\",\n    icon: ChatBubbleLeftRightIcon,\n  },\n  {\n    title: \"Analytics\",\n    url: \"/analytics\",\n    icon: PresentationChartLineIcon,\n  },\n  {\n    title: \"AI Controls\",\n    url: \"/ai-controls\",\n    icon: CpuChipIcon,\n  },\n  {\n    title: \"StreamDachi AI\",\n    url: \"/dachistream\",\n    icon: BoltIcon,\n  },\n  {\n    title: \"VIP Management\",\n    url: \"/vip-management\",\n    icon: ShieldCheckIcon,\n  },\n  {\n    title: \"Raid Management\",\n    url: \"/raid-management\",\n    icon: RocketLaunchIcon,\n  },\n  {\n    title: \"Audio Settings\",\n    url: \"/audio-settings\",\n    icon: SpeakerWaveIcon,\n  },\n  {\n    title: \"Database\",\n    url: \"/database\",\n    icon: CircleStackIcon,\n  },\n  {\n    title: \"Settings\",\n    url: \"/settings\",\n    icon: Cog6ToothIcon,\n  },\n];\n\nexport function AppSidebar() {\n  const [location] = useLocation();\n\n  return (\n    <Sidebar>\n      <SidebarHeader className=\"p-6\">\n        <div className=\"flex items-center gap-3\">\n          <div className=\"flex h-10 w-10 items-center justify-center rounded-md bg-primary\">\n            <SiTwitch className=\"h-6 w-6 text-primary-foreground\" />\n          </div>\n          <div>\n            <h1 className=\"text-lg font-bold text-sidebar-foreground\">StreamDachi</h1>\n            <p className=\"text-xs text-muted-foreground\">Dashboard</p>\n          </div>\n        </div>\n      </SidebarHeader>\n      <SidebarContent>\n        <SidebarGroup>\n          <SidebarGroupContent>\n            <SidebarMenu>\n              {menuItems.map((item) => {\n                const isActive = location === item.url;\n                return (\n                  <SidebarMenuItem key={item.title}>\n                    <SidebarMenuButton asChild isActive={isActive} data-testid={`link-${item.title.toLowerCase().replace(' ', '-')}`}>\n                      <Link href={item.url}>\n                        <item.icon className=\"h-5 w-5\" />\n                        <span>{item.title}</span>\n                      </Link>\n                    </SidebarMenuButton>\n                  </SidebarMenuItem>\n                );\n              })}\n            </SidebarMenu>\n          </SidebarGroupContent>\n        </SidebarGroup>\n      </SidebarContent>\n    </Sidebar>\n  );\n}\n","size_bytes":2910},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","size_bytes":710},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","size_bytes":2154},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","size_bytes":1139},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","size_bytes":4420},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","size_bytes":140},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","size_bytes":2695},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  // Whitespace-nowrap: Badges should never wrap.\n  \"whitespace-nowrap inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\" +\n  \" hover-elevate \" ,\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground shadow-xs\",\n        secondary: \"border-transparent bg-secondary text-secondary-foreground\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground shadow-xs\",\n\n        outline: \" border [border-color:var(--badge-outline)] shadow-xs\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  },\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  );\n}\n\nexport { Badge, badgeVariants }\n","size_bytes":1202},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","size_bytes":1527},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","size_bytes":1209},"server/ai-learning-service.ts":{"content":"import { storage } from \"./storage\";\nimport { generateAiResponse } from \"./groq-service\";\n\nlet learningInterval: NodeJS.Timeout | null = null;\n\nexport async function startAiLearning(intervalMinutes: number = 10) {\n  if (learningInterval) {\n    clearInterval(learningInterval);\n  }\n\n  const runLearning = async () => {\n    try {\n      const users = await storage.getAllUserProfiles();\n      \n      for (const user of users) {\n        const messages = await storage.getMessagesByUser(user.userId, 50);\n        \n        if (messages.length >= 5) {\n          const recentMessages = messages.slice(0, 20).map(m => m.message).join(\"\\n\");\n          \n          const prompt = `Analyze the following chat messages from @${user.username} and provide a 1-2 sentence personality summary that captures their tone, behavior, and chat style for in-stream personalization. Be concise and insightful.\n\nMessages:\n${recentMessages}\n\nProvide ONLY the summary, no additional text.`;\n\n          try {\n            const summary = await generateAiResponse(prompt, \"\");\n            \n            const insight = await storage.getUserInsight(user.userId);\n            const tags = extractTags(summary);\n            \n            await storage.saveUserInsight({\n              userId: user.userId,\n              summary: summary.trim(),\n              totalMessages: messages.length,\n              recentTags: tags,\n            });\n            \n            console.log(`Updated AI insight for user ${user.username}`);\n          } catch (error) {\n            console.error(`Failed to generate insight for ${user.username}:`, error);\n          }\n        }\n      }\n    } catch (error) {\n      console.error(\"Error in AI learning cycle:\", error);\n    }\n  };\n\n  await runLearning();\n\n  learningInterval = setInterval(runLearning, intervalMinutes * 60 * 1000);\n  console.log(`AI learning service started (running every ${intervalMinutes} minutes)`);\n}\n\nexport function stopAiLearning() {\n  if (learningInterval) {\n    clearInterval(learningInterval);\n    learningInterval = null;\n    console.log(\"AI learning service stopped\");\n  }\n}\n\nfunction extractTags(summary: string): string[] {\n  const tags: string[] = [];\n  const keywords = {\n    playful: [\"playful\", \"fun\", \"jokes\", \"humor\", \"funny\"],\n    helpful: [\"helpful\", \"supportive\", \"kind\", \"friendly\"],\n    enthusiastic: [\"enthusiastic\", \"excited\", \"energetic\", \"active\"],\n    analytical: [\"analytical\", \"thoughtful\", \"detailed\", \"technical\"],\n    casual: [\"casual\", \"relaxed\", \"chill\", \"laid-back\"],\n    positive: [\"positive\", \"upbeat\", \"optimistic\", \"happy\"],\n    engaged: [\"engaged\", \"interactive\", \"participates\", \"involved\"],\n  };\n\n  const lowerSummary = summary.toLowerCase();\n  for (const [tag, words] of Object.entries(keywords)) {\n    if (words.some(word => lowerSummary.includes(word))) {\n      tags.push(tag);\n    }\n  }\n\n  return tags.slice(0, 3);\n}\n","size_bytes":2876},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","size_bytes":3848},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","size_bytes":2765},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(`\n      after:content-[''] after:block after:absolute after:inset-0 after:rounded-full after:pointer-events-none after:border after:border-black/10 dark:after:border-white/10\n      relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full`,\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","size_bytes":1592},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","size_bytes":1584},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","size_bytes":7609},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","size_bytes":1056},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const res = await fetch(url, {\n    method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const res = await fetch(queryKey.join(\"/\") as string, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","size_bytes":1383},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","size_bytes":565},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \".5625rem\", /* 9px */\n        md: \".375rem\", /* 6px */\n        sm: \".1875rem\", /* 3px */\n      },\n      colors: {\n        // Flat / base colors (regular buttons)\n        background: \"hsl(var(--background) / <alpha-value>)\",\n        foreground: \"hsl(var(--foreground) / <alpha-value>)\",\n        border: \"hsl(var(--border) / <alpha-value>)\",\n        input: \"hsl(var(--input) / <alpha-value>)\",\n        card: {\n          DEFAULT: \"hsl(var(--card) / <alpha-value>)\",\n          foreground: \"hsl(var(--card-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--card-border) / <alpha-value>)\",\n        },\n        popover: {\n          DEFAULT: \"hsl(var(--popover) / <alpha-value>)\",\n          foreground: \"hsl(var(--popover-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--popover-border) / <alpha-value>)\",\n        },\n        primary: {\n          DEFAULT: \"hsl(var(--primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--primary-foreground) / <alpha-value>)\",\n          border: \"var(--primary-border)\",\n        },\n        secondary: {\n          DEFAULT: \"hsl(var(--secondary) / <alpha-value>)\",\n          foreground: \"hsl(var(--secondary-foreground) / <alpha-value>)\",\n          border: \"var(--secondary-border)\",\n        },\n        muted: {\n          DEFAULT: \"hsl(var(--muted) / <alpha-value>)\",\n          foreground: \"hsl(var(--muted-foreground) / <alpha-value>)\",\n          border: \"var(--muted-border)\",\n        },\n        accent: {\n          DEFAULT: \"hsl(var(--accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--accent-foreground) / <alpha-value>)\",\n          border: \"var(--accent-border)\",\n        },\n        destructive: {\n          DEFAULT: \"hsl(var(--destructive) / <alpha-value>)\",\n          foreground: \"hsl(var(--destructive-foreground) / <alpha-value>)\",\n          border: \"var(--destructive-border)\",\n        },\n        ring: \"hsl(var(--ring) / <alpha-value>)\",\n        chart: {\n          \"1\": \"hsl(var(--chart-1) / <alpha-value>)\",\n          \"2\": \"hsl(var(--chart-2) / <alpha-value>)\",\n          \"3\": \"hsl(var(--chart-3) / <alpha-value>)\",\n          \"4\": \"hsl(var(--chart-4) / <alpha-value>)\",\n          \"5\": \"hsl(var(--chart-5) / <alpha-value>)\",\n        },\n        sidebar: {\n          ring: \"hsl(var(--sidebar-ring) / <alpha-value>)\",\n          DEFAULT: \"hsl(var(--sidebar) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--sidebar-border) / <alpha-value>)\",\n        },\n        \"sidebar-primary\": {\n          DEFAULT: \"hsl(var(--sidebar-primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-primary-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-primary-border)\",\n        },\n        \"sidebar-accent\": {\n          DEFAULT: \"hsl(var(--sidebar-accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-accent-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-accent-border)\"\n        },\n        status: {\n          online: \"rgb(34 197 94)\",\n          away: \"rgb(245 158 11)\",\n          busy: \"rgb(239 68 68)\",\n          offline: \"rgb(156 163 175)\",\n        },\n      },\n      fontFamily: {\n        sans: [\"var(--font-sans)\"],\n        serif: [\"var(--font-serif)\"],\n        mono: [\"var(--font-mono)\"],\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: { height: \"0\" },\n          to: { height: \"var(--radix-accordion-content-height)\" },\n        },\n        \"accordion-up\": {\n          from: { height: \"var(--radix-accordion-content-height)\" },\n          to: { height: \"0\" },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","size_bytes":4050},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","size_bytes":157},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","size_bytes":689},"client/src/App.tsx":{"content":"import { Switch, Route } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { SidebarProvider, SidebarTrigger } from \"@/components/ui/sidebar\";\nimport { AppSidebar } from \"@/components/app-sidebar\";\nimport { useWebSocket } from \"@/hooks/use-websocket\";\nimport Dashboard from \"@/pages/dashboard\";\nimport LiveChat from \"@/pages/live-chat\";\nimport Analytics from \"@/pages/analytics\";\nimport AiControls from \"@/pages/ai-controls\";\nimport DachiStream from \"@/pages/dachistream\";\nimport SettingsPage from \"@/pages/settings\";\nimport VIPManagement from \"@/pages/vip-management\";\nimport RaidManagement from \"@/pages/raid-management\";\nimport Monitor from \"@/pages/monitor\";\nimport AudioSettings from \"@/pages/audio-settings\";\nimport Database from \"@/pages/database\";\n\nfunction Router() {\n  return (\n    <Switch>\n      <Route path=\"/\" component={Dashboard} />\n      <Route path=\"/live-chat\" component={LiveChat} />\n      <Route path=\"/analytics\" component={Analytics} />\n      <Route path=\"/ai-controls\" component={AiControls} />\n      <Route path=\"/dachistream\" component={DachiStream} />\n      <Route path=\"/vip-management\" component={VIPManagement} />\n      <Route path=\"/raid-management\" component={RaidManagement} />\n      <Route path=\"/monitor\" component={Monitor} />\n      <Route path=\"/audio-settings\" component={AudioSettings} />\n      <Route path=\"/database\" component={Database} />\n      <Route path=\"/settings\" component={SettingsPage} />\n    </Switch>\n  );\n}\n\nfunction AppContent() {\n  useWebSocket();\n\n  const sidebarStyle = {\n    \"--sidebar-width\": \"15rem\",\n    \"--sidebar-width-icon\": \"4rem\",\n  };\n\n  return (\n    <SidebarProvider style={sidebarStyle as React.CSSProperties}>\n      <div className=\"flex h-screen w-full\">\n        <AppSidebar />\n        <div className=\"flex flex-col flex-1 min-w-0\">\n          <header className=\"flex items-center justify-between p-4 border-b border-border\">\n            <SidebarTrigger data-testid=\"button-sidebar-toggle\" />\n          </header>\n          <main className=\"flex-1 overflow-auto\">\n            <Router />\n          </main>\n        </div>\n      </div>\n    </SidebarProvider>\n  );\n}\n\nfunction App() {\n  return (\n    <QueryClientProvider client={queryClient}>\n      <TooltipProvider>\n        <AppContent />\n        <Toaster />\n      </TooltipProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;\n","size_bytes":2546},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","size_bytes":3895},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\" +\n  \" hover-elevate active-elevate-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"bg-primary text-primary-foreground border border-primary-border\",\n        destructive:\n          \"bg-destructive text-destructive-foreground border border-destructive-border\",\n        outline:\n          // Shows the background color of whatever card / sidebar / accent background it is inside of.\n          // Inherits the current text color.\n          \" border [border-color:var(--button-outline)]  shadow-xs active:shadow-none \",\n        secondary: \"border bg-secondary text-secondary-foreground border border-secondary-border \",\n        // Add a transparent border so that when someone toggles a border on later, it doesn't shift layout/size.\n        ghost: \"border border-transparent\",\n      },\n      // Heights are set as \"min\" heights, because sometimes Ai will place large amount of content\n      // inside buttons. With a min-height they will look appropriate with small amounts of content,\n      // but will expand to fit large amounts of content.\n      size: {\n        default: \"min-h-9 px-4 py-2\",\n        sm: \"min-h-8 rounded-md px-3 text-xs\",\n        lg: \"min-h-10 rounded-md px-8\",\n        icon: \"h-9 w-9\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  },\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  },\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","size_bytes":2359},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","size_bytes":1883},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","size_bytes":1077},"client/src/pages/ai-controls.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Slider } from \"@/components/ui/slider\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport type { AiCommand, InsertAiCommand, Settings, InsertSettings } from \"@shared/schema\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { PlusIcon, TrashIcon, Sparkles } from \"lucide-react\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\n\nexport default function AiControls() {\n  const { toast } = useToast();\n  const [dialogOpen, setDialogOpen] = useState(false);\n  const [trigger, setTrigger] = useState(\"\");\n  const [prompt, setPrompt] = useState(\"\");\n  const [responseType, setResponseType] = useState(\"direct\");\n\n  // Groq AI Settings\n  const [aiModel, setAiModel] = useState(\"llama-3.3-70b-versatile\");\n  const [temperature, setTemperature] = useState([7]);\n  const [aiPersonality, setAiPersonality] = useState(\"Casual\");\n\n  const { data: commands = [], isLoading } = useQuery<AiCommand[]>({\n    queryKey: [\"/api/commands\"],\n  });\n\n  const { data: settings } = useQuery<Settings[]>({\n    queryKey: [\"/api/settings\"],\n  });\n\n  useEffect(() => {\n    if (settings && settings.length > 0) {\n      const setting = settings[0];\n      setAiModel(setting.dachipoolAiModel || \"llama-3.3-70b-versatile\");\n      setTemperature([setting.dachipoolAiTemp || 7]);\n      setAiPersonality(setting.aiPersonality || \"Casual\");\n    }\n  }, [settings]);\n\n  const createCommandMutation = useMutation({\n    mutationFn: (data: InsertAiCommand) => apiRequest(\"POST\", \"/api/commands\", data),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/commands\"] });\n      toast({\n        title: \"Command created\",\n        description: \"Your AI command has been created successfully.\",\n      });\n      setDialogOpen(false);\n      setTrigger(\"\");\n      setPrompt(\"\");\n      setResponseType(\"direct\");\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to create command. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const deleteCommandMutation = useMutation({\n    mutationFn: (id: string) => apiRequest(\"DELETE\", `/api/commands/${id}`, undefined),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/commands\"] });\n      toast({\n        title: \"Command deleted\",\n        description: \"The command has been removed.\",\n      });\n    },\n  });\n\n  const toggleCommandMutation = useMutation({\n    mutationFn: ({ id, enabled }: { id: string; enabled: boolean }) =>\n      apiRequest(\"PATCH\", `/api/commands/${id}`, { enabled }),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/commands\"] });\n    },\n  });\n\n  const updateAiSettingsMutation = useMutation({\n    mutationFn: (data: Partial<InsertSettings>) => \n      settings && settings.length > 0\n        ? apiRequest(\"PATCH\", `/api/settings/${settings[0].id}`, data)\n        : apiRequest(\"POST\", \"/api/settings\", data),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/settings\"] });\n      toast({\n        title: \"AI Settings saved\",\n        description: \"Your AI configuration has been updated.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to save AI settings. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleSaveAiSettings = () => {\n    updateAiSettingsMutation.mutate({\n      dachipoolAiModel: aiModel,\n      dachipoolAiTemp: temperature[0],\n      aiPersonality,\n    });\n  };\n\n  const handleCreateCommand = () => {\n    if (!trigger || !prompt) {\n      toast({\n        title: \"Missing fields\",\n        description: \"Please fill in all required fields.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    createCommandMutation.mutate({\n      trigger,\n      prompt,\n      responseType,\n      enabled: true,\n    });\n  };\n\n  const personalityDescriptions: Record<string, string> = {\n    Casual: \"Friendly and relaxed, like chatting with a friend\",\n    Comedy: \"Witty and humorous, always ready with a joke\",\n    Quirky: \"Unique and playful with unexpected responses\",\n    Serious: \"Professional and focused, straight to the point\",\n    Gaming: \"Energetic gamer vibes with gaming references\",\n    Professional: \"Polished and business-like communication\",\n  };\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      <div>\n        <h1 className=\"text-2xl font-bold text-foreground\" data-testid=\"page-title-ai-controls\">AI Controls</h1>\n        <p className=\"text-sm text-muted-foreground mt-1\">\n          Configure AI personality, model settings, and custom commands\n        </p>\n      </div>\n\n      <Card data-testid=\"card-ai-settings\">\n        <CardHeader>\n          <div className=\"flex items-center gap-2\">\n            <Sparkles className=\"h-5 w-5 text-primary\" />\n            <CardTitle className=\"text-lg font-semibold\">AI Configuration</CardTitle>\n          </div>\n          <CardDescription>\n            Customize how your AI assistant responds to chat\n          </CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-6\">\n          <div className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"personality\">AI Personality</Label>\n              <Select value={aiPersonality} onValueChange={setAiPersonality}>\n                <SelectTrigger id=\"personality\" data-testid=\"select-personality\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"Casual\"> Casual</SelectItem>\n                  <SelectItem value=\"Comedy\"> Comedy</SelectItem>\n                  <SelectItem value=\"Quirky\"> Quirky</SelectItem>\n                  <SelectItem value=\"Serious\"> Serious</SelectItem>\n                  <SelectItem value=\"Gaming\"> Gaming</SelectItem>\n                  <SelectItem value=\"Professional\"> Professional</SelectItem>\n                </SelectContent>\n              </Select>\n              <p className=\"text-xs text-muted-foreground\">\n                {personalityDescriptions[aiPersonality]}\n              </p>\n            </div>\n\n            <div className=\"grid md:grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"model\">Groq AI Model</Label>\n                <Select value={aiModel} onValueChange={setAiModel}>\n                  <SelectTrigger id=\"model\" data-testid=\"select-model\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"llama-3.3-70b-versatile\">Llama 3.3 70B (Best Quality)</SelectItem>\n                    <SelectItem value=\"llama-3.1-70b-versatile\">Llama 3.1 70B (Balanced)</SelectItem>\n                    <SelectItem value=\"mixtral-8x7b-32768\">Mixtral 8x7B (Long Context)</SelectItem>\n                    <SelectItem value=\"llama-3.1-8b-instant\">Llama 3.1 8B (Fastest)</SelectItem>\n                    <SelectItem value=\"gemma2-9b-it\">Gemma 2 9B (Efficient)</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"temperature\">Creativity: {(temperature[0] / 10).toFixed(1)}</Label>\n                <Slider\n                  id=\"temperature\"\n                  min={0}\n                  max={10}\n                  step={1}\n                  value={temperature}\n                  onValueChange={setTemperature}\n                  data-testid=\"slider-temperature\"\n                />\n                <div className=\"flex justify-between text-xs text-muted-foreground\">\n                  <span>Predictable</span>\n                  <span>Creative</span>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <div className=\"flex justify-end\">\n            <Button \n              onClick={handleSaveAiSettings}\n              disabled={updateAiSettingsMutation.isPending}\n              data-testid=\"button-save-ai-settings\"\n            >\n              {updateAiSettingsMutation.isPending ? \"Saving...\" : \"Save AI Settings\"}\n            </Button>\n          </div>\n        </CardContent>\n      </Card>\n\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h2 className=\"text-xl font-semibold\">Custom Commands</h2>\n          <p className=\"text-sm text-muted-foreground mt-1\">\n            Create AI commands triggered by chat messages\n          </p>\n        </div>\n        <Dialog open={dialogOpen} onOpenChange={setDialogOpen}>\n          <DialogTrigger asChild>\n            <Button data-testid=\"button-create-command\">\n              <PlusIcon className=\"h-4 w-4 mr-2\" />\n              New Command\n            </Button>\n          </DialogTrigger>\n          <DialogContent data-testid=\"dialog-create-command\">\n            <DialogHeader>\n              <DialogTitle>Create AI Command</DialogTitle>\n              <DialogDescription>\n                Add a new command that triggers AI responses in your chat\n              </DialogDescription>\n            </DialogHeader>\n            <div className=\"space-y-4\">\n              <div>\n                <Label htmlFor=\"trigger\">Trigger (e.g., !help)</Label>\n                <Input\n                  id=\"trigger\"\n                  value={trigger}\n                  onChange={(e) => setTrigger(e.target.value)}\n                  placeholder=\"!mycommand\"\n                  data-testid=\"input-trigger\"\n                />\n              </div>\n              <div>\n                <Label htmlFor=\"prompt\">AI Prompt</Label>\n                <Textarea\n                  id=\"prompt\"\n                  value={prompt}\n                  onChange={(e) => setPrompt(e.target.value)}\n                  placeholder=\"Describe what the AI should do...\"\n                  rows={3}\n                  data-testid=\"input-prompt\"\n                />\n              </div>\n              <div>\n                <Label htmlFor=\"responseType\">Response Type</Label>\n                <Select value={responseType} onValueChange={setResponseType}>\n                  <SelectTrigger id=\"responseType\" data-testid=\"select-response-type\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"direct\">Direct Response</SelectItem>\n                    <SelectItem value=\"analysis\">Analysis</SelectItem>\n                    <SelectItem value=\"generate\">Generate Content</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n            </div>\n            <DialogFooter>\n              <Button variant=\"outline\" onClick={() => setDialogOpen(false)} data-testid=\"button-cancel\">\n                Cancel\n              </Button>\n              <Button\n                onClick={handleCreateCommand}\n                disabled={createCommandMutation.isPending}\n                data-testid=\"button-save-command\"\n              >\n                {createCommandMutation.isPending ? \"Creating...\" : \"Create Command\"}\n              </Button>\n            </DialogFooter>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      <Card data-testid=\"card-commands\">\n        <CardHeader>\n          <CardTitle className=\"text-lg font-semibold\">Active Commands</CardTitle>\n        </CardHeader>\n        <CardContent>\n          {isLoading ? (\n            <div className=\"space-y-3\">\n              {[1, 2, 3].map((i) => (\n                <div key={i} className=\"h-16 bg-muted animate-pulse rounded-md\" />\n              ))}\n            </div>\n          ) : commands.length === 0 ? (\n            <div className=\"flex flex-col items-center justify-center py-12\">\n              <p className=\"text-sm text-muted-foreground\">No commands configured yet</p>\n              <p className=\"text-xs text-muted-foreground mt-1\">\n                Create your first AI command to get started\n              </p>\n            </div>\n          ) : (\n            <div className=\"space-y-3\">\n              {commands.map((command) => (\n                <div\n                  key={command.id}\n                  className=\"flex items-center justify-between p-4 rounded-md bg-card border border-card-border hover-elevate\"\n                  data-testid={`command-${command.id}`}\n                >\n                  <div className=\"flex-1 min-w-0\">\n                    <div className=\"flex items-center gap-3 flex-wrap\">\n                      <Badge variant=\"outline\" className=\"font-mono\" data-testid={`command-trigger-${command.id}`}>\n                        {command.trigger}\n                      </Badge>\n                      <Badge variant=\"secondary\" data-testid={`command-type-${command.id}`}>\n                        {command.responseType}\n                      </Badge>\n                      {command.usageCount > 0 && (\n                        <span className=\"text-xs text-muted-foreground\">\n                          Used {command.usageCount} times\n                        </span>\n                      )}\n                    </div>\n                    <p className=\"text-sm text-muted-foreground mt-2 line-clamp-2\">\n                      {command.prompt}\n                    </p>\n                  </div>\n                  <div className=\"flex items-center gap-3 ml-4\">\n                    <Switch\n                      checked={command.enabled}\n                      onCheckedChange={(enabled) =>\n                        toggleCommandMutation.mutate({ id: command.id, enabled })\n                      }\n                      data-testid={`switch-enabled-${command.id}`}\n                    />\n                    <Button\n                      size=\"icon\"\n                      variant=\"ghost\"\n                      onClick={() => deleteCommandMutation.mutate(command.id)}\n                      data-testid={`button-delete-${command.id}`}\n                    >\n                      <TrashIcon className=\"h-4 w-4\" />\n                    </Button>\n                  </div>\n                </div>\n              ))}\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":14846},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","size_bytes":7428},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","size_bytes":1753},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-9 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","size_bytes":5741},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","size_bytes":2751},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","size_bytes":756},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","size_bytes":1251},"client/src/pages/dachistream.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Label } from \"@/components/ui/label\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Slider } from \"@/components/ui/slider\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { useTextToSpeech } from \"@/hooks/use-text-to-speech\";\nimport { Volume2 } from \"lucide-react\";\n\ninterface Settings {\n  id: string;\n  twitchChannel: string;\n  autoModeration: boolean;\n  sentimentThreshold: number;\n  topicAllowlist: string[];\n  topicBlocklist: string[];\n  useDatabasePersonalization: boolean;\n  streamerVoiceOnlyMode: boolean;\n  dachiastreamSelectionStrategy: string;\n  dachiastreamAutoSendToChat: boolean;\n  dachiastreamCycleInterval: number;\n  dachipoolEnabled: boolean;\n  dachipoolMaxChars: number;\n  dachipoolEnergy: string;\n  dachipoolMode: string;\n  dachipoolShoutoutCooldownHours: number;\n  autoShoutoutsEnabled: boolean;\n  ttsEnabled: boolean;\n  ttsVoice: string | null;\n  ttsPitch: number;\n  ttsRate: number;\n  ttsVolume: number;\n}\n\nexport default function DachiStream() {\n  const { toast } = useToast();\n  const tts = useTextToSpeech();\n  \n  // DachiStream settings\n  const [topicAllowlist, setTopicAllowlist] = useState<string[]>([\"gaming\", \"anime\", \"chatting\"]);\n  const [topicBlocklist, setTopicBlocklist] = useState<string[]>([\"politics\", \"religion\"]);\n  const [useDatabasePersonalization, setUseDatabasePersonalization] = useState(true);\n  const [streamerVoiceOnlyMode, setStreamerVoiceOnlyMode] = useState(false);\n  const [dachiastreamSelectionStrategy, setDachiastreamSelectionStrategy] = useState(\"most_active\");\n  const [dachiastreamAutoSendToChat, setDachiastreamAutoSendToChat] = useState(false);\n  const [dachiastreamCycleInterval, setDachiastreamCycleInterval] = useState([15]);\n  \n  // DachiPool settings\n  const [dachipoolEnabled, setDachipoolEnabled] = useState(true);\n  const [dachipoolMaxChars, setDachipoolMaxChars] = useState([1000]);\n  const [dachipoolEnergy, setDachipoolEnergy] = useState(\"Balanced\");\n  const [dachipoolMode, setDachipoolMode] = useState(\"Auto\");\n  const [dachipoolShoutoutCooldownHours, setDachipoolShoutoutCooldownHours] = useState([24]);\n  const [autoShoutoutsEnabled, setAutoShoutoutsEnabled] = useState(true);\n  \n  // TTS settings\n  const [ttsEnabled, setTtsEnabled] = useState(false);\n  const [ttsVoice, setTtsVoice] = useState<string | null>(null);\n  const [ttsPitch, setTtsPitch] = useState([10]); // 5-20, divide by 10 for 0.5-2.0\n  const [ttsRate, setTtsRate] = useState([10]); // 5-20, divide by 10 for 0.5-2.0\n  const [ttsVolume, setTtsVolume] = useState([10]); // 0-10, divide by 10 for 0.0-1.0\n\n  const { data: settings } = useQuery<Settings[]>({\n    queryKey: [\"/api/settings\"],\n  });\n\n  useEffect(() => {\n    if (settings && settings.length > 0) {\n      const setting = settings[0];\n      setTopicAllowlist(setting.topicAllowlist || [\"gaming\", \"anime\", \"chatting\"]);\n      setTopicBlocklist(setting.topicBlocklist || [\"politics\", \"religion\"]);\n      setUseDatabasePersonalization(setting.useDatabasePersonalization ?? true);\n      setStreamerVoiceOnlyMode(setting.streamerVoiceOnlyMode ?? false);\n      setDachiastreamSelectionStrategy(setting.dachiastreamSelectionStrategy || \"most_active\");\n      setDachiastreamAutoSendToChat(setting.dachiastreamAutoSendToChat ?? false);\n      setDachiastreamCycleInterval([setting.dachiastreamCycleInterval || 15]);\n      \n      setDachipoolEnabled(setting.dachipoolEnabled ?? true);\n      setDachipoolMaxChars([setting.dachipoolMaxChars || 1000]);\n      setDachipoolEnergy(setting.dachipoolEnergy || \"Balanced\");\n      setDachipoolMode(setting.dachipoolMode || \"Auto\");\n      setDachipoolShoutoutCooldownHours([setting.dachipoolShoutoutCooldownHours || 24]);\n      setAutoShoutoutsEnabled(setting.autoShoutoutsEnabled ?? true);\n      \n      setTtsEnabled(setting.ttsEnabled ?? false);\n      setTtsVoice(setting.ttsVoice || null);\n      setTtsPitch([setting.ttsPitch || 10]);\n      setTtsRate([setting.ttsRate || 10]);\n      setTtsVolume([setting.ttsVolume || 10]);\n    }\n  }, [settings]);\n\n  const updateSettingsMutation = useMutation({\n    mutationFn: async (newSettings: Partial<Settings>) => {\n      if (!settings || settings.length === 0) {\n        throw new Error(\"No settings found\");\n      }\n      return await apiRequest(\"PATCH\", `/api/settings/${settings[0].id}`, newSettings);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/settings\"] });\n      toast({\n        title: \"Settings updated\",\n        description: \"StreamDachi AI settings have been saved successfully.\",\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Error\",\n        description: `Failed to update settings: ${error.message}`,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleSave = () => {\n    updateSettingsMutation.mutate({\n      topicAllowlist,\n      topicBlocklist,\n      useDatabasePersonalization,\n      streamerVoiceOnlyMode,\n      dachiastreamSelectionStrategy,\n      dachiastreamAutoSendToChat,\n      dachiastreamCycleInterval: dachiastreamCycleInterval[0],\n      dachipoolEnabled,\n      dachipoolMaxChars: dachipoolMaxChars[0],\n      dachipoolEnergy,\n      dachipoolMode,\n      dachipoolShoutoutCooldownHours: dachipoolShoutoutCooldownHours[0],\n      autoShoutoutsEnabled,\n      ttsEnabled,\n      ttsVoice,\n      ttsPitch: ttsPitch[0],\n      ttsRate: ttsRate[0],\n      ttsVolume: ttsVolume[0],\n    });\n  };\n\n  const handleTestTTS = () => {\n    tts.updateSettings({\n      enabled: true,\n      voice: ttsVoice,\n      pitch: ttsPitch[0] / 10,\n      rate: ttsRate[0] / 10,\n      volume: ttsVolume[0] / 10,\n    });\n    tts.speak(\"Welcome to StreamDachi! This is a test of the text to speech system.\");\n    toast({\n      title: \"Testing TTS\",\n      description: \"Playing test message...\",\n    });\n  };\n\n  return (\n    <div className=\"space-y-6 p-6\">\n      <div>\n        <h1 className=\"text-3xl font-bold text-foreground\" data-testid=\"text-page-title\">StreamDachi AI</h1>\n        <p className=\"text-muted-foreground mt-2\">\n          Configure how StreamDachi AI interacts with your Twitch chat stream\n        </p>\n      </div>\n\n      <Card data-testid=\"card-dachistream-controls\">\n        <CardHeader>\n          <CardTitle className=\"text-lg font-semibold\">Message Selection</CardTitle>\n          <CardDescription>Configure how the AI chooses which messages to respond to</CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-6\">\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"selection-strategy\">Selection Strategy</Label>\n            <Select value={dachiastreamSelectionStrategy} onValueChange={setDachiastreamSelectionStrategy}>\n              <SelectTrigger id=\"selection-strategy\" data-testid=\"select-selection-strategy\">\n                <SelectValue placeholder=\"Select strategy\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"most_active\">Most Active</SelectItem>\n                <SelectItem value=\"random\">Random</SelectItem>\n                <SelectItem value=\"new_chatter\">New Chatter</SelectItem>\n              </SelectContent>\n            </Select>\n            <p className=\"text-xs text-muted-foreground\">\n              How the AI chooses which messages to respond to\n            </p>\n          </div>\n\n          <div className=\"p-4 bg-muted rounded-md\">\n            <p className=\"text-sm text-foreground\">\n              StreamDachi AI operates on a configurable cycle, analyzing chat activity and selecting messages based on your chosen strategy. The AI will engage naturally while respecting cooldowns and topic filters.\n            </p>\n          </div>\n        </CardContent>\n      </Card>\n\n      <Card data-testid=\"card-response-modes\">\n        <CardHeader>\n          <CardTitle className=\"text-lg font-semibold\">Response Modes</CardTitle>\n          <CardDescription>Control who the AI responds to and how it learns</CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-6\">\n          <div className=\"grid gap-6 md:grid-cols-2\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"space-y-0.5\">\n                <Label htmlFor=\"database-personalization\">Database Personalization</Label>\n                <p className=\"text-xs text-muted-foreground\">\n                  Use AI-learned user personalities\n                </p>\n              </div>\n              <Switch\n                id=\"database-personalization\"\n                checked={useDatabasePersonalization}\n                onCheckedChange={setUseDatabasePersonalization}\n                data-testid=\"switch-database-personalization\"\n              />\n            </div>\n\n            <div className=\"flex items-center justify-between\">\n              <div className=\"space-y-0.5\">\n                <Label htmlFor=\"streamer-voice-only\">Streamer Voice-Only Mode</Label>\n                <p className=\"text-xs text-muted-foreground\">\n                  Only respond to streamer messages\n                </p>\n              </div>\n              <Switch\n                id=\"streamer-voice-only\"\n                checked={streamerVoiceOnlyMode}\n                onCheckedChange={setStreamerVoiceOnlyMode}\n                data-testid=\"switch-streamer-voice-only\"\n              />\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      <Card data-testid=\"card-topic-filters\">\n        <CardHeader>\n          <CardTitle className=\"text-lg font-semibold\">Topic Filters</CardTitle>\n          <CardDescription>Control what topics the AI can discuss</CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-6\">\n          <div className=\"grid gap-6 md:grid-cols-2\">\n            <div className=\"space-y-2\">\n              <Label>Allowed Topics</Label>\n              <div className=\"text-sm text-foreground p-3 bg-muted rounded-md\" data-testid=\"text-allowed-topics\">\n                {topicAllowlist.join(\", \")}\n              </div>\n              <p className=\"text-xs text-muted-foreground\">\n                Topics the AI can engage with\n              </p>\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label>Blocked Topics</Label>\n              <div className=\"text-sm text-foreground p-3 bg-muted rounded-md\" data-testid=\"text-blocked-topics\">\n                {topicBlocklist.join(\", \")}\n              </div>\n              <p className=\"text-xs text-muted-foreground\">\n                Topics the AI will avoid\n              </p>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      <Card data-testid=\"card-general-config\">\n        <CardHeader>\n          <CardTitle className=\"text-lg font-semibold\">General Configuration</CardTitle>\n          <CardDescription>Core AI behavior settings</CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-6\">\n          <div className=\"grid gap-6 md:grid-cols-2\">\n            <div className=\"space-y-6\">\n              <div className=\"flex items-center justify-between\">\n                <div className=\"space-y-0.5\">\n                  <Label htmlFor=\"dachipool-enabled\">Enable StreamDachi AI</Label>\n                  <p className=\"text-xs text-muted-foreground\">\n                    Activate enhanced AI features\n                  </p>\n                </div>\n                <Switch\n                  id=\"dachipool-enabled\"\n                  checked={dachipoolEnabled}\n                  onCheckedChange={setDachipoolEnabled}\n                  data-testid=\"switch-dachipool-enabled\"\n                />\n              </div>\n\n              <div className=\"flex items-center justify-between\">\n                <div className=\"space-y-0.5\">\n                  <Label htmlFor=\"auto-send-chat\">Auto-Send to Chat</Label>\n                  <p className=\"text-xs text-muted-foreground\">\n                    Send AI responses to Twitch chat\n                  </p>\n                </div>\n                <Switch\n                  id=\"auto-send-chat\"\n                  checked={dachiastreamAutoSendToChat}\n                  onCheckedChange={setDachiastreamAutoSendToChat}\n                  data-testid=\"switch-auto-send-chat\"\n                />\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"energy\">Energy Level</Label>\n                <Select value={dachipoolEnergy} onValueChange={setDachipoolEnergy}>\n                  <SelectTrigger id=\"energy\" data-testid=\"select-energy\">\n                    <SelectValue placeholder=\"Select energy level\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"Low\">Low</SelectItem>\n                    <SelectItem value=\"Balanced\">Balanced</SelectItem>\n                    <SelectItem value=\"High\">High</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"mode\">Mode</Label>\n                <Select value={dachipoolMode} onValueChange={setDachipoolMode}>\n                  <SelectTrigger id=\"mode\" data-testid=\"select-mode\">\n                    <SelectValue placeholder=\"Select mode\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"Auto\">Auto</SelectItem>\n                    <SelectItem value=\"Manual\">Manual</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n            </div>\n\n            <div className=\"space-y-6\">\n              <div className=\"space-y-2\">\n                <div className=\"flex justify-between\">\n                  <Label>Cycle Interval</Label>\n                  <span className=\"text-sm text-muted-foreground\" data-testid=\"text-cycle-interval-value\">\n                    {dachiastreamCycleInterval[0]}s\n                  </span>\n                </div>\n                <Slider\n                  value={dachiastreamCycleInterval}\n                  onValueChange={setDachiastreamCycleInterval}\n                  min={5}\n                  max={60}\n                  step={5}\n                  data-testid=\"slider-cycle-interval\"\n                />\n                <p className=\"text-xs text-muted-foreground\">\n                  Seconds between StreamDachi AI message collection cycles\n                </p>\n              </div>\n\n              <div className=\"space-y-2\">\n                <div className=\"flex justify-between\">\n                  <Label>Max Characters</Label>\n                  <span className=\"text-sm text-muted-foreground\" data-testid=\"text-max-chars-value\">\n                    {dachipoolMaxChars[0]}\n                  </span>\n                </div>\n                <Slider\n                  value={dachipoolMaxChars}\n                  onValueChange={setDachipoolMaxChars}\n                  min={100}\n                  max={2000}\n                  step={100}\n                  data-testid=\"slider-max-chars\"\n                />\n                <p className=\"text-xs text-muted-foreground\">\n                  Maximum length for AI responses\n                </p>\n              </div>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      <Card data-testid=\"card-shoutouts-tts\">\n        <CardHeader>\n          <CardTitle className=\"text-lg font-semibold\">Shoutouts & Text-to-Speech</CardTitle>\n          <CardDescription>Configure automatic greetings and voice synthesis</CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-6\">\n          <div className=\"grid gap-6 md:grid-cols-2\">\n            <div className=\"space-y-6\">\n              <div className=\"flex items-center justify-between\">\n                <div className=\"space-y-0.5\">\n                  <Label htmlFor=\"auto-shoutouts\">Auto Shoutouts</Label>\n                  <p className=\"text-xs text-muted-foreground\">\n                    Greet VIPs automatically\n                  </p>\n                </div>\n                <Switch\n                  id=\"auto-shoutouts\"\n                  checked={autoShoutoutsEnabled}\n                  onCheckedChange={setAutoShoutoutsEnabled}\n                  data-testid=\"switch-auto-shoutouts\"\n                />\n              </div>\n            </div>\n\n            <div className=\"space-y-6\">\n              <div className=\"space-y-2\">\n                <div className=\"flex justify-between\">\n                  <Label>Shoutout Cooldown (hours)</Label>\n                  <span className=\"text-sm text-muted-foreground\" data-testid=\"text-cooldown-value\">\n                    {dachipoolShoutoutCooldownHours[0]}h\n                  </span>\n                </div>\n                <Slider\n                  value={dachipoolShoutoutCooldownHours}\n                  onValueChange={setDachipoolShoutoutCooldownHours}\n                  min={1}\n                  max={168}\n                  step={1}\n                  data-testid=\"slider-shoutout-cooldown\"\n                />\n                <p className=\"text-xs text-muted-foreground\">\n                  Time between automatic greetings for VIPs\n                </p>\n              </div>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      <Card data-testid=\"card-web-speech-tts\">\n        <CardHeader>\n          <CardTitle className=\"text-lg font-semibold\">Web Speech API TTS (Free)</CardTitle>\n          <CardDescription>Browser-native text-to-speech with no API costs</CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-6\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"space-y-0.5\">\n              <Label htmlFor=\"tts-enabled\">Enable TTS</Label>\n              <p className=\"text-xs text-muted-foreground\">\n                Use browser-native voice synthesis for shoutouts\n              </p>\n            </div>\n            <Switch\n              id=\"tts-enabled\"\n              checked={ttsEnabled}\n              onCheckedChange={setTtsEnabled}\n              data-testid=\"switch-tts-enabled\"\n            />\n          </div>\n\n          {ttsEnabled && (\n            <>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"tts-voice\">Voice</Label>\n                <Select value={ttsVoice || \"\"} onValueChange={setTtsVoice}>\n                  <SelectTrigger id=\"tts-voice\" data-testid=\"select-tts-voice\">\n                    <SelectValue placeholder=\"Select a voice\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {tts.voices.map((voice) => (\n                      <SelectItem key={voice.name} value={voice.name}>\n                        {voice.name} ({voice.lang})\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n                <p className=\"text-xs text-muted-foreground\">\n                  Available voices from your operating system\n                </p>\n              </div>\n\n              <div className=\"grid gap-6 md:grid-cols-3\">\n                <div className=\"space-y-2\">\n                  <div className=\"flex justify-between\">\n                    <Label>Pitch</Label>\n                    <span className=\"text-sm text-muted-foreground\" data-testid=\"text-pitch-value\">\n                      {(ttsPitch[0] / 10).toFixed(1)}x\n                    </span>\n                  </div>\n                  <Slider\n                    value={ttsPitch}\n                    onValueChange={setTtsPitch}\n                    min={5}\n                    max={20}\n                    step={1}\n                    data-testid=\"slider-tts-pitch\"\n                  />\n                </div>\n\n                <div className=\"space-y-2\">\n                  <div className=\"flex justify-between\">\n                    <Label>Speed</Label>\n                    <span className=\"text-sm text-muted-foreground\" data-testid=\"text-rate-value\">\n                      {(ttsRate[0] / 10).toFixed(1)}x\n                    </span>\n                  </div>\n                  <Slider\n                    value={ttsRate}\n                    onValueChange={setTtsRate}\n                    min={5}\n                    max={20}\n                    step={1}\n                    data-testid=\"slider-tts-rate\"\n                  />\n                </div>\n\n                <div className=\"space-y-2\">\n                  <div className=\"flex justify-between\">\n                    <Label>Volume</Label>\n                    <span className=\"text-sm text-muted-foreground\" data-testid=\"text-volume-value\">\n                      {(ttsVolume[0] * 10)}%\n                    </span>\n                  </div>\n                  <Slider\n                    value={ttsVolume}\n                    onValueChange={setTtsVolume}\n                    min={0}\n                    max={10}\n                    step={1}\n                    data-testid=\"slider-tts-volume\"\n                  />\n                </div>\n              </div>\n\n              <div className=\"flex justify-end\">\n                <Button\n                  variant=\"outline\"\n                  onClick={handleTestTTS}\n                  disabled={tts.isSpeaking}\n                  data-testid=\"button-test-tts\"\n                >\n                  <Volume2 className=\"w-4 h-4 mr-2\" />\n                  {tts.isSpeaking ? \"Playing...\" : \"Test Voice\"}\n                </Button>\n              </div>\n\n              <div className=\"p-4 bg-muted/50 rounded-md border border-border\">\n                <p className=\"text-sm text-foreground\">\n                  Web Speech API uses your operating system's built-in voices. Quality and selection varies by platform. Works best in Chrome and Edge browsers.\n                </p>\n              </div>\n            </>\n          )}\n        </CardContent>\n      </Card>\n\n      <Card data-testid=\"card-message-priority\">\n        <CardHeader>\n          <CardTitle className=\"text-lg font-semibold\">Message Priority System</CardTitle>\n          <CardDescription>Configure which types of messages get priority for AI responses</CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div className=\"space-y-3\">\n            <div className=\"flex items-center gap-3 p-3 bg-muted rounded-md\">\n              <Badge variant=\"secondary\" className=\"min-w-12 justify-center\">1st</Badge>\n              <div className=\"flex-1\">\n                <p className=\"text-sm font-medium text-foreground\">Moderators & Mods</p>\n                <p className=\"text-xs text-muted-foreground\">Highest priority - Staff and channel moderators</p>\n              </div>\n            </div>\n\n            <div className=\"flex items-center gap-3 p-3 bg-muted rounded-md\">\n              <Badge variant=\"secondary\" className=\"min-w-12 justify-center\">2nd</Badge>\n              <div className=\"flex-1\">\n                <p className=\"text-sm font-medium text-foreground\">Raids</p>\n                <p className=\"text-xs text-muted-foreground\">Raiding viewers and raid events</p>\n              </div>\n            </div>\n\n            <div className=\"flex items-center gap-3 p-3 bg-muted rounded-md\">\n              <Badge variant=\"secondary\" className=\"min-w-12 justify-center\">3rd</Badge>\n              <div className=\"flex-1\">\n                <p className=\"text-sm font-medium text-foreground\">VIP Members</p>\n                <p className=\"text-xs text-muted-foreground\">Users with VIP badge or artist badge</p>\n              </div>\n            </div>\n\n            <div className=\"flex items-center gap-3 p-3 bg-muted rounded-md\">\n              <Badge variant=\"secondary\" className=\"min-w-12 justify-center\">4th</Badge>\n              <div className=\"flex-1\">\n                <p className=\"text-sm font-medium text-foreground\">Subscribers & Bit Users</p>\n                <p className=\"text-xs text-muted-foreground\">Subscription-based or bit-based messages</p>\n              </div>\n            </div>\n\n            <div className=\"flex items-center gap-3 p-3 bg-muted rounded-md\">\n              <Badge variant=\"secondary\" className=\"min-w-12 justify-center\">5th</Badge>\n              <div className=\"flex-1\">\n                <p className=\"text-sm font-medium text-foreground\">Regular Viewers</p>\n                <p className=\"text-xs text-muted-foreground\">Standard chat messages and redeems</p>\n              </div>\n            </div>\n          </div>\n\n          <div className=\"p-4 bg-muted/50 rounded-md border border-border\">\n            <p className=\"text-sm text-foreground\">\n              The AI will prioritize responding to messages based on this hierarchy. When multiple messages arrive within the 15-second cycle, higher priority messages are selected first.\n            </p>\n          </div>\n        </CardContent>\n      </Card>\n\n      <div className=\"flex justify-end\">\n        <Button\n          onClick={handleSave}\n          disabled={updateSettingsMutation.isPending}\n          data-testid=\"button-save-settings\"\n        >\n          {updateSettingsMutation.isPending ? \"Saving...\" : \"Save Settings\"}\n        </Button>\n      </div>\n    </div>\n  );\n}\n","size_bytes":25525},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","size_bytes":4885},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","size_bytes":325},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","size_bytes":6210},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","size_bytes":261},"design_guidelines.md":{"content":"# Design Guidelines: Twitch + OpenAI Integration Dashboard\n\n## Design Approach\n\n**Selected Approach:** Design System (Material Design + Twitch Aesthetic)\n\n**Justification:** This is a utility-focused, information-dense application requiring real-time data visualization, chat monitoring, and analytics. Drawing from Material Design for component consistency and Twitch's brand aesthetic for familiarity.\n\n**Key References:**\n- Twitch Creator Dashboard (dark theme, purple accents)\n- Discord (chat interface patterns)\n- Linear (clean data tables, modern inputs)\n- Streamlabs OBS (streaming tool UX patterns)\n\n## Core Design Principles\n\n1. **Real-time Clarity:** Information updates must be instantly visible without disrupting focus\n2. **Scan-ability:** Chat messages and analytics should be quickly parsable\n3. **Action Hierarchy:** Moderation and AI controls prominently accessible\n4. **Dark-First:** Optimized for extended viewing sessions\n\n## Color Palette\n\n### Dark Mode (Primary)\n- **Background Base:** 218 25% 8%\n- **Background Elevated:** 218 20% 12%\n- **Background Panel:** 218 18% 15%\n- **Twitch Purple Primary:** 265 100% 70%\n- **Twitch Purple Hover:** 265 100% 75%\n- **AI Accent (Green):** 142 70% 50%\n- **Warning/Moderation (Amber):** 38 92% 50%\n- **Danger/Block (Red):** 0 84% 60%\n\n### Text Colors\n- **Primary Text:** 0 0% 95%\n- **Secondary Text:** 0 0% 70%\n- **Muted/Timestamps:** 0 0% 50%\n- **Success Messages:** 142 70% 60%\n\n## Typography\n\n**Font Families:**\n- Primary: \"Inter\" (Google Fonts) - UI elements, labels, chat\n- Monospace: \"Roboto Mono\" (Google Fonts) - timestamps, usernames, data values\n\n**Text Hierarchy:**\n- Page Titles: text-2xl font-bold (24px)\n- Section Headers: text-lg font-semibold (18px)\n- Body/Chat: text-sm (14px)\n- Labels/Meta: text-xs (12px)\n- Timestamps: text-xs font-mono\n\n## Layout System\n\n**Spacing Primitives:** Tailwind units of 2, 3, 4, 6, 8\n- Component padding: p-4, p-6\n- Section gaps: gap-4, gap-6\n- Card spacing: space-y-4\n- Tight grouping: gap-2, gap-3\n\n**Grid Structure:**\n- Main layout: Sidebar (240px fixed) + Content (flex-1)\n- Dashboard cards: grid-cols-1 lg:grid-cols-2 xl:grid-cols-3\n- Chat + Details: 2:1 ratio split on desktop, stacked mobile\n\n## Component Library\n\n### Navigation\n- **Fixed Sidebar (Left):** 240px width, background elevated\n  - Logo/App name at top (p-6)\n  - Navigation items with icons (Heroicons)\n  - Active state: purple background, full width\n  - Sections: Dashboard, Live Chat, Analytics, AI Controls, Settings\n\n### Live Chat Interface\n- **Message Stream Container:** Background panel, rounded-lg, max height with scroll\n- **Individual Messages:** \n  - Horizontal layout: Avatar (8x8) + Username (purple/colored) + Message + Timestamp\n  - Padding: px-4 py-2\n  - Hover: subtle background highlight\n  - AI-analyzed messages: Left border (2px) in green/amber/red based on sentiment\n- **Chat Input:** Fixed bottom bar with send button and AI toggle\n\n### Dashboard Cards\n- **Card Container:** Background elevated, rounded-lg, p-6, border border-white/5\n- **Card Header:** Flex justify-between with title + action icon\n- **Stat Cards:** Large number (text-3xl font-bold) + label + trend indicator\n- **Metrics:** \n  - Messages/minute counter\n  - AI interactions count\n  - Moderation actions\n  - Active users\n\n### AI Interaction Panel\n- **Command List:** Table showing trigger commands, response types, usage count\n- **Live Analysis Feed:** Real-time sentiment scores, toxicity detection results\n- **Configuration Toggles:** Auto-moderation switches, threshold sliders\n\n### Data Tables\n- **Headers:** Background panel, sticky top, text-xs uppercase tracking-wide\n- **Rows:** Hover state, alternating subtle background\n- **Cells:** py-3 px-4, consistent alignment\n- **Actions:** Icon buttons (edit, delete) revealed on row hover\n\n### Forms & Controls\n- **Input Fields:** Background base, border border-white/10, rounded-md, px-4 py-2.5\n- **Focus State:** Ring-2 ring-purple-500\n- **Select Dropdowns:** Consistent height, chevron icon\n- **Switches/Toggles:** Purple when active, gray when inactive\n- **Range Sliders:** Purple track with white thumb\n\n### Modals & Overlays\n- **Backdrop:** bg-black/70 backdrop-blur-sm\n- **Modal Content:** Background elevated, rounded-lg, shadow-2xl, max-w-2xl\n- **Modal Header:** Border-b with close button\n- **Modal Actions:** Right-aligned button group in footer\n\n### Status Indicators\n- **Online/Active:** Green dot (h-2 w-2)\n- **AI Processing:** Pulsing purple dot\n- **Warning State:** Amber border-l-4\n- **Error/Blocked:** Red background with white text\n\n### Buttons\n- **Primary (Purple):** Full background, white text, hover brightens\n- **Secondary:** Border outline, purple text\n- **Danger:** Red background\n- **Icon Only:** Rounded-md p-2, hover background\n\n## Real-Time Elements\n\n### Animation Strategy (Minimal)\n- **Message Arrival:** Subtle fade-in (200ms) only\n- **AI Analysis Badge:** Gentle pulse on completion\n- **Live Counters:** Number transitions (not animated)\n- **NO continuous animations** - preserves performance\n\n### Live Data Updates\n- **Update Indicators:** Small purple dot appears briefly when data refreshes\n- **Scroll Behavior:** Chat auto-scrolls only if user at bottom\n- **Timestamp Format:** Relative time (2m ago) updating every minute\n\n## Iconography\n\n**Icon Library:** Heroicons (outline for navigation, solid for actions)\n\n**Key Icons:**\n- Dashboard: chart-bar\n- Chat: chat-bubble-left-right\n- AI: sparkles / cpu-chip\n- Analytics: presentation-chart-line\n- Settings: cog-6-tooth\n- Moderation: shield-check / shield-exclamation\n\n## Accessibility Notes\n\n- Maintain WCAG AA contrast ratios throughout dark theme\n- All interactive elements have visible focus states (ring-2)\n- Form inputs have associated labels\n- Real-time updates announced to screen readers\n- Chat messages have semantic HTML structure\n\n## Images\n\n**No hero images required** - This is a dashboard application focused on data display and real-time functionality, not marketing content.","size_bytes":5995},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"shadcn-card rounded-xl border bg-card border-card-border text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n));\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n));\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n));\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\nexport {\n  Card,\n  CardHeader,\n  CardFooter,\n  CardTitle,\n  CardDescription,\n  CardContent,\n}\n","size_bytes":1904},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","size_bytes":4845},"client/src/pages/vip-management.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Avatar, AvatarImage, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription } from \"@/components/ui/dialog\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Label } from \"@/components/ui/label\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { Shield, Trash2, Plus, Clock, Loader2, Eye, Copy, CheckCircle, Video } from \"lucide-react\";\nimport type { UserProfile } from \"@shared/schema\";\n\ninterface TwitchSearchUser {\n  id: string;\n  login: string;\n  display_name: string;\n  profile_image_url: string;\n}\n\nexport default function VIPManagement() {\n  const { toast } = useToast();\n  const [newUsername, setNewUsername] = useState(\"\");\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [showSuggestions, setShowSuggestions] = useState(false);\n  const [browserSourceUrl, setBrowserSourceUrl] = useState(\"\");\n  const [copied, setCopied] = useState(false);\n  const [testShoutoutUser, setTestShoutoutUser] = useState<UserProfile | null>(null);\n  const [testClip, setTestClip] = useState<{ url: string; title: string } | null>(null);\n  const dropdownRef = useRef<HTMLDivElement>(null);\n  const inputRef = useRef<HTMLInputElement>(null);\n\n  interface EnhancedVIP extends UserProfile {\n    profileImageUrl?: string | null;\n    followerCount?: number;\n    isLive?: boolean;\n    viewerCount?: number;\n    game?: string;\n  }\n\n  const { data: vips = [], isLoading } = useQuery<EnhancedVIP[]>({\n    queryKey: [\"/api/users/vips/enhanced\"],\n    refetchInterval: 60000, // Refresh every minute to update live status\n  });\n\n  const { data: settings } = useQuery({\n    queryKey: [\"/api/settings\"],\n  });\n\n  const { data: suggestions = [], isLoading: isSearching } = useQuery<TwitchSearchUser[]>({\n    queryKey: [`/api/twitch/search-users?query=${searchQuery}`],\n    enabled: searchQuery.length > 1,\n  });\n\n  useEffect(() => {\n    const timer = setTimeout(() => {\n      setSearchQuery(newUsername);\n      if (newUsername.length > 1) {\n        setShowSuggestions(true);\n      } else {\n        setShowSuggestions(false);\n      }\n    }, 300);\n    return () => clearTimeout(timer);\n  }, [newUsername]);\n\n  useEffect(() => {\n    const handleClickOutside = (event: MouseEvent) => {\n      if (dropdownRef.current && !dropdownRef.current.contains(event.target as Node)) {\n        setShowSuggestions(false);\n      }\n    };\n    document.addEventListener(\"mousedown\", handleClickOutside);\n    return () => document.removeEventListener(\"mousedown\", handleClickOutside);\n  }, []);\n\n  const toggleVipMutation = useMutation({\n    mutationFn: async ({ userId, isVip }: { userId: string; isVip: boolean }) => {\n      return await apiRequest(\"PATCH\", `/api/users/${userId}/vip`, { isVip });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/users/vips\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/users\"] });\n      toast({\n        title: \"VIP Status Updated\",\n        description: \"User VIP status has been changed successfully.\",\n      });\n    },\n  });\n\n  const addVipMutation = useMutation({\n    mutationFn: async (username: string) => {\n      const response = await fetch(\"/api/users\");\n      const users: UserProfile[] = await response.json();\n      const existingUser = users.find(u => u.username.toLowerCase() === username.toLowerCase());\n      \n      if (existingUser) {\n        const res = await apiRequest(\"PATCH\", `/api/users/${existingUser.userId}/vip`, { isVip: true });\n        return await res.json();\n      } else {\n        const userRes = await apiRequest(\"POST\", \"/api/users\", {\n          userId: `manual_${username}_${Date.now()}`,\n          username,\n          isVip: true,\n          isMod: false,\n          isSubscriber: false,\n          wasAnonymous: false,\n        });\n        const newUser: UserProfile = await userRes.json();\n        const vipRes = await apiRequest(\"PATCH\", `/api/users/${newUser.userId}/vip`, { isVip: true });\n        return await vipRes.json();\n      }\n    },\n    onSuccess: () => {\n      setNewUsername(\"\");\n      queryClient.invalidateQueries({ queryKey: [\"/api/users/vips\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/users\"] });\n      toast({\n        title: \"VIP Added\",\n        description: \"User has been added to VIP list.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to add VIP user.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleSelectUser = (username: string) => {\n    setNewUsername(username);\n    setShowSuggestions(false);\n    if (inputRef.current) {\n      inputRef.current.focus();\n    }\n  };\n\n  const handleAddVip = () => {\n    if (newUsername.trim()) {\n      addVipMutation.mutate(newUsername.trim());\n      setShowSuggestions(false);\n    }\n  };\n\n  const handleKeyDown = (e: React.KeyboardEvent<HTMLInputElement>) => {\n    if (e.key === \"Enter\") {\n      e.preventDefault();\n      if (suggestions.length > 0 && showSuggestions) {\n        handleSelectUser(suggestions[0].login);\n      } else if (newUsername.trim()) {\n        handleAddVip();\n      }\n    } else if (e.key === \"Escape\") {\n      setShowSuggestions(false);\n    } else if (e.key === \"ArrowDown\" && suggestions.length > 0) {\n      e.preventDefault();\n      setShowSuggestions(true);\n    }\n  };\n\n  const handleRemoveVip = (userId: string) => {\n    toggleVipMutation.mutate({ userId, isVip: false });\n  };\n\n  const getTimeSinceShoutout = (shoutoutDate: string | null) => {\n    if (!shoutoutDate) return \"Never\";\n    \n    const now = new Date().getTime();\n    const lastShoutout = new Date(shoutoutDate).getTime();\n    const diffMs = now - lastShoutout;\n    const diffHours = Math.floor(diffMs / (1000 * 60 * 60));\n    const diffDays = Math.floor(diffHours / 24);\n    \n    if (diffDays > 0) return `${diffDays}d ago`;\n    if (diffHours > 0) return `${diffHours}h ago`;\n    return \"Recently\";\n  };\n\n  const getCooldownStatus = (shoutoutDate: string | null, cooldownHours: number) => {\n    if (!shoutoutDate) return \"Ready\";\n    \n    const now = new Date().getTime();\n    const lastShoutout = new Date(shoutoutDate).getTime();\n    const cooldownMs = cooldownHours * 60 * 60 * 1000;\n    const timeLeft = cooldownMs - (now - lastShoutout);\n    \n    if (timeLeft <= 0) return \"Ready\";\n    \n    const hoursLeft = Math.ceil(timeLeft / (1000 * 60 * 60));\n    return `${hoursLeft}h cooldown`;\n  };\n\n  const settingsArray = Array.isArray(settings) ? settings : [];\n  const autoShoutoutsEnabled = settingsArray[0]?.autoShoutoutsEnabled;\n  const cooldownHours = settingsArray[0]?.dachipoolShoutoutCooldownHours || 24;\n  const browserSourceEnabled = settingsArray[0]?.browserSourceEnabled || false;\n  const browserSourceToken = settingsArray[0]?.browserSourceToken;\n\n  const generateBrowserSourceMutation = useMutation({\n    mutationFn: async () => {\n      const response = await apiRequest(\"POST\", \"/api/browser-source/generate\", {});\n      return await response.json();\n    },\n    onSuccess: (data: { url: string }) => {\n      setBrowserSourceUrl(data.url);\n      queryClient.invalidateQueries({ queryKey: [\"/api/settings\"] });\n      toast({\n        title: \"Browser Source URL Generated\",\n        description: \"Copy the URL and add it as a Browser Source in OBS.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to generate browser source URL.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const toggleBrowserSourceMutation = useMutation({\n    mutationFn: async (enabled: boolean) => {\n      return await apiRequest(\"POST\", \"/api/browser-source/toggle\", { enabled });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/settings\"] });\n      toast({\n        title: browserSourceEnabled ? \"Browser Source Disabled\" : \"Browser Source Enabled\",\n        description: browserSourceEnabled \n          ? \"Shoutouts will no longer appear in OBS.\" \n          : \"Shoutouts will now appear in OBS when the browser source is active.\",\n      });\n    },\n  });\n\n  const testShoutoutMutation = useMutation({\n    mutationFn: async (username: string) => {\n      const response = await apiRequest(\"GET\", `/api/twitch/user-clip?username=${username}`, undefined);\n      return await response.json();\n    },\n    onSuccess: (data: { clip: { url: string; title: string } | null }) => {\n      if (data.clip) {\n        setTestClip(data.clip);\n      } else {\n        toast({\n          title: \"No Clips Found\",\n          description: `${testShoutoutUser?.username} doesn't have any public clips yet.`,\n          variant: \"destructive\",\n        });\n        setTestShoutoutUser(null);\n      }\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to fetch test clip.\",\n        variant: \"destructive\",\n      });\n      setTestShoutoutUser(null);\n    },\n  });\n\n  const handleTestShoutout = (vip: UserProfile) => {\n    setTestShoutoutUser(vip);\n    setTestClip(null);\n    testShoutoutMutation.mutate(vip.username);\n  };\n\n  const copyToClipboard = () => {\n    if (browserSourceUrl) {\n      navigator.clipboard.writeText(browserSourceUrl);\n      setCopied(true);\n      toast({\n        title: \"URL Copied!\",\n        description: \"Browser source URL copied to clipboard.\",\n      });\n      setTimeout(() => setCopied(false), 2000);\n    }\n  };\n\n  const updateCooldownMutation = useMutation({\n    mutationFn: async (hours: number) => {\n      const settingId = settingsArray[0]?.id;\n      if (!settingId) {\n        throw new Error(\"Settings not found\");\n      }\n      return await apiRequest(\"PATCH\", `/api/settings/${settingId}`, {\n        dachipoolShoutoutCooldownHours: hours,\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/settings\"] });\n      toast({\n        title: \"Cooldown Updated\",\n        description: \"Shoutout cooldown has been changed successfully.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to update cooldown settings.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  useEffect(() => {\n    if (browserSourceToken) {\n      const domain = window.location.host;\n      const protocol = window.location.protocol;\n      setBrowserSourceUrl(`${protocol}//${domain}/browser-source/${browserSourceToken}`);\n    }\n  }, [browserSourceToken]);\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      <div>\n        <h1 className=\"text-3xl font-bold mb-2\" data-testid=\"text-page-title\">VIP Shout-Out Management</h1>\n        <p className=\"text-muted-foreground\" data-testid=\"text-page-description\">\n          Manage VIP users who receive automatic shoutouts when they interact in chat.\n        </p>\n      </div>\n\n      <Card>\n        <CardHeader>\n          <CardTitle>Add New VIP</CardTitle>\n          <CardDescription>\n            Add a Twitch username to the VIP shoutout list\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <div className=\"flex gap-2\">\n            <div className=\"flex-1 relative\" ref={dropdownRef}>\n              <div className=\"relative\">\n                <Input\n                  ref={inputRef}\n                  placeholder=\"Search Twitch users...\"\n                  value={newUsername}\n                  onChange={(e) => setNewUsername(e.target.value)}\n                  onFocus={() => {\n                    if (newUsername.length > 1) {\n                      setShowSuggestions(true);\n                    }\n                  }}\n                  onKeyDown={handleKeyDown}\n                  data-testid=\"input-vip-username\"\n                />\n                {isSearching && newUsername.length > 1 && (\n                  <div className=\"absolute right-3 top-1/2 -translate-y-1/2\">\n                    <Loader2 className=\"h-4 w-4 animate-spin text-muted-foreground\" />\n                  </div>\n                )}\n              </div>\n\n              {showSuggestions && newUsername.length > 1 && (\n                <div className=\"absolute z-50 w-full mt-1 bg-popover border rounded-md shadow-md max-h-[300px] overflow-auto\">\n                  {suggestions.length === 0 && !isSearching ? (\n                    <div className=\"p-3 text-sm text-muted-foreground text-center\">\n                      No Twitch users found\n                    </div>\n                  ) : (\n                    <div className=\"p-1\">\n                      <div className=\"px-2 py-1.5 text-xs font-semibold text-muted-foreground\">\n                        Twitch Users\n                      </div>\n                      {suggestions.map((user) => (\n                        <button\n                          key={user.id}\n                          onClick={() => handleSelectUser(user.login)}\n                          className=\"w-full flex items-center gap-3 px-2 py-2 rounded-sm hover-elevate active-elevate-2 text-left\"\n                          data-testid={`suggestion-${user.login}`}\n                        >\n                          <Avatar className=\"h-8 w-8\">\n                            <AvatarImage src={user.profile_image_url} alt={user.login} />\n                            <AvatarFallback>\n                              {user.login.substring(0, 2).toUpperCase()}\n                            </AvatarFallback>\n                          </Avatar>\n                          <div className=\"flex-1 min-w-0\">\n                            <p className=\"font-medium text-sm truncate\">{user.login}</p>\n                            {user.display_name !== user.login && (\n                              <p className=\"text-xs text-muted-foreground truncate\">\n                                {user.display_name}\n                              </p>\n                            )}\n                          </div>\n                        </button>\n                      ))}\n                    </div>\n                  )}\n                </div>\n              )}\n            </div>\n            <Button \n              onClick={handleAddVip}\n              disabled={!newUsername.trim() || addVipMutation.isPending}\n              data-testid=\"button-add-vip\"\n            >\n              <Plus className=\"h-4 w-4 mr-2\" />\n              Add VIP\n            </Button>\n          </div>\n        </CardContent>\n      </Card>\n\n      <Card>\n        <CardHeader>\n          <CardTitle>Shoutout Settings</CardTitle>\n          <CardDescription>\n            Configure the cooldown period between automatic shoutouts for the same VIP\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <div className=\"space-y-4\">\n            <div className=\"flex items-center gap-4\">\n              <div className=\"flex-1\">\n                <Label htmlFor=\"cooldown-select\">Cooldown Duration</Label>\n                <p className=\"text-xs text-muted-foreground mt-1\">\n                  Minimum time between shoutouts for the same VIP\n                </p>\n              </div>\n              <Select\n                value={cooldownHours.toString()}\n                onValueChange={(value) => updateCooldownMutation.mutate(parseInt(value))}\n                disabled={updateCooldownMutation.isPending}\n              >\n                <SelectTrigger className=\"w-[180px]\" id=\"cooldown-select\" data-testid=\"select-cooldown\">\n                  <SelectValue placeholder=\"Select cooldown\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"1\">1 hour</SelectItem>\n                  <SelectItem value=\"2\">2 hours</SelectItem>\n                  <SelectItem value=\"4\">4 hours</SelectItem>\n                  <SelectItem value=\"12\">12 hours</SelectItem>\n                  <SelectItem value=\"24\">24 hours</SelectItem>\n                  <SelectItem value=\"48\">48 hours (2 days)</SelectItem>\n                  <SelectItem value=\"72\">72 hours (3 days)</SelectItem>\n                  <SelectItem value=\"168\">1 week</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center justify-between\">\n            <span>VIP Users ({vips.length})</span>\n            <Badge variant={autoShoutoutsEnabled ? \"default\" : \"secondary\"} data-testid=\"badge-shoutouts-status\">\n              {autoShoutoutsEnabled ? \"Auto Shoutouts Active\" : \"Auto Shoutouts Disabled\"}\n            </Badge>\n          </CardTitle>\n          <CardDescription>\n            {autoShoutoutsEnabled \n              ? `Shoutouts will be sent automatically with a ${cooldownHours}h cooldown`\n              : \"Enable auto shoutouts in Settings to activate automatic greetings\"}\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          {isLoading ? (\n            <div className=\"text-center py-8 text-muted-foreground\">Loading VIPs...</div>\n          ) : vips.length === 0 ? (\n            <div className=\"text-center py-8 text-muted-foreground\" data-testid=\"text-no-vips\">\n              No VIP users yet. Add your first VIP above!\n            </div>\n          ) : (\n            <div className=\"space-y-2\">\n              {vips.map((vip) => (\n                <div\n                  key={vip.id}\n                  className=\"flex items-center justify-between p-4 rounded-lg border bg-card hover-elevate\"\n                  data-testid={`card-vip-${vip.userId}`}\n                >\n                  <div className=\"flex items-center gap-4 flex-1 min-w-0\">\n                    <Avatar className=\"h-12 w-12 border-2 border-primary\">\n                      {vip.profileImageUrl ? (\n                        <AvatarImage src={vip.profileImageUrl} alt={vip.username} />\n                      ) : null}\n                      <AvatarFallback className=\"bg-primary text-primary-foreground\">\n                        <Shield className=\"h-6 w-6\" />\n                      </AvatarFallback>\n                    </Avatar>\n                    <div className=\"flex-1 min-w-0\">\n                      <div className=\"flex items-center gap-2 mb-1\">\n                        <p className=\"font-medium text-base\" data-testid={`text-vip-username-${vip.userId}`}>\n                          {vip.username}\n                        </p>\n                        {vip.isLive && (\n                          <Badge variant=\"destructive\" className=\"gap-1 animate-pulse\">\n                            <div className=\"h-2 w-2 rounded-full bg-white\" />\n                            LIVE\n                          </Badge>\n                        )}\n                      </div>\n                      <div className=\"flex items-center gap-3 text-xs text-muted-foreground flex-wrap\">\n                        {vip.followerCount !== undefined && (\n                          <span className=\"flex items-center gap-1\">\n                            <span className=\"font-medium\">{vip.followerCount.toLocaleString()}</span> followers\n                          </span>\n                        )}\n                        {vip.isLive && vip.viewerCount !== undefined && (\n                          <span className=\"flex items-center gap-1\">\n                            <span className=\"font-medium text-destructive\">{vip.viewerCount.toLocaleString()}</span> watching\n                          </span>\n                        )}\n                        {vip.isLive && vip.game && (\n                          <span className=\"truncate\">Playing {vip.game}</span>\n                        )}\n                      </div>\n                      <div className=\"flex items-center gap-2 text-xs text-muted-foreground mt-1\">\n                        <Clock className=\"h-3 w-3\" />\n                        <span data-testid={`text-vip-last-shoutout-${vip.userId}`}>\n                          Last shoutout: {getTimeSinceShoutout(vip.shoutoutLastGiven ? new Date(vip.shoutoutLastGiven).toISOString() : null)}\n                        </span>\n                      </div>\n                    </div>\n                  </div>\n                  \n                  <div className=\"flex items-center gap-2 flex-shrink-0\">\n                    <Badge variant=\"outline\" data-testid={`badge-vip-cooldown-${vip.userId}`}>\n                      {getCooldownStatus(vip.shoutoutLastGiven ? new Date(vip.shoutoutLastGiven).toISOString() : null, cooldownHours)}\n                    </Badge>\n                    {vip.isMod && <Badge variant=\"secondary\">Mod</Badge>}\n                    {vip.isSubscriber && <Badge variant=\"secondary\">Sub</Badge>}\n                    <Button\n                      size=\"sm\"\n                      variant=\"outline\"\n                      onClick={() => handleTestShoutout(vip)}\n                      disabled={testShoutoutMutation.isPending}\n                      data-testid={`button-test-shoutout-${vip.userId}`}\n                    >\n                      <Video className=\"h-4 w-4 mr-1\" />\n                      Test\n                    </Button>\n                    <Button\n                      size=\"icon\"\n                      variant=\"ghost\"\n                      onClick={() => handleRemoveVip(vip.userId)}\n                      disabled={toggleVipMutation.isPending}\n                      data-testid={`button-remove-vip-${vip.userId}`}\n                    >\n                      <Trash2 className=\"h-4 w-4\" />\n                    </Button>\n                  </div>\n                </div>\n              ))}\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      {/* Browser Source for OBS */}\n      <Card data-testid=\"card-browser-source\">\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Eye className=\"h-5 w-5 text-primary\" />\n            VIP Shoutout Browser Source\n          </CardTitle>\n          <CardDescription>\n            Generate a URL for displaying VIP shoutouts in OBS or streaming software\n          </CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div className=\"flex items-center justify-between p-4 rounded-lg bg-muted\">\n            <div className=\"flex-1\">\n              <p className=\"font-medium text-foreground mb-1\">Browser Source Status</p>\n              <p className=\"text-sm text-muted-foreground\">\n                {browserSourceEnabled \n                  ? \"Browser source is active and will display shoutouts in real-time\" \n                  : \"Browser source is disabled\"}\n              </p>\n            </div>\n            <Button\n              variant={browserSourceEnabled ? \"secondary\" : \"default\"}\n              onClick={() => toggleBrowserSourceMutation.mutate(!browserSourceEnabled)}\n              disabled={toggleBrowserSourceMutation.isPending}\n              data-testid=\"button-toggle-browser-source\"\n            >\n              {browserSourceEnabled ? \"Disable\" : \"Enable\"}\n            </Button>\n          </div>\n\n          {browserSourceEnabled && (\n            <>\n              {!browserSourceToken ? (\n                <div className=\"text-center py-4\">\n                  <Button\n                    onClick={() => generateBrowserSourceMutation.mutate()}\n                    disabled={generateBrowserSourceMutation.isPending}\n                    data-testid=\"button-generate-url\"\n                  >\n                    {generateBrowserSourceMutation.isPending ? (\n                      <Loader2 className=\"h-4 w-4 animate-spin mr-2\" />\n                    ) : (\n                      <Plus className=\"h-4 w-4 mr-2\" />\n                    )}\n                    Generate Browser Source URL\n                  </Button>\n                </div>\n              ) : (\n                <div className=\"space-y-3\">\n                  <div>\n                    <label className=\"text-sm font-medium text-foreground mb-2 block\">\n                      Browser Source URL\n                    </label>\n                    <div className=\"flex gap-2\">\n                      <Input\n                        value={browserSourceUrl}\n                        readOnly\n                        className=\"font-mono text-sm\"\n                        data-testid=\"input-browser-source-url\"\n                      />\n                      <Button\n                        variant=\"outline\"\n                        size=\"icon\"\n                        onClick={copyToClipboard}\n                        data-testid=\"button-copy-url\"\n                      >\n                        {copied ? (\n                          <CheckCircle className=\"h-4 w-4 text-green-500\" />\n                        ) : (\n                          <Copy className=\"h-4 w-4\" />\n                        )}\n                      </Button>\n                    </div>\n                  </div>\n\n                  <div className=\"p-4 rounded-lg bg-muted space-y-2\">\n                    <p className=\"font-medium text-sm text-foreground\">How to use in OBS:</p>\n                    <ol className=\"text-sm text-muted-foreground space-y-1 list-decimal list-inside\">\n                      <li>In OBS, add a new \"Browser\" source</li>\n                      <li>Paste the URL above into the URL field</li>\n                      <li>Set width to 1920 and height to 1080</li>\n                      <li>VIP shoutouts will appear automatically when enabled!</li>\n                    </ol>\n                  </div>\n                </div>\n              )}\n            </>\n          )}\n        </CardContent>\n      </Card>\n\n      {/* Test Shoutout Clip Modal */}\n      <Dialog open={!!testShoutoutUser} onOpenChange={() => {\n        setTestShoutoutUser(null);\n        setTestClip(null);\n      }}>\n        <DialogContent className=\"max-w-4xl\">\n          <DialogHeader>\n            <DialogTitle>Test Shoutout: {testShoutoutUser?.username}</DialogTitle>\n            <DialogDescription>\n              {testShoutoutMutation.isPending \n                ? \"Fetching latest clip from Twitch...\" \n                : testClip \n                  ? \"Preview of their latest Twitch clip\"\n                  : \"Loading clip...\"}\n            </DialogDescription>\n          </DialogHeader>\n          {testShoutoutMutation.isPending ? (\n            <div className=\"flex items-center justify-center py-12\">\n              <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n            </div>\n          ) : testClip ? (\n            <div className=\"space-y-4\">\n              <div className=\"aspect-video w-full\">\n                <iframe\n                  src={`https://clips.twitch.tv/embed?clip=${testClip.url.split('/').pop()}&parent=${window.location.hostname}&autoplay=true`}\n                  className=\"w-full h-full rounded-md\"\n                  allowFullScreen\n                  title={testClip.title}\n                  data-testid=\"iframe-test-clip\"\n                />\n              </div>\n              <div className=\"p-4 bg-muted rounded-lg\">\n                <p className=\"text-sm font-medium text-foreground mb-1\">{testClip.title}</p>\n                <a \n                  href={testClip.url} \n                  target=\"_blank\" \n                  rel=\"noopener noreferrer\"\n                  className=\"text-xs text-primary hover:underline\"\n                >\n                  Open clip in new tab \n                </a>\n              </div>\n            </div>\n          ) : null}\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","size_bytes":27789},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","size_bytes":10481},"client/src/pages/settings.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Slider } from \"@/components/ui/slider\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Avatar, AvatarImage, AvatarFallback } from \"@/components/ui/avatar\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport type { Settings, InsertSettings, AuthenticatedUser } from \"@shared/schema\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { LogOut } from \"lucide-react\";\n\nexport default function SettingsPage() {\n  const { toast } = useToast();\n  const [twitchChannel, setTwitchChannel] = useState(\"\");\n  const [twitchUsername, setTwitchUsername] = useState(\"\");\n  const [autoModeration, setAutoModeration] = useState(false);\n  const [sentimentThreshold, setSentimentThreshold] = useState([3]);\n  const [enableAiAnalysis, setEnableAiAnalysis] = useState(true);\n  \n  const [audioMicMode, setAudioMicMode] = useState(\"muted\");\n  const [audioVoiceSelection, setAudioVoiceSelection] = useState(\"Default\");\n  const [audioAiVoiceActive, setAudioAiVoiceActive] = useState(true);\n  const [audioSpeechCleanup, setAudioSpeechCleanup] = useState(true);\n  const [audioFallbackToTextOnly, setAudioFallbackToTextOnly] = useState(true);\n  const [audioCooldownBetweenReplies, setAudioCooldownBetweenReplies] = useState([5]);\n  const [audioMaxVoiceLength, setAudioMaxVoiceLength] = useState([500]);\n\n  const { data: settings } = useQuery<Settings[]>({\n    queryKey: [\"/api/settings\"],\n  });\n\n  const { data: authenticatedUser } = useQuery<AuthenticatedUser>({\n    queryKey: [\"/api/auth/user\"],\n    retry: false,\n  });\n\n  const logoutMutation = useMutation({\n    mutationFn: () => apiRequest(\"POST\", \"/api/auth/logout\", {}),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/auth/user\"] });\n      toast({\n        title: \"Logged out\",\n        description: \"You have been logged out successfully.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to logout. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  useEffect(() => {\n    if (settings && settings.length > 0) {\n      const setting = settings[0];\n      setTwitchChannel(setting.twitchChannel || \"\");\n      setTwitchUsername(setting.twitchUsername || \"\");\n      setAutoModeration(setting.autoModeration);\n      setSentimentThreshold([setting.sentimentThreshold]);\n      setEnableAiAnalysis(setting.enableAiAnalysis);\n      \n      setAudioMicMode(setting.audioMicMode || \"muted\");\n      setAudioVoiceSelection(setting.audioVoiceSelection || \"Default\");\n      setAudioAiVoiceActive(setting.audioAiVoiceActive ?? true);\n      setAudioSpeechCleanup(setting.audioSpeechCleanup ?? true);\n      setAudioFallbackToTextOnly(setting.audioFallbackToTextOnly ?? true);\n      setAudioCooldownBetweenReplies([setting.audioCooldownBetweenReplies || 5]);\n      setAudioMaxVoiceLength([setting.audioMaxVoiceLength || 500]);\n    }\n  }, [settings]);\n\n  const updateSettingsMutation = useMutation({\n    mutationFn: (data: InsertSettings) => \n      settings && settings.length > 0\n        ? apiRequest(\"PATCH\", `/api/settings/${settings[0].id}`, data)\n        : apiRequest(\"POST\", \"/api/settings\", data),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/settings\"] });\n      toast({\n        title: \"Settings saved\",\n        description: \"Your settings have been updated successfully.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to save settings. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleSave = () => {\n    updateSettingsMutation.mutate({\n      twitchChannel,\n      twitchUsername,\n      autoModeration,\n      sentimentThreshold: sentimentThreshold[0],\n      enableAiAnalysis,\n      audioMicMode,\n      audioVoiceSelection,\n      audioAiVoiceActive,\n      audioSpeechCleanup,\n      audioFallbackToTextOnly,\n      audioCooldownBetweenReplies: audioCooldownBetweenReplies[0],\n      audioMaxVoiceLength: audioMaxVoiceLength[0],\n    });\n  };\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      <div>\n        <h1 className=\"text-2xl font-bold text-foreground\" data-testid=\"page-title-settings\">Settings</h1>\n        <p className=\"text-sm text-muted-foreground mt-1\">\n          Configure your Twitch integration and AI features\n        </p>\n      </div>\n\n      <div className=\"grid gap-6 md:grid-cols-2\">\n        <Card data-testid=\"card-twitch-config\">\n          <CardHeader>\n            <CardTitle className=\"text-lg font-semibold\">Twitch Configuration</CardTitle>\n            <CardDescription>Connect to your Twitch channel</CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            {authenticatedUser ? (\n              <div className=\"space-y-4\">\n                <div className=\"flex items-center gap-4 p-4 bg-muted/50 rounded-md\">\n                  <Avatar data-testid=\"avatar-user\">\n                    <AvatarImage src={authenticatedUser.twitchProfileImageUrl || undefined} />\n                    <AvatarFallback>{authenticatedUser.twitchDisplayName[0]}</AvatarFallback>\n                  </Avatar>\n                  <div className=\"flex-1\">\n                    <p className=\"font-semibold text-foreground\" data-testid=\"text-display-name\">\n                      {authenticatedUser.twitchDisplayName}\n                    </p>\n                    <p className=\"text-sm text-muted-foreground\" data-testid=\"text-username\">\n                      @{authenticatedUser.twitchUsername}\n                    </p>\n                    {authenticatedUser.twitchEmail && (\n                      <p className=\"text-xs text-muted-foreground\" data-testid=\"text-email\">\n                        {authenticatedUser.twitchEmail}\n                      </p>\n                    )}\n                  </div>\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => logoutMutation.mutate()}\n                    disabled={logoutMutation.isPending}\n                    data-testid=\"button-logout\"\n                  >\n                    <LogOut className=\"w-4 h-4 mr-2\" />\n                    Logout\n                  </Button>\n                </div>\n                <p className=\"text-sm text-muted-foreground\">\n                  Connected via Twitch OAuth. Your channel is automatically configured.\n                </p>\n              </div>\n            ) : (\n              <>\n                <div className=\"flex flex-col gap-4\">\n                  <Button\n                    onClick={() => window.location.href = \"/api/auth/twitch\"}\n                    data-testid=\"button-login-twitch\"\n                    className=\"w-full\"\n                  >\n                    Login with Twitch\n                  </Button>\n                  <p className=\"text-xs text-center text-muted-foreground\">\n                    Recommended: Login with Twitch for automatic configuration\n                  </p>\n                </div>\n                <div className=\"relative\">\n                  <div className=\"absolute inset-0 flex items-center\">\n                    <span className=\"w-full border-t\" />\n                  </div>\n                  <div className=\"relative flex justify-center text-xs uppercase\">\n                    <span className=\"bg-background px-2 text-muted-foreground\">\n                      Or configure manually\n                    </span>\n                  </div>\n                </div>\n                <div>\n                  <Label htmlFor=\"channel\">Channel Name</Label>\n                  <Input\n                    id=\"channel\"\n                    value={twitchChannel}\n                    onChange={(e) => setTwitchChannel(e.target.value)}\n                    placeholder=\"Enter channel name\"\n                    data-testid=\"input-channel\"\n                  />\n                  <p className=\"text-xs text-muted-foreground mt-1\">\n                    The Twitch channel to monitor\n                  </p>\n                </div>\n                <div>\n                  <Label htmlFor=\"username\">Bot Username</Label>\n                  <Input\n                    id=\"username\"\n                    value={twitchUsername}\n                    onChange={(e) => setTwitchUsername(e.target.value)}\n                    placeholder=\"Enter bot username\"\n                    data-testid=\"input-username\"\n                  />\n                  <p className=\"text-xs text-muted-foreground mt-1\">\n                    Username for the chat bot (can be your own)\n                  </p>\n                </div>\n              </>\n            )}\n          </CardContent>\n        </Card>\n\n        <Card data-testid=\"card-ai-settings\">\n          <CardHeader>\n            <CardTitle className=\"text-lg font-semibold\">AI Settings</CardTitle>\n            <CardDescription>Configure AI analysis and moderation</CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-6\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"space-y-0.5\">\n                <Label htmlFor=\"ai-analysis\">Enable AI Analysis</Label>\n                <p className=\"text-xs text-muted-foreground\">\n                  Analyze messages with Groq AI\n                </p>\n              </div>\n              <Switch\n                id=\"ai-analysis\"\n                checked={enableAiAnalysis}\n                onCheckedChange={setEnableAiAnalysis}\n                data-testid=\"switch-ai-analysis\"\n              />\n            </div>\n\n            <div className=\"flex items-center justify-between\">\n              <div className=\"space-y-0.5\">\n                <Label htmlFor=\"auto-mod\">Auto Moderation</Label>\n                <p className=\"text-xs text-muted-foreground\">\n                  Automatically flag toxic messages\n                </p>\n              </div>\n              <Switch\n                id=\"auto-mod\"\n                checked={autoModeration}\n                onCheckedChange={setAutoModeration}\n                data-testid=\"switch-auto-moderation\"\n              />\n            </div>\n\n            <div className=\"space-y-2\">\n              <div className=\"flex justify-between\">\n                <Label>Sentiment Threshold</Label>\n                <span className=\"text-sm text-muted-foreground\" data-testid=\"text-threshold-value\">\n                  {sentimentThreshold[0]}\n                </span>\n              </div>\n              <Slider\n                value={sentimentThreshold}\n                onValueChange={setSentimentThreshold}\n                min={1}\n                max={5}\n                step={1}\n                data-testid=\"slider-sentiment-threshold\"\n              />\n              <p className=\"text-xs text-muted-foreground\">\n                Minimum sentiment score for positive classification\n              </p>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      <Card data-testid=\"card-audio-settings\">\n        <CardHeader>\n          <CardTitle className=\"text-lg font-semibold\">Audio Settings</CardTitle>\n          <CardDescription>Configure voice and audio features</CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-6\">\n          <div className=\"grid gap-6 md:grid-cols-2\">\n            <div className=\"space-y-6\">\n              <div className=\"flex items-center justify-between\">\n                <div className=\"space-y-0.5\">\n                  <Label htmlFor=\"ai-voice-active\">AI Voice Active</Label>\n                  <p className=\"text-xs text-muted-foreground\">\n                    Enable AI voice responses\n                  </p>\n                </div>\n                <Switch\n                  id=\"ai-voice-active\"\n                  checked={audioAiVoiceActive}\n                  onCheckedChange={setAudioAiVoiceActive}\n                  data-testid=\"switch-ai-voice-active\"\n                />\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"voice-selection\">Voice Selection</Label>\n                <Select value={audioVoiceSelection} onValueChange={setAudioVoiceSelection}>\n                  <SelectTrigger id=\"voice-selection\" data-testid=\"select-voice-selection\">\n                    <SelectValue placeholder=\"Select voice\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"Default\">Default</SelectItem>\n                    <SelectItem value=\"Voice 1\">Voice 1</SelectItem>\n                    <SelectItem value=\"Voice 2\">Voice 2</SelectItem>\n                    <SelectItem value=\"Voice 3\">Voice 3</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"mic-mode\">Mic Mode</Label>\n                <Select value={audioMicMode} onValueChange={setAudioMicMode}>\n                  <SelectTrigger id=\"mic-mode\" data-testid=\"select-mic-mode\">\n                    <SelectValue placeholder=\"Select mic mode\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"muted\">Muted</SelectItem>\n                    <SelectItem value=\"passthrough\">Passthrough</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n\n              <div className=\"flex items-center justify-between\">\n                <div className=\"space-y-0.5\">\n                  <Label htmlFor=\"speech-cleanup\">Speech Cleanup</Label>\n                  <p className=\"text-xs text-muted-foreground\">\n                    Clean up spoken text with AI\n                  </p>\n                </div>\n                <Switch\n                  id=\"speech-cleanup\"\n                  checked={audioSpeechCleanup}\n                  onCheckedChange={setAudioSpeechCleanup}\n                  data-testid=\"switch-speech-cleanup\"\n                />\n              </div>\n            </div>\n\n            <div className=\"space-y-6\">\n              <div className=\"flex items-center justify-between\">\n                <div className=\"space-y-0.5\">\n                  <Label htmlFor=\"fallback-text\">Fallback to Text Only</Label>\n                  <p className=\"text-xs text-muted-foreground\">\n                    Use text when quota exceeded\n                  </p>\n                </div>\n                <Switch\n                  id=\"fallback-text\"\n                  checked={audioFallbackToTextOnly}\n                  onCheckedChange={setAudioFallbackToTextOnly}\n                  data-testid=\"switch-fallback-text\"\n                />\n              </div>\n\n              <div className=\"space-y-2\">\n                <div className=\"flex justify-between\">\n                  <Label>Cooldown Between Replies</Label>\n                  <span className=\"text-sm text-muted-foreground\" data-testid=\"text-cooldown-replies-value\">\n                    {audioCooldownBetweenReplies[0]}s\n                  </span>\n                </div>\n                <Slider\n                  value={audioCooldownBetweenReplies}\n                  onValueChange={setAudioCooldownBetweenReplies}\n                  min={1}\n                  max={30}\n                  step={1}\n                  data-testid=\"slider-cooldown-replies\"\n                />\n                <p className=\"text-xs text-muted-foreground\">\n                  Minimum seconds between voice replies\n                </p>\n              </div>\n\n              <div className=\"space-y-2\">\n                <div className=\"flex justify-between\">\n                  <Label>Max Voice Length</Label>\n                  <span className=\"text-sm text-muted-foreground\" data-testid=\"text-max-voice-length-value\">\n                    {audioMaxVoiceLength[0]}\n                  </span>\n                </div>\n                <Slider\n                  value={audioMaxVoiceLength}\n                  onValueChange={setAudioMaxVoiceLength}\n                  min={100}\n                  max={1000}\n                  step={50}\n                  data-testid=\"slider-max-voice-length\"\n                />\n                <p className=\"text-xs text-muted-foreground\">\n                  Maximum characters for voice synthesis\n                </p>\n              </div>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      <Card data-testid=\"card-connection-status\">\n        <CardHeader>\n          <CardTitle className=\"text-lg font-semibold\">Connection Status</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"flex items-center gap-3\">\n            <div className=\"flex items-center gap-2\">\n              <div className=\"h-3 w-3 rounded-full bg-chart-2\" />\n              <span className=\"text-sm text-foreground\">Twitch: Connected</span>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <div className=\"h-3 w-3 rounded-full bg-chart-2\" />\n              <span className=\"text-sm text-foreground\">Groq AI: Ready</span>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <div className=\"h-3 w-3 rounded-full bg-chart-2\" />\n              <span className=\"text-sm text-foreground\">Database: Active</span>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      <div className=\"flex justify-end\">\n        <Button\n          onClick={handleSave}\n          disabled={updateSettingsMutation.isPending}\n          data-testid=\"button-save-settings\"\n        >\n          {updateSettingsMutation.isPending ? \"Saving...\" : \"Save Settings\"}\n        </Button>\n      </div>\n    </div>\n  );\n}\n","size_bytes":18048},"server/storage.ts":{"content":"// Reference: javascript_database blueprint\nimport {\n  chatMessages,\n  aiAnalysis,\n  aiCommands,\n  settings,\n  userProfiles,\n  userInsights,\n  authenticatedUsers,\n  raids,\n  voiceAiResponses,\n  moderationActions,\n  type ChatMessage,\n  type InsertChatMessage,\n  type AiAnalysis,\n  type InsertAiAnalysis,\n  type AiCommand,\n  type InsertAiCommand,\n  type Settings,\n  type InsertSettings,\n  type ChatMessageWithAnalysis,\n  type UserProfile,\n  type InsertUserProfile,\n  type UserInsight,\n  type InsertUserInsight,\n  type UserProfileWithInsight,\n  type AuthenticatedUser,\n  type InsertAuthenticatedUser,\n  type Raid,\n  type InsertRaid,\n  type VoiceAiResponse,\n  type InsertVoiceAiResponse,\n  type ModerationAction,\n  type InsertModerationAction,\n} from \"@shared/schema\";\nimport { db } from \"./db\";\nimport { eq, desc } from \"drizzle-orm\";\n\nexport interface IStorage {\n  // User Profiles\n  getUserProfile(userId: string): Promise<UserProfile | undefined>;\n  getUserProfileByUsername(username: string): Promise<UserProfile | undefined>;\n  getAllUserProfiles(): Promise<UserProfile[]>;\n  getVipUsers(): Promise<UserProfile[]>;\n  createOrUpdateUserProfile(profile: InsertUserProfile): Promise<UserProfile>;\n  toggleVip(userId: string, isVip: boolean): Promise<UserProfile>;\n  updateUserLastSeen(userId: string): Promise<void>;\n  updateShoutoutTimestamp(userId: string): Promise<void>;\n  \n  // User Insights\n  getUserInsight(userId: string): Promise<UserInsight | undefined>;\n  saveUserInsight(insight: InsertUserInsight): Promise<UserInsight>;\n  getAllUserInsights(): Promise<UserInsight[]>;\n  \n  // Chat Messages\n  getChatMessages(limit?: number): Promise<ChatMessageWithAnalysis[]>;\n  getChatMessageById(id: string): Promise<ChatMessage | undefined>;\n  createChatMessage(message: InsertChatMessage): Promise<ChatMessage>;\n  getMessagesByUser(userId: string, limit?: number): Promise<ChatMessage[]>;\n  \n  // AI Analysis\n  getAiAnalyses(): Promise<AiAnalysis[]>;\n  getAiAnalysisByMessageId(messageId: string): Promise<AiAnalysis | undefined>;\n  createAiAnalysis(analysis: InsertAiAnalysis): Promise<AiAnalysis>;\n  \n  // AI Commands\n  getAiCommands(): Promise<AiCommand[]>;\n  getAiCommandByTrigger(trigger: string): Promise<AiCommand | undefined>;\n  createAiCommand(command: InsertAiCommand): Promise<AiCommand>;\n  updateAiCommand(id: string, data: Partial<InsertAiCommand>): Promise<AiCommand>;\n  deleteAiCommand(id: string): Promise<void>;\n  incrementCommandUsage(id: string): Promise<void>;\n  \n  // Settings\n  getSettings(): Promise<Settings[]>;\n  getSettingsById(id: string): Promise<Settings | undefined>;\n  createSettings(settings: InsertSettings): Promise<Settings>;\n  updateSettings(id: string, settings: Partial<InsertSettings>): Promise<Settings>;\n  \n  // Authenticated Users\n  getAuthenticatedUser(): Promise<AuthenticatedUser | undefined>;\n  saveAuthenticatedUser(user: InsertAuthenticatedUser): Promise<AuthenticatedUser>;\n  deleteAuthenticatedUser(): Promise<void>;\n  updateAuthenticatedUserTokens(id: string, accessToken: string, refreshToken: string, tokenExpiresAt: Date): Promise<AuthenticatedUser>;\n  \n  // Raids\n  getRaids(limit?: number): Promise<Raid[]>;\n  createRaid(raid: InsertRaid): Promise<Raid>;\n  \n  // Browser Source\n  generateBrowserSourceToken(settingsId: string): Promise<string>;\n  getBrowserSourceSettings(token: string): Promise<Settings | undefined>;\n  \n  // Voice AI Responses\n  createVoiceAiResponse(response: InsertVoiceAiResponse): Promise<VoiceAiResponse>;\n  getVoiceAiResponses(limit?: number): Promise<VoiceAiResponse[]>;\n  \n  // Moderation Actions\n  createModerationAction(action: InsertModerationAction): Promise<ModerationAction>;\n  getModerationActions(limit?: number): Promise<ModerationAction[]>;\n  getModerationActionsSince(timestamp: Date): Promise<ModerationAction[]>;\n}\n\nexport class DatabaseStorage implements IStorage {\n  // User Profiles\n  async getUserProfile(userId: string): Promise<UserProfile | undefined> {\n    const [profile] = await db\n      .select()\n      .from(userProfiles)\n      .where(eq(userProfiles.userId, userId));\n    return profile || undefined;\n  }\n\n  async getUserProfileByUsername(username: string): Promise<UserProfile | undefined> {\n    const [profile] = await db\n      .select()\n      .from(userProfiles)\n      .where(eq(userProfiles.username, username));\n    return profile || undefined;\n  }\n\n  async getAllUserProfiles(): Promise<UserProfile[]> {\n    return await db.select().from(userProfiles).orderBy(desc(userProfiles.lastSeen));\n  }\n\n  async getVipUsers(): Promise<UserProfile[]> {\n    return await db\n      .select()\n      .from(userProfiles)\n      .where(eq(userProfiles.isVip, true))\n      .orderBy(desc(userProfiles.lastSeen));\n  }\n\n  async createOrUpdateUserProfile(profile: InsertUserProfile): Promise<UserProfile> {\n    const existing = await this.getUserProfile(profile.userId);\n    \n    if (existing) {\n      const [updated] = await db\n        .update(userProfiles)\n        .set({ \n          ...profile, \n          lastSeen: new Date() \n        })\n        .where(eq(userProfiles.userId, profile.userId))\n        .returning();\n      return updated;\n    } else {\n      const [created] = await db\n        .insert(userProfiles)\n        .values(profile)\n        .returning();\n      return created;\n    }\n  }\n\n  async toggleVip(userId: string, isVip: boolean): Promise<UserProfile> {\n    const [updated] = await db\n      .update(userProfiles)\n      .set({ isVip })\n      .where(eq(userProfiles.userId, userId))\n      .returning();\n    return updated;\n  }\n\n  async updateUserLastSeen(userId: string): Promise<void> {\n    await db\n      .update(userProfiles)\n      .set({ lastSeen: new Date() })\n      .where(eq(userProfiles.userId, userId));\n  }\n\n  async updateShoutoutTimestamp(userId: string): Promise<void> {\n    await db\n      .update(userProfiles)\n      .set({ shoutoutLastGiven: new Date() })\n      .where(eq(userProfiles.userId, userId));\n  }\n\n  // User Insights\n  async getUserInsight(userId: string): Promise<UserInsight | undefined> {\n    const [insight] = await db\n      .select()\n      .from(userInsights)\n      .where(eq(userInsights.userId, userId));\n    return insight || undefined;\n  }\n\n  async saveUserInsight(insight: InsertUserInsight): Promise<UserInsight> {\n    const existing = await this.getUserInsight(insight.userId);\n    \n    if (existing) {\n      const [updated] = await db\n        .update(userInsights)\n        .set({ \n          userId: insight.userId,\n          summary: insight.summary,\n          totalMessages: insight.totalMessages,\n          recentTags: insight.recentTags as string[] | undefined,\n          lastUpdated: new Date() \n        })\n        .where(eq(userInsights.userId, insight.userId))\n        .returning();\n      return updated;\n    } else {\n      const [created] = await db\n        .insert(userInsights)\n        .values({\n          userId: insight.userId,\n          summary: insight.summary,\n          totalMessages: insight.totalMessages,\n          recentTags: insight.recentTags as string[] | undefined,\n        })\n        .returning();\n      return created;\n    }\n  }\n\n  async getAllUserInsights(): Promise<UserInsight[]> {\n    return await db.select().from(userInsights);\n  }\n\n  // Chat Messages\n  async getChatMessages(limit: number = 100): Promise<ChatMessageWithAnalysis[]> {\n    const messages = await db\n      .select()\n      .from(chatMessages)\n      .orderBy(desc(chatMessages.timestamp))\n      .limit(limit);\n    \n    const messagesWithAnalysis: ChatMessageWithAnalysis[] = [];\n    for (const message of messages) {\n      const analysis = await this.getAiAnalysisByMessageId(message.id);\n      messagesWithAnalysis.push({\n        ...message,\n        analysis,\n      });\n    }\n    \n    return messagesWithAnalysis.reverse();\n  }\n\n  async getChatMessageById(id: string): Promise<ChatMessage | undefined> {\n    const [message] = await db.select().from(chatMessages).where(eq(chatMessages.id, id));\n    return message || undefined;\n  }\n\n  async createChatMessage(insertMessage: InsertChatMessage): Promise<ChatMessage> {\n    const [message] = await db\n      .insert(chatMessages)\n      .values(insertMessage)\n      .returning();\n    return message;\n  }\n\n  async getMessagesByUser(userId: string, limit: number = 50): Promise<ChatMessage[]> {\n    return await db\n      .select()\n      .from(chatMessages)\n      .where(eq(chatMessages.userId, userId))\n      .orderBy(desc(chatMessages.timestamp))\n      .limit(limit);\n  }\n\n  // AI Analysis\n  async getAiAnalyses(): Promise<AiAnalysis[]> {\n    return await db.select().from(aiAnalysis).orderBy(desc(aiAnalysis.timestamp));\n  }\n\n  async getAiAnalysisByMessageId(messageId: string): Promise<AiAnalysis | undefined> {\n    const [analysis] = await db\n      .select()\n      .from(aiAnalysis)\n      .where(eq(aiAnalysis.messageId, messageId));\n    return analysis || undefined;\n  }\n\n  async createAiAnalysis(insertAnalysis: InsertAiAnalysis): Promise<AiAnalysis> {\n    const [analysis] = await db\n      .insert(aiAnalysis)\n      .values({\n        messageId: insertAnalysis.messageId,\n        sentiment: insertAnalysis.sentiment,\n        sentimentScore: insertAnalysis.sentimentScore,\n        toxicity: insertAnalysis.toxicity,\n        categories: insertAnalysis.categories as string[] | undefined,\n      })\n      .returning();\n    return analysis;\n  }\n\n  // AI Commands\n  async getAiCommands(): Promise<AiCommand[]> {\n    return await db.select().from(aiCommands).orderBy(desc(aiCommands.createdAt));\n  }\n\n  async getAiCommandByTrigger(trigger: string): Promise<AiCommand | undefined> {\n    const [command] = await db\n      .select()\n      .from(aiCommands)\n      .where(eq(aiCommands.trigger, trigger));\n    return command || undefined;\n  }\n\n  async createAiCommand(insertCommand: InsertAiCommand): Promise<AiCommand> {\n    const [command] = await db\n      .insert(aiCommands)\n      .values(insertCommand)\n      .returning();\n    return command;\n  }\n\n  async updateAiCommand(id: string, data: Partial<InsertAiCommand>): Promise<AiCommand> {\n    const [command] = await db\n      .update(aiCommands)\n      .set(data)\n      .where(eq(aiCommands.id, id))\n      .returning();\n    return command;\n  }\n\n  async deleteAiCommand(id: string): Promise<void> {\n    await db.delete(aiCommands).where(eq(aiCommands.id, id));\n  }\n\n  async incrementCommandUsage(id: string): Promise<void> {\n    const [command] = await db\n      .select()\n      .from(aiCommands)\n      .where(eq(aiCommands.id, id));\n    \n    if (command) {\n      await db\n        .update(aiCommands)\n        .set({ usageCount: command.usageCount + 1 })\n        .where(eq(aiCommands.id, id));\n    }\n  }\n\n  // Settings\n  async getSettings(): Promise<Settings[]> {\n    return await db.select().from(settings);\n  }\n\n  async getSettingsById(id: string): Promise<Settings | undefined> {\n    const [setting] = await db.select().from(settings).where(eq(settings.id, id));\n    return setting || undefined;\n  }\n\n  async createSettings(insertSettings: InsertSettings): Promise<Settings> {\n    const [setting] = await db\n      .insert(settings)\n      .values({\n        ...insertSettings,\n        topicAllowlist: insertSettings.topicAllowlist as string[] | undefined,\n        topicBlocklist: insertSettings.topicBlocklist as string[] | undefined,\n      })\n      .returning();\n    return setting;\n  }\n\n  async updateSettings(id: string, updateData: Partial<InsertSettings>): Promise<Settings> {\n    const [setting] = await db\n      .update(settings)\n      .set({ \n        ...updateData, \n        topicAllowlist: updateData.topicAllowlist as string[] | undefined,\n        topicBlocklist: updateData.topicBlocklist as string[] | undefined,\n        updatedAt: new Date() \n      })\n      .where(eq(settings.id, id))\n      .returning();\n    return setting;\n  }\n\n  // Authenticated Users\n  async getAuthenticatedUser(): Promise<AuthenticatedUser | undefined> {\n    const [user] = await db\n      .select()\n      .from(authenticatedUsers)\n      .limit(1);\n    return user || undefined;\n  }\n\n  async saveAuthenticatedUser(insertUser: InsertAuthenticatedUser): Promise<AuthenticatedUser> {\n    const existing = await this.getAuthenticatedUser();\n    \n    if (existing) {\n      const [updated] = await db\n        .update(authenticatedUsers)\n        .set({ \n          ...insertUser, \n          updatedAt: new Date() \n        })\n        .where(eq(authenticatedUsers.id, existing.id))\n        .returning();\n      return updated;\n    } else {\n      const [created] = await db\n        .insert(authenticatedUsers)\n        .values(insertUser)\n        .returning();\n      return created;\n    }\n  }\n\n  async deleteAuthenticatedUser(): Promise<void> {\n    await db.delete(authenticatedUsers);\n  }\n\n  async updateAuthenticatedUserTokens(userId: string, accessToken: string, refreshToken: string, expiresAt: Date): Promise<AuthenticatedUser> {\n    const [updated] = await db\n      .update(authenticatedUsers)\n      .set({ \n        accessToken,\n        refreshToken,\n        tokenExpiresAt: expiresAt,\n        updatedAt: new Date()\n      })\n      .where(eq(authenticatedUsers.id, userId))\n      .returning();\n    return updated;\n  }\n\n  // Raids\n  async getRaids(limit: number = 50): Promise<Raid[]> {\n    return await db\n      .select()\n      .from(raids)\n      .orderBy(desc(raids.timestamp))\n      .limit(limit);\n  }\n\n  async createRaid(raid: InsertRaid): Promise<Raid> {\n    const [created] = await db\n      .insert(raids)\n      .values(raid)\n      .returning();\n    return created;\n  }\n\n  // Browser Source\n  async generateBrowserSourceToken(settingsId: string): Promise<string> {\n    const token = crypto.randomUUID();\n    await db\n      .update(settings)\n      .set({ \n        browserSourceToken: token,\n        updatedAt: new Date()\n      })\n      .where(eq(settings.id, settingsId));\n    return token;\n  }\n\n  async getBrowserSourceSettings(token: string): Promise<Settings | undefined> {\n    const [setting] = await db\n      .select()\n      .from(settings)\n      .where(eq(settings.browserSourceToken, token));\n    return setting || undefined;\n  }\n\n  // Voice AI Responses\n  async createVoiceAiResponse(response: InsertVoiceAiResponse): Promise<VoiceAiResponse> {\n    const [created] = await db\n      .insert(voiceAiResponses)\n      .values(response)\n      .returning();\n    return created;\n  }\n\n  async getVoiceAiResponses(limit: number = 50): Promise<VoiceAiResponse[]> {\n    return await db\n      .select()\n      .from(voiceAiResponses)\n      .orderBy(desc(voiceAiResponses.timestamp))\n      .limit(limit);\n  }\n\n  // Moderation Actions\n  async createModerationAction(action: InsertModerationAction): Promise<ModerationAction> {\n    const [created] = await db\n      .insert(moderationActions)\n      .values(action)\n      .returning();\n    return created;\n  }\n\n  async getModerationActions(limit: number = 50): Promise<ModerationAction[]> {\n    return await db\n      .select()\n      .from(moderationActions)\n      .orderBy(desc(moderationActions.timestamp))\n      .limit(limit);\n  }\n\n  async getModerationActionsSince(timestamp: Date): Promise<ModerationAction[]> {\n    return await db\n      .select()\n      .from(moderationActions)\n      .where(sql`${moderationActions.timestamp} > ${timestamp}`)\n      .orderBy(desc(moderationActions.timestamp));\n  }\n}\n\nexport const storage = new DatabaseStorage();\n","size_bytes":15301},"server/db.ts":{"content":"// Dual-mode database: Auto-switches between PostgreSQL (Replit) and SQLite (local)\n// Uses db-config.ts to detect environment and configure database accordingly\n\nexport { db, pool, sqliteInstance, schema, isReplit, isLocal } from './db-config';\n","size_bytes":246},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","size_bytes":4281},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","size_bytes":5128},"client/src/components/stat-card.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { ArrowTrendingUpIcon, ArrowTrendingDownIcon } from \"@heroicons/react/24/outline\";\n\ninterface StatCardProps {\n  title: string;\n  value: string | number;\n  trend?: {\n    value: number;\n    isPositive: boolean;\n  };\n  icon?: React.ComponentType<{ className?: string }>;\n  loading?: boolean;\n  onClick?: () => void;\n}\n\nexport function StatCard({ title, value, trend, icon: Icon, loading, onClick }: StatCardProps) {\n  const testId = title.toLowerCase().replace(/\\s+/g, '-');\n\n  return (\n    <Card \n      data-testid={`stat-card-${testId}`}\n      className={onClick ? \"cursor-pointer hover-elevate active-elevate-2 transition-all\" : \"\"}\n      onClick={onClick}\n    >\n      <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n        <CardTitle className=\"text-sm font-medium text-muted-foreground\">{title}</CardTitle>\n        {Icon && <Icon className=\"h-4 w-4 text-muted-foreground\" />}\n      </CardHeader>\n      <CardContent>\n        {loading ? (\n          <div className=\"h-8 w-24 animate-pulse rounded bg-muted\" />\n        ) : (\n          <>\n            <div className=\"text-3xl font-bold text-foreground\" data-testid={`stat-value-${testId}`}>{value}</div>\n            {trend && (\n              <div className=\"mt-1 flex items-center gap-1 text-xs\">\n                {trend.isPositive ? (\n                  <ArrowTrendingUpIcon className=\"h-3 w-3 text-chart-2\" />\n                ) : (\n                  <ArrowTrendingDownIcon className=\"h-3 w-3 text-destructive\" />\n                )}\n                <span className={trend.isPositive ? \"text-chart-2\" : \"text-destructive\"}>\n                  {Math.abs(trend.value)}%\n                </span>\n                <span className=\"text-muted-foreground\">from last hour</span>\n              </div>\n            )}\n          </>\n        )}\n      </CardContent>\n    </Card>\n  );\n}\n","size_bytes":1945},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":711},"client/src/index.css":{"content":"@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n/* LIGHT MODE */\n:root {\n  --button-outline: rgba(0,0,0, .10);\n  --badge-outline: rgba(0,0,0, .05);\n\n  /* Automatic computation of border around primary / danger buttons */\n  --opaque-button-border-intensity: -8; /* In terms of percentages */\n\n  /* Backgrounds applied on top of other backgrounds when hovered/active */\n  --elevate-1: rgba(0,0,0, .03);\n  --elevate-2: rgba(0,0,0, .08);\n\n  --background: 0 0% 100%;\n\n  --foreground: 218 25% 12%;\n\n  --border: 218 15% 88%;\n\n  --card: 218 10% 98%;\n\n  --card-foreground: 218 25% 12%;\n\n  --card-border: 218 15% 92%;\n\n  --sidebar: 218 12% 96%;\n\n  --sidebar-foreground: 218 25% 12%;\n\n  --sidebar-border: 218 15% 90%;\n\n  --sidebar-primary: 265 100% 65%;\n\n  --sidebar-primary-foreground: 0 0% 100%;\n\n  --sidebar-accent: 218 18% 92%;\n\n  --sidebar-accent-foreground: 218 25% 12%;\n\n  --sidebar-ring: 265 100% 65%;\n\n  --popover: 218 10% 94%;\n\n  --popover-foreground: 218 25% 12%;\n\n  --popover-border: 218 15% 88%;\n\n  --primary: 265 100% 65%;\n\n  --primary-foreground: 0 0% 100%;\n\n  --secondary: 218 15% 90%;\n\n  --secondary-foreground: 218 25% 12%;\n\n  --muted: 218 12% 92%;\n\n  --muted-foreground: 218 12% 35%;\n\n  --accent: 218 15% 88%;\n\n  --accent-foreground: 218 25% 12%;\n\n  --destructive: 0 84% 50%;\n\n  --destructive-foreground: 0 0% 100%;\n\n  --input: 218 20% 75%;\n  --ring: 265 100% 65%;\n  --chart-1: 265 100% 65%;\n  --chart-2: 142 70% 45%;\n  --chart-3: 38 92% 45%;\n  --chart-4: 200 90% 45%;\n  --chart-5: 280 80% 50%;\n\n  --font-sans: Inter, system-ui, -apple-system, sans-serif;\n  --font-serif: Georgia, serif;\n  --font-mono: \"Roboto Mono\", Menlo, monospace;\n  --radius: .5rem; /* 8px */\n  --shadow-2xs: 0px 1px 2px 0px hsl(218 25% 8% / 0.05);\n  --shadow-xs: 0px 1px 2px 0px hsl(218 25% 8% / 0.08);\n  --shadow-sm: 0px 1px 3px 0px hsl(218 25% 8% / 0.10), 0px 1px 2px -1px hsl(218 25% 8% / 0.10);\n  --shadow: 0px 1px 3px 0px hsl(218 25% 8% / 0.10), 0px 1px 2px -1px hsl(218 25% 8% / 0.10);\n  --shadow-md: 0px 4px 6px -1px hsl(218 25% 8% / 0.10), 0px 2px 4px -1px hsl(218 25% 8% / 0.10);\n  --shadow-lg: 0px 10px 15px -3px hsl(218 25% 8% / 0.10), 0px 4px 6px -2px hsl(218 25% 8% / 0.05);\n  --shadow-xl: 0px 20px 25px -5px hsl(218 25% 8% / 0.10), 0px 10px 10px -5px hsl(218 25% 8% / 0.04);\n  --shadow-2xl: 0px 25px 50px -12px hsl(218 25% 8% / 0.25);\n  --tracking-normal: 0em;\n  --spacing: 0.25rem;\n\n  /* Automatically computed borders - intensity can be controlled by the user by the --opaque-button-border-intensity setting */\n\n  /* Fallback for older browsers */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --primary-border: hsl(var(--primary));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --secondary-border: hsl(var(--secondary));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --muted-border: hsl(var(--muted));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --accent-border: hsl(var(--accent));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --destructive-border: hsl(var(--destructive));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n.dark {\n  --button-outline: rgba(255,255,255, .10);\n  --badge-outline: rgba(255,255,255, .05);\n\n  --opaque-button-border-intensity: 9;  /* In terms of percentages */\n\n  /* Backgrounds applied on top of other backgrounds when hovered/active */\n  --elevate-1: rgba(255,255,255, .04);\n  --elevate-2: rgba(255,255,255, .09);\n\n  --background: 218 25% 8%;\n\n  --foreground: 0 0% 95%;\n\n  --border: 218 20% 18%;\n\n  --card: 218 20% 12%;\n\n  --card-foreground: 0 0% 95%;\n\n  --card-border: 218 18% 16%;\n\n  --sidebar: 218 18% 15%;\n\n  --sidebar-foreground: 0 0% 95%;\n\n  --sidebar-border: 218 16% 20%;\n\n  --sidebar-primary: 265 100% 70%;\n\n  --sidebar-primary-foreground: 0 0% 100%;\n\n  --sidebar-accent: 218 16% 20%;\n\n  --sidebar-accent-foreground: 0 0% 95%;\n\n  --sidebar-ring: 265 100% 70%;\n\n  --popover: 218 18% 18%;\n\n  --popover-foreground: 0 0% 95%;\n\n  --popover-border: 218 16% 22%;\n\n  --primary: 265 100% 70%;\n\n  --primary-foreground: 0 0% 100%;\n\n  --secondary: 218 15% 22%;\n\n  --secondary-foreground: 0 0% 95%;\n\n  --muted: 218 12% 20%;\n\n  --muted-foreground: 0 0% 70%;\n\n  --accent: 218 14% 18%;\n\n  --accent-foreground: 0 0% 95%;\n\n  --destructive: 0 84% 60%;\n\n  --destructive-foreground: 0 0% 100%;\n\n  --input: 218 20% 35%;\n  --ring: 265 100% 70%;\n  --chart-1: 265 100% 75%;\n  --chart-2: 142 70% 60%;\n  --chart-3: 38 92% 60%;\n  --chart-4: 200 90% 65%;\n  --chart-5: 280 80% 65%;\n\n  --shadow-2xs: 0px 1px 2px 0px hsl(0 0% 0% / 0.30);\n  --shadow-xs: 0px 1px 2px 0px hsl(0 0% 0% / 0.40);\n  --shadow-sm: 0px 1px 3px 0px hsl(0 0% 0% / 0.50), 0px 1px 2px -1px hsl(0 0% 0% / 0.50);\n  --shadow: 0px 1px 3px 0px hsl(0 0% 0% / 0.50), 0px 1px 2px -1px hsl(0 0% 0% / 0.50);\n  --shadow-md: 0px 4px 6px -1px hsl(0 0% 0% / 0.50), 0px 2px 4px -1px hsl(0 0% 0% / 0.50);\n  --shadow-lg: 0px 10px 15px -3px hsl(0 0% 0% / 0.50), 0px 4px 6px -2px hsl(0 0% 0% / 0.30);\n  --shadow-xl: 0px 20px 25px -5px hsl(0 0% 0% / 0.50), 0px 10px 10px -5px hsl(0 0% 0% / 0.30);\n  --shadow-2xl: 0px 25px 50px -12px hsl(0 0% 0% / 0.70);\n\n  /* Automatically computed borders - intensity can be controlled by the user by the --opaque-button-border-intensity setting */\n\n  /* Fallback for older browsers */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --primary-border: hsl(var(--primary));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --secondary-border: hsl(var(--secondary));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --muted-border: hsl(var(--muted));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --accent-border: hsl(var(--accent));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --destructive-border: hsl(var(--destructive));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n  }\n}\n\n/**\n * Using the elevate system.\n * Automatic contrast adjustment.\n *\n * <element className=\"hover-elevate\" />\n * <element className=\"active-elevate-2\" />\n *\n * // Using the tailwind utility when a data attribute is \"on\"\n * <element className=\"toggle-elevate data-[state=on]:toggle-elevated\" />\n * // Or manually controlling the toggle state\n * <element className=\"toggle-elevate toggle-elevated\" />\n *\n * Elevation systems have to handle many states.\n * - not-hovered, vs. hovered vs. active  (three mutually exclusive states)\n * - toggled or not\n * - focused or not (this is not handled with these utilities)\n *\n * Even without handling focused or not, this is six possible combinations that\n * need to be distinguished from eachother visually.\n */\n@layer utilities {\n\n  /* Hide ugly search cancel button in Chrome until we can style it properly */\n  input[type=\"search\"]::-webkit-search-cancel-button {\n    @apply hidden;\n  }\n\n  /* Placeholder styling for contentEditable div */\n  [contenteditable][data-placeholder]:empty::before {\n    content: attr(data-placeholder);\n    color: hsl(var(--muted-foreground));\n    pointer-events: none;\n  }\n\n  /* .no-default-hover-elevate/no-default-active-elevate is an escape hatch so consumers of\n   * buttons/badges can remove the automatic brightness adjustment on interactions\n   * and program their own. */\n  .no-default-hover-elevate {}\n\n  .no-default-active-elevate {}\n\n\n  /**\n   * Toggleable backgrounds go behind the content. Hoverable/active goes on top.\n   * This way they can stack/compound. Both will overlap the parent's borders!\n   * So borders will be automatically adjusted both on toggle, and hover/active,\n   * and they will be compounded.\n   */\n  .toggle-elevate::before,\n  .toggle-elevate-2::before {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: -1;\n    /* sits behind content but above backdrop */\n  }\n\n  .toggle-elevate.toggle-elevated::before {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.toggle-elevate::before {\n    inset: -1px;\n  }\n\n  /* Does not work on elements with overflow:hidden! */\n  .hover-elevate:not(.no-default-hover-elevate),\n  .active-elevate:not(.no-default-active-elevate),\n  .hover-elevate-2:not(.no-default-hover-elevate),\n  .active-elevate-2:not(.no-default-active-elevate) {\n    position: relative;\n    z-index: 0;\n  }\n\n  .hover-elevate:not(.no-default-hover-elevate)::after,\n  .active-elevate:not(.no-default-active-elevate)::after,\n  .hover-elevate-2:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:not(.no-default-active-elevate)::after {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: 999;\n    /* sits in front of content */\n  }\n\n  .hover-elevate:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-1);\n  }\n\n  .hover-elevate-2:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate-2:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate-2:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after {\n    inset: -1px;\n  }\n}","size_bytes":11368},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","size_bytes":2712},"replit.md":{"content":"# StreamDachi - Twitch AI Integration Platform\n\n## Overview\nStreamDachi is a Twitch integration application designed to enhance live streams with AI-powered voice features, real-time chat monitoring, and AI-driven chat analysis. It tracks user profiles (VIPs, moderators, subscribers), automates shoutouts, and logs all chat activity. A core feature is its AI user learning engine, providing personalized responses and configurable settings, alongside a hands-free voice AI system with continuous listening, automatic AI rephrasing via Groq, and unlimited free high-quality TTS using Puter.js. The platform includes a comprehensive dashboard with \"Today\" vs \"What You Missed\" activity tracking, toggleable stat cards, stream session management, and a Database Viewer for internal data management with CSV export. The VIP Management page features a \"Test Shoutout\" to preview VIP clips. The UI boasts a dark-themed dashboard with a distinctive Twitch aesthetic.\n\n## User Preferences\nPreferred communication style: Simple, everyday language.\n\n## System Architecture\nStreamDachi utilizes a React with TypeScript frontend built with Vite, leveraging Shadcn UI (New York variant) and Radix UI for a dark-first design featuring Twitch-inspired purple accents. State management is handled by TanStack Query and WebSockets for real-time updates, while Wouter manages client-side routing. Styling is done with Tailwind CSS, and Recharts is used for data visualization.\n\nThe backend is an Express.js server with TypeScript, providing RESTful APIs and a WebSocket server. It employs a dual-mode database system with Drizzle ORM, automatically switching between Neon PostgreSQL for production (Replit environment) and SQLite for local development. Key tables include `user_profiles`, `chat_messages`, `ai_analysis`, and `settings`. Real-time communication is powered by a WebSocket server. Architectural decisions prioritize WebSocket for real-time updates, Drizzle ORM for type-safe operations, clear separation of concerns, and an asynchronous AI analysis pipeline. A periodic AI learning engine analyzes user chat history for personalized responses. The system features an auto-shoutout system for VIPs, per-stream chat logging, and a comprehensive StreamDachi Voice AI with configurable behavior, continuous voice recognition, Groq-powered rephrasing, and Puter.js TTS.\n\nKey features include a configurable DachiStream interval, a redesigned Monitor page with modules for status collection, collected messages, and AI responses. It supports global Twitch user search for VIP management, an AI provider switch to GroqCloud (using models like Llama 3.3 70B Versatile), and automatic sending of AI responses to chat. VIP management includes autocomplete with profile pictures, follower counts, live streaming status, shoutout cooldowns, and a \"Test Shoutout\" feature. A dedicated Raid Management system supports incoming and outgoing raids. The StreamDachi Voice AI system provides hands-free continuous voice-to-text with automatic AI rephrasing (using llama-3.1-8b-instant), continuous listening, and logging of responses. A dual audio system integrates Puter.js for AI voice TTS and Web Speech API for VIP shoutout audio. The Live Chat page offers a clean, authentic Twitch experience, with all sentiment analysis moved to the Analytics tab. The Dashboard features \"Today\" vs \"What You Missed\" tabs with clickable, filterable stat cards. A Database Viewer page provides searchable user tables, role-based filtering, and CSV export. Moderation actions (bans, timeouts, deletions) are fully logged and integrated into the dashboard and database viewer. A dedicated Audio Settings page consolidates all voice and audio configurations.\n\n## External Dependencies\n*   **Twitch Integration**: `tmi.js` for IRC and chat, Twitch Helix API for user search, OAuth, raid commands, follower/stream status, and clip fetching.\n*   **GroqCloud AI Integration**: `groq-sdk` with models like Llama 3.3 70B Versatile, Llama 3.1 70B, Mixtral 8x7B, Llama 3.1 8B Instant, and Gemma 2 9B for sentiment analysis, toxicity detection, message categorization, custom commands, and AI learning.\n*   **Database**: Neon Serverless PostgreSQL with `@neondatabase/serverless` and Drizzle Kit for migrations.\n*   **UI Component Libraries**: Radix UI (primitives), Heroicons, React Icons, Recharts (data visualization).\n*   **Puter.js**: Free unlimited Text-to-Speech (TTS) using Neural and Generative quality engines for AI voice output.","size_bytes":4496},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n          await import(\"@replit/vite-plugin-dev-banner\").then((m) =>\n            m.devBanner(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","size_bytes":1080},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport { registerRoutes } from \"./routes\";\nimport { setupVite, serveStatic, log } from \"./vite\";\nimport { startAiLearning } from \"./ai-learning-service\";\nimport { DachiStreamService } from \"./dachistream-service\";\nimport { storage } from \"./storage\";\nimport { generateDachiStreamResponse } from \"./groq-service\";\nimport { setDachiStreamService } from \"./twitch-client\";\n\nconst app = express();\napp.use(express.json());\napp.use(express.urlencoded({ extended: false }));\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      if (logLine.length > 80) {\n        logLine = logLine.slice(0, 79) + \"\";\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  const server = await registerRoutes(app);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (app.get(\"env\") === \"development\") {\n    await setupVite(app, server);\n  } else {\n    serveStatic(app);\n  }\n\n  // ALWAYS serve the app on the port specified in the environment variable PORT\n  // Other ports are firewalled. Default to 5000 if not specified.\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  // Initialize DachiStream service\n  const dachiStreamService = new DachiStreamService(storage);\n\n  // Connect DachiStream service to Twitch client\n  setDachiStreamService(dachiStreamService);\n\n  // Export services for use in routes\n  (app as any).dachiStreamService = dachiStreamService;\n\n  const port = parseInt(process.env.PORT || '5000', 10);\n  server.listen({\n    port,\n    host: \"0.0.0.0\",\n    reusePort: true,\n  }, async () => {\n    log(`serving on port ${port}`);\n    \n    // Start AI learning service\n    startAiLearning(10).catch(error => {\n      console.error(\"Failed to start AI learning service:\", error);\n    });\n\n    // Start DachiStream service with AI response callback and status updates\n    await dachiStreamService.start(\n      async (message, context) => {\n        try {\n          const allSettings = await storage.getSettings();\n          const settings = allSettings[0];\n          \n          if (settings && settings.dachipoolEnabled) {\n            // Generate AI response with guardrails\n            const aiResponse = await generateDachiStreamResponse(\n              message.message,\n              context,\n              {\n                model: settings.dachipoolAiModel || \"llama-3.3-70b-versatile\",\n                temperature: (settings.dachipoolAiTemp || 7) / 10,\n                maxChars: settings.dachipoolMaxChars || 1000,\n                energy: settings.dachipoolEnergy || \"Balanced\",\n                personality: settings.aiPersonality || \"Casual\",\n                topicAllowlist: settings.topicAllowlist as string[] || [],\n                topicBlocklist: settings.topicBlocklist as string[] || [],\n                streamerVoiceOnlyMode: settings.streamerVoiceOnlyMode || false,\n              }\n            );\n\n            if (aiResponse) {\n              console.log(`DachiStream AI Response: ${aiResponse}`);\n              \n              // Log the AI response\n              dachiStreamService.logAIResponse(aiResponse);\n              \n              // Send to Twitch chat if auto-send is enabled\n              if (settings.dachiastreamAutoSendToChat) {\n                const { sendChatMessage } = await import(\"./twitch-client\");\n                const sent = await sendChatMessage(aiResponse);\n                if (sent) {\n                  console.log(\" AI response sent to Twitch chat\");\n                } else {\n                  console.error(\" Failed to send AI response to Twitch chat\");\n                }\n              }\n            }\n          }\n        } catch (error) {\n          console.error(\"Error in DachiStream callback:\", error);\n        }\n      },\n      (state) => {\n        // Status updates are handled internally, no need for additional broadcast here\n      }\n    );\n  });\n})();\n","size_bytes":4894},"client/src/components/ui/sidebar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, VariantProps } from \"class-variance-authority\"\nimport { PanelLeftIcon } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nfunction SidebarProvider({\n  defaultOpen = true,\n  open: openProp,\n  onOpenChange: setOpenProp,\n  className,\n  style,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  defaultOpen?: boolean\n  open?: boolean\n  onOpenChange?: (open: boolean) => void\n}) {\n  const isMobile = useIsMobile()\n  const [openMobile, setOpenMobile] = React.useState(false)\n\n  // This is the internal state of the sidebar.\n  // We use openProp and setOpenProp for control from outside the component.\n  const [_open, _setOpen] = React.useState(defaultOpen)\n  const open = openProp ?? _open\n  const setOpen = React.useCallback(\n    (value: boolean | ((value: boolean) => boolean)) => {\n      const openState = typeof value === \"function\" ? value(open) : value\n      if (setOpenProp) {\n        setOpenProp(openState)\n      } else {\n        _setOpen(openState)\n      }\n\n      // This sets the cookie to keep the sidebar state.\n      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n    },\n    [setOpenProp, open]\n  )\n\n  // Helper to toggle the sidebar.\n  const toggleSidebar = React.useCallback(() => {\n    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open)\n  }, [isMobile, setOpen, setOpenMobile])\n\n  // Adds a keyboard shortcut to toggle the sidebar.\n  React.useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (\n        event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n        (event.metaKey || event.ctrlKey)\n      ) {\n        event.preventDefault()\n        toggleSidebar()\n      }\n    }\n\n    window.addEventListener(\"keydown\", handleKeyDown)\n    return () => window.removeEventListener(\"keydown\", handleKeyDown)\n  }, [toggleSidebar])\n\n  // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n  // This makes it easier to style the sidebar with Tailwind classes.\n  const state = open ? \"expanded\" : \"collapsed\"\n\n  const contextValue = React.useMemo<SidebarContextProps>(\n    () => ({\n      state,\n      open,\n      setOpen,\n      isMobile,\n      openMobile,\n      setOpenMobile,\n      toggleSidebar,\n    }),\n    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n  )\n\n  return (\n    <SidebarContext.Provider value={contextValue}>\n      <TooltipProvider delayDuration={0}>\n        <div\n          data-slot=\"sidebar-wrapper\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH,\n              \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n              ...style,\n            } as React.CSSProperties\n          }\n          className={cn(\n            \"group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full\",\n            className\n          )}\n          {...props}\n        >\n          {children}\n        </div>\n      </TooltipProvider>\n    </SidebarContext.Provider>\n  )\n}\n\nfunction Sidebar({\n  side = \"left\",\n  variant = \"sidebar\",\n  collapsible = \"offcanvas\",\n  className,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  side?: \"left\" | \"right\"\n  variant?: \"sidebar\" | \"floating\" | \"inset\"\n  collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n}) {\n  const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n  if (collapsible === \"none\") {\n    return (\n      <div\n        data-slot=\"sidebar\"\n        className={cn(\n          \"bg-sidebar text-sidebar-foreground flex h-full w-[var(--sidebar-width)] flex-col\",\n          className\n        )}\n        {...props}\n      >\n        {children}\n      </div>\n    )\n  }\n\n  if (isMobile) {\n    return (\n      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n        <SheetContent\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar\"\n          data-mobile=\"true\"\n          className=\"bg-sidebar text-sidebar-foreground w-[var(--sidebar-width)] p-0 [&>button]:hidden\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n            } as React.CSSProperties\n          }\n          side={side}\n        >\n          <SheetHeader className=\"sr-only\">\n            <SheetTitle>Sidebar</SheetTitle>\n            <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n          </SheetHeader>\n          <div className=\"flex h-full w-full flex-col\">{children}</div>\n        </SheetContent>\n      </Sheet>\n    )\n  }\n\n  return (\n    <div\n      className=\"group peer text-sidebar-foreground hidden md:block\"\n      data-state={state}\n      data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n      data-variant={variant}\n      data-side={side}\n      data-slot=\"sidebar\"\n    >\n      {/* This is what handles the sidebar gap on desktop */}\n      <div\n        data-slot=\"sidebar-gap\"\n        className={cn(\n          \"relative w-[var(--sidebar-width)] bg-transparent transition-[width] duration-200 ease-linear\",\n          \"group-data-[collapsible=offcanvas]:w-0\",\n          \"group-data-[side=right]:rotate-180\",\n          variant === \"floating\" || variant === \"inset\"\n            ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4))]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)]\"\n        )}\n      />\n      <div\n        data-slot=\"sidebar-container\"\n        className={cn(\n          \"fixed inset-y-0 z-10 hidden h-svh w-[var(--sidebar-width)] transition-[left,right,width] duration-200 ease-linear md:flex\",\n          side === \"left\"\n            ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n            : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n          // Adjust the padding for floating and inset variants.\n          variant === \"floating\" || variant === \"inset\"\n            ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4)+2px)]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n          className\n        )}\n        {...props}\n      >\n        <div\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar-inner\"\n          className=\"bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm\"\n        >\n          {children}\n        </div>\n      </div>\n    </div>\n  )\n}\n\nfunction SidebarTrigger({\n  className,\n  onClick,\n  ...props\n}: React.ComponentProps<typeof Button>) {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      data-sidebar=\"trigger\"\n      data-slot=\"sidebar-trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeftIcon />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n}\n\nfunction SidebarRail({ className, ...props }: React.ComponentProps<\"button\">) {\n  const { toggleSidebar } = useSidebar()\n\n  // Note: Tailwind v3.4 doesn't support \"in-\" selectors. So the rail won't work perfectly.\n  return (\n    <button\n      data-sidebar=\"rail\"\n      data-slot=\"sidebar-rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear group-data-[side=left]:-right-4 group-data-[side=right]:left-0 after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] sm:flex\",\n        \"in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInset({ className, ...props }: React.ComponentProps<\"main\">) {\n  return (\n    <main\n      data-slot=\"sidebar-inset\"\n      className={cn(\n        \"bg-background relative flex w-full flex-1 flex-col\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInput({\n  className,\n  ...props\n}: React.ComponentProps<typeof Input>) {\n  return (\n    <Input\n      data-slot=\"sidebar-input\"\n      data-sidebar=\"input\"\n      className={cn(\"bg-background h-8 w-full shadow-none\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-header\"\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-footer\"\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"sidebar-separator\"\n      data-sidebar=\"separator\"\n      className={cn(\"bg-sidebar-border mx-2 w-auto\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-content\"\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group\"\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupLabel({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-label\"\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:h-4 [&>svg]:w-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupAction({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"button\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-action\"\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground absolute top-3.5 right-3 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupContent({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group-content\"\n      data-sidebar=\"group-content\"\n      className={cn(\"w-full text-sm\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenu({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu\"\n      data-sidebar=\"menu\"\n      className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuItem({ className, ...props }: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-item\"\n      data-sidebar=\"menu-item\"\n      className={cn(\"group/menu-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:w-8! group-data-[collapsible=icon]:h-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:p-0!\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction SidebarMenuButton({\n  asChild = false,\n  isActive = false,\n  variant = \"default\",\n  size = \"default\",\n  tooltip,\n  className,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  isActive?: boolean\n  tooltip?: string | React.ComponentProps<typeof TooltipContent>\n} & VariantProps<typeof sidebarMenuButtonVariants>) {\n  const Comp = asChild ? Slot : \"button\"\n  const { isMobile, state } = useSidebar()\n\n  const button = (\n    <Comp\n      data-slot=\"sidebar-menu-button\"\n      data-sidebar=\"menu-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n      {...props}\n    />\n  )\n\n  if (!tooltip) {\n    return button\n  }\n\n  if (typeof tooltip === \"string\") {\n    tooltip = {\n      children: tooltip,\n    }\n  }\n\n  return (\n    <Tooltip>\n      <TooltipTrigger asChild>{button}</TooltipTrigger>\n      <TooltipContent\n        side=\"right\"\n        align=\"center\"\n        hidden={state !== \"collapsed\" || isMobile}\n        {...tooltip}\n      />\n    </Tooltip>\n  )\n}\n\nfunction SidebarMenuAction({\n  className,\n  asChild = false,\n  showOnHover = false,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  showOnHover?: boolean\n}) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-action\"\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground peer-hover/menu-button:text-sidebar-accent-foreground absolute top-1.5 right-1 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"peer-data-[active=true]/menu-button:text-sidebar-accent-foreground group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuBadge({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-menu-badge\"\n      data-sidebar=\"menu-badge\"\n      className={cn(\n        \"text-sidebar-foreground pointer-events-none absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums select-none\",\n        \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSkeleton({\n  className,\n  showIcon = false,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  showIcon?: boolean\n}) {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      data-slot=\"sidebar-menu-skeleton\"\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[var(--skeleton-width)] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n}\n\nfunction SidebarMenuSub({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu-sub\"\n      data-sidebar=\"menu-sub\"\n      className={cn(\n        \"border-sidebar-border mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l px-2.5 py-0.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubItem({\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-sub-item\"\n      data-sidebar=\"menu-sub-item\"\n      className={cn(\"group/menu-sub-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubButton({\n  asChild = false,\n  size = \"md\",\n  isActive = false,\n  className,\n  ...props\n}: React.ComponentProps<\"a\"> & {\n  asChild?: boolean\n  size?: \"sm\" | \"md\"\n  isActive?: boolean\n}) {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-sub-button\"\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground active:bg-sidebar-accent active:text-sidebar-accent-foreground [&>svg]:text-sidebar-accent-foreground flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 outline outline-2 outline-transparent outline-offset-2 focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","size_bytes":21846},"client/src/hooks/use-websocket.ts":{"content":"import { useEffect, useRef, useState } from \"react\";\nimport { queryClient } from \"@/lib/queryClient\";\n\nexport function useWebSocket() {\n  const [isConnected, setIsConnected] = useState(false);\n  const wsRef = useRef<WebSocket | null>(null);\n\n  useEffect(() => {\n    const protocol = window.location.protocol === \"https:\" ? \"wss:\" : \"ws:\";\n    const host = window.location.host;\n    const wsUrl = `${protocol}//${host}/ws`;\n    \n    console.log(\"Connecting to WebSocket:\", wsUrl);\n    const ws = new WebSocket(wsUrl);\n    wsRef.current = ws;\n\n    ws.onopen = () => {\n      console.log(\"WebSocket connected\");\n      setIsConnected(true);\n    };\n\n    ws.onmessage = (event) => {\n      try {\n        const { event: eventType, data } = JSON.parse(event.data);\n        \n        switch (eventType) {\n          case \"new_message\":\n            queryClient.invalidateQueries({ queryKey: [\"/api/messages\"] });\n            queryClient.invalidateQueries({ queryKey: [\"/api/analyses\"] });\n            break;\n          case \"command_response\":\n            console.log(\"Command response:\", data);\n            break;\n          case \"twitch_connected\":\n            console.log(\"Twitch connected:\", data);\n            break;\n          case \"twitch_disconnected\":\n            console.log(\"Twitch disconnected:\", data);\n            break;\n          case \"auto_shoutout\":\n            console.log(\"Auto shoutout:\", data);\n            // Emit custom browser event for shoutout\n            window.dispatchEvent(new CustomEvent(\"vip_shoutout\", { detail: data }));\n            break;\n        }\n      } catch (error) {\n        console.error(\"Error parsing WebSocket message:\", error);\n      }\n    };\n\n    ws.onerror = (error) => {\n      console.error(\"WebSocket error:\", error);\n      setIsConnected(false);\n    };\n\n    ws.onclose = () => {\n      console.log(\"WebSocket disconnected\");\n      setIsConnected(false);\n    };\n\n    return () => {\n      if (ws.readyState === WebSocket.OPEN) {\n        ws.close();\n      }\n    };\n  }, []);\n\n  return { isConnected, ws: wsRef.current };\n}\n","size_bytes":2053},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","size_bytes":166},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","size_bytes":1723},"server/dachistream-service.ts":{"content":"import type { IStorage } from \"./storage\";\nimport type { ChatMessage, UserInsight, Settings } from \"@shared/schema\";\n\nexport interface MessageBuffer {\n  messages: ChatMessage[];\n  userMessageCounts: Map<string, number>;\n}\n\nexport type SelectionStrategy = \"most_active\" | \"random\" | \"new_chatter\";\n\nexport type DachiStreamStatus = \"idle\" | \"collecting\" | \"processing\" | \"selecting_message\" | \"building_context\" | \"waiting_for_ai\" | \"disabled\" | \"paused\";\n\nexport interface DachiStreamLog {\n  timestamp: Date;\n  type: \"info\" | \"status\" | \"message\" | \"selection\" | \"ai_response\" | \"error\";\n  message: string;\n  data?: any;\n}\n\nexport interface DachiStreamState {\n  status: DachiStreamStatus;\n  bufferCount: number;\n  lastCycleTime: Date | null;\n  nextCycleTime: Date | null;\n  secondsUntilNextCycle: number;\n  selectedMessage: ChatMessage | null;\n  aiResponse: string | null;\n  error: string | null;\n}\n\nexport class DachiStreamService {\n  private storage: IStorage;\n  private messageBuffer: MessageBuffer = {\n    messages: [],\n    userMessageCounts: new Map(),\n  };\n  private timeoutId: NodeJS.Timeout | null = null;\n  private isPaused: boolean = false;\n  private onMessageSelected?: (message: ChatMessage, context: string) => Promise<void>;\n  \n  private currentStatus: DachiStreamStatus = \"idle\";\n  private logs: DachiStreamLog[] = [];\n  private maxLogs = 100;\n  private lastCycleTime: Date | null = null;\n  private onStatusChange?: (state: DachiStreamState) => void;\n  private cycleIntervalSeconds: number = 15;\n  \n  // Timer tracking for proper pause/resume with setTimeout\n  private remainingSeconds: number = 15;\n  private pausedAt: Date | null = null;\n  private cycleStartTime: Date | null = null;\n\n  constructor(storage: IStorage) {\n    this.storage = storage;\n  }\n\n  async start(onMessageSelected: (message: ChatMessage, context: string) => Promise<void>, onStatusChange?: (state: DachiStreamState) => void) {\n    this.onMessageSelected = onMessageSelected;\n    this.onStatusChange = onStatusChange;\n    \n    // Fetch cycle interval from settings\n    const allSettings = await this.storage.getSettings();\n    const settings = allSettings[0];\n    if (settings && settings.dachiastreamCycleInterval) {\n      this.cycleIntervalSeconds = settings.dachiastreamCycleInterval;\n    }\n    \n    // Initialize timer\n    this.remainingSeconds = this.cycleIntervalSeconds;\n    this.cycleStartTime = new Date();\n    \n    // Start first timeout\n    this.scheduleNextCycle(this.cycleIntervalSeconds);\n    \n    this.addLog(\"info\", `DachiStream service started (${this.cycleIntervalSeconds}-second cycle)`);\n    this.updateStatus(\"collecting\");\n    console.log(`DachiStream service started (${this.cycleIntervalSeconds}-second cycle)`);\n  }\n  \n  private scheduleNextCycle(seconds: number) {\n    if (this.timeoutId) {\n      clearTimeout(this.timeoutId);\n    }\n    \n    this.timeoutId = setTimeout(() => {\n      this.processBuffer();\n    }, seconds * 1000);\n    \n    this.remainingSeconds = seconds;\n    this.cycleStartTime = new Date();\n  }\n\n  updateCycleInterval(intervalSeconds: number) {\n    if (intervalSeconds < 1 || intervalSeconds > 300) {\n      console.warn(\"Cycle interval must be between 1 and 300 seconds\");\n      return;\n    }\n    \n    this.cycleIntervalSeconds = intervalSeconds;\n    \n    // Just update the interval for next cycle - don't reset current countdown\n    this.addLog(\"info\", `Cycle interval updated to ${this.cycleIntervalSeconds} seconds (takes effect next cycle)`);\n    console.log(`DachiStream cycle interval updated to ${this.cycleIntervalSeconds} seconds (takes effect next cycle)`);\n    this.broadcastState();\n  }\n\n  stop() {\n    if (this.timeoutId) {\n      clearTimeout(this.timeoutId);\n      this.timeoutId = null;\n    }\n    this.addLog(\"info\", \"DachiStream service stopped\");\n    this.updateStatus(\"idle\");\n    console.log(\"DachiStream service stopped\");\n  }\n\n  pause() {\n    if (this.isPaused) return; // Already paused\n    \n    this.isPaused = true;\n    this.pausedAt = new Date();\n    \n    // Calculate how much time was remaining when paused\n    if (this.cycleStartTime) {\n      const elapsed = Math.floor((this.pausedAt.getTime() - this.cycleStartTime.getTime()) / 1000);\n      this.remainingSeconds = Math.max(0, this.remainingSeconds - elapsed);\n    }\n    \n    // Cancel the current timeout\n    if (this.timeoutId) {\n      clearTimeout(this.timeoutId);\n      this.timeoutId = null;\n    }\n    \n    this.addLog(\"status\", `DachiStream paused (${this.remainingSeconds}s remaining)`);\n    this.updateStatus(\"paused\");\n    console.log(`DachiStream paused with ${this.remainingSeconds}s remaining`);\n  }\n\n  resume() {\n    if (!this.isPaused) return; // Not paused\n    \n    this.isPaused = false;\n    this.pausedAt = null;\n    \n    // Resume with remaining time\n    this.scheduleNextCycle(this.remainingSeconds);\n    \n    this.addLog(\"status\", `DachiStream resumed (${this.remainingSeconds}s until next cycle)`);\n    this.updateStatus(\"collecting\");\n    console.log(`DachiStream resumed with ${this.remainingSeconds}s until next cycle`);\n  }\n  \n  reset() {\n    // Clear the timeout\n    if (this.timeoutId) {\n      clearTimeout(this.timeoutId);\n      this.timeoutId = null;\n    }\n    \n    // Reset timer state\n    this.isPaused = false;\n    this.pausedAt = null;\n    this.lastCycleTime = null;\n    \n    // Clear buffer\n    this.clearBuffer();\n    \n    // Restart with full interval\n    this.scheduleNextCycle(this.cycleIntervalSeconds);\n    \n    this.addLog(\"status\", \"DachiStream reset - timer and buffer cleared\");\n    this.updateStatus(\"collecting\");\n    console.log(\"DachiStream reset\");\n  }\n\n  addMessage(message: ChatMessage) {\n    // Add to buffer\n    this.messageBuffer.messages.push(message);\n    \n    // Update user message count\n    if (message.userId) {\n      const currentCount = this.messageBuffer.userMessageCounts.get(message.userId) || 0;\n      this.messageBuffer.userMessageCounts.set(message.userId, currentCount + 1);\n    }\n    \n    this.addLog(\"message\", `Message added to buffer from ${message.username}`, { \n      message: message.message,\n      bufferSize: this.messageBuffer.messages.length \n    });\n    this.broadcastState();\n  }\n\n  private async processBuffer() {\n    this.lastCycleTime = new Date();\n    \n    this.addLog(\"info\", `Processing cycle started - ${this.messageBuffer.messages.length} messages in buffer`);\n    \n    // Skip if paused (timeout won't be rescheduled until resume)\n    if (this.isPaused) {\n      this.addLog(\"status\", \"Cycle skipped - service is paused\");\n      this.updateStatus(\"paused\");\n      return;\n    }\n    \n    if (this.messageBuffer.messages.length === 0) {\n      this.addLog(\"info\", \"Cycle skipped - no messages in buffer\");\n      this.updateStatus(\"collecting\");\n      this.broadcastState();\n      // Schedule next cycle\n      if (!this.isPaused) {\n        this.scheduleNextCycle(this.cycleIntervalSeconds);\n      }\n      return;\n    }\n\n    try {\n      this.updateStatus(\"processing\");\n      \n      // Get current settings (returns array, take first)\n      const allSettings = await this.storage.getSettings();\n      const settings = allSettings[0];\n      \n      if (!settings || !settings.dachipoolEnabled) {\n        this.addLog(\"status\", \"DachiPool is disabled - clearing buffer\");\n        this.updateStatus(\"disabled\");\n        this.clearBuffer();\n        // Schedule next cycle\n        if (!this.isPaused) {\n          this.scheduleNextCycle(this.cycleIntervalSeconds);\n        }\n        return;\n      }\n\n      this.updateStatus(\"selecting_message\");\n      this.addLog(\"info\", `Using selection strategy: ${settings.dachiastreamSelectionStrategy}`);\n      \n      // Select message based on strategy\n      const selectedMessage = await this.selectMessage(\n        settings.dachiastreamSelectionStrategy as SelectionStrategy\n      );\n\n      if (selectedMessage) {\n        this.addLog(\"selection\", `Selected message from ${selectedMessage.username}: \"${selectedMessage.message}\"`, {\n          username: selectedMessage.username,\n          message: selectedMessage.message,\n          strategy: settings.dachiastreamSelectionStrategy\n        });\n        \n        this.updateStatus(\"building_context\");\n        // Build AI context\n        const context = await this.buildAIContext(selectedMessage, settings);\n        this.addLog(\"info\", \"AI context built successfully\");\n\n        this.updateStatus(\"waiting_for_ai\");\n        // Trigger AI response callback\n        if (this.onMessageSelected) {\n          await this.onMessageSelected(selectedMessage, context);\n        }\n      } else {\n        this.addLog(\"info\", \"No message selected from buffer\");\n      }\n    } catch (error) {\n      const errorMessage = error instanceof Error ? error.message : String(error);\n      this.addLog(\"error\", `Error processing DachiStream buffer: ${errorMessage}`, { error });\n      console.error(\"Error processing DachiStream buffer:\", error);\n    } finally {\n      // Clear buffer for next cycle\n      this.clearBuffer();\n      this.updateStatus(\"collecting\");\n      this.addLog(\"info\", \"Buffer cleared - scheduling next cycle\");\n      \n      // Schedule next cycle if not paused\n      if (!this.isPaused) {\n        this.scheduleNextCycle(this.cycleIntervalSeconds);\n      }\n    }\n  }\n\n  private async selectMessage(strategy: SelectionStrategy): Promise<ChatMessage | null> {\n    const { messages } = this.messageBuffer;\n    \n    if (messages.length === 0) {\n      return null;\n    }\n\n    switch (strategy) {\n      case \"most_active\": {\n        // Find user with most messages in this cycle\n        let maxCount = 0;\n        let mostActiveUserId: string | null = null;\n\n        const entries = Array.from(this.messageBuffer.userMessageCounts.entries());\n        for (const [userId, count] of entries) {\n          if (count > maxCount) {\n            maxCount = count;\n            mostActiveUserId = userId;\n          }\n        }\n\n        // Get the most recent message from that user\n        if (mostActiveUserId) {\n          for (let i = messages.length - 1; i >= 0; i--) {\n            if (messages[i].userId === mostActiveUserId) {\n              return messages[i];\n            }\n          }\n        }\n        \n        // Fallback to last message\n        return messages[messages.length - 1];\n      }\n\n      case \"random\": {\n        // Select random message\n        const randomIndex = Math.floor(Math.random() * messages.length);\n        return messages[randomIndex];\n      }\n\n      case \"new_chatter\": {\n        // Prioritize users who haven't spoken much overall\n        const userProfiles = await this.storage.getAllUserProfiles();\n        const userInsights = await this.storage.getAllUserInsights();\n        \n        // Map userId to total message count\n        const totalMessageCounts = new Map<string, number>();\n        for (const insight of userInsights) {\n          totalMessageCounts.set(insight.userId, insight.totalMessages);\n        }\n\n        // Find message from user with lowest total messages\n        let selectedMessage = messages[0];\n        let lowestCount = Infinity;\n\n        for (const message of messages) {\n          if (message.userId) {\n            const count = totalMessageCounts.get(message.userId) || 0;\n            if (count < lowestCount) {\n              lowestCount = count;\n              selectedMessage = message;\n            }\n          }\n        }\n\n        return selectedMessage;\n      }\n\n      default:\n        return messages[messages.length - 1];\n    }\n  }\n\n  private async buildAIContext(message: ChatMessage, settings: Settings): Promise<string> {\n    const contextParts: string[] = [];\n\n    // Add streamer voice-only mode info\n    if (settings.streamerVoiceOnlyMode) {\n      contextParts.push(\"STREAMER VOICE-ONLY MODE: Only respond if the streamer has spoken recently.\");\n    }\n\n    // Add topic filters\n    if (settings.topicAllowlist && Array.isArray(settings.topicAllowlist) && settings.topicAllowlist.length > 0) {\n      contextParts.push(`ALLOWED TOPICS: ${settings.topicAllowlist.join(\", \")}`);\n    }\n    if (settings.topicBlocklist && Array.isArray(settings.topicBlocklist) && settings.topicBlocklist.length > 0) {\n      contextParts.push(`BLOCKED TOPICS: Avoid discussing ${settings.topicBlocklist.join(\", \")}`);\n    }\n\n    // Add user personality if database personalization is enabled\n    if (settings.useDatabasePersonalization && message.userId) {\n      try {\n        const userInsight = await this.storage.getUserInsight(message.userId);\n        if (userInsight && userInsight.summary) {\n          contextParts.push(`USER PERSONALITY (${message.username}): ${userInsight.summary}`);\n        }\n      } catch (error) {\n        console.error(\"Error fetching user insight:\", error);\n      }\n    }\n\n    // Add recent chat context (last 10 messages)\n    try {\n      const recentMessages = await this.storage.getChatMessages(10);\n      if (recentMessages.length > 0) {\n        const chatHistory = recentMessages\n          .reverse()\n          .map(msg => `${msg.username}: ${msg.message}`)\n          .join(\"\\n\");\n        contextParts.push(`RECENT CHAT:\\n${chatHistory}`);\n      }\n    } catch (error) {\n      console.error(\"Error fetching recent messages:\", error);\n    }\n\n    return contextParts.join(\"\\n\\n\");\n  }\n\n  private clearBuffer() {\n    this.messageBuffer.messages = [];\n    this.messageBuffer.userMessageCounts.clear();\n  }\n\n  getBufferStatus() {\n    return {\n      messageCount: this.messageBuffer.messages.length,\n      userCount: this.messageBuffer.userMessageCounts.size,\n      isPaused: this.isPaused,\n    };\n  }\n  \n  private addLog(type: DachiStreamLog[\"type\"], message: string, data?: any) {\n    const log: DachiStreamLog = {\n      timestamp: new Date(),\n      type,\n      message,\n      data,\n    };\n    \n    this.logs.push(log);\n    \n    // Keep only last maxLogs entries\n    if (this.logs.length > this.maxLogs) {\n      this.logs = this.logs.slice(-this.maxLogs);\n    }\n  }\n  \n  private updateStatus(status: DachiStreamStatus) {\n    this.currentStatus = status;\n    this.broadcastState();\n  }\n  \n  private broadcastState() {\n    if (this.onStatusChange) {\n      this.onStatusChange(this.getState());\n    }\n  }\n  \n  getState(): DachiStreamState {\n    let secondsUntilNextCycle: number;\n    let nextCycleTime: Date | null = null;\n    \n    if (this.isPaused && this.pausedAt) {\n      // When paused, return the frozen remaining seconds\n      secondsUntilNextCycle = this.remainingSeconds;\n      nextCycleTime = new Date(this.pausedAt.getTime() + this.remainingSeconds * 1000);\n    } else if (this.cycleStartTime) {\n      // When running, calculate remaining time from cycle start\n      const now = new Date();\n      const elapsed = Math.floor((now.getTime() - this.cycleStartTime.getTime()) / 1000);\n      secondsUntilNextCycle = Math.max(0, this.remainingSeconds - elapsed);\n      nextCycleTime = new Date(this.cycleStartTime.getTime() + this.remainingSeconds * 1000);\n    } else {\n      // Fallback when not started\n      secondsUntilNextCycle = this.cycleIntervalSeconds;\n    }\n    \n    return {\n      status: this.currentStatus,\n      bufferCount: this.messageBuffer.messages.length,\n      lastCycleTime: this.lastCycleTime,\n      nextCycleTime,\n      secondsUntilNextCycle,\n      selectedMessage: null,\n      aiResponse: null,\n      error: null,\n    };\n  }\n  \n  getCycleInterval(): number {\n    return this.cycleIntervalSeconds;\n  }\n  \n  getLogs(): DachiStreamLog[] {\n    return [...this.logs];\n  }\n  \n  getBufferMessages(): ChatMessage[] {\n    return [...this.messageBuffer.messages];\n  }\n  \n  logAIResponse(response: string) {\n    this.addLog(\"ai_response\", `AI Response generated: ${response.substring(0, 100)}${response.length > 100 ? '...' : ''}`, {\n      fullResponse: response,\n      length: response.length\n    });\n    this.broadcastState();\n  }\n}\n","size_bytes":15794},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","size_bytes":8605},"server/twitch-client.ts":{"content":"import tmi from \"tmi.js\";\nimport { storage } from \"./storage\";\nimport { analyzeChatMessage, generateAiResponse } from \"./groq-service\";\nimport { WebSocket } from \"ws\";\nimport type { DachiStreamService } from \"./dachistream-service\";\nimport { twitchOAuthService } from \"./twitch-oauth-service\";\nimport { ActiveChattersService } from \"./active-chatters-service\";\n\nlet twitchClient: tmi.Client | null = null;\nconst connectedClients: Set<WebSocket> = new Set();\nlet dachiStreamService: DachiStreamService | null = null;\nexport const activeChattersService = new ActiveChattersService();\n\nexport function setDachiStreamService(service: DachiStreamService) {\n  dachiStreamService = service;\n}\n\nexport function addWebSocketClient(ws: WebSocket) {\n  connectedClients.add(ws);\n  ws.on(\"close\", () => {\n    connectedClients.delete(ws);\n  });\n}\n\nfunction broadcastToClients(event: string, data: any) {\n  const message = JSON.stringify({ event, data });\n  connectedClients.forEach((client) => {\n    if (client.readyState === WebSocket.OPEN) {\n      client.send(message);\n    }\n  });\n}\n\n/**\n * Ensures the access token is valid, refreshing if necessary\n */\nasync function ensureValidAccessToken() {\n  const user = await storage.getAuthenticatedUser();\n  \n  if (!user) {\n    console.log(\"No authenticated user found\");\n    return null;\n  }\n  \n  // Check if token is expired or about to expire\n  if (twitchOAuthService.isTokenExpired(user.tokenExpiresAt)) {\n    console.log(\"Access token is expired or expiring soon, attempting refresh...\");\n    \n    if (!user.refreshToken) {\n      console.error(\"No refresh token available - user needs to re-authenticate\");\n      return null;\n    }\n    \n    try {\n      // Refresh the token\n      const tokenResponse = await twitchOAuthService.refreshAccessToken(user.refreshToken);\n      \n      // Calculate new expiration\n      const expiresAt = new Date(Date.now() + tokenResponse.expires_in * 1000);\n      \n      // Update in database\n      await storage.updateAuthenticatedUserTokens(\n        user.id,\n        tokenResponse.access_token,\n        tokenResponse.refresh_token,\n        expiresAt\n      );\n      \n      console.log(` Token refreshed successfully, expires at: ${expiresAt.toISOString()}`);\n      \n      return tokenResponse.access_token;\n    } catch (error) {\n      console.error(\"Failed to refresh token:\", error);\n      console.error(\"User needs to re-authenticate via Settings page\");\n      return null;\n    }\n  }\n  \n  // Token is still valid\n  console.log(` Access token is valid until: ${user.tokenExpiresAt?.toISOString()}`);\n  return user.accessToken;\n}\n\nexport async function connectToTwitch(channel: string, username: string = \"justinfan12345\") {\n  if (twitchClient) {\n    try {\n      await twitchClient.disconnect();\n    } catch (error) {\n      console.log(\"Note: Previous Twitch client was already disconnected\");\n    }\n  }\n\n  // Ensure we have a valid access token (refresh if needed)\n  const validAccessToken = await ensureValidAccessToken();\n  \n  // Get the authenticated user (may have been updated with new token)\n  const authenticatedUser = await storage.getAuthenticatedUser();\n  console.log(`[DEBUG] getAuthenticatedUser result:`, authenticatedUser ? {\n    username: authenticatedUser.twitchUsername,\n    hasAccessToken: !!authenticatedUser.accessToken,\n    tokenLength: authenticatedUser.accessToken?.length || 0,\n    tokenExpires: authenticatedUser.tokenExpiresAt?.toISOString()\n  } : 'null');\n  \n  let identity: { username: string; password?: string } | undefined;\n\n  if (validAccessToken && authenticatedUser) {\n    // Use OAuth token for authenticated connection\n    identity = {\n      username: authenticatedUser.twitchUsername,\n      password: `oauth:${validAccessToken}`,\n    };\n    console.log(`Connecting to Twitch as authenticated user: ${authenticatedUser.twitchUsername}`);\n  } else if (username !== \"justinfan12345\") {\n    // If specific username provided but no token, log warning and connect anonymously\n    console.warn(`No valid OAuth token found for ${username}, connecting anonymously instead`);\n    identity = undefined; // Anonymous connection\n  } else {\n    // Fully anonymous connection\n    identity = undefined;\n  }\n\n  twitchClient = new tmi.Client({\n    options: { debug: false },\n    connection: {\n      reconnect: true,\n      secure: true,\n    },\n    identity: identity,\n    channels: [channel],\n  });\n\n  twitchClient.on(\"message\", async (channel, tags, message, self) => {\n    if (self) return;\n\n    const username = tags[\"display-name\"] || tags.username || \"Anonymous\";\n    const userColor = tags.color || \"#9146FF\";\n    const userId = tags[\"user-id\"] || `anonymous_${username}`;\n    \n    const badges = tags.badges || {};\n    const isVip = badges.vip === \"1\" || false;\n    const isMod = badges.moderator === \"1\" || badges.broadcaster === \"1\" || false;\n    const isSubscriber = badges.subscriber !== undefined || badges.founder !== undefined || false;\n\n    try {\n      await storage.createOrUpdateUserProfile({\n        userId,\n        username,\n        isVip,\n        isMod,\n        isSubscriber,\n        wasAnonymous: !tags[\"user-id\"],\n      });\n\n      await storage.updateUserLastSeen(userId);\n\n      const settingsList = await storage.getSettings();\n      const settings = settingsList.length > 0 ? settingsList[0] : null;\n      \n      if (settings && settings.autoShoutoutsEnabled && isVip) {\n        const userProfile = await storage.getUserProfile(userId);\n        if (userProfile) {\n          const cooldownHours = settings.dachipoolShoutoutCooldownHours || 24;\n          const cooldownMs = cooldownHours * 60 * 60 * 1000;\n          const now = new Date().getTime();\n          const lastShoutout = userProfile.shoutoutLastGiven?.getTime() || 0;\n          \n          if (now - lastShoutout > cooldownMs) {\n            await storage.updateShoutoutTimestamp(userId);\n            const shoutoutMessage = ` Welcome VIP @${username}! Thanks for being amazing! `;\n            broadcastToClients(\"auto_shoutout\", {\n              username,\n              message: shoutoutMessage,\n            });\n          }\n        }\n      }\n\n      const chatMessage = await storage.createChatMessage({\n        userId,\n        username,\n        message,\n        channel,\n        userColor,\n        badges: tags.badges ? Object.fromEntries(\n          Object.entries(tags.badges).filter(([_, v]) => v !== undefined)\n        ) as Record<string, string> : {},\n        emotes: tags.emotes || null,\n      });\n\n      // Track active chatter\n      const userProfile = await storage.getUserProfile(userId);\n      activeChattersService.addMessage(chatMessage, userProfile || undefined);\n\n      // Add message to DachiStream buffer\n      if (dachiStreamService) {\n        dachiStreamService.addMessage(chatMessage);\n      }\n\n      const enableAiAnalysis = settings ? settings.enableAiAnalysis : true;\n\n      let analysis = null;\n      if (enableAiAnalysis) {\n        const aiResult = await analyzeChatMessage(message);\n        analysis = await storage.createAiAnalysis({\n          messageId: chatMessage.id,\n          sentiment: aiResult.sentiment,\n          sentimentScore: aiResult.sentimentScore,\n          toxicity: aiResult.toxicity,\n          categories: aiResult.categories,\n        });\n      }\n\n      broadcastToClients(\"new_message\", {\n        ...chatMessage,\n        analysis,\n      });\n\n      const commands = await storage.getAiCommands();\n      const matchedCommand = commands.find(\n        (cmd) => cmd.enabled && message.toLowerCase().startsWith(cmd.trigger.toLowerCase())\n      );\n\n      if (matchedCommand) {\n        await storage.incrementCommandUsage(matchedCommand.id);\n        \n        const response = await generateAiResponse(matchedCommand.prompt, message);\n        \n        broadcastToClients(\"command_response\", {\n          command: matchedCommand.trigger,\n          response,\n        });\n      }\n    } catch (error) {\n      console.error(\"Error processing Twitch message:\", error);\n    }\n  });\n\n  twitchClient.on(\"connected\", (address, port) => {\n    console.log(`Connected to Twitch chat at ${address}:${port}`);\n    broadcastToClients(\"twitch_connected\", { channel });\n  });\n\n  twitchClient.on(\"disconnected\", (reason) => {\n    console.log(`Disconnected from Twitch: ${reason}`);\n    broadcastToClients(\"twitch_disconnected\", { reason });\n  });\n\n  // Listen for incoming raids\n  twitchClient.on(\"raided\", async (channel, username, viewers) => {\n    console.log(` RAID! ${username} raided with ${viewers} viewers!`);\n    \n    try {\n      // Store the raid in database\n      const raid = await storage.createRaid({\n        fromUserId: username, // Use username as fallback since tags aren't available\n        fromUsername: username,\n        fromDisplayName: username,\n        viewers: viewers || 0,\n      });\n\n      // Broadcast raid notification to connected clients\n      broadcastToClients(\"incoming_raid\", raid);\n      \n      // Also log it as a chat message for history\n      await storage.createChatMessage({\n        userId: username,\n        username,\n        message: ` RAID from ${username} with ${viewers} viewers!`,\n        channel,\n        eventType: \"raid\",\n        userColor: \"#9146FF\",\n        badges: {},\n        emotes: null,\n        metadata: { viewers: viewers || 0 },\n      });\n    } catch (error) {\n      console.error(\"Error processing raid:\", error);\n    }\n  });\n\n  await twitchClient.connect();\n  return twitchClient;\n}\n\nexport function disconnectFromTwitch() {\n  if (twitchClient) {\n    twitchClient.disconnect();\n    twitchClient = null;\n  }\n}\n\nexport function getTwitchClient() {\n  return twitchClient;\n}\n\n/**\n * Send a message to the currently connected Twitch channel\n */\nexport async function sendChatMessage(message: string): Promise<boolean> {\n  if (!twitchClient) {\n    console.error(\"Cannot send chat message: Twitch client not connected\");\n    return false;\n  }\n\n  const authenticatedUser = await storage.getAuthenticatedUser();\n  if (!authenticatedUser) {\n    console.error(\"Cannot send chat message: No authenticated user\");\n    return false;\n  }\n\n  const channel = authenticatedUser.twitchUsername;\n  \n  try {\n    await twitchClient.say(channel, message);\n    console.log(`Sent to Twitch chat: ${message}`);\n    return true;\n  } catch (error) {\n    console.error(\"Failed to send message to Twitch chat:\", error);\n    return false;\n  }\n}\n","size_bytes":10380},"client/src/pages/live-chat.tsx":{"content":"import { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { SiTwitch } from \"react-icons/si\";\n\ninterface TwitchStatus {\n  connected: boolean;\n  channel: string | null;\n  messageCount: number;\n}\n\ninterface AuthenticatedUser {\n  id: string;\n  twitchUsername: string;\n  twitchDisplayName: string;\n  twitchProfileImageUrl: string | null;\n}\n\nexport default function LiveChat() {\n  const { toast } = useToast();\n\n  const { data: status, isLoading: statusLoading } = useQuery<TwitchStatus>({\n    queryKey: [\"/api/twitch/status\"],\n    refetchInterval: 3000,\n  });\n\n  const { data: authenticatedUser } = useQuery<AuthenticatedUser>({\n    queryKey: [\"/api/auth/user\"],\n    retry: false,\n  });\n\n  const connectMutation = useMutation({\n    mutationFn: async () => {\n      if (!authenticatedUser) {\n        throw new Error(\"Please log in with Twitch first\");\n      }\n      const response = await fetch(\"/api/twitch/connect\", {\n        method: \"POST\",\n        body: JSON.stringify({\n          channel: authenticatedUser.twitchUsername,\n          username: authenticatedUser.twitchUsername,\n        }),\n        headers: { \"Content-Type\": \"application/json\" },\n      });\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || \"Failed to connect\");\n      }\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Connected!\",\n        description: \"Successfully connected to Twitch chat\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/twitch/status\"] });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Connection failed\",\n        description: error.message || \"Failed to connect to Twitch\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const isConnected = status?.connected ?? false;\n  const channelName = status?.channel ?? null;\n\n  return (\n    <div className=\"h-screen flex flex-col p-6\">\n      <div className=\"mb-4\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h1 className=\"text-2xl font-bold text-foreground\" data-testid=\"page-title-live-chat\">Live Chat</h1>\n            <p className=\"text-sm text-muted-foreground mt-1\">\n              Native Twitch chat with full moderation abilities\n            </p>\n          </div>\n          <div className=\"flex items-center gap-3\">\n            {isConnected && channelName && (\n              <Badge variant=\"default\" className=\"gap-2\" data-testid=\"badge-connected\">\n                <div className=\"w-2 h-2 rounded-full bg-green-400 animate-pulse\"></div>\n                Connected to {channelName}\n              </Badge>\n            )}\n            {!isConnected && (\n              <Button\n                onClick={() => connectMutation.mutate()}\n                disabled={connectMutation.isPending || !authenticatedUser}\n                data-testid=\"button-connect\"\n              >\n                <SiTwitch className=\"mr-2 h-4 w-4\" />\n                {connectMutation.isPending ? \"Connecting...\" : \"Connect to Twitch\"}\n              </Button>\n            )}\n          </div>\n        </div>\n      </div>\n\n      {/* Embedded Twitch Chat - Fixed iframe display */}\n      <div className=\"flex-1 flex flex-col min-h-0\">\n        {isConnected && channelName ? (\n          <Card className=\"flex-1 flex flex-col min-h-0\">\n            <CardHeader className=\"flex-shrink-0\">\n              <CardTitle className=\"flex items-center gap-2\">\n                <SiTwitch className=\"h-5 w-5 text-primary\" />\n                {channelName}'s Chat\n              </CardTitle>\n              <p className=\"text-xs text-muted-foreground\">\n                Full Twitch chat experience with native mod tools (ban, timeout, delete, etc.)\n              </p>\n            </CardHeader>\n            <CardContent className=\"flex-1 p-0 min-h-0\">\n              <iframe\n                src={`https://www.twitch.tv/embed/${channelName}/chat?parent=${window.location.hostname}&darkpopout`}\n                className=\"w-full h-full rounded-b-lg border-0\"\n                data-testid=\"iframe-twitch-chat\"\n                title={`${channelName} Twitch Chat`}\n                style={{ minHeight: '500px' }}\n              />\n            </CardContent>\n          </Card>\n        ) : (\n          <Card className=\"flex-1 flex items-center justify-center\">\n            <CardContent className=\"text-center py-16\">\n              <SiTwitch className=\"h-16 w-16 mx-auto mb-4 text-muted-foreground opacity-50\" />\n              <h2 className=\"text-xl font-semibold mb-2\">\n                {!authenticatedUser\n                  ? \"Login Required\"\n                  : \"Not Connected\"}\n              </h2>\n              <p className=\"text-sm text-muted-foreground mb-4 max-w-md\">\n                {!authenticatedUser\n                  ? \"Please log in with Twitch to connect to chat\"\n                  : \"Click the Connect button to start monitoring your Twitch chat\"}\n              </p>\n              {authenticatedUser && !isConnected && (\n                <Button\n                  onClick={() => connectMutation.mutate()}\n                  disabled={connectMutation.isPending}\n                  size=\"lg\"\n                  data-testid=\"button-connect-centered\"\n                >\n                  <SiTwitch className=\"mr-2 h-5 w-5\" />\n                  {connectMutation.isPending ? \"Connecting...\" : \"Connect to Twitch\"}\n                </Button>\n              )}\n            </CardContent>\n          </Card>\n        )}\n      </div>\n\n      {/* Info Card */}\n      <Card className=\"mt-4\">\n        <CardContent className=\"py-3\">\n          <div className=\"flex items-start gap-3 text-sm\">\n            <div className=\"w-2 h-2 rounded-full bg-primary mt-1.5 flex-shrink-0\"></div>\n            <div className=\"space-y-1\">\n              <p className=\"font-medium\">Native Twitch Chat Features</p>\n              <p className=\"text-xs text-muted-foreground\">\n                This embedded chat provides all native Twitch moderation tools including: ban users, timeout users, \n                delete messages, clear chat, slow mode, followers-only mode, subscriber mode, and all emote/badge rendering.\n              </p>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":6540},"server/vite.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\nexport async function setupVite(app: Express, server: Server) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(import.meta.dirname, \"public\");\n\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","size_bytes":2263},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    // h-9 to match icon buttons and default buttons.\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","size_bytes":844},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","size_bytes":1467},"client/src/pages/analytics.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport type { ChatMessage, AiAnalysis } from \"@shared/schema\";\nimport { BarChart, Bar, XAxis, YAxis, Tooltip, ResponsiveContainer, LineChart, Line } from \"recharts\";\nimport { Badge } from \"@/components/ui/badge\";\n\nexport default function Analytics() {\n  const { data: messages = [] } = useQuery<ChatMessage[]>({\n    queryKey: [\"/api/messages\"],\n  });\n\n  const { data: analyses = [] } = useQuery<AiAnalysis[]>({\n    queryKey: [\"/api/analyses\"],\n  });\n\n  const topUsers = messages.reduce((acc, msg) => {\n    acc[msg.username] = (acc[msg.username] || 0) + 1;\n    return acc;\n  }, {} as Record<string, number>);\n\n  const topUsersData = Object.entries(topUsers)\n    .sort(([, a], [, b]) => b - a)\n    .slice(0, 10)\n    .map(([username, count]) => ({ username, count }));\n\n  const sentimentOverTime = analyses.map((analysis, index) => ({\n    index,\n    score: analysis.sentimentScore,\n    sentiment: analysis.sentiment,\n  }));\n\n  const avgSentiment = analyses.length > 0\n    ? (analyses.reduce((sum, a) => sum + a.sentimentScore, 0) / analyses.length).toFixed(2)\n    : \"0\";\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      <div>\n        <h1 className=\"text-2xl font-bold text-foreground\" data-testid=\"page-title-analytics\">Analytics</h1>\n        <p className=\"text-sm text-muted-foreground mt-1\">\n          Deep insights into your chat activity and sentiment trends\n        </p>\n      </div>\n\n      <div className=\"grid gap-4 md:grid-cols-3\">\n        <Card data-testid=\"card-avg-sentiment\">\n          <CardHeader>\n            <CardTitle className=\"text-sm font-medium text-muted-foreground\">Average Sentiment</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-3xl font-bold text-foreground\">{avgSentiment}</div>\n            <p className=\"text-xs text-muted-foreground mt-1\">out of 5.0</p>\n          </CardContent>\n        </Card>\n\n        <Card data-testid=\"card-total-users\">\n          <CardHeader>\n            <CardTitle className=\"text-sm font-medium text-muted-foreground\">Total Users</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-3xl font-bold text-foreground\">{Object.keys(topUsers).length}</div>\n            <p className=\"text-xs text-muted-foreground mt-1\">unique chatters</p>\n          </CardContent>\n        </Card>\n\n        <Card data-testid=\"card-toxicity-rate\">\n          <CardHeader>\n            <CardTitle className=\"text-sm font-medium text-muted-foreground\">Toxicity Rate</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-3xl font-bold text-foreground\">\n              {analyses.length > 0\n                ? `${((analyses.filter((a) => a.toxicity).length / analyses.length) * 100).toFixed(1)}%`\n                : \"0%\"}\n            </div>\n            <p className=\"text-xs text-muted-foreground mt-1\">of analyzed messages</p>\n          </CardContent>\n        </Card>\n      </div>\n\n      <div className=\"grid gap-4 md:grid-cols-2\">\n        <Card data-testid=\"card-top-chatters\">\n          <CardHeader>\n            <CardTitle className=\"text-lg font-semibold\">Top Chatters</CardTitle>\n          </CardHeader>\n          <CardContent>\n            {topUsersData.length === 0 ? (\n              <div className=\"flex h-[300px] items-center justify-center\">\n                <p className=\"text-sm text-muted-foreground\">No chat data yet</p>\n              </div>\n            ) : (\n              <ResponsiveContainer width=\"100%\" height={300}>\n                <BarChart data={topUsersData} layout=\"vertical\">\n                  <XAxis type=\"number\" stroke=\"hsl(var(--muted-foreground))\" fontSize={12} />\n                  <YAxis\n                    type=\"category\"\n                    dataKey=\"username\"\n                    stroke=\"hsl(var(--muted-foreground))\"\n                    fontSize={12}\n                    width={100}\n                  />\n                  <Tooltip\n                    contentStyle={{\n                      backgroundColor: \"hsl(var(--popover))\",\n                      border: \"1px solid hsl(var(--border))\",\n                      borderRadius: \"6px\",\n                    }}\n                  />\n                  <Bar dataKey=\"count\" fill=\"hsl(var(--primary))\" radius={[0, 4, 4, 0]} />\n                </BarChart>\n              </ResponsiveContainer>\n            )}\n          </CardContent>\n        </Card>\n\n        <Card data-testid=\"card-sentiment-trend\">\n          <CardHeader>\n            <CardTitle className=\"text-lg font-semibold\">Sentiment Trend</CardTitle>\n          </CardHeader>\n          <CardContent>\n            {sentimentOverTime.length === 0 ? (\n              <div className=\"flex h-[300px] items-center justify-center\">\n                <p className=\"text-sm text-muted-foreground\">No sentiment data yet</p>\n              </div>\n            ) : (\n              <ResponsiveContainer width=\"100%\" height={300}>\n                <LineChart data={sentimentOverTime}>\n                  <XAxis\n                    dataKey=\"index\"\n                    stroke=\"hsl(var(--muted-foreground))\"\n                    fontSize={12}\n                    tickLine={false}\n                    axisLine={false}\n                  />\n                  <YAxis\n                    stroke=\"hsl(var(--muted-foreground))\"\n                    fontSize={12}\n                    tickLine={false}\n                    axisLine={false}\n                    domain={[1, 5]}\n                  />\n                  <Tooltip\n                    contentStyle={{\n                      backgroundColor: \"hsl(var(--popover))\",\n                      border: \"1px solid hsl(var(--border))\",\n                      borderRadius: \"6px\",\n                    }}\n                  />\n                  <Line\n                    type=\"monotone\"\n                    dataKey=\"score\"\n                    stroke=\"hsl(var(--primary))\"\n                    strokeWidth={2}\n                    dot={{ fill: \"hsl(var(--primary))\", r: 3 }}\n                  />\n                </LineChart>\n              </ResponsiveContainer>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n\n      <Card data-testid=\"card-recent-analyses\">\n        <CardHeader>\n          <CardTitle className=\"text-lg font-semibold\">Recent AI Analyses</CardTitle>\n        </CardHeader>\n        <CardContent>\n          {analyses.length === 0 ? (\n            <div className=\"flex h-[200px] items-center justify-center\">\n              <p className=\"text-sm text-muted-foreground\">No analyses yet</p>\n            </div>\n          ) : (\n            <div className=\"space-y-3\">\n              {analyses.slice(-5).reverse().map((analysis) => (\n                <div\n                  key={analysis.id}\n                  className=\"flex items-center justify-between p-3 rounded-md bg-card hover-elevate\"\n                  data-testid={`analysis-${analysis.id}`}\n                >\n                  <div className=\"flex items-center gap-3\">\n                    <Badge\n                      variant={\n                        analysis.sentiment === \"positive\"\n                          ? \"default\"\n                          : analysis.sentiment === \"negative\"\n                          ? \"destructive\"\n                          : \"secondary\"\n                      }\n                      data-testid={`badge-sentiment-${analysis.id}`}\n                    >\n                      {analysis.sentiment}\n                    </Badge>\n                    <span className=\"text-sm font-mono text-muted-foreground\">\n                      Score: {analysis.sentimentScore}/5\n                    </span>\n                  </div>\n                  {analysis.toxicity && (\n                    <Badge variant=\"destructive\" data-testid={`badge-toxic-${analysis.id}`}>Toxic</Badge>\n                  )}\n                </div>\n              ))}\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":8035},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","size_bytes":329},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","size_bytes":3021},"shared/schema.ts":{"content":"import { sql } from \"drizzle-orm\";\nimport { pgTable, text, varchar, timestamp, integer, boolean, jsonb } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\nimport { relations } from \"drizzle-orm\";\n\n// User Profiles Table - Track VIP/Mod/Subscriber status + Personality Profiling\nexport const userProfiles = pgTable(\"user_profiles\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: text(\"user_id\").notNull().unique(), // Twitch user ID\n  username: text(\"username\").notNull(),\n  isVip: boolean(\"is_vip\").notNull().default(false),\n  isMod: boolean(\"is_mod\").notNull().default(false),\n  isSubscriber: boolean(\"is_subscriber\").notNull().default(false),\n  channelPointsBalance: integer(\"channel_points_balance\").default(0),\n  wasAnonymous: boolean(\"was_anonymous\").notNull().default(false),\n  firstSeen: timestamp(\"first_seen\").notNull().defaultNow(),\n  lastSeen: timestamp(\"last_seen\").notNull().defaultNow(),\n  shoutoutLastGiven: timestamp(\"shoutout_last_given\"),\n  \n  // Personality Tracking (1-10 scale, measured over time by AI)\n  humorLevel: integer(\"humor_level\").default(5), // How funny/lighthearted the user is\n  knowledgeLevel: integer(\"knowledge_level\").default(5), // How knowledgeable/informative\n  bluntnessLevel: integer(\"bluntness_level\").default(5), // How direct/honest\n  rudenessLevel: integer(\"rudeness_level\").default(5), // How rude/toxic (lower is better)\n  \n  // Profile Information (NO PII - usernames, roles, preferences only)\n  timezone: text(\"timezone\"), // e.g., \"America/New_York\"\n  twitchUrl: text(\"twitch_url\"), // Full Twitch channel URL\n  previousNames: jsonb(\"previous_names\").$type<string[]>().default(sql`'[]'::jsonb`), // Name change history\n  hobbies: jsonb(\"hobbies\").$type<string[]>().default(sql`'[]'::jsonb`), // User interests\n  likes: jsonb(\"likes\").$type<string[]>().default(sql`'[]'::jsonb`), // Things they enjoy\n  dislikes: jsonb(\"dislikes\").$type<string[]>().default(sql`'[]'::jsonb`), // Things they don't like\n  \n  // Social Media & Links (URLs only, no PII)\n  profilePictureUrl: text(\"profile_picture_url\"), // Twitch avatar URL\n  socials: jsonb(\"socials\").$type<Record<string, string>>().default(sql`'{}'::jsonb`), // {twitter: \"url\", discord: \"username\", etc}\n  customLinks: jsonb(\"custom_links\").$type<Array<{title: string, url: string}>>().default(sql`'[]'::jsonb`), // Custom links/images\n});\n\n// User Insights Table - AI Learning Engine\nexport const userInsights = pgTable(\"user_insights\", {\n  userId: text(\"user_id\").primaryKey(), // References userProfiles.userId\n  summary: text(\"summary\"), // AI-generated personality summary\n  lastUpdated: timestamp(\"last_updated\").notNull().defaultNow(),\n  totalMessages: integer(\"total_messages\").notNull().default(0),\n  recentTags: jsonb(\"recent_tags\").$type<string[]>().default(sql`'[]'::jsonb`),\n});\n\n// Chat Messages Table - Enhanced with stream tracking\nexport const chatMessages = pgTable(\"chat_messages\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: text(\"user_id\"), // Twitch user ID (may be null for anonymous)\n  username: text(\"username\").notNull(),\n  message: text(\"message\").notNull(),\n  channel: text(\"channel\").notNull(),\n  streamId: text(\"stream_id\"), // Unique per streaming session\n  eventType: text(\"event_type\").notNull().default(\"chat\"), // chat, redeem, raid, sub, etc.\n  timestamp: timestamp(\"timestamp\").notNull().defaultNow(),\n  userColor: text(\"user_color\"),\n  badges: jsonb(\"badges\").$type<Record<string, string>>(),\n  emotes: jsonb(\"emotes\"),\n  metadata: jsonb(\"metadata\"), // Additional event-specific data\n});\n\n// AI Analysis Table\nexport const aiAnalysis = pgTable(\"ai_analysis\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  messageId: varchar(\"message_id\").notNull().references(() => chatMessages.id, { onDelete: \"cascade\" }),\n  sentiment: text(\"sentiment\").notNull(), // positive, neutral, negative\n  sentimentScore: integer(\"sentiment_score\").notNull(), // 1-5\n  toxicity: boolean(\"toxicity\").notNull().default(false),\n  categories: jsonb(\"categories\").$type<string[]>(),\n  timestamp: timestamp(\"timestamp\").notNull().defaultNow(),\n});\n\n// AI Commands Table\nexport const aiCommands = pgTable(\"ai_commands\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  trigger: text(\"trigger\").notNull().unique(),\n  prompt: text(\"prompt\").notNull(),\n  responseType: text(\"response_type\").notNull(), // direct, analysis, generate\n  enabled: boolean(\"enabled\").notNull().default(true),\n  usageCount: integer(\"usage_count\").notNull().default(0),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\n// Voice AI Responses Table - History of voice transcriptions and AI rephrasing\nexport const voiceAiResponses = pgTable(\"voice_ai_responses\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  originalText: text(\"original_text\").notNull(), // Raw voice transcription\n  rephrasedText: text(\"rephrased_text\").notNull(), // AI-rephrased version\n  wasSpoken: boolean(\"was_spoken\").notNull().default(false), // Was it sent to TTS\n  timestamp: timestamp(\"timestamp\").notNull().defaultNow(),\n});\n\n// Authenticated Users Table - OAuth Login\nexport const authenticatedUsers = pgTable(\"authenticated_users\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  twitchUserId: text(\"twitch_user_id\").notNull().unique(),\n  twitchUsername: text(\"twitch_username\").notNull(),\n  twitchDisplayName: text(\"twitch_display_name\").notNull(),\n  twitchProfileImageUrl: text(\"twitch_profile_image_url\"),\n  twitchEmail: text(\"twitch_email\"),\n  accessToken: text(\"access_token\").notNull(),\n  refreshToken: text(\"refresh_token\"),\n  tokenExpiresAt: timestamp(\"token_expires_at\"),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n  updatedAt: timestamp(\"updated_at\").notNull().defaultNow(),\n});\n\n// Raids Table - Track incoming raids\nexport const raids = pgTable(\"raids\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  fromUserId: text(\"from_user_id\").notNull(), // Raider's Twitch user ID\n  fromUsername: text(\"from_username\").notNull(), // Raider's username\n  fromDisplayName: text(\"from_display_name\").notNull(), // Raider's display name\n  viewers: integer(\"viewers\").notNull().default(0), // Number of viewers in raid\n  timestamp: timestamp(\"timestamp\").notNull().defaultNow(),\n});\n\n// Moderation Actions Table - Track Twitch mod events\nexport const moderationActions = pgTable(\"moderation_actions\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  actionType: text(\"action_type\").notNull(), // timeout, ban, delete, clear\n  targetUserId: text(\"target_user_id\"), // User being moderated\n  targetUsername: text(\"target_username\").notNull(), // Username of moderated user\n  moderatorId: text(\"moderator_id\"), // Moderator's user ID\n  moderatorUsername: text(\"moderator_username\"), // Moderator's username\n  duration: integer(\"duration\"), // Timeout duration in seconds (null for ban/delete)\n  reason: text(\"reason\"), // Reason for action\n  messageDeleted: text(\"message_deleted\"), // Message text if deleted\n  timestamp: timestamp(\"timestamp\").notNull().defaultNow(),\n});\n\n// Settings Table - Enhanced with DachiPool configuration\nexport const settings = pgTable(\"settings\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  twitchChannel: text(\"twitch_channel\"),\n  twitchUsername: text(\"twitch_username\"),\n  autoModeration: boolean(\"auto_moderation\").notNull().default(false),\n  sentimentThreshold: integer(\"sentiment_threshold\").notNull().default(2), // 1-5\n  enableAiAnalysis: boolean(\"enable_ai_analysis\").notNull().default(true),\n  \n  // Browser Source Settings\n  browserSourceEnabled: boolean(\"browser_source_enabled\").notNull().default(false),\n  browserSourceToken: text(\"browser_source_token\"), // Unique token for OBS URL\n  \n  // DachiPool Settings\n  dachipoolEnabled: boolean(\"dachipool_enabled\").notNull().default(true),\n  dachipoolMaxChars: integer(\"dachipool_max_chars\").notNull().default(1000),\n  dachipoolEnergy: text(\"dachipool_energy\").notNull().default(\"Balanced\"), // Balanced, High, Low\n  dachipoolMode: text(\"dachipool_mode\").notNull().default(\"Auto\"), // Auto, Manual\n  dachipoolShoutoutCooldownHours: integer(\"dachipool_shoutout_cooldown_hours\").notNull().default(24),\n  dachipoolAiModel: text(\"dachipool_ai_model\").notNull().default(\"llama-3.3-70b-versatile\"),\n  dachipoolAiTemp: integer(\"dachipool_ai_temp\").notNull().default(7), // Stored as 0-10, divide by 10\n  aiPersonality: text(\"ai_personality\").notNull().default(\"Casual\"), // Casual, Comedy, Quirky, Serious, Gaming, Professional\n  autoShoutoutsEnabled: boolean(\"auto_shoutouts_enabled\").notNull().default(true),\n  \n  // Audio Settings\n  audioMicMode: text(\"audio_mic_mode\").notNull().default(\"muted\"), // muted, passthrough\n  audioVoiceSelection: text(\"audio_voice_selection\").default(\"Default\"),\n  audioAiVoiceActive: boolean(\"audio_ai_voice_active\").notNull().default(true),\n  audioSpeechCleanup: boolean(\"audio_speech_cleanup\").notNull().default(true),\n  audioFallbackToTextOnly: boolean(\"audio_fallback_to_text_only\").notNull().default(true),\n  audioCooldownBetweenReplies: integer(\"audio_cooldown_between_replies\").notNull().default(5), // seconds\n  audioMaxVoiceLength: integer(\"audio_max_voice_length\").notNull().default(500), // characters\n  \n  // Web Speech API TTS Settings\n  ttsEnabled: boolean(\"tts_enabled\").notNull().default(false),\n  ttsVoice: text(\"tts_voice\"), // Voice name from speechSynthesis.getVoices()\n  ttsPitch: integer(\"tts_pitch\").notNull().default(10), // 5-20 (0.5-2.0), divide by 10\n  ttsRate: integer(\"tts_rate\").notNull().default(10), // 5-20 (0.5-2.0), divide by 10\n  ttsVolume: integer(\"tts_volume\").notNull().default(10), // 0-10 (0.0-1.0), divide by 10\n  \n  // Voice AI Personality Settings (for Groq rephrasing + Puter.js TTS)\n  voiceAiPersonality: text(\"voice_ai_personality\").notNull().default(\"Neutral\"), // Neutral, Quirky, Funny, Sarcastic, Professional\n  voiceAiPitch: integer(\"voice_ai_pitch\").notNull().default(10), // 5-20 (0.5-2.0), divide by 10\n  voiceAiSpeed: integer(\"voice_ai_speed\").notNull().default(10), // 5-20 (0.5-2.0), divide by 10\n  \n  // Topic Filters\n  topicAllowlist: jsonb(\"topic_allowlist\").$type<string[]>().default(sql`'[\"gaming\", \"anime\", \"chatting\"]'::jsonb`),\n  topicBlocklist: jsonb(\"topic_blocklist\").$type<string[]>().default(sql`'[\"politics\", \"religion\"]'::jsonb`),\n  useDatabasePersonalization: boolean(\"use_database_personalization\").notNull().default(true),\n  streamerVoiceOnlyMode: boolean(\"streamer_voice_only_mode\").notNull().default(false),\n  \n  // DachiStream Settings\n  dachiastreamSelectionStrategy: text(\"dachiastream_selection_strategy\").notNull().default(\"most_active\"), // most_active, random, new_chatter\n  dachiastreamPaused: boolean(\"dachiastream_paused\").notNull().default(false),\n  dachiastreamAutoSendToChat: boolean(\"dachiastream_auto_send_to_chat\").notNull().default(false),\n  dachiastreamCycleInterval: integer(\"dachiastream_cycle_interval\").notNull().default(15), // seconds between cycles (5-60)\n  \n  // Dashboard Settings\n  streamSessionStarted: timestamp(\"stream_session_started\"), // Track when current stream started\n  dashboardShowTotalMessages: boolean(\"dashboard_show_total_messages\").notNull().default(true),\n  dashboardShowAiAnalyzed: boolean(\"dashboard_show_ai_analyzed\").notNull().default(true),\n  dashboardShowActiveUsers: boolean(\"dashboard_show_active_users\").notNull().default(true),\n  dashboardShowModActions: boolean(\"dashboard_show_mod_actions\").notNull().default(true),\n  \n  updatedAt: timestamp(\"updated_at\").notNull().defaultNow(),\n});\n\n// Relations\nexport const chatMessagesRelations = relations(chatMessages, ({ one }) => ({\n  analysis: one(aiAnalysis, {\n    fields: [chatMessages.id],\n    references: [aiAnalysis.messageId],\n  }),\n}));\n\nexport const aiAnalysisRelations = relations(aiAnalysis, ({ one }) => ({\n  message: one(chatMessages, {\n    fields: [aiAnalysis.messageId],\n    references: [chatMessages.id],\n  }),\n}));\n\n// Insert Schemas\nexport const insertUserProfileSchema = createInsertSchema(userProfiles).omit({\n  id: true,\n  firstSeen: true,\n  lastSeen: true,\n});\n\nexport const insertUserInsightSchema = createInsertSchema(userInsights).omit({\n  lastUpdated: true,\n});\n\nexport const insertChatMessageSchema = createInsertSchema(chatMessages).omit({\n  id: true,\n  timestamp: true,\n});\n\nexport const insertAiAnalysisSchema = createInsertSchema(aiAnalysis).omit({\n  id: true,\n  timestamp: true,\n});\n\nexport const insertAiCommandSchema = createInsertSchema(aiCommands).omit({\n  id: true,\n  usageCount: true,\n  createdAt: true,\n});\n\nexport const insertSettingsSchema = createInsertSchema(settings).omit({\n  id: true,\n  updatedAt: true,\n});\n\nexport const insertVoiceAiResponseSchema = createInsertSchema(voiceAiResponses).omit({\n  id: true,\n  timestamp: true,\n});\n\nexport const insertAuthenticatedUserSchema = createInsertSchema(authenticatedUsers).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertRaidSchema = createInsertSchema(raids).omit({\n  id: true,\n  timestamp: true,\n});\n\nexport const insertModerationActionSchema = createInsertSchema(moderationActions).omit({\n  id: true,\n  timestamp: true,\n});\n\n// Types\nexport type UserProfile = typeof userProfiles.$inferSelect;\nexport type InsertUserProfile = z.infer<typeof insertUserProfileSchema>;\n\nexport type UserInsight = typeof userInsights.$inferSelect;\nexport type InsertUserInsight = z.infer<typeof insertUserInsightSchema>;\n\nexport type ChatMessage = typeof chatMessages.$inferSelect;\nexport type InsertChatMessage = z.infer<typeof insertChatMessageSchema>;\n\nexport type AiAnalysis = typeof aiAnalysis.$inferSelect;\nexport type InsertAiAnalysis = z.infer<typeof insertAiAnalysisSchema>;\n\nexport type AiCommand = typeof aiCommands.$inferSelect;\nexport type InsertAiCommand = z.infer<typeof insertAiCommandSchema>;\n\nexport type Settings = typeof settings.$inferSelect;\nexport type InsertSettings = z.infer<typeof insertSettingsSchema>;\n\nexport type VoiceAiResponse = typeof voiceAiResponses.$inferSelect;\nexport type InsertVoiceAiResponse = z.infer<typeof insertVoiceAiResponseSchema>;\n\nexport type AuthenticatedUser = typeof authenticatedUsers.$inferSelect;\nexport type InsertAuthenticatedUser = z.infer<typeof insertAuthenticatedUserSchema>;\n\nexport type Raid = typeof raids.$inferSelect;\nexport type InsertRaid = z.infer<typeof insertRaidSchema>;\n\nexport type ModerationAction = typeof moderationActions.$inferSelect;\nexport type InsertModerationAction = z.infer<typeof insertModerationActionSchema>;\n\n// Extended types for frontend\nexport type ChatMessageWithAnalysis = ChatMessage & {\n  analysis?: AiAnalysis;\n};\n\nexport type UserProfileWithInsight = UserProfile & {\n  insight?: UserInsight;\n};\n","size_bytes":14866},"STREAMDACHI_COMPLETE_DOCUMENTATION.md":{"content":"# StreamDachi - Complete Project Documentation\n\n## Project Overview\n\n**StreamDachi** is a comprehensive Twitch integration application with AI-powered features for streamers. It provides real-time chat monitoring, AI-driven analysis, user profile tracking, automatic VIP shoutouts, and personalized AI responses.\n\n### Key Features\n- Real-time Twitch chat monitoring with WebSocket updates\n- AI-powered sentiment analysis and toxicity detection using OpenAI GPT\n- VIP Management system with automatic shoutout cooldowns\n- AI Learning Engine that creates personalized user profiles\n- DachiPool configuration for customizable AI behavior\n- Per-stream chat logging and analytics\n- Dark-themed dashboard with Twitch purple aesthetic (HSL 265 100% 70%)\n\n### Tech Stack\n- **Frontend**: React + TypeScript, Vite, Wouter (routing), TanStack Query, Shadcn UI\n- **Backend**: Express.js, WebSocket (ws library)\n- **Database**: PostgreSQL (Neon Serverless) with Drizzle ORM\n- **AI**: OpenAI GPT-4o-mini for learning, GPT-4 for analysis\n- **Integrations**: Twitch (tmi.js), ElevenLabs TTS (optional)\n\n---\n\n## Application Architecture\n\n### Frontend Structure\n\n**Pages (6 total)**:\n1. **Dashboard** (`/`) - Overview with key metrics and activity\n2. **Live Chat** (`/chat`) - Real-time chat monitoring with sentiment display\n3. **Analytics** (`/analytics`) - User activity charts and sentiment trends\n4. **AI Controls** (`/ai-controls`) - Custom AI command management\n5. **VIP Management** (`/vip-management`) - Add/remove VIPs, view shoutout cooldowns\n6. **Settings** (`/settings`) - Twitch config, AI settings, DachiPool configuration\n\n**Key Frontend Components**:\n- `AppSidebar` - Navigation with Shadcn sidebar primitives\n- `ChatMessage` - Individual message display with sentiment indicators\n- `use-websocket.ts` - Custom hook for WebSocket connection management\n\n**State Management**:\n- TanStack Query for server state and data fetching\n- WebSocket for real-time updates\n- Local React state for UI interactions\n\n### Backend Structure\n\n**Server Framework**: Express.js with TypeScript\n- RESTful API endpoints\n- WebSocket server for real-time bidirectional communication\n- Middleware for logging and error handling\n\n**Service Layer**:\n- `storage.ts` - Database abstraction (IStorage interface + DbStorage implementation)\n- `openai-service.ts` - AI analysis and response generation\n- `twitch-client.ts` - Twitch chat connection with role tracking\n- `ai-learning-service.ts` - Periodic user personality analysis (runs every 10 minutes)\n\n---\n\n## Database Schema\n\n### 1. User Profiles Table (`user_profiles`)\nTracks all chat users with their roles and interaction history.\n\n```typescript\n{\n  id: varchar (UUID, primary key)\n  userId: text (unique, Twitch user ID)\n  username: text (Twitch username)\n  isVip: boolean (default: false)\n  isMod: boolean (default: false)\n  isSubscriber: boolean (default: false)\n  channelPointsBalance: integer (default: 0)\n  wasAnonymous: boolean (default: false)\n  firstSeen: timestamp (auto-set on creation)\n  lastSeen: timestamp (auto-updated)\n  shoutoutLastGiven: timestamp (nullable, for cooldown tracking)\n}\n```\n\n**Purpose**: \n- Track VIP/mod/subscriber status\n- Manage auto-shoutout cooldowns\n- Foundation for channel points system (requires OAuth)\n\n### 2. User Insights Table (`user_insights`)\nAI-generated personality summaries for personalized responses.\n\n```typescript\n{\n  userId: text (primary key, references user_profiles.userId)\n  summary: text (AI-generated personality summary)\n  lastUpdated: timestamp (auto-updated)\n  totalMessages: integer (default: 0)\n  recentTags: jsonb array (behavioral tags from AI)\n}\n```\n\n**Purpose**:\n- Store AI-learned user personalities\n- Enable personalized AI responses\n- Track user engagement patterns\n\n### 3. Chat Messages Table (`chat_messages`)\nEnhanced message storage with stream tracking.\n\n```typescript\n{\n  id: varchar (UUID, primary key)\n  userId: text (nullable, references user_profiles.userId)\n  username: text\n  message: text\n  channel: text\n  streamId: text (nullable, unique per streaming session)\n  eventType: text (default: \"chat\", options: chat/redeem/raid/sub)\n  timestamp: timestamp (auto-set)\n}\n```\n\n**Purpose**:\n- Per-stream chat logging (via streamId)\n- Support multiple event types\n- Historical analysis and highlight extraction\n\n### 4. AI Analysis Table (`ai_analysis`)\nSentiment and toxicity analysis results.\n\n```typescript\n{\n  id: varchar (UUID, primary key)\n  messageId: varchar (references chat_messages.id)\n  sentiment: text (positive/neutral/negative)\n  sentimentScore: integer (1-5)\n  isToxic: boolean\n  categories: jsonb array (message categories)\n  timestamp: timestamp (auto-set)\n}\n```\n\n**Purpose**:\n- Store OpenAI analysis results\n- Enable reanalysis without message duplication\n- Track sentiment trends over time\n\n### 5. AI Commands Table (`ai_commands`)\nCustom AI command definitions.\n\n```typescript\n{\n  id: varchar (UUID, primary key)\n  trigger: text (unique, command trigger)\n  response: text (AI response template)\n  isActive: boolean (default: true)\n}\n```\n\n**Purpose**:\n- Define custom chat commands\n- Enable/disable commands dynamically\n\n### 6. Settings Table (`settings`)\nApplication configuration including DachiPool settings.\n\n```typescript\n{\n  id: varchar (UUID, primary key)\n  twitchChannel: text (nullable)\n  twitchUsername: text (nullable)\n  autoModeration: boolean (default: false)\n  sentimentThreshold: integer (default: 3, range: 1-5)\n  enableAiAnalysis: boolean (default: true)\n  \n  // DachiPool Configuration\n  dachipoolEnabled: boolean (default: true)\n  dachipoolMaxChars: integer (default: 1000, range: 100-2000)\n  dachipoolEnergy: text (default: \"Balanced\", options: Low/Balanced/High)\n  dachipoolMode: text (default: \"Auto\", options: Auto/Manual)\n  dachipoolShoutoutCooldownHours: integer (default: 24, range: 1-168)\n  dachipoolOpenaiModel: text (default: \"gpt-4o-mini\")\n  dachipoolOpenaiTemp: integer (default: 7, range: 0-10, displayed as 0.0-1.0)\n  dachipoolElevenlabsEnabled: boolean (default: false)\n  dachipoolElevenlabsVoice: text (default: \"Default\")\n  autoShoutoutsEnabled: boolean (default: true)\n}\n```\n\n**Purpose**:\n- Centralized configuration management\n- DachiPool AI behavior customization\n- Twitch connection settings\n\n---\n\n## API Endpoints\n\n### Chat Messages\n- `GET /api/messages?limit=100` - Fetch recent chat messages (default: 50)\n- `POST /api/messages` - Create new chat message\n  ```json\n  {\n    \"userId\": \"optional_twitch_id\",\n    \"username\": \"required_username\",\n    \"message\": \"message_text\",\n    \"channel\": \"channel_name\",\n    \"streamId\": \"optional_stream_id\",\n    \"eventType\": \"chat|redeem|raid|sub\"\n  }\n  ```\n\n### AI Analysis\n- `GET /api/analyses?limit=100` - Fetch AI analysis results\n- `POST /api/analyses` - Create AI analysis\n  ```json\n  {\n    \"messageId\": \"message_uuid\",\n    \"sentiment\": \"positive|neutral|negative\",\n    \"sentimentScore\": 1-5,\n    \"isToxic\": boolean,\n    \"categories\": [\"category1\", \"category2\"]\n  }\n  ```\n\n### AI Commands\n- `GET /api/commands` - Fetch all AI commands\n- `POST /api/commands` - Create new command\n- `PATCH /api/commands/:id` - Update command\n- `DELETE /api/commands/:id` - Delete command\n\n### User Profiles\n- `GET /api/users` - Fetch all user profiles\n- `GET /api/users/:userId` - Fetch specific user profile\n- `POST /api/users` - Create or update user profile\n  ```json\n  {\n    \"userId\": \"twitch_user_id\",\n    \"username\": \"username\",\n    \"isVip\": boolean,\n    \"isMod\": boolean,\n    \"isSubscriber\": boolean,\n    \"wasAnonymous\": boolean\n  }\n  ```\n- `GET /api/users/vips` - Fetch all VIP users\n- `PATCH /api/users/:userId/vip` - Toggle VIP status\n  ```json\n  {\n    \"isVip\": boolean\n  }\n  ```\n\n### User Insights\n- `GET /api/insights` - Fetch all user insights\n- `GET /api/insights/:userId` - Fetch specific user insight\n- `POST /api/insights` - Save user insight\n  ```json\n  {\n    \"userId\": \"user_id\",\n    \"summary\": \"AI-generated personality summary\",\n    \"totalMessages\": integer,\n    \"recentTags\": [\"tag1\", \"tag2\"]\n  }\n  ```\n\n### Settings\n- `GET /api/settings` - Fetch application settings (returns array)\n- `POST /api/settings` - Create settings\n- `PATCH /api/settings/:id` - Update settings\n\n### WebSocket\n- `GET /ws` - WebSocket endpoint for real-time updates\n  - Broadcasts: new messages, AI analysis, connection status\n  - Message format: `{ type: 'message' | 'analysis' | 'status', data: {...} }`\n\n---\n\n## Key Features Implementation\n\n### 1. VIP Management System\n\n**Location**: `client/src/pages/vip-management.tsx`\n\n**Features**:\n- Display all VIP users with shoutout cooldown status\n- Add new VIP users (manual entry)\n- Remove VIP status\n- Search/filter VIPs\n- Auto-shoutouts status indicator\n\n**Backend Logic**:\n- VIP status stored in `user_profiles.isVip`\n- Cooldown tracked via `user_profiles.shoutoutLastGiven`\n- Auto-detection from Twitch chat badges (VIP/mod badges)\n\n**Data Flow**:\n1. User enters username in VIP Management page\n2. Frontend checks if user exists in database\n3. If exists: Toggle VIP status via PATCH `/api/users/:userId/vip`\n4. If not exists: Create user profile with VIP=true via POST `/api/users`\n5. Cache invalidation triggers UI update\n\n### 2. AI Learning Engine\n\n**Location**: `server/ai-learning-service.ts`\n\n**Process**:\n1. Runs every 10 minutes (cron-like interval)\n2. Fetches recent chat messages grouped by user\n3. Sends chat history to OpenAI GPT-4o-mini\n4. Generates personality summary and behavioral tags\n5. Saves to `user_insights` table\n\n**Prompt Example**:\n```\nAnalyze these recent chat messages from user {username} and provide:\n1. A brief personality summary\n2. 3-5 behavioral tags\n3. Engagement patterns\n\nMessages: [recent chat history]\n```\n\n**Cost Optimization**:\n- Uses gpt-4o-mini (cheaper than GPT-4)\n- Only analyzes users with recent activity\n- Caches results to avoid redundant analysis\n\n### 3. Auto-Shoutout System\n\n**Location**: `server/twitch-client.ts`\n\n**Logic**:\n1. When VIP user sends message, check `shoutoutLastGiven`\n2. If null or > cooldown period: Send shoutout, update timestamp\n3. If within cooldown: Skip shoutout\n4. Cooldown configurable via `settings.dachipoolShoutoutCooldownHours`\n\n**Example Shoutout**:\n```javascript\nif (isVip && canShoutout(lastShoutout, cooldownHours)) {\n  client.say(channel, `Welcome back ${displayName}! `);\n  await storage.updateShoutoutTimestamp(userId);\n}\n```\n\n### 4. DachiPool Configuration\n\n**Location**: `client/src/pages/settings.tsx`\n\n**Settings**:\n- **Enable/Disable**: Master toggle for AI features\n- **Energy Level**: Low/Balanced/High (controls AI response intensity)\n- **Mode**: Auto (AI decides) / Manual (user-controlled)\n- **Max Characters**: 100-2000 (AI response length limit)\n- **Shoutout Cooldown**: 1-168 hours\n- **OpenAI Model**: Model selection (gpt-4, gpt-4o-mini, etc.)\n- **Temperature**: 0.0-1.0 (creativity level)\n- **ElevenLabs TTS**: Enable voice synthesis (requires API key)\n- **Auto Shoutouts**: Toggle VIP greeting system\n\n**UI Components**:\n- Switches for boolean toggles\n- Select dropdowns for discrete options\n- Sliders for numeric ranges\n- All changes saved via single \"Save Settings\" button\n\n### 5. Per-Stream Chat Logging\n\n**Implementation**:\n- Each stream session assigned unique `streamId` (generated on stream start)\n- All messages during session tagged with same `streamId`\n- Enables queries like: \"Show all chat from stream on 2025-01-15\"\n- Foundation for stream highlights and recap features\n\n**Future Uses**:\n- Generate stream summaries\n- Extract viral moments\n- Compare stream-to-stream engagement\n\n---\n\n## File Structure\n\n```\nstreamdachi/\n client/                          # Frontend (React + Vite)\n    src/\n       components/\n          ui/                  # Shadcn UI components\n             button.tsx\n             card.tsx\n             sidebar.tsx\n             ... (30+ components)\n          app-sidebar.tsx      # Main navigation sidebar\n       hooks/\n          use-toast.ts\n          use-websocket.ts     # WebSocket connection hook\n       lib/\n          queryClient.ts       # TanStack Query setup\n       pages/\n          dashboard.tsx        # Main dashboard\n          live-chat.tsx        # Real-time chat view\n          analytics.tsx        # Charts and insights\n          ai-controls.tsx      # AI command management\n          vip-management.tsx   # VIP shoutout management\n          settings.tsx         # Settings + DachiPool config\n       App.tsx                  # Router + providers\n       index.css                # Tailwind + custom styles\n    index.html\n\n server/                          # Backend (Express + WebSocket)\n    index.ts                     # Server entry point\n    routes.ts                    # API endpoint definitions\n    storage.ts                   # Database abstraction layer\n    openai-service.ts            # AI analysis service\n    twitch-client.ts             # Twitch chat integration\n    ai-learning-service.ts       # Periodic user analysis\n    vite.ts                      # Vite dev server integration\n\n shared/                          # Shared types (frontend + backend)\n    schema.ts                    # Drizzle schema + Zod validation\n\n db/                              # Database migrations (Drizzle)\n    migrations/\n\n replit.md                        # Project documentation (detailed)\n package.json\n tsconfig.json\n vite.config.ts\n tailwind.config.ts\n drizzle.config.ts\n```\n\n---\n\n## Setup Instructions\n\n### Prerequisites\n- Node.js 18+ installed\n- OpenAI API key\n- PostgreSQL database (or use Replit's built-in database)\n\n### Environment Variables\nCreate `.env` file with:\n```bash\nDATABASE_URL=postgresql://...\nOPENAI_API_KEY=sk-...\nSESSION_SECRET=random_secret_string\nELEVENLABS_API_KEY=optional_for_tts\n```\n\n### Installation\n```bash\n# Install dependencies\nnpm install\n\n# Push database schema (creates tables)\nnpm run db:push\n\n# Start development server (frontend + backend)\nnpm run dev\n```\n\n### Initial Configuration\n1. Navigate to Settings page\n2. Enter Twitch channel name (e.g., \"your_channel\")\n3. Enter bot username (can be your own username)\n4. Configure DachiPool settings\n5. Click \"Save Settings\"\n\n### Running the Application\n- Frontend: http://localhost:5000\n- Backend API: http://localhost:5000/api\n- WebSocket: ws://localhost:5000/ws\n- AI Learning Service: Auto-starts, runs every 10 minutes\n\n---\n\n## Key Implementation Details\n\n### WebSocket Real-Time Updates\n\n**Server Side** (`server/index.ts`):\n```typescript\nconst wss = new WebSocketServer({ noServer: true });\n\nconst clients = new Set<WebSocket>();\n\nwss.on('connection', (ws) => {\n  clients.add(ws);\n  ws.on('close', () => clients.delete(ws));\n});\n\n// Broadcast to all clients\nfunction broadcast(data: any) {\n  const message = JSON.stringify(data);\n  clients.forEach(client => {\n    if (client.readyState === WebSocket.OPEN) {\n      client.send(message);\n    }\n  });\n}\n```\n\n**Client Side** (`client/src/hooks/use-websocket.ts`):\n```typescript\nexport function useWebSocket() {\n  useEffect(() => {\n    const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';\n    const ws = new WebSocket(`${protocol}//${window.location.host}/ws`);\n    \n    ws.onmessage = (event) => {\n      const data = JSON.parse(event.data);\n      // Invalidate queries to trigger refetch\n      queryClient.invalidateQueries({ queryKey: ['/api/messages'] });\n    };\n    \n    return () => ws.close();\n  }, []);\n}\n```\n\n### AI Analysis Pipeline\n\n**Flow**:\n1. User sends message in Twitch chat\n2. `twitch-client.ts` receives message via tmi.js\n3. Message saved to database via `storage.createChatMessage()`\n4. OpenAI analysis requested via `openai-service.ts`\n5. Analysis saved via `storage.createAiAnalysis()`\n6. WebSocket broadcasts new message + analysis\n7. Frontend receives update and re-renders\n\n**OpenAI Service** (`server/openai-service.ts`):\n```typescript\nexport async function analyzeMessage(message: string) {\n  const response = await openai.chat.completions.create({\n    model: \"gpt-4\",\n    messages: [\n      {\n        role: \"system\",\n        content: \"Analyze sentiment and toxicity. Return JSON.\"\n      },\n      { role: \"user\", content: message }\n    ],\n    response_format: { type: \"json_object\" }\n  });\n  \n  return JSON.parse(response.choices[0].message.content);\n}\n```\n\n### Twitch Role Detection\n\n**Badge Parsing** (`server/twitch-client.ts`):\n```typescript\nclient.on('message', (channel, tags, message, self) => {\n  const badges = tags['badges'] || {};\n  const isVip = !!badges.vip;\n  const isMod = !!badges.moderator;\n  const isSubscriber = !!badges.subscriber;\n  \n  // Create/update user profile\n  await storage.createOrUpdateUserProfile({\n    userId: tags['user-id'],\n    username: tags['username'],\n    isVip,\n    isMod,\n    isSubscriber\n  });\n});\n```\n\n**Note**: VIP and moderator badges are automatically detected. Subscriber status requires OAuth (optional enhancement).\n\n### Database Queries with Drizzle ORM\n\n**Example - Get VIP Users**:\n```typescript\nasync getVipUsers(): Promise<UserProfile[]> {\n  return await db\n    .select()\n    .from(userProfiles)\n    .where(eq(userProfiles.isVip, true))\n    .orderBy(desc(userProfiles.lastSeen));\n}\n```\n\n**Example - Toggle VIP Status**:\n```typescript\nasync toggleVip(userId: string, isVip: boolean): Promise<UserProfile> {\n  const [updated] = await db\n    .update(userProfiles)\n    .set({ isVip })\n    .where(eq(userProfiles.userId, userId))\n    .returning();\n  return updated;\n}\n```\n\n---\n\n## Current Status (As of Latest Update)\n\n###  Fully Implemented\n- Real-time Twitch chat monitoring\n- AI sentiment analysis and toxicity detection\n- VIP Management page with add/remove functionality\n- Auto-shoutout system with configurable cooldowns\n- AI Learning Engine (runs every 10 minutes)\n- DachiPool configuration UI (Settings page)\n- Per-stream chat logging\n- User profile tracking\n- WebSocket real-time updates\n- Dark mode theme with Twitch branding\n- All 6 pages fully functional\n- Complete API backend\n- Database schema with 6 tables\n\n###  Tested & Working\n- VIP add/remove via UI\n- Settings save and load\n- Navigation across all pages\n- WebSocket connections\n- API endpoints responding correctly\n- Database queries and mutations\n\n###  Requires OAuth (Optional Enhancement)\n- Subscriber status detection (currently badge-based only)\n- Channel points balance (foundation exists in schema)\n- Twitch API integration for advanced features\n\n###  Future Enhancements\n1. **ElevenLabs TTS Integration**\n   - Voice synthesis for AI responses\n   - Requires ELEVENLABS_API_KEY environment variable\n   - UI toggle already implemented in Settings\n\n2. **Stream Highlights**\n   - Use streamId to extract viral moments\n   - Clip generation suggestions\n   - Sentiment spike detection\n\n3. **Advanced Analytics**\n   - User engagement trends over time\n   - Comparative stream analysis\n   - Top chatters leaderboard\n\n4. **Custom AI Personas**\n   - Multiple AI personalities\n   - Scheduled persona changes\n   - Context-aware responses\n\n5. **Raid/Sub Event Handling**\n   - Special responses for raids\n   - Sub celebration messages\n   - Event type tracking (already in schema)\n\n---\n\n## Troubleshooting\n\n### Common Issues\n\n**Issue**: \"Failed to add VIP user\"\n- **Cause**: API request format mismatch\n- **Solution**: Ensure `apiRequest` uses correct parameter order: `apiRequest(method, url, data)`\n\n**Issue**: AI Learning Service not running\n- **Cause**: Missing OPENAI_API_KEY\n- **Solution**: Add key to environment variables and restart server\n\n**Issue**: WebSocket disconnections\n- **Cause**: Network issues or server restart\n- **Solution**: Frontend auto-reconnects; check browser console for errors\n\n**Issue**: Twitch messages not appearing\n- **Cause**: Channel name incorrect or bot not connected\n- **Solution**: Verify channel name in Settings, check server logs for connection status\n\n### Logs\n- Backend logs: Server console output\n- Frontend errors: Browser console (F12)\n- Database queries: Enable Drizzle logging in `drizzle.config.ts`\n\n---\n\n## Security Considerations\n\n### API Keys\n- Never commit `.env` file to version control\n- Use Replit Secrets for production deployments\n- Rotate OpenAI API keys regularly\n\n### Database\n- All queries use parameterized statements (Drizzle ORM)\n- Input validation via Zod schemas\n- Foreign key constraints for data integrity\n\n### WebSocket\n- No authentication implemented (add JWT if needed)\n- Consider rate limiting for production\n- Sanitize all user inputs before broadcasting\n\n---\n\n## Performance Optimization\n\n### Current Optimizations\n- TanStack Query caching reduces API calls\n- WebSocket broadcasts only changed data\n- Drizzle ORM generates efficient SQL\n- AI Learning uses cheaper gpt-4o-mini model\n- Pagination on message queries (limit parameter)\n\n### Recommended for Scale\n- Add Redis for WebSocket message queue\n- Implement message pagination in UI\n- Cache AI analysis results (already stored in DB)\n- Rate limit OpenAI API calls\n- Database connection pooling (already enabled via Neon)\n\n---\n\n## Contributing Guidelines\n\n### Code Style\n- TypeScript strict mode enabled\n- ESLint + Prettier for formatting\n- Follow existing patterns in codebase\n\n### Git Workflow\n- Feature branches off `main`\n- Descriptive commit messages\n- Test before merging\n\n### Testing\n- Use Playwright for e2e tests\n- Test API endpoints with testing subagent\n- Verify WebSocket connections\n\n---\n\n## License & Credits\n\n**Built with**:\n- React, Vite, TypeScript\n- Shadcn UI (New York variant)\n- Drizzle ORM, PostgreSQL\n- OpenAI GPT, Twitch tmi.js\n- Express, WebSocket\n\n**Theme**: Dark mode with Twitch purple (HSL 265 100% 70%)\n\n---\n\n## Quick Reference\n\n### Start Development\n```bash\nnpm run dev\n```\n\n### Database Commands\n```bash\nnpm run db:push          # Sync schema to database\nnpm run db:push --force  # Force sync (use with caution)\nnpm run db:studio        # Open Drizzle Studio (database GUI)\n```\n\n### Build for Production\n```bash\nnpm run build\nnpm start\n```\n\n### Environment Variables Required\n- `DATABASE_URL` - PostgreSQL connection string\n- `OPENAI_API_KEY` - OpenAI API key\n- `SESSION_SECRET` - Random string for session encryption\n- `ELEVENLABS_API_KEY` - (Optional) For TTS integration\n\n---\n\n## Contact & Support\n\nFor issues or questions:\n1. Check this documentation\n2. Review server logs\n3. Test with Playwright e2e tests\n4. Check replit.md for architecture details\n\n**Last Updated**: 2025-10-20\n**Version**: 1.0.0\n**Status**: Production Ready \n","size_bytes":22999},"server/routes.ts":{"content":"// Reference: javascript_websocket blueprint\nimport type { Express } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { WebSocketServer, WebSocket } from \"ws\";\nimport { storage } from \"./storage\";\nimport {\n  insertChatMessageSchema,\n  insertAiAnalysisSchema,\n  insertAiCommandSchema,\n  insertSettingsSchema,\n  insertUserProfileSchema,\n  insertUserInsightSchema,\n} from \"@shared/schema\";\nimport { connectToTwitch, disconnectFromTwitch, addWebSocketClient, getTwitchClient } from \"./twitch-client\";\nimport { twitchOAuthService } from \"./twitch-oauth-service\";\n\nexport async function registerRoutes(app: Express): Promise<Server> {\n  // Chat Messages\n  app.get(\"/api/messages\", async (req, res) => {\n    try {\n      const messages = await storage.getChatMessages(100);\n      res.json(messages);\n    } catch (error) {\n      console.error(\"Error fetching messages:\", error);\n      res.status(500).json({ error: \"Failed to fetch messages\" });\n    }\n  });\n\n  app.post(\"/api/messages\", async (req, res) => {\n    try {\n      const data = insertChatMessageSchema.parse(req.body);\n      const message = await storage.createChatMessage(data);\n      res.json(message);\n    } catch (error) {\n      console.error(\"Error creating message:\", error);\n      res.status(400).json({ error: \"Invalid message data\" });\n    }\n  });\n\n  // AI Analyses\n  app.get(\"/api/analyses\", async (req, res) => {\n    try {\n      const analyses = await storage.getAiAnalyses();\n      res.json(analyses);\n    } catch (error) {\n      console.error(\"Error fetching analyses:\", error);\n      res.status(500).json({ error: \"Failed to fetch analyses\" });\n    }\n  });\n\n  app.post(\"/api/analyses\", async (req, res) => {\n    try {\n      const data = insertAiAnalysisSchema.parse(req.body);\n      const analysis = await storage.createAiAnalysis(data);\n      res.json(analysis);\n    } catch (error) {\n      console.error(\"Error creating analysis:\", error);\n      res.status(400).json({ error: \"Invalid analysis data\" });\n    }\n  });\n\n  // AI Commands\n  app.get(\"/api/commands\", async (req, res) => {\n    try {\n      const commands = await storage.getAiCommands();\n      res.json(commands);\n    } catch (error) {\n      console.error(\"Error fetching commands:\", error);\n      res.status(500).json({ error: \"Failed to fetch commands\" });\n    }\n  });\n\n  app.post(\"/api/commands\", async (req, res) => {\n    try {\n      const data = insertAiCommandSchema.parse(req.body);\n      const command = await storage.createAiCommand(data);\n      res.json(command);\n    } catch (error) {\n      console.error(\"Error creating command:\", error);\n      res.status(400).json({ error: \"Invalid command data\" });\n    }\n  });\n\n  app.patch(\"/api/commands/:id\", async (req, res) => {\n    try {\n      const { id } = req.params;\n      const command = await storage.updateAiCommand(id, req.body);\n      res.json(command);\n    } catch (error) {\n      console.error(\"Error updating command:\", error);\n      res.status(400).json({ error: \"Failed to update command\" });\n    }\n  });\n\n  app.delete(\"/api/commands/:id\", async (req, res) => {\n    try {\n      const { id } = req.params;\n      await storage.deleteAiCommand(id);\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error deleting command:\", error);\n      res.status(400).json({ error: \"Failed to delete command\" });\n    }\n  });\n\n  // User Profiles\n  app.get(\"/api/users\", async (req, res) => {\n    try {\n      const users = await storage.getAllUserProfiles();\n      res.json(users);\n    } catch (error) {\n      console.error(\"Error fetching users:\", error);\n      res.status(500).json({ error: \"Failed to fetch users\" });\n    }\n  });\n\n  app.get(\"/api/users/vips\", async (req, res) => {\n    try {\n      const vips = await storage.getVipUsers();\n      res.json(vips);\n    } catch (error) {\n      console.error(\"Error fetching VIPs:\", error);\n      res.status(500).json({ error: \"Failed to fetch VIPs\" });\n    }\n  });\n\n  app.get(\"/api/users/vips/streams\", async (req, res) => {\n    try {\n      const vips = await storage.getVipUsers();\n      const vipUserIds = vips.map(vip => vip.userId);\n      \n      if (vipUserIds.length === 0) {\n        return res.json([]);\n      }\n\n      const streams = await twitchOAuthService.getStreams(vipUserIds);\n      \n      res.json(streams);\n    } catch (error) {\n      console.error(\"Error fetching VIP streams:\", error);\n      res.status(500).json({ error: \"Failed to fetch VIP streams\" });\n    }\n  });\n\n  app.get(\"/api/users/vips/enhanced\", async (req, res) => {\n    try {\n      const vips = await storage.getVipUsers();\n      \n      if (vips.length === 0) {\n        return res.json([]);\n      }\n\n      // Fetch enhanced info for all VIPs in parallel\n      const enhancedVips = await Promise.all(\n        vips.map(async (vip) => {\n          const enhancedInfo = await twitchOAuthService.getEnhancedUserInfo(vip.username);\n          return {\n            ...vip,\n            profileImageUrl: enhancedInfo.profileImageUrl,\n            followerCount: enhancedInfo.followerCount,\n            isLive: enhancedInfo.isLive,\n            viewerCount: enhancedInfo.viewerCount,\n            game: enhancedInfo.game,\n          };\n        })\n      );\n\n      res.json(enhancedVips);\n    } catch (error) {\n      console.error(\"Error fetching enhanced VIP data:\", error);\n      res.status(500).json({ error: \"Failed to fetch enhanced VIP data\" });\n    }\n  });\n\n  app.get(\"/api/users/:userId\", async (req, res) => {\n    try {\n      const { userId } = req.params;\n      const user = await storage.getUserProfile(userId);\n      if (!user) {\n        return res.status(404).json({ error: \"User not found\" });\n      }\n      res.json(user);\n    } catch (error) {\n      console.error(\"Error fetching user:\", error);\n      res.status(500).json({ error: \"Failed to fetch user\" });\n    }\n  });\n\n  app.post(\"/api/users\", async (req, res) => {\n    try {\n      const data = insertUserProfileSchema.parse(req.body);\n      const user = await storage.createOrUpdateUserProfile(data);\n      res.json(user);\n    } catch (error) {\n      console.error(\"Error creating/updating user:\", error);\n      res.status(400).json({ error: \"Invalid user data\" });\n    }\n  });\n\n  app.patch(\"/api/users/:userId/vip\", async (req, res) => {\n    try {\n      const { userId } = req.params;\n      const { isVip } = req.body;\n      const user = await storage.toggleVip(userId, isVip);\n      res.json(user);\n    } catch (error) {\n      console.error(\"Error toggling VIP status:\", error);\n      res.status(400).json({ error: \"Failed to update VIP status\" });\n    }\n  });\n\n  // Active Chatters\n  app.get(\"/api/chatters/active\", async (req, res) => {\n    try {\n      const { getTwitchClient, activeChattersService } = await import(\"./twitch-client\");\n      const chatters = activeChattersService.getActiveChatters();\n      res.json(chatters);\n    } catch (error) {\n      console.error(\"Error fetching active chatters:\", error);\n      res.status(500).json({ error: \"Failed to fetch active chatters\" });\n    }\n  });\n\n  app.get(\"/api/chatters/search\", async (req, res) => {\n    try {\n      const { activeChattersService } = await import(\"./twitch-client\");\n      const query = req.query.q as string || \"\";\n      const results = activeChattersService.searchChatters(query);\n      res.json(results);\n    } catch (error) {\n      console.error(\"Error searching chatters:\", error);\n      res.status(500).json({ error: \"Failed to search chatters\" });\n    }\n  });\n\n  // User Insights\n  app.get(\"/api/insights\", async (req, res) => {\n    try {\n      const insights = await storage.getAllUserInsights();\n      res.json(insights);\n    } catch (error) {\n      console.error(\"Error fetching insights:\", error);\n      res.status(500).json({ error: \"Failed to fetch insights\" });\n    }\n  });\n\n  app.get(\"/api/insights/:userId\", async (req, res) => {\n    try {\n      const { userId } = req.params;\n      const insight = await storage.getUserInsight(userId);\n      if (!insight) {\n        return res.status(404).json({ error: \"Insight not found\" });\n      }\n      res.json(insight);\n    } catch (error) {\n      console.error(\"Error fetching insight:\", error);\n      res.status(500).json({ error: \"Failed to fetch insight\" });\n    }\n  });\n\n  app.post(\"/api/insights\", async (req, res) => {\n    try {\n      const data = insertUserInsightSchema.parse(req.body);\n      const insight = await storage.saveUserInsight(data);\n      res.json(insight);\n    } catch (error) {\n      console.error(\"Error saving insight:\", error);\n      res.status(400).json({ error: \"Invalid insight data\" });\n    }\n  });\n\n  // Settings\n  app.get(\"/api/settings\", async (req, res) => {\n    try {\n      const settings = await storage.getSettings();\n      res.json(settings);\n    } catch (error) {\n      console.error(\"Error fetching settings:\", error);\n      res.status(500).json({ error: \"Failed to fetch settings\" });\n    }\n  });\n\n  app.post(\"/api/settings\", async (req, res) => {\n    try {\n      const data = insertSettingsSchema.parse(req.body);\n      const setting = await storage.createSettings(data);\n      \n      if (data.twitchChannel && data.twitchUsername) {\n        await connectToTwitch(data.twitchChannel, data.twitchUsername);\n      }\n      \n      res.json(setting);\n    } catch (error) {\n      console.error(\"Error creating settings:\", error);\n      res.status(400).json({ error: \"Invalid settings data\" });\n    }\n  });\n\n  app.patch(\"/api/settings/:id\", async (req, res) => {\n    try {\n      const { id } = req.params;\n      const setting = await storage.updateSettings(id, req.body);\n      \n      // Try to reconnect to Twitch, but don't fail the settings save if it errors\n      if (req.body.twitchChannel && req.body.twitchUsername) {\n        try {\n          await connectToTwitch(req.body.twitchChannel, req.body.twitchUsername);\n        } catch (twitchError) {\n          console.error(\"Warning: Twitch reconnection failed, but settings saved:\", twitchError);\n        }\n      }\n      \n      // Update DachiStream cycle interval if it changed\n      if (req.body.dachiastreamCycleInterval !== undefined && (app as any).dachiStreamService) {\n        const dachiStreamService = (app as any).dachiStreamService;\n        dachiStreamService.updateCycleInterval(req.body.dachiastreamCycleInterval);\n      }\n      \n      res.json(setting);\n    } catch (error) {\n      console.error(\"Error updating settings:\", error);\n      res.status(400).json({ error: \"Failed to update settings\" });\n    }\n  });\n\n  // Moderation Actions\n  app.get(\"/api/moderation-actions\", async (req, res) => {\n    try {\n      const limit = req.query.limit ? parseInt(req.query.limit as string) : 100;\n      const actions = await storage.getModerationActions(limit);\n      res.json(actions);\n    } catch (error) {\n      console.error(\"Error fetching moderation actions:\", error);\n      res.status(500).json({ error: \"Failed to fetch moderation actions\" });\n    }\n  });\n\n  // Twitch OAuth Routes\n  app.get(\"/api/auth/twitch\", (req, res) => {\n    try {\n      const authUrl = twitchOAuthService.getAuthorizationUrl();\n      console.log(\"=== TWITCH OAUTH DEBUG ===\");\n      console.log(\"Generated Auth URL:\", authUrl);\n      console.log(\"REPLIT_DEV_DOMAIN:\", process.env.REPLIT_DEV_DOMAIN);\n      console.log(\"Expected callback:\", process.env.REPLIT_DEV_DOMAIN \n        ? `https://${process.env.REPLIT_DEV_DOMAIN}/api/auth/twitch/callback`\n        : 'http://localhost:5000/api/auth/twitch/callback');\n      console.log(\"========================\");\n      res.redirect(authUrl);\n    } catch (error) {\n      console.error(\"Error generating auth URL:\", error);\n      res.status(500).json({ error: \"Failed to generate authorization URL\" });\n    }\n  });\n\n  app.get(\"/api/auth/twitch/callback\", async (req, res) => {\n    console.log(\"=== OAUTH CALLBACK HIT ===\");\n    console.log(\"Query params:\", req.query);\n    console.log(\"========================\");\n    \n    try {\n      const { code, error } = req.query;\n      \n      if (error) {\n        console.error(\"OAuth error from Twitch:\", error);\n        return res.redirect(`/?auth=error&reason=${error}`);\n      }\n      \n      if (!code || typeof code !== 'string') {\n        console.error(\"No authorization code received\");\n        return res.status(400).json({ error: \"Authorization code is required\" });\n      }\n\n      // Exchange code for token\n      const tokenResponse = await twitchOAuthService.exchangeCodeForToken(code);\n      \n      // Get user info\n      const twitchUser = await twitchOAuthService.getTwitchUser(tokenResponse.access_token);\n      \n      // Calculate token expiration\n      const expiresAt = new Date(Date.now() + tokenResponse.expires_in * 1000);\n      \n      // Save authenticated user\n      await storage.saveAuthenticatedUser({\n        twitchUserId: twitchUser.id,\n        twitchUsername: twitchUser.login,\n        twitchDisplayName: twitchUser.display_name,\n        twitchProfileImageUrl: twitchUser.profile_image_url,\n        twitchEmail: twitchUser.email,\n        accessToken: tokenResponse.access_token,\n        refreshToken: tokenResponse.refresh_token,\n        tokenExpiresAt: expiresAt,\n      });\n\n      // Auto-connect to Twitch with OAuth token\n      try {\n        await connectToTwitch(twitchUser.login, twitchUser.login);\n        console.log(`Auto-connected to Twitch channel: ${twitchUser.login}`);\n      } catch (error) {\n        console.error(\"Failed to auto-connect after OAuth:\", error);\n      }\n\n      // Redirect to dashboard\n      res.redirect(\"/?auth=success\");\n    } catch (error) {\n      console.error(\"Error in OAuth callback:\", error);\n      res.redirect(\"/?auth=error\");\n    }\n  });\n\n  app.post(\"/api/auth/logout\", async (req, res) => {\n    try {\n      await storage.deleteAuthenticatedUser();\n      disconnectFromTwitch();\n      res.json({ success: true, message: \"Logged out successfully\" });\n    } catch (error) {\n      console.error(\"Error logging out:\", error);\n      res.status(500).json({ error: \"Failed to logout\" });\n    }\n  });\n\n  app.get(\"/api/auth/user\", async (req, res) => {\n    try {\n      const user = await storage.getAuthenticatedUser();\n      if (!user) {\n        return res.status(404).json({ error: \"No authenticated user\" });\n      }\n      res.json(user);\n    } catch (error) {\n      console.error(\"Error fetching authenticated user:\", error);\n      res.status(500).json({ error: \"Failed to fetch authenticated user\" });\n    }\n  });\n\n  // Twitch Connection Control\n  app.post(\"/api/twitch/connect\", async (req, res) => {\n    try {\n      const { channel, username } = req.body;\n      if (!channel) {\n        return res.status(400).json({ error: \"Channel name is required\" });\n      }\n      await connectToTwitch(channel, username);\n      res.json({ success: true, message: \"Connected to Twitch\" });\n    } catch (error) {\n      console.error(\"Error connecting to Twitch:\", error);\n      res.status(500).json({ error: \"Failed to connect to Twitch\" });\n    }\n  });\n\n  app.post(\"/api/twitch/disconnect\", async (req, res) => {\n    try {\n      disconnectFromTwitch();\n      res.json({ success: true, message: \"Disconnected from Twitch\" });\n    } catch (error) {\n      console.error(\"Error disconnecting from Twitch:\", error);\n      res.status(500).json({ error: \"Failed to disconnect from Twitch\" });\n    }\n  });\n\n  app.get(\"/api/twitch/status\", async (req, res) => {\n    try {\n      const client = getTwitchClient();\n      const messageCount = await storage.getChatMessages(1);\n      \n      if (!client) {\n        return res.json({\n          connected: false,\n          channel: null,\n          messageCount: messageCount.length,\n        });\n      }\n\n      const channels = client.getChannels();\n      res.json({\n        connected: client.readyState() === \"OPEN\",\n        channel: channels.length > 0 ? channels[0].replace('#', '') : null,\n        messageCount: messageCount.length,\n      });\n    } catch (error) {\n      console.error(\"Error getting Twitch status:\", error);\n      res.status(500).json({ error: \"Failed to get Twitch status\" });\n    }\n  });\n\n  app.get(\"/api/twitch/search-users\", async (req, res) => {\n    try {\n      const { query } = req.query;\n      \n      if (!query || typeof query !== 'string') {\n        return res.status(400).json({ error: \"Query parameter is required\" });\n      }\n\n      if (query.length < 2) {\n        return res.json([]);\n      }\n\n      const users = await twitchOAuthService.searchUsers(query);\n      res.json(users);\n    } catch (error) {\n      console.error(\"Error searching Twitch users:\", error);\n      res.status(500).json({ error: \"Failed to search Twitch users\" });\n    }\n  });\n\n  // Get user's latest clip for test shoutout\n  app.get(\"/api/twitch/user-clip\", async (req, res) => {\n    try {\n      const { username } = req.query;\n      \n      if (!username || typeof username !== 'string') {\n        return res.status(400).json({ error: \"Username parameter is required\" });\n      }\n\n      const clip = await twitchOAuthService.getLatestClip(username);\n      res.json({ clip });\n    } catch (error) {\n      console.error(\"Error fetching user clip:\", error);\n      res.status(500).json({ error: \"Failed to fetch user clip\" });\n    }\n  });\n\n  // Raid Management\n  app.get(\"/api/raids\", async (req, res) => {\n    try {\n      const raids = await storage.getRaids(50);\n      res.json(raids);\n    } catch (error) {\n      console.error(\"Error fetching raids:\", error);\n      res.status(500).json({ error: \"Failed to fetch raids\" });\n    }\n  });\n\n  app.post(\"/api/raids/start\", async (req, res) => {\n    try {\n      const { toUsername } = req.body;\n      \n      if (!toUsername) {\n        return res.status(400).json({ error: \"Target username is required\" });\n      }\n\n      // Get authenticated user\n      const user = await storage.getAuthenticatedUser();\n      if (!user) {\n        return res.status(401).json({ error: \"Not authenticated. Please connect with Twitch in Settings.\" });\n      }\n\n      // Get target user info\n      const targetUser = await twitchOAuthService.getUserByUsername(toUsername);\n      if (!targetUser) {\n        return res.status(404).json({ error: \"Target user not found\" });\n      }\n\n      // Start the raid\n      const success = await twitchOAuthService.startRaid(\n        user.twitchUserId,\n        targetUser.id,\n        user.accessToken\n      );\n\n      if (success) {\n        res.json({ success: true, message: `Raid started to ${toUsername}` });\n      } else {\n        res.status(500).json({ error: \"Failed to start raid. Please try reconnecting your Twitch account in Settings to grant raid permissions.\" });\n      }\n    } catch (error: any) {\n      console.error(\"Error starting raid:\", error);\n      \n      // Check if it's a scope error\n      if (error.status === 401 || (error.message && error.message.includes('scope'))) {\n        return res.status(403).json({ \n          error: \"Missing permissions. Please reconnect your Twitch account in Settings to grant raid permissions.\",\n          needsReauth: true\n        });\n      }\n      \n      res.status(500).json({ error: \"Failed to start raid. Please try again.\" });\n    }\n  });\n\n  // Browser Source\n  app.post(\"/api/browser-source/generate\", async (req, res) => {\n    try {\n      const settings = await storage.getSettings();\n      if (settings.length === 0) {\n        return res.status(404).json({ error: \"Settings not found\" });\n      }\n\n      const token = await storage.generateBrowserSourceToken(settings[0].id);\n      const domain = process.env.REPLIT_DEV_DOMAIN || 'localhost:5000';\n      const protocol = process.env.REPLIT_DEV_DOMAIN ? 'https' : 'http';\n      const url = `${protocol}://${domain}/browser-source/${token}`;\n\n      res.json({ token, url });\n    } catch (error) {\n      console.error(\"Error generating browser source token:\", error);\n      res.status(500).json({ error: \"Failed to generate browser source token\" });\n    }\n  });\n\n  app.post(\"/api/browser-source/toggle\", async (req, res) => {\n    try {\n      const { enabled } = req.body;\n      const settings = await storage.getSettings();\n      \n      if (settings.length === 0) {\n        return res.status(404).json({ error: \"Settings not found\" });\n      }\n\n      const updated = await storage.updateSettings(settings[0].id, {\n        browserSourceEnabled: enabled,\n      });\n\n      res.json(updated);\n    } catch (error) {\n      console.error(\"Error toggling browser source:\", error);\n      res.status(500).json({ error: \"Failed to toggle browser source\" });\n    }\n  });\n\n  // DachiStream Controls\n  app.post(\"/api/dachistream/pause\", async (req, res) => {\n    try {\n      const dachiStreamService = (app as any).dachiStreamService;\n      if (!dachiStreamService) {\n        return res.status(503).json({ error: \"DachiStream service not available\" });\n      }\n      dachiStreamService.pause();\n      res.json({ success: true, message: \"DachiStream paused\" });\n    } catch (error) {\n      console.error(\"Error pausing DachiStream:\", error);\n      res.status(500).json({ error: \"Failed to pause DachiStream\" });\n    }\n  });\n\n  app.post(\"/api/dachistream/resume\", async (req, res) => {\n    try {\n      const dachiStreamService = (app as any).dachiStreamService;\n      if (!dachiStreamService) {\n        return res.status(503).json({ error: \"DachiStream service not available\" });\n      }\n      dachiStreamService.resume();\n      res.json({ success: true, message: \"DachiStream resumed\" });\n    } catch (error) {\n      console.error(\"Error resuming DachiStream:\", error);\n      res.status(500).json({ error: \"Failed to resume DachiStream\" });\n    }\n  });\n\n  app.post(\"/api/dachistream/update-interval\", async (req, res) => {\n    try {\n      const { intervalSeconds } = req.body;\n      if (!intervalSeconds || intervalSeconds < 1 || intervalSeconds > 300) {\n        return res.status(400).json({ error: \"Interval must be between 1 and 300 seconds\" });\n      }\n      const dachiStreamService = (app as any).dachiStreamService;\n      if (!dachiStreamService) {\n        return res.status(503).json({ error: \"DachiStream service not available\" });\n      }\n      \n      // Save interval to database settings so it persists across restarts\n      const allSettings = await storage.getSettings();\n      if (allSettings.length > 0) {\n        const settings = allSettings[0];\n        await storage.updateSettings(settings.id, {\n          dachiastreamCycleInterval: intervalSeconds,\n        });\n      }\n      \n      // Update the service\n      dachiStreamService.updateCycleInterval(intervalSeconds);\n      res.json({ success: true, intervalSeconds });\n    } catch (error) {\n      console.error(\"Error updating DachiStream interval:\", error);\n      res.status(500).json({ error: \"Failed to update interval\" });\n    }\n  });\n\n  app.post(\"/api/dachistream/reset\", async (req, res) => {\n    try {\n      const dachiStreamService = (app as any).dachiStreamService;\n      if (!dachiStreamService) {\n        return res.status(503).json({ error: \"DachiStream service not available\" });\n      }\n      dachiStreamService.reset();\n      res.json({ success: true, message: \"DachiStream reset\" });\n    } catch (error) {\n      console.error(\"Error resetting DachiStream:\", error);\n      res.status(500).json({ error: \"Failed to reset DachiStream\" });\n    }\n  });\n\n  app.get(\"/api/dachistream/interval\", (req, res) => {\n    try {\n      const dachiStreamService = (app as any).dachiStreamService;\n      if (!dachiStreamService) {\n        return res.status(503).json({ error: \"DachiStream service not available\" });\n      }\n      res.json({ intervalSeconds: dachiStreamService.getCycleInterval() });\n    } catch (error) {\n      console.error(\"Error getting DachiStream interval:\", error);\n      res.status(500).json({ error: \"Failed to get interval\" });\n    }\n  });\n  // Speech-to-Text for Streamer Voice\n  app.post(\"/api/stt/transcribe\", async (req, res) => {\n    try {\n      // This endpoint will handle audio transcription using Groq Whisper\n      // Implementation will be added when integrating services\n      res.json({\n        success: true,\n        message: \"STT transcription endpoint ready\",\n      });\n    } catch (error) {\n      console.error(\"Error transcribing audio:\", error);\n      res.status(500).json({ error: \"Failed to transcribe audio\" });\n    }\n  });\n\n  app.post(\"/api/stt/cleanup\", async (req, res) => {\n    try {\n      const { text } = req.body;\n      if (!text) {\n        return res.status(400).json({ error: \"Text is required\" });\n      }\n      \n      // This uses the Groq AI service for speech cleanup\n      res.json({\n        original: text,\n        cleaned: text,\n      });\n    } catch (error) {\n      console.error(\"Error cleaning up speech:\", error);\n      res.status(500).json({ error: \"Failed to clean up speech\" });\n    }\n  });\n\n  // Browser Source HTML Page for OBS\n  app.get(\"/browser-source/:token\", async (req, res) => {\n    try {\n      const { token } = req.params;\n      \n      // Verify token\n      const settings = await storage.getBrowserSourceSettings(token);\n      if (!settings || !settings.browserSourceEnabled) {\n        return res.status(404).send(\"Browser source not found or disabled\");\n      }\n\n      const domain = process.env.REPLIT_DEV_DOMAIN || 'localhost:5000';\n      const wsProtocol = process.env.REPLIT_DEV_DOMAIN ? 'wss' : 'ws';\n      \n      // Serve HTML page with WebSocket connection for live shoutouts\n      const html = `\n<!DOCTYPE html>\n<html>\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>StreamDachi VIP Shoutouts</title>\n  <style>\n    * {\n      margin: 0;\n      padding: 0;\n      box-sizing: border-box;\n    }\n    \n    body {\n      background: transparent;\n      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n      overflow: hidden;\n    }\n    \n    #shoutout-container {\n      position: fixed;\n      bottom: 20px;\n      left: 20px;\n      max-width: 600px;\n      opacity: 0;\n      transform: translateY(100px);\n      transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);\n    }\n    \n    #shoutout-container.show {\n      opacity: 1;\n      transform: translateY(0);\n    }\n    \n    .shoutout {\n      background: linear-gradient(135deg, #6441a5 0%, #9146ff 100%);\n      padding: 20px 30px;\n      border-radius: 15px;\n      box-shadow: 0 10px 30px rgba(148, 70, 255, 0.5);\n      color: white;\n      font-size: 24px;\n      font-weight: 600;\n      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);\n      border: 3px solid rgba(255, 255, 255, 0.3);\n    }\n    \n    .vip-icon {\n      display: inline-block;\n      margin-right: 10px;\n      font-size: 28px;\n      animation: bounce 1s infinite;\n    }\n    \n    @keyframes bounce {\n      0%, 100% { transform: translateY(0); }\n      50% { transform: translateY(-10px); }\n    }\n  </style>\n</head>\n<body>\n  <div id=\"shoutout-container\">\n    <div class=\"shoutout\">\n      <span class=\"vip-icon\"></span>\n      <span id=\"shoutout-text\"></span>\n      <span class=\"vip-icon\"></span>\n    </div>\n  </div>\n\n  <script>\n    const ws = new WebSocket('${wsProtocol}://${domain}/ws');\n    const container = document.getElementById('shoutout-container');\n    const text = document.getElementById('shoutout-text');\n    let hideTimeout;\n    \n    ws.onopen = () => {\n      console.log('Connected to StreamDachi');\n    };\n    \n    ws.onmessage = (event) => {\n      try {\n        const data = JSON.parse(event.data);\n        \n        // Listen for auto_shoutout events\n        if (data.event === 'auto_shoutout') {\n          showShoutout(data.data.username);\n        }\n      } catch (error) {\n        console.error('Error parsing message:', error);\n      }\n    };\n    \n    function showShoutout(username) {\n      // Clear any existing timeout\n      if (hideTimeout) {\n        clearTimeout(hideTimeout);\n      }\n      \n      // Update text and show\n      text.textContent = \\`Welcome VIP @\\${username}! Thanks for being amazing!\\`;\n      container.classList.add('show');\n      \n      // Hide after 5 seconds\n      hideTimeout = setTimeout(() => {\n        container.classList.remove('show');\n      }, 5000);\n    }\n    \n    ws.onerror = (error) => {\n      console.error('WebSocket error:', error);\n    };\n    \n    ws.onclose = () => {\n      console.log('Disconnected from StreamDachi');\n      // Attempt reconnection after 3 seconds\n      setTimeout(() => {\n        window.location.reload();\n      }, 3000);\n    };\n  </script>\n</body>\n</html>\n      `;\n      \n      res.setHeader('Content-Type', 'text/html');\n      res.send(html);\n    } catch (error) {\n      console.error(\"Error serving browser source:\", error);\n      res.status(500).send(\"Internal server error\");\n    }\n  });\n\n  const httpServer = createServer(app);\n\n  // WebSocket Server - using distinct path to avoid conflicts with Vite HMR\n  const wss = new WebSocketServer({ server: httpServer, path: '/ws' });\n\n  wss.on(\"connection\", (ws: WebSocket) => {\n    console.log(\"WebSocket client connected\");\n    addWebSocketClient(ws);\n\n    ws.on(\"message\", (message: string) => {\n      try {\n        const data = JSON.parse(message.toString());\n        console.log(\"Received WebSocket message:\", data);\n      } catch (error) {\n        console.error(\"Error parsing WebSocket message:\", error);\n      }\n    });\n\n    ws.on(\"close\", () => {\n      console.log(\"WebSocket client disconnected\");\n    });\n  });\n\n  // Auto-connect to Twitch if authenticated user exists (OAuth takes priority)\n  const authenticatedUser = await storage.getAuthenticatedUser();\n  if (authenticatedUser && authenticatedUser.twitchUsername) {\n    try {\n      await connectToTwitch(authenticatedUser.twitchUsername, authenticatedUser.twitchUsername);\n      console.log(`Auto-connected to Twitch via OAuth: ${authenticatedUser.twitchUsername}`);\n    } catch (error) {\n      console.error(\"Failed to auto-connect to Twitch:\", error);\n    }\n  } else {\n    // Fallback to manual settings if no OAuth user\n    const existingSettings = await storage.getSettings();\n    if (existingSettings.length > 0) {\n      const setting = existingSettings[0];\n      const channel = setting.twitchChannel;\n      if (channel) {\n        try {\n          await connectToTwitch(channel, setting.twitchUsername ?? undefined);\n          console.log(`Auto-connected to Twitch channel: ${channel}`);\n        } catch (error) {\n          console.error(\"Failed to auto-connect to Twitch:\", error);\n        }\n      }\n    }\n  }\n\n  // DachiStream Monitor API\n  app.get(\"/api/dachistream/status\", (req, res) => {\n    try {\n      const dachiStreamService = (req.app as any).dachiStreamService;\n      if (!dachiStreamService) {\n        return res.status(503).json({ error: \"DachiStream service not available\" });\n      }\n      \n      const state = dachiStreamService.getState();\n      res.json(state);\n    } catch (error) {\n      console.error(\"Error fetching DachiStream status:\", error);\n      res.status(500).json({ error: \"Failed to fetch status\" });\n    }\n  });\n\n  app.get(\"/api/dachistream/logs\", (req, res) => {\n    try {\n      const dachiStreamService = (req.app as any).dachiStreamService;\n      if (!dachiStreamService) {\n        return res.status(503).json({ error: \"DachiStream service not available\" });\n      }\n      \n      const logs = dachiStreamService.getLogs();\n      res.json(logs);\n    } catch (error) {\n      console.error(\"Error fetching DachiStream logs:\", error);\n      res.status(500).json({ error: \"Failed to fetch logs\" });\n    }\n  });\n\n  app.get(\"/api/dachistream/buffer\", (req, res) => {\n    try {\n      const dachiStreamService = (req.app as any).dachiStreamService;\n      if (!dachiStreamService) {\n        return res.status(503).json({ error: \"DachiStream service not available\" });\n      }\n      \n      const messages = dachiStreamService.getBufferMessages();\n      res.json(messages);\n    } catch (error) {\n      console.error(\"Error fetching DachiStream buffer:\", error);\n      res.status(500).json({ error: \"Failed to fetch buffer\" });\n    }\n  });\n\n  // Voice Transcription API - Groq Whisper\n  const multer = (await import(\"multer\")).default;\n  const upload = multer({ storage: multer.memoryStorage() });\n  \n  app.post(\"/api/voice/transcribe\", upload.single(\"audio\"), async (req, res) => {\n    try {\n      if (!req.file) {\n        return res.status(400).json({ error: \"Audio file is required\" });\n      }\n\n      const { transcribeAudio } = await import(\"./groq-service\");\n      \n      // Create a File object from the buffer\n      const audioFile = new File([req.file.buffer], req.file.originalname, {\n        type: req.file.mimetype,\n      });\n      \n      const text = await transcribeAudio(audioFile);\n      \n      res.json({ text });\n    } catch (error) {\n      console.error(\"Error transcribing audio:\", error);\n      res.status(500).json({ error: \"Failed to transcribe audio\" });\n    }\n  });\n\n  // Voice Enhancement API - with database logging and personality support\n  app.post(\"/api/voice/enhance\", async (req, res) => {\n    try {\n      const { text, personality } = req.body;\n      \n      if (!text || typeof text !== \"string\") {\n        return res.status(400).json({ error: \"Text is required\" });\n      }\n\n      const { enhanceSpeechForChat } = await import(\"./groq-service\");\n      \n      // Get personality from request or settings\n      let selectedPersonality = personality;\n      if (!selectedPersonality) {\n        const allSettings = await storage.getSettings();\n        const settings = allSettings[0];\n        selectedPersonality = settings?.voiceAiPersonality || \"Neutral\";\n      }\n      \n      const result = await enhanceSpeechForChat(text, selectedPersonality as any);\n      \n      // Save to database\n      try {\n        await storage.createVoiceAiResponse({\n          originalText: result.original,\n          rephrasedText: result.enhanced,\n          wasSpoken: false, // Will be updated when TTS plays it\n        });\n      } catch (dbError) {\n        console.error(\"Failed to save voice AI response to DB:\", dbError);\n        // Don't fail the request if DB save fails\n      }\n      \n      res.json(result);\n    } catch (error) {\n      console.error(\"Error enhancing speech:\", error);\n      res.status(500).json({ error: \"Failed to enhance speech\" });\n    }\n  });\n\n  // Voice AI Response History - for Monitor page\n  app.get(\"/api/voice/responses\", async (req, res) => {\n    try {\n      const limit = parseInt(req.query.limit as string) || 50;\n      const responses = await storage.getVoiceAiResponses(limit);\n      res.json(responses);\n    } catch (error) {\n      console.error(\"Error fetching voice AI responses:\", error);\n      res.status(500).json({ error: \"Failed to fetch voice AI responses\" });\n    }\n  });\n\n  // Voice Personality Settings\n  app.post(\"/api/settings/voice-personality\", async (req, res) => {\n    try {\n      const { personality, pitch, speed } = req.body;\n      \n      const allSettings = await storage.getSettings();\n      if (allSettings.length === 0) {\n        return res.status(404).json({ error: \"Settings not found\" });\n      }\n      \n      const settings = allSettings[0];\n      await storage.updateSettings(settings.id, {\n        voiceAiPersonality: personality,\n        voiceAiPitch: Math.round(pitch * 10), // Store as 0-20 (0.0-2.0)\n        voiceAiSpeed: Math.round(speed * 10), // Store as 0-20 (0.0-2.0)\n      });\n      \n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error updating voice personality:\", error);\n      res.status(500).json({ error: \"Failed to update voice personality\" });\n    }\n  });\n\n  return httpServer;\n}\n","size_bytes":35433},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","size_bytes":791},"client/src/components/chat-message.tsx":{"content":"import { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { formatDistanceToNow } from \"date-fns\";\nimport type { ChatMessageWithAnalysis } from \"@shared/schema\";\n\ninterface ChatMessageProps {\n  message: ChatMessageWithAnalysis;\n  showSentiment?: boolean; // Show sentiment badge (for Analytics only)\n}\n\nexport function ChatMessage({ message, showSentiment = false }: ChatMessageProps) {\n  const getSentimentColor = (sentiment?: string) => {\n    if (!sentiment) return \"\";\n    switch (sentiment) {\n      case \"positive\":\n        return \"border-l-chart-2\";\n      case \"negative\":\n        return \"border-l-destructive\";\n      default:\n        return \"border-l-chart-3\";\n    }\n  };\n\n  const getUserInitials = (username: string) => {\n    return username.slice(0, 2).toUpperCase();\n  };\n\n  return (\n    <div\n      className={`flex items-start gap-3 px-4 py-2 hover-elevate ${\n        showSentiment && message.analysis ? `border-l-2 ${getSentimentColor(message.analysis.sentiment)}` : \"\"\n      }`}\n      data-testid={`chat-message-${message.id}`}\n    >\n      <Avatar className=\"h-8 w-8\">\n        <AvatarFallback className=\"bg-primary text-primary-foreground text-xs\">\n          {getUserInitials(message.username)}\n        </AvatarFallback>\n      </Avatar>\n      <div className=\"flex-1 min-w-0\">\n        <div className=\"flex items-baseline gap-2 flex-wrap\">\n          <span\n            className=\"font-mono text-sm font-semibold\"\n            style={{ color: message.userColor || \"hsl(var(--primary))\" }}\n            data-testid={`message-username-${message.id}`}\n          >\n            {message.username}\n          </span>\n          <span className=\"text-xs font-mono text-muted-foreground\" data-testid={`message-timestamp-${message.id}`}>\n            {formatDistanceToNow(new Date(message.timestamp), { addSuffix: true })}\n          </span>\n          {showSentiment && message.analysis && (\n            <Badge variant=\"secondary\" className=\"text-xs\" data-testid={`message-sentiment-${message.id}`}>\n              {message.analysis.sentiment}\n            </Badge>\n          )}\n        </div>\n        <p className=\"text-sm text-foreground mt-1 break-words\" data-testid={`message-text-${message.id}`}>\n          {message.message}\n        </p>\n      </div>\n    </div>\n  );\n}\n","size_bytes":2326},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","size_bytes":772},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","size_bytes":1280},"server/twitch-oauth-service.ts":{"content":"export interface TwitchTokenResponse {\n  access_token: string;\n  refresh_token: string;\n  expires_in: number;\n  token_type: string;\n}\n\nexport interface TwitchUser {\n  id: string;\n  login: string;\n  display_name: string;\n  profile_image_url: string;\n  email?: string;\n}\n\nexport interface TwitchStream {\n  id: string;\n  user_id: string;\n  user_login: string;\n  user_name: string;\n  game_id: string;\n  game_name: string;\n  type: string;\n  title: string;\n  viewer_count: number;\n  started_at: string;\n  language: string;\n  thumbnail_url: string;\n  tag_ids: string[];\n  is_mature: boolean;\n}\n\nconst TWITCH_CLIENT_ID = process.env.TWITCH_CLIENT_ID || '';\nconst TWITCH_CLIENT_SECRET = process.env.TWITCH_CLIENT_SECRET || '';\nconst REDIRECT_URI = process.env.REPLIT_DEV_DOMAIN \n  ? `https://${process.env.REPLIT_DEV_DOMAIN}/api/auth/twitch/callback`\n  : 'http://localhost:5000/api/auth/twitch/callback';\n\nexport class TwitchOAuthService {\n  /**\n   * Generates the Twitch OAuth authorization URL\n   */\n  getAuthorizationUrl(): string {\n    const params = new URLSearchParams({\n      client_id: TWITCH_CLIENT_ID,\n      redirect_uri: REDIRECT_URI,\n      response_type: 'code',\n      scope: 'user:read:email chat:read chat:edit channel:manage:raids',\n    });\n\n    return `https://id.twitch.tv/oauth2/authorize?${params.toString()}`;\n  }\n\n  /**\n   * Exchanges authorization code for access token\n   */\n  async exchangeCodeForToken(code: string): Promise<TwitchTokenResponse> {\n    const params = new URLSearchParams({\n      client_id: TWITCH_CLIENT_ID,\n      client_secret: TWITCH_CLIENT_SECRET,\n      code,\n      grant_type: 'authorization_code',\n      redirect_uri: REDIRECT_URI,\n    });\n\n    const response = await fetch('https://id.twitch.tv/oauth2/token', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded',\n      },\n      body: params.toString(),\n    });\n\n    if (!response.ok) {\n      const error = await response.text();\n      throw new Error(`Failed to exchange code for token: ${error}`);\n    }\n\n    return await response.json();\n  }\n\n  /**\n   * Fetches user information from Twitch API\n   */\n  async getTwitchUser(accessToken: string): Promise<TwitchUser> {\n    const response = await fetch('https://api.twitch.tv/helix/users', {\n      headers: {\n        'Authorization': `Bearer ${accessToken}`,\n        'Client-Id': TWITCH_CLIENT_ID,\n      },\n    });\n\n    if (!response.ok) {\n      const error = await response.text();\n      throw new Error(`Failed to fetch Twitch user: ${error}`);\n    }\n\n    const data = await response.json();\n    \n    if (!data.data || data.data.length === 0) {\n      throw new Error('No user data returned from Twitch');\n    }\n\n    return data.data[0];\n  }\n\n  /**\n   * Refreshes an expired access token\n   */\n  async refreshAccessToken(refreshToken: string): Promise<TwitchTokenResponse> {\n    const params = new URLSearchParams({\n      client_id: TWITCH_CLIENT_ID,\n      client_secret: TWITCH_CLIENT_SECRET,\n      grant_type: 'refresh_token',\n      refresh_token: refreshToken,\n    });\n\n    const response = await fetch('https://id.twitch.tv/oauth2/token', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded',\n      },\n      body: params.toString(),\n    });\n\n    if (!response.ok) {\n      const error = await response.text();\n      throw new Error(`Failed to refresh access token: ${error}`);\n    }\n\n    return await response.json();\n  }\n\n  /**\n   * Validates an access token\n   */\n  async validateToken(accessToken: string): Promise<boolean> {\n    try {\n      const response = await fetch('https://id.twitch.tv/oauth2/validate', {\n        headers: {\n          'Authorization': `OAuth ${accessToken}`,\n        },\n      });\n\n      return response.ok;\n    } catch (error) {\n      return false;\n    }\n  }\n\n  /**\n   * Checks if token is expired or about to expire (within 1 hour)\n   */\n  isTokenExpired(tokenExpiresAt: Date | null): boolean {\n    if (!tokenExpiresAt) return true;\n    \n    const now = new Date();\n    const expiresAt = new Date(tokenExpiresAt);\n    const oneHourFromNow = new Date(now.getTime() + 60 * 60 * 1000);\n    \n    // Return true if token expires within the next hour\n    return expiresAt <= oneHourFromNow;\n  }\n\n  /**\n   * Gets an app access token using client credentials flow\n   * This token can be used for API calls that don't require user authentication\n   */\n  private appAccessToken: string | null = null;\n  private appTokenExpiry: Date | null = null;\n\n  async getAppAccessToken(): Promise<string> {\n    // Return cached token if still valid\n    if (this.appAccessToken && this.appTokenExpiry && this.appTokenExpiry > new Date()) {\n      return this.appAccessToken;\n    }\n\n    const params = new URLSearchParams({\n      client_id: TWITCH_CLIENT_ID,\n      client_secret: TWITCH_CLIENT_SECRET,\n      grant_type: 'client_credentials',\n    });\n\n    const response = await fetch('https://id.twitch.tv/oauth2/token', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded',\n      },\n      body: params.toString(),\n    });\n\n    if (!response.ok) {\n      const error = await response.text();\n      throw new Error(`Failed to get app access token: ${error}`);\n    }\n\n    const data = await response.json();\n    this.appAccessToken = data.access_token || null;\n    this.appTokenExpiry = new Date(Date.now() + (data.expires_in || 3600) * 1000);\n    \n    if (!this.appAccessToken) {\n      throw new Error('No access token received from Twitch');\n    }\n    \n    return this.appAccessToken;\n  }\n\n  /**\n   * Searches for Twitch users by username\n   * Returns up to 20 results matching the query\n   */\n  async searchUsers(query: string): Promise<TwitchUser[]> {\n    if (!query || query.length < 1) {\n      return [];\n    }\n\n    const appToken = await this.getAppAccessToken();\n\n    const response = await fetch(`https://api.twitch.tv/helix/search/channels?query=${encodeURIComponent(query)}&first=20`, {\n      headers: {\n        'Authorization': `Bearer ${appToken}`,\n        'Client-Id': TWITCH_CLIENT_ID,\n      },\n    });\n\n    if (!response.ok) {\n      const error = await response.text();\n      throw new Error(`Failed to search Twitch users: ${error}`);\n    }\n\n    const data = await response.json();\n    \n    // Convert channel search results to user format\n    return (data.data || []).map((channel: any) => ({\n      id: channel.broadcaster_id,\n      login: channel.broadcaster_login,\n      display_name: channel.display_name,\n      profile_image_url: channel.thumbnail_url,\n    }));\n  }\n\n  /**\n   * Initiates a raid to another broadcaster's channel\n   * Requires channel:manage:raids scope\n   */\n  async startRaid(fromBroadcasterId: string, toBroadcasterId: string, accessToken: string): Promise<boolean> {\n    const params = new URLSearchParams({\n      from_broadcaster_id: fromBroadcasterId,\n      to_broadcaster_id: toBroadcasterId,\n    });\n\n    const response = await fetch(`https://api.twitch.tv/helix/raids?${params.toString()}`, {\n      method: 'POST',\n      headers: {\n        'Authorization': `Bearer ${accessToken}`,\n        'Client-Id': TWITCH_CLIENT_ID,\n      },\n    });\n\n    if (!response.ok) {\n      const error = await response.text();\n      console.error(`Failed to start raid: ${error}`);\n      return false;\n    }\n\n    return true;\n  }\n\n  /**\n   * Gets user information by username\n   */\n  async getUserByUsername(username: string, accessToken?: string): Promise<TwitchUser | null> {\n    const token = accessToken || await this.getAppAccessToken();\n\n    const response = await fetch(`https://api.twitch.tv/helix/users?login=${encodeURIComponent(username)}`, {\n      headers: {\n        'Authorization': `Bearer ${token}`,\n        'Client-Id': TWITCH_CLIENT_ID,\n      },\n    });\n\n    if (!response.ok) {\n      return null;\n    }\n\n    const data = await response.json();\n    const user = data.data?.[0];\n    \n    if (!user) {\n      return null;\n    }\n\n    return {\n      id: user.id,\n      login: user.login,\n      display_name: user.display_name,\n      profile_image_url: user.profile_image_url,\n    };\n  }\n\n  /**\n   * Gets stream information for multiple user IDs\n   * Returns only streams that are currently live\n   */\n  async getStreams(userIds: string[]): Promise<TwitchStream[]> {\n    if (!userIds || userIds.length === 0) {\n      return [];\n    }\n\n    const appToken = await this.getAppAccessToken();\n\n    // Twitch API allows up to 100 user IDs per request\n    const chunks = [];\n    for (let i = 0; i < userIds.length; i += 100) {\n      chunks.push(userIds.slice(i, i + 100));\n    }\n\n    const allStreams: TwitchStream[] = [];\n\n    for (const chunk of chunks) {\n      const params = chunk.map(id => `user_id=${encodeURIComponent(id)}`).join('&');\n      const response = await fetch(`https://api.twitch.tv/helix/streams?${params}`, {\n        headers: {\n          'Authorization': `Bearer ${appToken}`,\n          'Client-Id': TWITCH_CLIENT_ID,\n        },\n      });\n\n      if (!response.ok) {\n        console.error('Failed to fetch streams:', await response.text());\n        continue;\n      }\n\n      const data = await response.json();\n      if (data.data && Array.isArray(data.data)) {\n        allStreams.push(...data.data);\n      }\n    }\n\n    return allStreams;\n  }\n\n  /**\n   * Gets the latest clip for a Twitch user\n   */\n  async getLatestClip(username: string): Promise<{ url: string; title: string } | null> {\n    try {\n      const appToken = await this.getAppAccessToken();\n\n      // First, get the user ID from username\n      const userResponse = await fetch(`https://api.twitch.tv/helix/users?login=${encodeURIComponent(username)}`, {\n        headers: {\n          'Authorization': `Bearer ${appToken}`,\n          'Client-Id': TWITCH_CLIENT_ID,\n        },\n      });\n\n      if (!userResponse.ok) {\n        console.error('Failed to fetch user for clips:', await userResponse.text());\n        return null;\n      }\n\n      const userData = await userResponse.json();\n      if (!userData.data || userData.data.length === 0) {\n        return null;\n      }\n\n      const broadcasterId = userData.data[0].id;\n\n      // Now get the clips for this broadcaster\n      const clipsResponse = await fetch(\n        `https://api.twitch.tv/helix/clips?broadcaster_id=${broadcasterId}&first=1`,\n        {\n          headers: {\n            'Authorization': `Bearer ${appToken}`,\n            'Client-Id': TWITCH_CLIENT_ID,\n          },\n        }\n      );\n\n      if (!clipsResponse.ok) {\n        console.error('Failed to fetch clips:', await clipsResponse.text());\n        return null;\n      }\n\n      const clipsData = await clipsResponse.json();\n      if (!clipsData.data || clipsData.data.length === 0) {\n        return null;\n      }\n\n      const clip = clipsData.data[0];\n      return {\n        url: clip.url,\n        title: clip.title,\n      };\n    } catch (error) {\n      console.error('Error fetching clip:', error);\n      return null;\n    }\n  }\n\n  /**\n   * Gets follower count for a Twitch user\n   */\n  async getFollowerCount(username: string): Promise<number> {\n    try {\n      const appToken = await this.getAppAccessToken();\n\n      // Get user ID from username\n      const userResponse = await fetch(`https://api.twitch.tv/helix/users?login=${encodeURIComponent(username)}`, {\n        headers: {\n          'Authorization': `Bearer ${appToken}`,\n          'Client-Id': TWITCH_CLIENT_ID,\n        },\n      });\n\n      if (!userResponse.ok) {\n        return 0;\n      }\n\n      const userData = await userResponse.json();\n      if (!userData.data || userData.data.length === 0) {\n        return 0;\n      }\n\n      const broadcasterId = userData.data[0].id;\n\n      // Get follower count\n      const followersResponse = await fetch(\n        `https://api.twitch.tv/helix/channels/followers?broadcaster_id=${broadcasterId}&first=1`,\n        {\n          headers: {\n            'Authorization': `Bearer ${appToken}`,\n            'Client-Id': TWITCH_CLIENT_ID,\n          },\n        }\n      );\n\n      if (!followersResponse.ok) {\n        return 0;\n      }\n\n      const followersData = await followersResponse.json();\n      return followersData.total || 0;\n    } catch (error) {\n      console.error('Error fetching follower count:', error);\n      return 0;\n    }\n  }\n\n  /**\n   * Checks if a user is currently live streaming\n   */\n  async getStreamStatus(username: string): Promise<{ isLive: boolean; viewerCount?: number; game?: string }> {\n    try {\n      const appToken = await this.getAppAccessToken();\n\n      // Get user ID from username\n      const userResponse = await fetch(`https://api.twitch.tv/helix/users?login=${encodeURIComponent(username)}`, {\n        headers: {\n          'Authorization': `Bearer ${appToken}`,\n          'Client-Id': TWITCH_CLIENT_ID,\n        },\n      });\n\n      if (!userResponse.ok) {\n        return { isLive: false };\n      }\n\n      const userData = await userResponse.json();\n      if (!userData.data || userData.data.length === 0) {\n        return { isLive: false };\n      }\n\n      const userId = userData.data[0].id;\n\n      // Check if user is live\n      const streamResponse = await fetch(\n        `https://api.twitch.tv/helix/streams?user_id=${userId}`,\n        {\n          headers: {\n            'Authorization': `Bearer ${appToken}`,\n            'Client-Id': TWITCH_CLIENT_ID,\n          },\n        }\n      );\n\n      if (!streamResponse.ok) {\n        return { isLive: false };\n      }\n\n      const streamData = await streamResponse.json();\n      \n      if (streamData.data && streamData.data.length > 0) {\n        const stream = streamData.data[0];\n        return {\n          isLive: true,\n          viewerCount: stream.viewer_count,\n          game: stream.game_name,\n        };\n      }\n\n      return { isLive: false };\n    } catch (error) {\n      console.error('Error checking stream status:', error);\n      return { isLive: false };\n    }\n  }\n\n  /**\n   * Gets enhanced VIP information including profile picture, follower count, and live status\n   */\n  async getEnhancedUserInfo(username: string): Promise<{\n    profileImageUrl: string | null;\n    followerCount: number;\n    isLive: boolean;\n    viewerCount?: number;\n    game?: string;\n  }> {\n    try {\n      const appToken = await this.getAppAccessToken();\n\n      // Get user info\n      const userResponse = await fetch(`https://api.twitch.tv/helix/users?login=${encodeURIComponent(username)}`, {\n        headers: {\n          'Authorization': `Bearer ${appToken}`,\n          'Client-Id': TWITCH_CLIENT_ID,\n        },\n      });\n\n      if (!userResponse.ok) {\n        return {\n          profileImageUrl: null,\n          followerCount: 0,\n          isLive: false,\n        };\n      }\n\n      const userData = await userResponse.json();\n      if (!userData.data || userData.data.length === 0) {\n        return {\n          profileImageUrl: null,\n          followerCount: 0,\n          isLive: false,\n        };\n      }\n\n      const user = userData.data[0];\n      const userId = user.id;\n\n      // Fetch follower count and stream status in parallel\n      const [followerCount, streamStatus] = await Promise.all([\n        this.getFollowerCount(username),\n        this.getStreamStatus(username),\n      ]);\n\n      return {\n        profileImageUrl: user.profile_image_url,\n        followerCount,\n        isLive: streamStatus.isLive,\n        viewerCount: streamStatus.viewerCount,\n        game: streamStatus.game,\n      };\n    } catch (error) {\n      console.error('Error fetching enhanced user info:', error);\n      return {\n        profileImageUrl: null,\n        followerCount: 0,\n        isLive: false,\n      };\n    }\n  }\n}\n\nexport const twitchOAuthService = new TwitchOAuthService();\n","size_bytes":15651},"client/src/pages/dashboard.tsx":{"content":"import { useState } from \"react\";\nimport { StatCard } from \"@/components/stat-card\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport type { ChatMessage, AiAnalysis, Settings, ModerationAction } from \"@shared/schema\";\nimport { \n  ChatBubbleLeftRightIcon, \n  CpuChipIcon, \n  ShieldCheckIcon, \n  UsersIcon \n} from \"@heroicons/react/24/outline\";\nimport { BarChart, Bar, XAxis, YAxis, Tooltip, ResponsiveContainer, PieChart, Pie, Cell } from \"recharts\";\nimport { AlertCircle } from \"lucide-react\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface TwitchStatus {\n  connected: boolean;\n  channel: string | null;\n  messageCount: number;\n}\n\ninterface AuthenticatedUser {\n  id: string;\n  twitchUsername: string;\n  twitchDisplayName: string;\n  twitchProfileImageUrl: string | null;\n}\n\nexport default function Dashboard() {\n  const { toast } = useToast();\n  const [activeTab, setActiveTab] = useState(\"today\");\n  const [activeDetailModal, setActiveDetailModal] = useState<string | null>(null);\n\n  const { data: messages = [], isLoading: messagesLoading } = useQuery<ChatMessage[]>({\n    queryKey: [\"/api/messages\"],\n  });\n\n  const { data: analyses = [], isLoading: analysesLoading } = useQuery<AiAnalysis[]>({\n    queryKey: [\"/api/analyses\"],\n  });\n\n  const { data: moderationActions = [], isLoading: moderationActionsLoading } = useQuery<ModerationAction[]>({\n    queryKey: [\"/api/moderation-actions\"],\n  });\n\n  const { data: settingsList = [] } = useQuery<Settings[]>({\n    queryKey: [\"/api/settings\"],\n  });\n\n  const settings = settingsList[0];\n\n  const { data: twitchStatus } = useQuery<TwitchStatus>({\n    queryKey: [\"/api/twitch/status\"],\n    refetchInterval: 3000,\n  });\n\n  const { data: authenticatedUser } = useQuery<AuthenticatedUser>({\n    queryKey: [\"/api/auth/user\"],\n    retry: false,\n  });\n\n  const connectMutation = useMutation({\n    mutationFn: async () => {\n      if (!authenticatedUser) {\n        throw new Error(\"Please log in with Twitch first\");\n      }\n      const response = await fetch(\"/api/twitch/connect\", {\n        method: \"POST\",\n        body: JSON.stringify({\n          channel: authenticatedUser.twitchUsername,\n          username: authenticatedUser.twitchUsername,\n        }),\n        headers: { \"Content-Type\": \"application/json\" },\n      });\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || \"Failed to connect\");\n      }\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Connected!\",\n        description: \"Successfully connected to Twitch chat\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/twitch/status\"] });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Connection failed\",\n        description: error.message || \"Failed to connect to Twitch\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const startStreamSessionMutation = useMutation({\n    mutationFn: async () => {\n      if (!settings?.id) {\n        throw new Error(\"Settings not loaded\");\n      }\n      return await apiRequest(`/api/settings/${settings.id}`, \"PATCH\", {\n        streamSessionStarted: new Date().toISOString(),\n      });\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Stream session started!\",\n        description: \"New stream session timestamp has been set\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/settings\"] });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Failed to start session\",\n        description: error.message || \"Failed to update stream session\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const streamSessionStarted = settings?.streamSessionStarted ? new Date(settings.streamSessionStarted) : null;\n\n  const todayMessages = streamSessionStarted \n    ? messages.filter((m) => new Date(m.timestamp) >= streamSessionStarted)\n    : messages;\n\n  const missedMessages = streamSessionStarted \n    ? messages.filter((m) => new Date(m.timestamp) < streamSessionStarted)\n    : [];\n\n  const todayAnalyses = streamSessionStarted\n    ? analyses.filter((a) => new Date(a.timestamp) >= streamSessionStarted)\n    : analyses;\n\n  const missedAnalyses = streamSessionStarted\n    ? analyses.filter((a) => new Date(a.timestamp) < streamSessionStarted)\n    : [];\n\n  const todayModerationActions = streamSessionStarted\n    ? moderationActions.filter((a) => new Date(a.timestamp) >= streamSessionStarted)\n    : moderationActions;\n\n  const missedModerationActions = streamSessionStarted\n    ? moderationActions.filter((a) => new Date(a.timestamp) < streamSessionStarted)\n    : [];\n\n  const currentMessages = activeTab === \"today\" ? todayMessages : missedMessages;\n  const currentAnalyses = activeTab === \"today\" ? todayAnalyses : missedAnalyses;\n  const currentModerationActions = activeTab === \"today\" ? todayModerationActions : missedModerationActions;\n\n  const totalMessages = currentMessages.length;\n  const aiAnalyzed = currentAnalyses.length;\n  const uniqueUsers = new Set(currentMessages.map((m) => m.username)).size;\n  const moderationActionsCount = currentModerationActions.length;\n\n  const positiveMessages = currentAnalyses.filter((a) => a.sentiment === \"positive\").length;\n  const negativeMessages = currentAnalyses.filter((a) => a.sentiment === \"negative\").length;\n\n  const sentimentData = [\n    { name: \"Positive\", value: positiveMessages, color: \"hsl(var(--chart-2))\" },\n    { name: \"Neutral\", value: currentAnalyses.length - positiveMessages - negativeMessages, color: \"hsl(var(--chart-3))\" },\n    { name: \"Negative\", value: negativeMessages, color: \"hsl(var(--destructive))\" },\n  ];\n\n  const hourlyData = currentMessages.reduce((acc, msg) => {\n    const hour = new Date(msg.timestamp).getHours();\n    const existing = acc.find((d) => d.hour === hour);\n    if (existing) {\n      existing.count++;\n    } else {\n      acc.push({ hour, count: 1 });\n    }\n    return acc;\n  }, [] as { hour: number; count: number }[]).sort((a, b) => a.hour - b.hour);\n\n  const recentMessages = [...currentMessages].reverse().slice(0, 20);\n\n  const userMessageCounts = currentMessages.reduce((acc, msg) => {\n    acc[msg.username] = (acc[msg.username] || 0) + 1;\n    return acc;\n  }, {} as Record<string, number>);\n\n  const activeUsers = Object.entries(userMessageCounts)\n    .map(([username, count]) => ({ username, count }))\n    .sort((a, b) => b.count - a.count);\n\n  const toxicMessages = currentAnalyses.filter((a) => a.toxicity).length;\n\n  const categoryDistribution = currentAnalyses.reduce((acc, analysis) => {\n    const categories = analysis.categories || [\"general\"];\n    categories.forEach(category => {\n      acc[category] = (acc[category] || 0) + 1;\n    });\n    return acc;\n  }, {} as Record<string, number>);\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      {/* Header with Twitch Connection on the right */}\n      <div className=\"flex items-start justify-between gap-4 flex-wrap\">\n        <div>\n          <h1 className=\"text-2xl font-bold text-foreground\" data-testid=\"page-title-dashboard\">Dashboard</h1>\n          <p className=\"text-sm text-muted-foreground mt-1\">\n            Real-time analytics and insights for your Twitch chat\n          </p>\n        </div>\n\n        {/* Twitch Connection - Top Right */}\n        {authenticatedUser && (\n          <Card data-testid=\"card-twitch-connection\" className=\"w-auto min-w-[300px]\">\n            <CardHeader className=\"pb-3\">\n              <div className=\"flex items-center justify-between gap-2\">\n                <CardTitle className=\"text-base font-semibold\">Twitch</CardTitle>\n                {twitchStatus?.connected ? (\n                  <Badge variant=\"secondary\" className=\"gap-2\" data-testid=\"badge-connected\">\n                    <div className=\"h-2 w-2 rounded-full bg-chart-2 animate-pulse\" />\n                    Connected\n                  </Badge>\n                ) : (\n                  <Badge variant=\"outline\" className=\"gap-2\" data-testid=\"badge-disconnected\">\n                    <div className=\"h-2 w-2 rounded-full bg-muted-foreground\" />\n                    Disconnected\n                  </Badge>\n                )}\n              </div>\n            </CardHeader>\n            <CardContent className=\"space-y-2\">\n              <p className=\"text-sm font-medium\">{authenticatedUser.twitchDisplayName}</p>\n              {twitchStatus?.connected ? (\n                <p className=\"text-xs text-muted-foreground\">\n                  {twitchStatus.messageCount} messages received\n                </p>\n              ) : (\n                <div>\n                  <Button \n                    onClick={() => connectMutation.mutate()}\n                    disabled={connectMutation.isPending}\n                    size=\"sm\"\n                    className=\"w-full\"\n                    data-testid=\"button-connect-chat\"\n                  >\n                    {connectMutation.isPending ? \"Connecting...\" : \"Connect\"}\n                  </Button>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        )}\n      </div>\n\n      <Tabs value={activeTab} onValueChange={setActiveTab} data-testid=\"tabs-dashboard\">\n        <TabsList data-testid=\"tabs-list-dashboard\">\n          <TabsTrigger value=\"today\" data-testid=\"tab-today\">\n            Today\n          </TabsTrigger>\n          <TabsTrigger value=\"missed\" data-testid=\"tab-missed\">\n            What You Missed\n          </TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"today\" data-testid=\"tab-content-today\" className=\"space-y-6\">\n          <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4\">\n            <StatCard\n              title=\"Total Messages\"\n              value={totalMessages}\n              icon={ChatBubbleLeftRightIcon}\n              loading={messagesLoading}\n              onClick={() => setActiveDetailModal('messages')}\n            />\n            <StatCard\n              title=\"AI Analyzed\"\n              value={aiAnalyzed}\n              icon={CpuChipIcon}\n              loading={analysesLoading}\n              onClick={() => setActiveDetailModal('ai')}\n            />\n            <StatCard\n              title=\"Active Users\"\n              value={uniqueUsers}\n              icon={UsersIcon}\n              loading={messagesLoading}\n              onClick={() => setActiveDetailModal('users')}\n            />\n            <StatCard\n              title=\"Moderation Actions\"\n              value={moderationActionsCount}\n              icon={ShieldCheckIcon}\n              loading={moderationActionsLoading}\n              onClick={() => setActiveDetailModal('moderation')}\n            />\n          </div>\n\n          <div className=\"grid gap-4 md:grid-cols-2\">\n            <Card data-testid=\"card-sentiment-distribution\">\n              <CardHeader>\n                <CardTitle className=\"text-lg font-semibold\">Sentiment Distribution</CardTitle>\n              </CardHeader>\n              <CardContent>\n                {currentAnalyses.length === 0 ? (\n                  <div className=\"flex h-[200px] items-center justify-center\">\n                    <p className=\"text-sm text-muted-foreground\">No analysis data yet</p>\n                  </div>\n                ) : (\n                  <ResponsiveContainer width=\"100%\" height={200}>\n                    <PieChart>\n                      <Pie\n                        data={sentimentData}\n                        cx=\"50%\"\n                        cy=\"50%\"\n                        innerRadius={60}\n                        outerRadius={80}\n                        paddingAngle={5}\n                        dataKey=\"value\"\n                      >\n                        {sentimentData.map((entry, index) => (\n                          <Cell key={`cell-${index}`} fill={entry.color} />\n                        ))}\n                      </Pie>\n                      <Tooltip />\n                    </PieChart>\n                  </ResponsiveContainer>\n                )}\n                <div className=\"mt-4 flex justify-center gap-4\">\n                  {sentimentData.map((item) => (\n                    <div key={item.name} className=\"flex items-center gap-2\">\n                      <div className=\"h-3 w-3 rounded-sm\" style={{ backgroundColor: item.color }} />\n                      <span className=\"text-xs text-muted-foreground\">{item.name}</span>\n                    </div>\n                  ))}\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card data-testid=\"card-hourly-activity\">\n              <CardHeader>\n                <CardTitle className=\"text-lg font-semibold\">Hourly Activity</CardTitle>\n              </CardHeader>\n              <CardContent>\n                {hourlyData.length === 0 ? (\n                  <div className=\"flex h-[200px] items-center justify-center\">\n                    <p className=\"text-sm text-muted-foreground\">No message data yet</p>\n                  </div>\n                ) : (\n                  <ResponsiveContainer width=\"100%\" height={200}>\n                    <BarChart data={hourlyData}>\n                      <XAxis\n                        dataKey=\"hour\"\n                        stroke=\"hsl(var(--muted-foreground))\"\n                        fontSize={12}\n                        tickLine={false}\n                        axisLine={false}\n                      />\n                      <YAxis\n                        stroke=\"hsl(var(--muted-foreground))\"\n                        fontSize={12}\n                        tickLine={false}\n                        axisLine={false}\n                      />\n                      <Tooltip\n                        contentStyle={{\n                          backgroundColor: \"hsl(var(--popover))\",\n                          border: \"1px solid hsl(var(--border))\",\n                          borderRadius: \"6px\",\n                        }}\n                      />\n                      <Bar dataKey=\"count\" fill=\"hsl(var(--primary))\" radius={[4, 4, 0, 0]} />\n                    </BarChart>\n                  </ResponsiveContainer>\n                )}\n              </CardContent>\n            </Card>\n          </div>\n        </TabsContent>\n\n        <TabsContent value=\"missed\" data-testid=\"tab-content-missed\" className=\"space-y-6\">\n          <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4\">\n            <StatCard\n              title=\"Total Messages\"\n              value={totalMessages}\n              icon={ChatBubbleLeftRightIcon}\n              loading={messagesLoading}\n              onClick={() => setActiveDetailModal('messages')}\n            />\n            <StatCard\n              title=\"AI Analyzed\"\n              value={aiAnalyzed}\n              icon={CpuChipIcon}\n              loading={analysesLoading}\n              onClick={() => setActiveDetailModal('ai')}\n            />\n            <StatCard\n              title=\"Active Users\"\n              value={uniqueUsers}\n              icon={UsersIcon}\n              loading={messagesLoading}\n              onClick={() => setActiveDetailModal('users')}\n            />\n            <StatCard\n              title=\"Moderation Actions\"\n              value={moderationActionsCount}\n              icon={ShieldCheckIcon}\n              loading={moderationActionsLoading}\n              onClick={() => setActiveDetailModal('moderation')}\n            />\n          </div>\n\n          <div className=\"grid gap-4 md:grid-cols-2\">\n            <Card data-testid=\"card-sentiment-distribution\">\n              <CardHeader>\n                <CardTitle className=\"text-lg font-semibold\">Sentiment Distribution</CardTitle>\n              </CardHeader>\n              <CardContent>\n                {currentAnalyses.length === 0 ? (\n                  <div className=\"flex h-[200px] items-center justify-center\">\n                    <p className=\"text-sm text-muted-foreground\">No analysis data yet</p>\n                  </div>\n                ) : (\n                  <ResponsiveContainer width=\"100%\" height={200}>\n                    <PieChart>\n                      <Pie\n                        data={sentimentData}\n                        cx=\"50%\"\n                        cy=\"50%\"\n                        innerRadius={60}\n                        outerRadius={80}\n                        paddingAngle={5}\n                        dataKey=\"value\"\n                      >\n                        {sentimentData.map((entry, index) => (\n                          <Cell key={`cell-${index}`} fill={entry.color} />\n                        ))}\n                      </Pie>\n                      <Tooltip />\n                    </PieChart>\n                  </ResponsiveContainer>\n                )}\n                <div className=\"mt-4 flex justify-center gap-4\">\n                  {sentimentData.map((item) => (\n                    <div key={item.name} className=\"flex items-center gap-2\">\n                      <div className=\"h-3 w-3 rounded-sm\" style={{ backgroundColor: item.color }} />\n                      <span className=\"text-xs text-muted-foreground\">{item.name}</span>\n                    </div>\n                  ))}\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card data-testid=\"card-hourly-activity\">\n              <CardHeader>\n                <CardTitle className=\"text-lg font-semibold\">Hourly Activity</CardTitle>\n              </CardHeader>\n              <CardContent>\n                {hourlyData.length === 0 ? (\n                  <div className=\"flex h-[200px] items-center justify-center\">\n                    <p className=\"text-sm text-muted-foreground\">No message data yet</p>\n                  </div>\n                ) : (\n                  <ResponsiveContainer width=\"100%\" height={200}>\n                    <BarChart data={hourlyData}>\n                      <XAxis\n                        dataKey=\"hour\"\n                        stroke=\"hsl(var(--muted-foreground))\"\n                        fontSize={12}\n                        tickLine={false}\n                        axisLine={false}\n                      />\n                      <YAxis\n                        stroke=\"hsl(var(--muted-foreground))\"\n                        fontSize={12}\n                        tickLine={false}\n                        axisLine={false}\n                      />\n                      <Tooltip\n                        contentStyle={{\n                          backgroundColor: \"hsl(var(--popover))\",\n                          border: \"1px solid hsl(var(--border))\",\n                          borderRadius: \"6px\",\n                        }}\n                      />\n                      <Bar dataKey=\"count\" fill=\"hsl(var(--primary))\" radius={[4, 4, 0, 0]} />\n                    </BarChart>\n                  </ResponsiveContainer>\n                )}\n              </CardContent>\n            </Card>\n          </div>\n        </TabsContent>\n      </Tabs>\n\n      <Dialog open={activeDetailModal === 'messages'} onOpenChange={(open) => !open && setActiveDetailModal(null)}>\n        <DialogContent className=\"max-w-2xl\" data-testid=\"modal-messages\">\n          <DialogHeader>\n            <DialogTitle>Recent Messages</DialogTitle>\n            <DialogDescription>\n              Last 20 messages from {activeTab === 'today' ? 'today' : 'before your stream session'}\n            </DialogDescription>\n          </DialogHeader>\n          <ScrollArea className=\"max-h-[500px]\">\n            <div className=\"space-y-3 pr-4\">\n              {recentMessages.length === 0 ? (\n                <p className=\"text-sm text-muted-foreground text-center py-8\">No messages yet</p>\n              ) : (\n                recentMessages.map((msg) => (\n                  <div \n                    key={msg.id} \n                    className=\"flex flex-col gap-1 p-3 rounded-md bg-muted/50\"\n                    data-testid={`message-item-${msg.id}`}\n                  >\n                    <div className=\"flex items-center justify-between gap-2\">\n                      <span className=\"font-medium text-sm\" data-testid={`message-username-${msg.id}`}>\n                        {msg.username}\n                      </span>\n                      <span className=\"text-xs text-muted-foreground\" data-testid={`message-timestamp-${msg.id}`}>\n                        {new Date(msg.timestamp).toLocaleString()}\n                      </span>\n                    </div>\n                    <p className=\"text-sm\" data-testid={`message-text-${msg.id}`}>{msg.message}</p>\n                  </div>\n                ))\n              )}\n            </div>\n          </ScrollArea>\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={activeDetailModal === 'ai'} onOpenChange={(open) => !open && setActiveDetailModal(null)}>\n        <DialogContent className=\"max-w-2xl\" data-testid=\"modal-ai\">\n          <DialogHeader>\n            <DialogTitle>AI Analysis Details</DialogTitle>\n            <DialogDescription>\n              Sentiment breakdown and analysis statistics for {activeTab === 'today' ? 'today' : 'missed messages'}\n            </DialogDescription>\n          </DialogHeader>\n          <ScrollArea className=\"max-h-[500px]\">\n            <div className=\"space-y-6 pr-4\">\n              <div className=\"space-y-3\">\n                <h3 className=\"font-semibold text-sm\">Sentiment Breakdown</h3>\n                <div className=\"grid grid-cols-3 gap-3\">\n                  <div className=\"p-3 rounded-md bg-chart-2/10 border border-chart-2/20\">\n                    <div className=\"text-2xl font-bold text-chart-2\" data-testid=\"ai-positive-count\">\n                      {positiveMessages}\n                    </div>\n                    <div className=\"text-xs text-muted-foreground\">Positive</div>\n                  </div>\n                  <div className=\"p-3 rounded-md bg-chart-3/10 border border-chart-3/20\">\n                    <div className=\"text-2xl font-bold\" data-testid=\"ai-neutral-count\">\n                      {currentAnalyses.length - positiveMessages - negativeMessages}\n                    </div>\n                    <div className=\"text-xs text-muted-foreground\">Neutral</div>\n                  </div>\n                  <div className=\"p-3 rounded-md bg-destructive/10 border border-destructive/20\">\n                    <div className=\"text-2xl font-bold text-destructive\" data-testid=\"ai-negative-count\">\n                      {negativeMessages}\n                    </div>\n                    <div className=\"text-xs text-muted-foreground\">Negative</div>\n                  </div>\n                </div>\n              </div>\n\n              <div className=\"space-y-3\">\n                <h3 className=\"font-semibold text-sm\">Toxicity Detection</h3>\n                <div className=\"p-3 rounded-md bg-muted/50\">\n                  <div className=\"text-2xl font-bold\" data-testid=\"ai-toxic-count\">\n                    {toxicMessages}\n                  </div>\n                  <div className=\"text-xs text-muted-foreground\">Messages flagged as potentially toxic</div>\n                </div>\n              </div>\n\n              <div className=\"space-y-3\">\n                <h3 className=\"font-semibold text-sm\">Category Distribution</h3>\n                <div className=\"space-y-2\">\n                  {Object.entries(categoryDistribution).length === 0 ? (\n                    <p className=\"text-sm text-muted-foreground\">No category data available</p>\n                  ) : (\n                    Object.entries(categoryDistribution).map(([category, count]) => (\n                      <div key={category} className=\"flex items-center justify-between p-2 rounded-md bg-muted/50\">\n                        <span className=\"text-sm capitalize\">{category}</span>\n                        <Badge variant=\"secondary\" data-testid={`category-count-${category}`}>{count}</Badge>\n                      </div>\n                    ))\n                  )}\n                </div>\n              </div>\n            </div>\n          </ScrollArea>\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={activeDetailModal === 'users'} onOpenChange={(open) => !open && setActiveDetailModal(null)}>\n        <DialogContent className=\"max-w-2xl\" data-testid=\"modal-users\">\n          <DialogHeader>\n            <DialogTitle>Active Users</DialogTitle>\n            <DialogDescription>\n              Users sorted by message count for {activeTab === 'today' ? 'today' : 'missed period'}\n            </DialogDescription>\n          </DialogHeader>\n          <ScrollArea className=\"max-h-[500px]\">\n            <div className=\"space-y-2 pr-4\">\n              {activeUsers.length === 0 ? (\n                <p className=\"text-sm text-muted-foreground text-center py-8\">No active users yet</p>\n              ) : (\n                <div className=\"space-y-2\">\n                  {activeUsers.map((user, index) => (\n                    <div \n                      key={user.username}\n                      className=\"flex items-center justify-between p-3 rounded-md bg-muted/50\"\n                      data-testid={`user-item-${index}`}\n                    >\n                      <div className=\"flex items-center gap-3\">\n                        <div className=\"flex items-center justify-center w-8 h-8 rounded-full bg-primary/10 text-primary font-bold text-sm\">\n                          {index + 1}\n                        </div>\n                        <span className=\"font-medium text-sm\" data-testid={`user-name-${index}`}>\n                          {user.username}\n                        </span>\n                      </div>\n                      <Badge variant=\"secondary\" data-testid={`user-count-${index}`}>\n                        {user.count} {user.count === 1 ? 'message' : 'messages'}\n                      </Badge>\n                    </div>\n                  ))}\n                </div>\n              )}\n            </div>\n          </ScrollArea>\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={activeDetailModal === 'moderation'} onOpenChange={(open) => !open && setActiveDetailModal(null)}>\n        <DialogContent className=\"max-w-2xl\" data-testid=\"modal-moderation\">\n          <DialogHeader>\n            <DialogTitle>Moderation Actions</DialogTitle>\n            <DialogDescription>\n              All moderation actions for {activeTab === 'today' ? 'today' : 'missed period'}\n            </DialogDescription>\n          </DialogHeader>\n          <ScrollArea className=\"max-h-[500px]\">\n            <div className=\"space-y-3 pr-4\">\n              {currentModerationActions.length === 0 ? (\n                <p className=\"text-sm text-muted-foreground text-center py-8\">No moderation actions yet</p>\n              ) : (\n                currentModerationActions.map((action) => (\n                  <div \n                    key={action.id}\n                    className=\"p-3 rounded-md bg-muted/50 space-y-2\"\n                    data-testid={`moderation-item-${action.id}`}\n                  >\n                    <div className=\"flex items-center justify-between gap-2\">\n                      <Badge variant=\"outline\" data-testid={`moderation-type-${action.id}`}>\n                        {action.actionType}\n                      </Badge>\n                      <span className=\"text-xs text-muted-foreground\" data-testid={`moderation-timestamp-${action.id}`}>\n                        {new Date(action.timestamp).toLocaleString()}\n                      </span>\n                    </div>\n                    <div className=\"text-sm space-y-1\">\n                      <div className=\"flex gap-2\">\n                        <span className=\"text-muted-foreground\">Target:</span>\n                        <span className=\"font-medium\" data-testid={`moderation-target-${action.id}`}>\n                          {action.targetUsername}\n                        </span>\n                      </div>\n                      <div className=\"flex gap-2\">\n                        <span className=\"text-muted-foreground\">Moderator:</span>\n                        <span data-testid={`moderation-moderator-${action.id}`}>\n                          {action.moderatorUsername}\n                        </span>\n                      </div>\n                      {action.reason && (\n                        <div className=\"flex gap-2\">\n                          <span className=\"text-muted-foreground\">Reason:</span>\n                          <span className=\"text-xs\" data-testid={`moderation-reason-${action.id}`}>\n                            {action.reason}\n                          </span>\n                        </div>\n                      )}\n                    </div>\n                  </div>\n                ))\n              )}\n            </div>\n          </ScrollArea>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","size_bytes":29243},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","size_bytes":4120},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","size_bytes":1642},"client/src/pages/monitor.tsx":{"content":"import { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Slider } from \"@/components/ui/slider\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Clock, MessageSquare, Sparkles, Ban, Clock as TimeoutIcon, Star, Shield, Play, Pause, Square, Mic, MicOff, Volume2, Settings, RefreshCw } from \"lucide-react\";\nimport { format } from \"date-fns\";\nimport { useState, useEffect, useRef } from \"react\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport type { ChatMessage, VoiceAiResponse } from \"@shared/schema\";\nimport WorkflowChart, { type WorkflowStage, type StageStatus } from \"@/components/workflow-chart\";\nimport { useVoiceRecognition } from \"@/hooks/use-voice-recognition\";\nimport { PUTER_VOICES, usePuterTTS } from \"@/hooks/use-puter-tts\";\n\ninterface DachiStreamState {\n  status: string;\n  bufferCount: number;\n  lastCycleTime: string | null;\n  nextCycleTime: string | null;\n  secondsUntilNextCycle: number;\n}\n\n// Personality presets (defined outside component to avoid recreation)\nconst PERSONALITY_PRESETS = {\n  Neutral: { pitch: 1.0, speed: 1.0 },\n  Quirky: { pitch: 1.2, speed: 1.1 },\n  Funny: { pitch: 1.1, speed: 1.05 },\n  Sarcastic: { pitch: 0.95, speed: 0.9 },\n  Professional: { pitch: 0.9, speed: 0.95 },\n} as const;\n\nexport default function Monitor() {\n  const [isPaused, setIsPaused] = useState(false);\n  const [cycleInterval, setCycleInterval] = useState(15);\n  const [aiResponseLimit, setAiResponseLimit] = useState<number>(10);\n  const [selectedUser, setSelectedUser] = useState<{username: string, userId?: string | null} | null>(null);\n  \n  // Voice & Controls State\n  const [micMuted, setMicMuted] = useState(false);\n  const [voiceRephrasingEnabled, setVoiceRephrasingEnabled] = useState(true);\n  const [stageControlEnabled, setStageControlEnabled] = useState(true);\n  const [selectedVoice, setSelectedVoice] = useState(\"Joanna\");\n  const [listeningPaused, setListeningPaused] = useState(false);\n  const [personality, setPersonality] = useState<\"Neutral\" | \"Quirky\" | \"Funny\" | \"Sarcastic\" | \"Professional\">(\"Neutral\");\n  const [voicePitch, setVoicePitch] = useState(1.0);\n  const [voiceSpeed, setVoiceSpeed] = useState(1.0);\n  \n  // Dual Audio Output State\n  const [programAudioMuted, setProgramAudioMuted] = useState(false);\n  const [secondCableMuted, setSecondCableMuted] = useState(false);\n  const [ttsEnabled, setTtsEnabled] = useState(true);\n  \n  // Silence detection state\n  const lastEnhancedTextRef = useRef(\"\");\n  const silenceTimerRef = useRef<NodeJS.Timeout | null>(null);\n  const previousTranscriptRef = useRef(\"\");\n\n  // Voice Recognition Integration\n  const {\n    isListening,\n    transcript,\n    enhancedText,\n    startListening,\n    stopListening,\n    resetTranscript,\n    isSupported: voiceSupported,\n    isEnhancing\n  } = useVoiceRecognition({\n    autoEnhance: voiceRephrasingEnabled,\n    continuous: true,\n  });\n\n  // Puter TTS Integration\n  const {\n    isSupported: ttsSupported,\n    isSpeaking,\n    speak,\n    stop: stopSpeaking,\n    updateSettings: updateTtsSettings,\n  } = usePuterTTS();\n\n  // Fetch DachiStream status\n  const { data: streamStatus } = useQuery<DachiStreamState>({\n    queryKey: [\"/api/dachistream/status\"],\n    refetchInterval: 1000, // Update every second for countdown\n  });\n\n  // Fetch current interval\n  const { data: intervalData } = useQuery<{ intervalSeconds: number }>({\n    queryKey: [\"/api/dachistream/interval\"],\n  });\n\n  // Fetch buffer messages\n  const { data: bufferMessages = [] } = useQuery<ChatMessage[]>({\n    queryKey: [\"/api/dachistream/buffer\"],\n    refetchInterval: 2000, // Update every 2 seconds\n  });\n\n  // Fetch AI responses\n  const { data: allAiResponses = [] } = useQuery<VoiceAiResponse[]>({\n    queryKey: [\"/api/voice/responses\"],\n    refetchInterval: 5000, // Update every 5 seconds\n  });\n\n  // Sync interval from server\n  useEffect(() => {\n    if (intervalData?.intervalSeconds) {\n      setCycleInterval(intervalData.intervalSeconds);\n    }\n  }, [intervalData]);\n\n  // Sync pause state from server status\n  useEffect(() => {\n    if (streamStatus?.status === \"paused\") {\n      setIsPaused(true);\n    } else if (streamStatus?.status === \"collecting\" || streamStatus?.status === \"processing\") {\n      setIsPaused(false);\n    }\n  }, [streamStatus?.status]);\n\n  // Handle mic mute toggle\n  useEffect(() => {\n    if (micMuted && isListening) {\n      stopListening();\n    } else if (!micMuted && !isListening && voiceSupported && !listeningPaused) {\n      startListening();\n    }\n  }, [micMuted]);\n\n  // Auto-clear previous transcription when new speech starts\n  useEffect(() => {\n    // Detect when new speech session starts (transcript goes from empty to non-empty)\n    const hadNoTranscript = !previousTranscriptRef.current || previousTranscriptRef.current.trim() === \"\";\n    const hasNewTranscript = transcript && transcript.trim() !== \"\";\n    \n    if (hadNoTranscript && hasNewTranscript) {\n      // New speech session detected - clear everything from previous session\n      console.log(\"[Monitor] New speech detected - clearing previous session\");\n      lastEnhancedTextRef.current = \"\";\n      stopSpeaking();\n      \n      // Clear the silence timer\n      if (silenceTimerRef.current) {\n        clearTimeout(silenceTimerRef.current);\n        silenceTimerRef.current = null;\n      }\n    }\n    \n    // Update previous transcript reference\n    previousTranscriptRef.current = transcript;\n  }, [transcript, stopSpeaking]);\n\n  // Auto-clear AI output after new enhanced text appears AND trigger TTS audio\n  useEffect(() => {\n    if (enhancedText && enhancedText !== lastEnhancedTextRef.current) {\n      lastEnhancedTextRef.current = enhancedText;\n      \n      // Play TTS audio if enabled and not muted\n      if (ttsEnabled && ttsSupported && !programAudioMuted) {\n        console.log(\"[Monitor] Playing TTS for:\", enhancedText);\n        speak(enhancedText);\n      }\n      \n      // Clear the silence timer if it exists\n      if (silenceTimerRef.current) {\n        clearTimeout(silenceTimerRef.current);\n      }\n      \n      // Set new timer to clear after 10 seconds\n      silenceTimerRef.current = setTimeout(() => {\n        lastEnhancedTextRef.current = \"\";\n      }, 10000);\n    }\n  }, [enhancedText, ttsEnabled, ttsSupported, programAudioMuted, speak]);\n\n  // Handle pause/resume listening\n  const handleListeningToggle = () => {\n    if (listeningPaused) {\n      setListeningPaused(false);\n      if (!micMuted && voiceSupported) {\n        startListening();\n      }\n    } else {\n      setListeningPaused(true);\n      if (isListening) {\n        stopListening();\n      }\n    }\n  };\n\n  // Handle personality change\n  const handlePersonalityChange = (newPersonality: typeof personality) => {\n    setPersonality(newPersonality);\n    \n    const preset = PERSONALITY_PRESETS[newPersonality];\n    setVoicePitch(preset.pitch);\n    setVoiceSpeed(preset.speed);\n    \n    // Save to database\n    updatePersonalityMutation.mutate({\n      personality: newPersonality,\n      pitch: preset.pitch,\n      speed: preset.speed,\n    });\n  };\n  \n  // Sync TTS voice selection\n  useEffect(() => {\n    updateTtsSettings({\n      voice: selectedVoice,\n      enabled: ttsEnabled && !programAudioMuted,\n    });\n  }, [selectedVoice, ttsEnabled, programAudioMuted, updateTtsSettings]);\n\n  // Handle clear AI output\n  const handleClearOutput = () => {\n    resetTranscript();\n    lastEnhancedTextRef.current = \"\";\n    stopSpeaking();\n  };\n\n  // Handle test voice button\n  const handleTestVoice = () => {\n    const testPhrases = {\n      Neutral: \"Hello everyone! Thanks for tuning in to the stream today. Let's have a great time!\",\n      Quirky: \"Heyo chat! Ready to dive into some epic shenanigans? Let's gooo! This is gonna be wild!\",\n      Funny: \"What's up squad! Time to get this party started. Don't worry, I promise to only make dad jokes... maybe!\",\n      Sarcastic: \"Oh look, another stream. How thrilling. But seriously, glad you're here. Let's see what chaos awaits.\",\n      Professional: \"Good evening, everyone. Welcome to today's stream. I appreciate you joining us for what promises to be an excellent session.\",\n    };\n    \n    const phrase = testPhrases[personality];\n    speak(phrase);\n  };\n\n  // Pause mutation\n  const pauseMutation = useMutation({\n    mutationFn: async () => {\n      return await apiRequest(\"/api/dachistream/pause\", \"POST\");\n    },\n    onSuccess: () => {\n      setIsPaused(true);\n      queryClient.invalidateQueries({ queryKey: [\"/api/dachistream/status\"] });\n    },\n  });\n\n  // Resume mutation\n  const resumeMutation = useMutation({\n    mutationFn: async () => {\n      return await apiRequest(\"/api/dachistream/resume\", \"POST\");\n    },\n    onSuccess: () => {\n      setIsPaused(false);\n      queryClient.invalidateQueries({ queryKey: [\"/api/dachistream/status\"] });\n    },\n  });\n\n  // Reset mutation\n  const resetMutation = useMutation({\n    mutationFn: async () => {\n      return await apiRequest(\"/api/dachistream/reset\", \"POST\");\n    },\n    onSuccess: () => {\n      setIsPaused(false);\n      queryClient.invalidateQueries({ queryKey: [\"/api/dachistream/status\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/dachistream/buffer\"] });\n    },\n  });\n\n  // Update interval mutation\n  const updateIntervalMutation = useMutation({\n    mutationFn: async (intervalSeconds: number) => {\n      return await apiRequest(\"/api/dachistream/update-interval\", \"POST\", { intervalSeconds });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/dachistream/interval\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/dachistream/status\"] });\n    },\n  });\n\n  // Update personality mutation\n  const updatePersonalityMutation = useMutation({\n    mutationFn: async (data: { personality: string; pitch: number; speed: number }) => {\n      return await apiRequest(\"/api/settings/voice-personality\", \"POST\", data);\n    },\n  });\n\n  const handlePauseToggle = () => {\n    if (isPaused) {\n      resumeMutation.mutate();\n    } else {\n      pauseMutation.mutate();\n    }\n  };\n\n  const handleIntervalChange = (value: number[]) => {\n    const newInterval = value[0];\n    setCycleInterval(newInterval);\n    updateIntervalMutation.mutate(newInterval);\n  };\n\n  const formatTime = (seconds: number) => {\n    const mins = Math.floor(seconds / 60);\n    const secs = seconds % 60;\n    if (mins > 0) {\n      return `${mins}m ${secs}s`;\n    }\n    return `${secs}s`;\n  };\n\n  // Get limited AI responses based on user selection\n  const limitedAiResponses = allAiResponses.slice(0, aiResponseLimit);\n\n  // Map backend status AND voice states to workflow stages\n  const getWorkflowStageFromStatus = (\n    backendStatus: string | undefined,\n    voiceState: {\n      isListening: boolean,\n      transcript: string,\n      isEnhancing: boolean,\n      isSpeaking: boolean,\n      micMuted: boolean,\n    }\n  ): { stage: WorkflowStage; statuses: Record<WorkflowStage, StageStatus> } => {\n    const allIdle: Record<WorkflowStage, StageStatus> = {\n      \"waiting-pool\": \"idle\",\n      \"waiting-mic\": \"idle\",\n      \"collecting-pool\": \"idle\",\n      \"collecting-mic\": \"idle\",\n      \"decision\": \"idle\",\n      \"ai-setup-mic\": \"idle\",\n      \"ai-setup-pool\": \"idle\",\n      \"text-response\": \"idle\",\n      \"voice\": \"idle\",\n      \"complete\": \"idle\",\n    };\n\n    // VOICE ACTIVITY TAKES PRIORITY - override pool cycle when user is speaking\n    // Stage 1: Mic is waiting/ready (isListening but no speech yet)\n    if (voiceState.isListening && !voiceState.micMuted && !voiceState.transcript && !voiceState.isEnhancing) {\n      return {\n        stage: \"waiting-mic\",\n        statuses: {\n          ...allIdle,\n          \"waiting-mic\": \"active\",\n        }\n      };\n    }\n\n    // Stage 2: Mic is collecting speech (transcript is being captured)\n    if (voiceState.isListening && voiceState.transcript && !voiceState.isEnhancing) {\n      return {\n        stage: \"collecting-mic\",\n        statuses: {\n          ...allIdle,\n          \"waiting-mic\": \"success\",\n          \"collecting-mic\": \"active\",\n        }\n      };\n    }\n\n    // Stage 3: AI is rephrasing the speech\n    if (voiceState.isEnhancing) {\n      return {\n        stage: \"ai-setup-mic\",\n        statuses: {\n          ...allIdle,\n          \"waiting-mic\": \"success\",\n          \"collecting-mic\": \"success\",\n          \"ai-setup-mic\": \"active\",\n        }\n      };\n    }\n\n    // Stage 4: TTS is playing audio\n    if (voiceState.isSpeaking) {\n      return {\n        stage: \"voice\",\n        statuses: {\n          ...allIdle,\n          \"waiting-mic\": \"success\",\n          \"collecting-mic\": \"success\",\n          \"ai-setup-mic\": \"success\",\n          \"voice\": \"active\",\n        }\n      };\n    }\n\n    // POOL CYCLE STATES - when no voice activity is happening\n    if (!backendStatus || backendStatus === \"idle\") {\n      return { stage: \"waiting-pool\", statuses: allIdle };\n    }\n\n    if (backendStatus === \"collecting\") {\n      return {\n        stage: \"collecting-pool\",\n        statuses: {\n          ...allIdle,\n          \"waiting-pool\": \"success\",\n          \"collecting-pool\": \"active\",\n        }\n      };\n    }\n\n    if (backendStatus === \"processing\") {\n      return {\n        stage: \"decision\",\n        statuses: {\n          ...allIdle,\n          \"waiting-pool\": \"success\",\n          \"collecting-pool\": \"success\",\n          \"decision\": \"active\",\n        }\n      };\n    }\n\n    if (backendStatus === \"selecting_message\") {\n      return {\n        stage: \"ai-setup-pool\",\n        statuses: {\n          ...allIdle,\n          \"waiting-pool\": \"success\",\n          \"collecting-pool\": \"success\",\n          \"decision\": \"success\",\n          \"ai-setup-pool\": \"active\",\n        }\n      };\n    }\n\n    if (backendStatus === \"building_context\") {\n      return {\n        stage: \"ai-setup-pool\",\n        statuses: {\n          ...allIdle,\n          \"waiting-pool\": \"success\",\n          \"collecting-pool\": \"success\",\n          \"decision\": \"success\",\n          \"ai-setup-pool\": \"active\",\n        }\n      };\n    }\n\n    if (backendStatus === \"waiting_for_ai\") {\n      return {\n        stage: \"text-response\",\n        statuses: {\n          ...allIdle,\n          \"waiting-pool\": \"success\",\n          \"collecting-pool\": \"success\",\n          \"decision\": \"success\",\n          \"ai-setup-pool\": \"success\",\n          \"text-response\": \"active\",\n        }\n      };\n    }\n\n    if (backendStatus === \"paused\") {\n      return {\n        stage: \"waiting-pool\",\n        statuses: {\n          ...allIdle,\n          \"waiting-pool\": \"waiting-input\",\n        }\n      };\n    }\n\n    return { stage: \"waiting-pool\", statuses: allIdle };\n  };\n\n  const workflowData = getWorkflowStageFromStatus(streamStatus?.status, {\n    isListening,\n    transcript,\n    isEnhancing,\n    isSpeaking,\n    micMuted,\n  });\n\n  return (\n    <div className=\"p-6 space-y-6\" id=\"monitor-page\">\n      <div>\n        <h1 className=\"text-2xl font-bold text-foreground\" data-testid=\"page-title-monitor\">\n          Monitor\n        </h1>\n        <p className=\"text-sm text-muted-foreground mt-1\">\n          Real-time voice controls and StreamDashi monitoring\n        </p>\n      </div>\n\n      {/* MAIN LAYOUT - Voice Panel (LEFT) + StreamDashi Display (RIGHT - FIXED WIDTH) */}\n      <div className=\"grid grid-cols-1 lg:grid-cols-12 gap-6\" id=\"main-monitor-layout\">\n        \n        {/* LEFT COLUMN - Voice Controls & Transcription Panel (Responsive) */}\n        <div className=\"lg:col-span-5 space-y-4\" id=\"voice-controls-panel\">\n          \n          {/* Voice Control Card */}\n          <Card data-testid=\"card-voice-controls\">\n            <CardHeader>\n              <CardTitle className=\"text-lg font-semibold flex items-center gap-2\">\n                <Settings className=\"h-5 w-5\" />\n                Voice Controls\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              \n              {/* Microphone Toggle */}\n              <div className=\"flex items-center justify-between\">\n                <div className=\"flex items-center gap-3\">\n                  {micMuted ? <MicOff className=\"h-5 w-5 text-muted-foreground\" /> : <Mic className=\"h-5 w-5 text-primary\" />}\n                  <div>\n                    <label htmlFor=\"mic-toggle\" className=\"text-sm font-medium cursor-pointer\">\n                      Microphone\n                    </label>\n                    <p className=\"text-xs text-muted-foreground\">\n                      {micMuted ? \"Muted\" : \"Active\"}\n                    </p>\n                  </div>\n                </div>\n                <Switch\n                  id=\"mic-toggle\"\n                  checked={!micMuted}\n                  onCheckedChange={(checked) => setMicMuted(!checked)}\n                  data-testid=\"switch-mic\"\n                />\n              </div>\n\n              {/* Voice Rephrasing Toggle */}\n              <div className=\"flex items-center justify-between\">\n                <div className=\"flex items-center gap-3\">\n                  <Sparkles className=\"h-5 w-5 text-primary\" />\n                  <div>\n                    <label htmlFor=\"rephrasing-toggle\" className=\"text-sm font-medium cursor-pointer\">\n                      AI Rephrasing\n                    </label>\n                    <p className=\"text-xs text-muted-foreground\">\n                      {voiceRephrasingEnabled ? \"Enabled\" : \"Disabled\"}\n                    </p>\n                  </div>\n                </div>\n                <Switch\n                  id=\"rephrasing-toggle\"\n                  checked={voiceRephrasingEnabled}\n                  onCheckedChange={setVoiceRephrasingEnabled}\n                  data-testid=\"switch-rephrasing\"\n                />\n              </div>\n\n              {/* Personality Selector */}\n              <div className=\"space-y-2\">\n                <div className=\"flex items-center justify-between\">\n                  <label className=\"text-sm font-medium flex items-center gap-2\">\n                    <Sparkles className=\"h-4 w-4\" />\n                    AI Personality\n                  </label>\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={handleTestVoice}\n                    disabled={!ttsEnabled || isSpeaking}\n                    data-testid=\"button-test-voice\"\n                  >\n                    {isSpeaking ? \"Speaking...\" : \"Test Voice\"}\n                  </Button>\n                </div>\n                <Select value={personality} onValueChange={(value: any) => handlePersonalityChange(value)}>\n                  <SelectTrigger data-testid=\"select-personality\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"Neutral\">Neutral - Natural & conversational</SelectItem>\n                    <SelectItem value=\"Quirky\">Quirky - Playful & energetic</SelectItem>\n                    <SelectItem value=\"Funny\">Funny - Humorous & lighthearted</SelectItem>\n                    <SelectItem value=\"Sarcastic\">Sarcastic - Witty & deadpan</SelectItem>\n                    <SelectItem value=\"Professional\">Professional - Polished & articulate</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n\n              {/* Voice Selector */}\n              <div className=\"space-y-2\">\n                <label className=\"text-sm font-medium flex items-center gap-2\">\n                  <Volume2 className=\"h-4 w-4\" />\n                  Voice Selection\n                </label>\n                <Select value={selectedVoice} onValueChange={setSelectedVoice}>\n                  <SelectTrigger data-testid=\"select-voice\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {PUTER_VOICES.map((voice) => (\n                      <SelectItem key={voice.id} value={voice.id}>\n                        {voice.name} ({voice.gender}, {voice.region})\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n\n              {/* Dual Audio Output Controls */}\n              <div className=\"pt-2 border-t space-y-3\">\n                <div className=\"flex items-center justify-between\">\n                  <label className=\"text-sm font-medium\">Audio Outputs</label>\n                  {isSpeaking && (\n                    <Badge variant=\"secondary\" className=\"text-xs\">\n                      <Volume2 className=\"h-3 w-3 mr-1\" />\n                      Playing\n                    </Badge>\n                  )}\n                </div>\n\n                {/* Program Audio (Main Output) */}\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-3\">\n                    <Volume2 className=\"h-4 w-4 text-primary\" />\n                    <div>\n                      <label htmlFor=\"program-audio\" className=\"text-sm cursor-pointer\">\n                        Program Audio\n                      </label>\n                      <p className=\"text-xs text-muted-foreground\">\n                        {programAudioMuted ? \"Muted\" : \"Active\"}\n                      </p>\n                    </div>\n                  </div>\n                  <Switch\n                    id=\"program-audio\"\n                    checked={!programAudioMuted}\n                    onCheckedChange={(checked) => setProgramAudioMuted(!checked)}\n                    data-testid=\"switch-program-audio\"\n                  />\n                </div>\n\n                {/* Second Cable (Optional Output) */}\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-3\">\n                    <Volume2 className=\"h-4 w-4 text-primary\" />\n                    <div>\n                      <label htmlFor=\"second-cable\" className=\"text-sm cursor-pointer\">\n                        Second Cable\n                      </label>\n                      <p className=\"text-xs text-muted-foreground\">\n                        {secondCableMuted ? \"Muted\" : \"Active\"}\n                      </p>\n                    </div>\n                  </div>\n                  <Switch\n                    id=\"second-cable\"\n                    checked={!secondCableMuted}\n                    onCheckedChange={(checked) => setSecondCableMuted(!checked)}\n                    data-testid=\"switch-second-cable\"\n                  />\n                </div>\n              </div>\n\n              {/* Pause/Resume Listening Button */}\n              <div className=\"pt-2\">\n                <Button\n                  onClick={handleListeningToggle}\n                  variant={listeningPaused ? \"default\" : \"secondary\"}\n                  className=\"w-full\"\n                  data-testid=\"button-pause-listening\"\n                >\n                  {listeningPaused ? (\n                    <>\n                      <Play className=\"h-4 w-4 mr-2\" />\n                      Resume Listening\n                    </>\n                  ) : (\n                    <>\n                      <Pause className=\"h-4 w-4 mr-2\" />\n                      Pause Listening\n                    </>\n                  )}\n                </Button>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Live Transcription Display */}\n          <Card data-testid=\"card-live-transcription\">\n            <CardHeader>\n              <div className=\"flex items-center justify-between\">\n                <CardTitle className=\"text-lg font-semibold flex items-center gap-2\">\n                  <Mic className=\"h-5 w-5\" />\n                  Live Transcription\n                  {isListening && !listeningPaused && (\n                    <Badge variant=\"default\" className=\"ml-2\">\n                      <span className=\"w-2 h-2 rounded-full bg-red-500 animate-pulse mr-2\"></span>\n                      Listening\n                    </Badge>\n                  )}\n                </CardTitle>\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  onClick={handleClearOutput}\n                  data-testid=\"button-clear-transcript\"\n                >\n                  <RefreshCw className=\"h-4 w-4\" />\n                </Button>\n              </div>\n              <p className=\"text-xs text-muted-foreground mt-1\">\n                What the microphone detected\n              </p>\n            </CardHeader>\n            <CardContent>\n              <ScrollArea className=\"h-[200px] w-full rounded-md border p-4 bg-muted/30\">\n                {transcript ? (\n                  <p className=\"text-sm text-foreground whitespace-pre-wrap\" data-testid=\"text-transcript\">\n                    {transcript}\n                  </p>\n                ) : (\n                  <p className=\"text-sm text-muted-foreground italic\">\n                    {!voiceSupported \n                      ? \"Voice recognition not supported in this browser\" \n                      : micMuted\n                      ? \"Microphone is muted\"\n                      : listeningPaused\n                      ? \"Listening paused - Click 'Resume Listening' to continue\"\n                      : \"Waiting for speech input...\"}\n                  </p>\n                )}\n              </ScrollArea>\n            </CardContent>\n          </Card>\n\n          {/* AI Rephrased Output */}\n          <Card data-testid=\"card-ai-rephrased\">\n            <CardHeader>\n              <CardTitle className=\"text-lg font-semibold flex items-center gap-2\">\n                <Sparkles className=\"h-5 w-5\" />\n                AI Rephrased Output\n                {isEnhancing && (\n                  <Badge variant=\"secondary\" className=\"ml-2\">\n                    Processing...\n                  </Badge>\n                )}\n              </CardTitle>\n              <p className=\"text-xs text-muted-foreground mt-1\">\n                AI-enhanced version (auto-clears after each response)\n              </p>\n            </CardHeader>\n            <CardContent>\n              <ScrollArea className=\"h-[200px] w-full rounded-md border p-4 bg-primary/10\">\n                {enhancedText ? (\n                  <p className=\"text-sm text-foreground font-medium whitespace-pre-wrap\" data-testid=\"text-enhanced\">\n                    {enhancedText}\n                  </p>\n                ) : (\n                  <p className=\"text-sm text-muted-foreground italic\">\n                    {!voiceRephrasingEnabled\n                      ? \"Voice rephrasing is disabled\"\n                      : \"AI-enhanced text will appear here...\"}\n                  </p>\n                )}\n              </ScrollArea>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* RIGHT COLUMN - StreamDashi Display (FIXED WIDTH) */}\n        <div className=\"lg:col-span-7\" id=\"streamdashi-display\" style={{ maxWidth: '900px' }}>\n          \n          {/* 3-Module Status Layout */}\n          <div className=\"grid gap-4 md:grid-cols-3 mb-6\">\n            {/* Module 1: Status Collecting Messages */}\n            <Card data-testid=\"card-status\">\n              <CardHeader>\n                <CardTitle className=\"text-lg font-semibold flex items-center gap-2\">\n                  <Clock className=\"h-5 w-5\" />\n                  Status\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                {/* Status Badge */}\n                <div className=\"flex items-center justify-center\">\n                  <Badge \n                    variant={isPaused ? \"secondary\" : \"default\"}\n                    className=\"text-lg py-2 px-4\"\n                    data-testid=\"badge-status\"\n                  >\n                    {isPaused ? \"PAUSED\" : streamStatus?.status?.toUpperCase() || \"IDLE\"}\n                  </Badge>\n                </div>\n\n                {/* Countdown Timer */}\n                <div className=\"text-center\">\n                  <div className=\"text-4xl font-bold text-primary\" data-testid=\"text-countdown\">\n                    {formatTime(streamStatus?.secondsUntilNextCycle || cycleInterval)}\n                  </div>\n                  <p className=\"text-xs text-muted-foreground mt-1\">Until next cycle</p>\n                </div>\n\n                {/* Pause/Resume and Reset Buttons */}\n                <div className=\"grid grid-cols-2 gap-2\">\n                  <Button\n                    onClick={handlePauseToggle}\n                    variant={isPaused ? \"default\" : \"secondary\"}\n                    className=\"w-full\"\n                    data-testid=\"button-pause-resume\"\n                  >\n                    {isPaused ? (\n                      <>\n                        <Play className=\"h-4 w-4 mr-2\" />\n                        Resume\n                      </>\n                    ) : (\n                      <>\n                        <Pause className=\"h-4 w-4 mr-2\" />\n                        Pause\n                      </>\n                    )}\n                  </Button>\n                  <Button\n                    onClick={() => resetMutation.mutate()}\n                    variant=\"destructive\"\n                    className=\"w-full\"\n                    data-testid=\"button-reset\"\n                  >\n                    <Square className=\"h-4 w-4 mr-2\" />\n                    Reset\n                  </Button>\n                </div>\n\n                {/* Timer Slider */}\n                <div className=\"space-y-2\">\n                  <div className=\"flex items-center justify-between\">\n                    <label className=\"text-sm font-medium\">Cycle Interval</label>\n                    <span className=\"text-sm text-muted-foreground\" data-testid=\"text-interval\">\n                      {formatTime(cycleInterval)}\n                    </span>\n                  </div>\n                  <Slider\n                    value={[cycleInterval]}\n                    onValueChange={handleIntervalChange}\n                    min={1}\n                    max={300}\n                    step={1}\n                    className=\"w-full\"\n                    data-testid=\"slider-interval\"\n                  />\n                  <div className=\"flex justify-between text-xs text-muted-foreground\">\n                    <span>1s</span>\n                    <span>5m</span>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            {/* Module 2: Collected Messages */}\n            <Card data-testid=\"card-collected-messages\">\n              <CardHeader>\n                <CardTitle className=\"text-lg font-semibold flex items-center gap-2\">\n                  <MessageSquare className=\"h-5 w-5\" />\n                  Messages\n                </CardTitle>\n                <div className=\"text-sm text-muted-foreground mt-1\">\n                  {streamStatus?.bufferCount || 0} collected\n                </div>\n              </CardHeader>\n              <CardContent>\n                {/* Inline Scrollable Messages */}\n                {bufferMessages.length === 0 ? (\n                  <div className=\"text-center py-8 text-muted-foreground text-sm\">\n                    No messages yet\n                  </div>\n                ) : (\n                  <ScrollArea className=\"h-[350px] pr-4\">\n                    <div className=\"space-y-2\">\n                      {bufferMessages.map((msg, index) => (\n                        <div\n                          key={index}\n                          className=\"p-3 rounded-lg border bg-card text-sm hover-elevate\"\n                          data-testid={`message-${index}`}\n                        >\n                          <div className=\"flex items-center justify-between mb-1\">\n                            <button\n                              onClick={() => setSelectedUser({username: msg.username, userId: msg.userId})}\n                              className=\"font-medium text-primary hover:underline cursor-pointer\"\n                              data-testid={`username-${index}`}\n                            >\n                              {msg.username}\n                            </button>\n                            <span className=\"text-xs text-muted-foreground\">\n                              {format(new Date(msg.timestamp), \"HH:mm:ss\")}\n                            </span>\n                          </div>\n                          <p className=\"text-foreground\">{msg.message}</p>\n                        </div>\n                      ))}\n                    </div>\n                  </ScrollArea>\n                )}\n              </CardContent>\n            </Card>\n\n            {/* Module 3: AI Responses */}\n            <Card data-testid=\"card-ai-responses\">\n              <CardHeader>\n                <CardTitle className=\"text-lg font-semibold flex items-center gap-2\">\n                  <Sparkles className=\"h-5 w-5\" />\n                  AI Responses\n                </CardTitle>\n                <div className=\"text-sm text-muted-foreground mt-1\">\n                  {allAiResponses.length} total\n                </div>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                {/* Response Limit Selector */}\n                <div className=\"flex items-center gap-2\">\n                  <label className=\"text-sm font-medium\">Show:</label>\n                  <Select\n                    value={aiResponseLimit.toString()}\n                    onValueChange={(value) => setAiResponseLimit(parseInt(value))}\n                  >\n                    <SelectTrigger className=\"w-[100px]\" data-testid=\"select-ai-limit\">\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"5\">5</SelectItem>\n                      <SelectItem value=\"10\">10</SelectItem>\n                      <SelectItem value=\"25\">25</SelectItem>\n                      <SelectItem value=\"50\">50</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n\n                {/* Inline Scrollable Responses */}\n                {limitedAiResponses.length === 0 ? (\n                  <div className=\"text-center py-8 text-muted-foreground text-sm\">\n                    No responses yet\n                  </div>\n                ) : (\n                  <ScrollArea className=\"h-[280px] pr-4\">\n                    <div className=\"space-y-3\">\n                      {limitedAiResponses.map((response) => (\n                        <div\n                          key={response.id}\n                          className=\"p-3 rounded-lg border bg-card text-sm\"\n                          data-testid={`ai-response-${response.id}`}\n                        >\n                          <div className=\"flex items-center justify-between mb-2\">\n                            <span className=\"text-xs text-muted-foreground\">\n                              {format(new Date(response.timestamp), \"MMM d, HH:mm:ss\")}\n                            </span>\n                          </div>\n                          <div className=\"space-y-2\">\n                            <div>\n                              <p className=\"text-xs text-muted-foreground mb-1\">Original:</p>\n                              <p className=\"text-foreground bg-muted/30 p-2 rounded\">\n                                {response.originalText}\n                              </p>\n                            </div>\n                            <div>\n                              <p className=\"text-xs text-primary mb-1\">AI Rephrased:</p>\n                              <p className=\"text-foreground bg-primary/10 p-2 rounded border border-primary/20 font-medium\">\n                                {response.rephrasedText}\n                              </p>\n                            </div>\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                  </ScrollArea>\n                )}\n              </CardContent>\n            </Card>\n          </div>\n\n          {/* Visual Workflow Chart (Fixed Width Display) */}\n          <div style={{ width: '100%', maxWidth: '900px' }}>\n            <WorkflowChart\n              currentStage={workflowData.stage}\n              stageStatuses={workflowData.statuses}\n            />\n          </div>\n        </div>\n      </div>\n\n      {/* User Management Dialog */}\n      <Dialog open={selectedUser !== null} onOpenChange={(open) => !open && setSelectedUser(null)}>\n        <DialogContent data-testid=\"dialog-user-management\">\n          <DialogHeader>\n            <DialogTitle>Manage {selectedUser?.username}</DialogTitle>\n            <DialogDescription>\n              Twitch moderation commands and VIP controls\n            </DialogDescription>\n          </DialogHeader>\n\n          <div className=\"space-y-4\">\n            {/* Mod Commands */}\n            <div>\n              <h4 className=\"text-sm font-semibold mb-2 flex items-center gap-2\">\n                <Shield className=\"h-4 w-4\" />\n                Moderation Actions\n              </h4>\n              <div className=\"grid grid-cols-2 gap-2\">\n                <Button variant=\"outline\" size=\"sm\" data-testid=\"button-timeout\">\n                  <TimeoutIcon className=\"h-4 w-4 mr-2\" />\n                  Timeout (10m)\n                </Button>\n                <Button variant=\"destructive\" size=\"sm\" data-testid=\"button-ban\">\n                  <Ban className=\"h-4 w-4 mr-2\" />\n                  Ban User\n                </Button>\n              </div>\n            </div>\n\n            {/* VIP & Mod Controls */}\n            <div>\n              <h4 className=\"text-sm font-semibold mb-2 flex items-center gap-2\">\n                <Star className=\"h-4 w-4\" />\n                Role Management\n              </h4>\n              <div className=\"grid grid-cols-2 gap-2\">\n                <Button variant=\"outline\" size=\"sm\" data-testid=\"button-add-vip\">\n                  <Star className=\"h-4 w-4 mr-2\" />\n                  Add VIP\n                </Button>\n                <Button variant=\"outline\" size=\"sm\" data-testid=\"button-remove-vip\">\n                  <Star className=\"h-4 w-4 mr-2\" />\n                  Remove VIP\n                </Button>\n                <Button variant=\"outline\" size=\"sm\" data-testid=\"button-add-mod\">\n                  <Shield className=\"h-4 w-4 mr-2\" />\n                  Add Mod\n                </Button>\n                <Button variant=\"outline\" size=\"sm\" data-testid=\"button-remove-mod\">\n                  <Shield className=\"h-4 w-4 mr-2\" />\n                  Remove Mod\n                </Button>\n              </div>\n            </div>\n\n            {/* Future: Channel Points Display */}\n            <div className=\"pt-2 border-t\">\n              <p className=\"text-xs text-muted-foreground italic\">\n                Channel points display coming soon via Twitch API integration\n              </p>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","size_bytes":39419},"server/active-chatters-service.ts":{"content":"import type { ChatMessage, UserProfile } from \"@shared/schema\";\n\ninterface ActiveChatter {\n  username: string;\n  displayName: string;\n  userId: string;\n  lastMessageTime: Date;\n  messageCount: number;\n  isVip: boolean;\n  isMod: boolean;\n  isSubscriber: boolean;\n}\n\nexport class ActiveChattersService {\n  private chatters: Map<string, ActiveChatter> = new Map();\n  private readonly ACTIVE_WINDOW_MS = 30 * 60 * 1000; // 30 minutes\n\n  addMessage(message: ChatMessage, userProfile?: UserProfile) {\n    const existing = this.chatters.get(message.username.toLowerCase());\n    \n    if (existing) {\n      existing.lastMessageTime = new Date();\n      existing.messageCount++;\n      if (userProfile) {\n        existing.isVip = userProfile.isVip;\n        existing.isMod = userProfile.isMod;\n        existing.isSubscriber = userProfile.isSubscriber;\n      }\n    } else {\n      this.chatters.set(message.username.toLowerCase(), {\n        username: message.username,\n        displayName: message.username,\n        userId: message.userId || \"\",\n        lastMessageTime: new Date(),\n        messageCount: 1,\n        isVip: userProfile?.isVip || false,\n        isMod: userProfile?.isMod || false,\n        isSubscriber: userProfile?.isSubscriber || false,\n      });\n    }\n  }\n\n  getActiveChatters(): ActiveChatter[] {\n    this.cleanupInactive();\n    return Array.from(this.chatters.values())\n      .sort((a, b) => b.lastMessageTime.getTime() - a.lastMessageTime.getTime());\n  }\n\n  searchChatters(query: string): ActiveChatter[] {\n    this.cleanupInactive();\n    const lowerQuery = query.toLowerCase();\n    \n    return Array.from(this.chatters.values())\n      .filter(chatter => \n        chatter.username.toLowerCase().includes(lowerQuery) ||\n        chatter.displayName.toLowerCase().includes(lowerQuery)\n      )\n      .sort((a, b) => b.lastMessageTime.getTime() - a.lastMessageTime.getTime())\n      .slice(0, 10);\n  }\n\n  private cleanupInactive() {\n    const now = Date.now();\n    const toRemove: string[] = [];\n    \n    for (const [key, chatter] of Array.from(this.chatters.entries())) {\n      if (now - chatter.lastMessageTime.getTime() > this.ACTIVE_WINDOW_MS) {\n        toRemove.push(key);\n      }\n    }\n    \n    toRemove.forEach(key => this.chatters.delete(key));\n  }\n\n  clear() {\n    this.chatters.clear();\n  }\n\n  getCount(): number {\n    this.cleanupInactive();\n    return this.chatters.size;\n  }\n}\n","size_bytes":2390},"client/src/pages/raid-management.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Avatar, AvatarImage, AvatarFallback } from \"@/components/ui/avatar\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { Users, ExternalLink, Loader2, Rocket, Crown, Info } from \"lucide-react\";\nimport { formatDistanceToNow } from \"date-fns\";\nimport type { UserProfile } from \"@shared/schema\";\n\ninterface Raid {\n  id: number;\n  fromUserId: string;\n  fromUsername: string;\n  fromDisplayName: string;\n  viewers: number;\n  timestamp: string;\n}\n\ninterface TwitchSearchUser {\n  id: string;\n  login: string;\n  display_name: string;\n  profile_image_url: string;\n}\n\nexport default function RaidManagement() {\n  const { toast } = useToast();\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [raidTarget, setRaidTarget] = useState(\"\");\n  const [showSuggestions, setShowSuggestions] = useState(false);\n  const dropdownRef = useRef<HTMLDivElement>(null);\n  const inputRef = useRef<HTMLInputElement>(null);\n\n  const { data: raids = [], isLoading: raidsLoading } = useQuery<Raid[]>({\n    queryKey: [\"/api/raids\"],\n    refetchInterval: 5000,\n  });\n\n  const { data: vips = [] } = useQuery<UserProfile[]>({\n    queryKey: [\"/api/users/vips\"],\n  });\n\n  const { data: suggestions = [], isLoading: isSearching } = useQuery<TwitchSearchUser[]>({\n    queryKey: [`/api/twitch/search-users?query=${searchQuery}`],\n    enabled: searchQuery.length > 1,\n  });\n\n  useEffect(() => {\n    const timer = setTimeout(() => {\n      setSearchQuery(raidTarget);\n      if (raidTarget.length > 1) {\n        setShowSuggestions(true);\n      } else {\n        setShowSuggestions(false);\n      }\n    }, 300);\n    return () => clearTimeout(timer);\n  }, [raidTarget]);\n\n  useEffect(() => {\n    const handleClickOutside = (event: MouseEvent) => {\n      if (dropdownRef.current && !dropdownRef.current.contains(event.target as Node)) {\n        setShowSuggestions(false);\n      }\n    };\n    document.addEventListener(\"mousedown\", handleClickOutside);\n    return () => document.removeEventListener(\"mousedown\", handleClickOutside);\n  }, []);\n\n  const startRaidMutation = useMutation({\n    mutationFn: async (toUsername: string) => {\n      return await apiRequest(\"POST\", \"/api/raids/start\", { toUsername });\n    },\n    onSuccess: (data: any) => {\n      toast({\n        title: \"Raid Started!\",\n        description: `Successfully started raid to ${data.message?.split(\"to \")[1] || \"target channel\"}`,\n      });\n      setRaidTarget(\"\");\n      setShowSuggestions(false);\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Raid Failed\",\n        description: error.message || \"Failed to start raid. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleSelectUser = (username: string) => {\n    setRaidTarget(username);\n    setShowSuggestions(false);\n    if (inputRef.current) {\n      inputRef.current.focus();\n    }\n  };\n\n  const handleRaidVIP = (username: string) => {\n    startRaidMutation.mutate(username);\n  };\n\n  const handleRaidSearch = () => {\n    if (raidTarget.trim()) {\n      startRaidMutation.mutate(raidTarget.trim());\n    }\n  };\n\n  const handleKeyDown = (e: React.KeyboardEvent) => {\n    if (e.key === \"Enter\" && suggestions.length > 0 && showSuggestions) {\n      e.preventDefault();\n      handleSelectUser(suggestions[0].login);\n    } else if (e.key === \"Enter\" && !showSuggestions && raidTarget.trim()) {\n      e.preventDefault();\n      handleRaidSearch();\n    }\n  };\n\n  return (\n    <div className=\"container mx-auto p-6 space-y-6\" data-testid=\"page-raid-management\">\n      <div>\n        <h1 className=\"text-3xl font-bold text-foreground mb-2\" data-testid=\"text-page-title\">\n          Raid Management\n        </h1>\n        <p className=\"text-muted-foreground mb-3\" data-testid=\"text-page-description\">\n          View incoming raids and send your viewers to raid other channels\n        </p>\n        <div className=\"flex items-start gap-2 p-3 rounded-lg bg-muted/50 border border-border\">\n          <Info className=\"h-4 w-4 text-primary mt-0.5 shrink-0\" />\n          <p className=\"text-sm text-muted-foreground\">\n            <strong className=\"text-foreground\">Note:</strong> To send raids, you must be authenticated with Twitch. \n            If raid commands fail, try disconnecting and reconnecting your Twitch account in Settings to grant raid permissions.\n          </p>\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        {/* Incoming Raids */}\n        <Card data-testid=\"card-incoming-raids\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Users className=\"h-5 w-5 text-primary\" />\n              Incoming Raids\n            </CardTitle>\n            <CardDescription>Recent raids from other streamers</CardDescription>\n          </CardHeader>\n          <CardContent>\n            {raidsLoading ? (\n              <div className=\"flex items-center justify-center py-8\">\n                <Loader2 className=\"h-6 w-6 animate-spin text-muted-foreground\" />\n              </div>\n            ) : raids.length === 0 ? (\n              <div className=\"text-center py-8 text-muted-foreground\" data-testid=\"text-no-raids\">\n                No raids yet. When someone raids your channel, they'll appear here!\n              </div>\n            ) : (\n              <div className=\"space-y-3\">\n                {raids.map((raid) => (\n                  <div\n                    key={raid.id}\n                    className=\"flex items-center justify-between p-3 rounded-lg bg-card border border-border hover-elevate\"\n                    data-testid={`card-raid-${raid.id}`}\n                  >\n                    <div className=\"flex items-center gap-3 flex-1\">\n                      <Avatar className=\"h-10 w-10\">\n                        <AvatarImage \n                          src={`https://unavatar.io/twitch/${raid.fromUsername}`}\n                          alt={raid.fromDisplayName}\n                        />\n                        <AvatarFallback>{raid.fromDisplayName[0]}</AvatarFallback>\n                      </Avatar>\n                      <div className=\"flex-1 min-w-0\">\n                        <div className=\"flex items-center gap-2\">\n                          <span className=\"font-semibold text-foreground truncate\">\n                            {raid.fromDisplayName}\n                          </span>\n                          <Badge variant=\"secondary\" className=\"shrink-0\">\n                            {raid.viewers} {raid.viewers === 1 ? 'viewer' : 'viewers'}\n                          </Badge>\n                        </div>\n                        <p className=\"text-sm text-muted-foreground\">\n                          {formatDistanceToNow(new Date(raid.timestamp), { addSuffix: true })}\n                        </p>\n                      </div>\n                    </div>\n                    <Button\n                      variant=\"ghost\"\n                      size=\"icon\"\n                      asChild\n                      data-testid={`button-view-profile-${raid.id}`}\n                    >\n                      <a\n                        href={`https://www.twitch.tv/${raid.fromUsername}`}\n                        target=\"_blank\"\n                        rel=\"noopener noreferrer\"\n                        title=\"View on Twitch\"\n                      >\n                        <ExternalLink className=\"h-4 w-4\" />\n                      </a>\n                    </Button>\n                  </div>\n                ))}\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        {/* Outgoing Raids */}\n        <Card data-testid=\"card-outgoing-raids\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Rocket className=\"h-5 w-5 text-primary\" />\n              Start a Raid\n            </CardTitle>\n            <CardDescription>Send your viewers to raid another channel</CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            {/* VIP Quick Raid */}\n            {vips.length > 0 && (\n              <div>\n                <h3 className=\"text-sm font-medium text-foreground mb-3 flex items-center gap-2\">\n                  <Crown className=\"h-4 w-4 text-primary\" />\n                  Your VIPs\n                </h3>\n                <div className=\"space-y-2\">\n                  {vips.map((vip) => (\n                    <div\n                      key={vip.userId}\n                      className=\"flex items-center justify-between p-3 rounded-lg bg-card border border-border hover-elevate\"\n                      data-testid={`card-vip-${vip.userId}`}\n                    >\n                      <div className=\"flex items-center gap-3 flex-1\">\n                        <Avatar className=\"h-8 w-8\">\n                          <AvatarImage \n                            src={`https://unavatar.io/twitch/${vip.username}`}\n                            alt={vip.username}\n                          />\n                          <AvatarFallback>{vip.username[0]}</AvatarFallback>\n                        </Avatar>\n                        <span className=\"font-medium text-foreground\">{vip.username}</span>\n                      </div>\n                      <Button\n                        variant=\"default\"\n                        size=\"sm\"\n                        onClick={() => handleRaidVIP(vip.username)}\n                        disabled={startRaidMutation.isPending}\n                        data-testid={`button-raid-vip-${vip.userId}`}\n                      >\n                        {startRaidMutation.isPending ? (\n                          <Loader2 className=\"h-4 w-4 animate-spin\" />\n                        ) : (\n                          <>\n                            <Rocket className=\"h-4 w-4 mr-2\" />\n                            Raid\n                          </>\n                        )}\n                      </Button>\n                    </div>\n                  ))}\n                </div>\n              </div>\n            )}\n\n            {/* Search and Raid */}\n            <div>\n              <h3 className=\"text-sm font-medium text-foreground mb-3\">Raid Any Channel</h3>\n              <div className=\"relative\" ref={dropdownRef}>\n                <div className=\"flex gap-2\">\n                  <Input\n                    ref={inputRef}\n                    placeholder=\"Search for a channel...\"\n                    value={raidTarget}\n                    onChange={(e) => setRaidTarget(e.target.value)}\n                    onKeyDown={handleKeyDown}\n                    data-testid=\"input-raid-search\"\n                    className=\"flex-1\"\n                  />\n                  <Button\n                    onClick={handleRaidSearch}\n                    disabled={!raidTarget.trim() || startRaidMutation.isPending}\n                    data-testid=\"button-raid-search\"\n                  >\n                    {startRaidMutation.isPending ? (\n                      <Loader2 className=\"h-4 w-4 animate-spin\" />\n                    ) : (\n                      <>\n                        <Rocket className=\"h-4 w-4 mr-2\" />\n                        Raid\n                      </>\n                    )}\n                  </Button>\n                </div>\n\n                {/* Autocomplete Suggestions */}\n                {showSuggestions && suggestions.length > 0 && (\n                  <div className=\"absolute z-50 w-full mt-1 bg-popover border border-border rounded-lg shadow-lg max-h-60 overflow-y-auto\">\n                    {isSearching ? (\n                      <div className=\"p-4 text-center text-muted-foreground\">\n                        <Loader2 className=\"h-4 w-4 animate-spin inline\" />\n                      </div>\n                    ) : (\n                      suggestions.map((user) => (\n                        <button\n                          key={user.id}\n                          className=\"w-full flex items-center gap-3 p-3 hover-elevate text-left\"\n                          onClick={() => handleSelectUser(user.login)}\n                          data-testid={`button-suggestion-${user.login}`}\n                        >\n                          <Avatar className=\"h-8 w-8\">\n                            <AvatarImage src={user.profile_image_url} alt={user.display_name} />\n                            <AvatarFallback>{user.display_name[0]}</AvatarFallback>\n                          </Avatar>\n                          <div>\n                            <div className=\"font-medium text-foreground\">{user.display_name}</div>\n                            <div className=\"text-sm text-muted-foreground\">@{user.login}</div>\n                          </div>\n                        </button>\n                      ))\n                    )}\n                  </div>\n                )}\n              </div>\n              <p className=\"text-xs text-muted-foreground mt-2\">\n                Start typing to search all Twitch channels, or select a VIP above\n              </p>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","size_bytes":13450},"client/src/hooks/use-text-to-speech.ts":{"content":"import { useState, useEffect, useCallback, useRef } from \"react\";\n\nexport interface TTSVoice {\n  voice: SpeechSynthesisVoice;\n  name: string;\n  lang: string;\n}\n\ninterface TTSSettings {\n  enabled: boolean;\n  voice: string | null; // voice name\n  pitch: number; // 0.5 - 2\n  rate: number; // 0.5 - 2\n  volume: number; // 0 - 1\n}\n\ninterface UseTextToSpeechReturn {\n  isSupported: boolean;\n  isSpeaking: boolean;\n  voices: TTSVoice[];\n  settings: TTSSettings;\n  speak: (text: string) => void;\n  stop: () => void;\n  updateSettings: (settings: Partial<TTSSettings>) => void;\n}\n\nexport function useTextToSpeech(): UseTextToSpeechReturn {\n  const [isSupported] = useState(\n    typeof window !== \"undefined\" && \"speechSynthesis\" in window\n  );\n  const [isSpeaking, setIsSpeaking] = useState(false);\n  const [voices, setVoices] = useState<TTSVoice[]>([]);\n  const [settings, setSettings] = useState<TTSSettings>({\n    enabled: false,\n    voice: null,\n    pitch: 1.0,\n    rate: 1.0,\n    volume: 1.0,\n  });\n\n  const utteranceRef = useRef<SpeechSynthesisUtterance | null>(null);\n\n  // Load available voices\n  useEffect(() => {\n    if (!isSupported) return;\n\n    const loadVoices = () => {\n      const availableVoices = window.speechSynthesis.getVoices();\n      const voiceList = availableVoices.map((voice) => ({\n        voice,\n        name: voice.name,\n        lang: voice.lang,\n      }));\n      setVoices(voiceList);\n      \n      // Set default voice if not set\n      if (!settings.voice && voiceList.length > 0) {\n        // Prefer English voices\n        const englishVoice = voiceList.find((v) => v.lang.startsWith(\"en\"));\n        setSettings((prev) => ({\n          ...prev,\n          voice: englishVoice ? englishVoice.name : voiceList[0].name,\n        }));\n      }\n    };\n\n    loadVoices();\n    \n    // Voices might load asynchronously\n    if (window.speechSynthesis.onvoiceschanged !== undefined) {\n      window.speechSynthesis.onvoiceschanged = loadVoices;\n    }\n\n    return () => {\n      if (window.speechSynthesis.onvoiceschanged !== undefined) {\n        window.speechSynthesis.onvoiceschanged = null;\n      }\n    };\n  }, [isSupported]);\n\n  const speak = useCallback(\n    (text: string) => {\n      if (!isSupported || !text.trim()) return;\n\n      // Cancel any ongoing speech\n      window.speechSynthesis.cancel();\n\n      const utterance = new SpeechSynthesisUtterance(text);\n      \n      // Find selected voice\n      const selectedVoice = voices.find((v) => v.name === settings.voice);\n      if (selectedVoice) {\n        utterance.voice = selectedVoice.voice;\n      }\n\n      utterance.pitch = settings.pitch;\n      utterance.rate = settings.rate;\n      utterance.volume = settings.volume;\n\n      utterance.onstart = () => {\n        console.log(\"TTS started:\", text);\n        setIsSpeaking(true);\n      };\n\n      utterance.onend = () => {\n        console.log(\"TTS ended\");\n        setIsSpeaking(false);\n      };\n\n      utterance.onerror = (event) => {\n        console.error(\"TTS error:\", event);\n        setIsSpeaking(false);\n      };\n\n      utteranceRef.current = utterance;\n      window.speechSynthesis.speak(utterance);\n    },\n    [isSupported, voices, settings]\n  );\n\n  const stop = useCallback(() => {\n    if (!isSupported) return;\n    window.speechSynthesis.cancel();\n    setIsSpeaking(false);\n  }, [isSupported]);\n\n  const updateSettings = useCallback((newSettings: Partial<TTSSettings>) => {\n    setSettings((prev) => ({ ...prev, ...newSettings }));\n  }, []);\n\n  // Cleanup on unmount\n  useEffect(() => {\n    return () => {\n      if (isSupported) {\n        window.speechSynthesis.cancel();\n      }\n    };\n  }, [isSupported]);\n\n  return {\n    isSupported,\n    isSpeaking,\n    voices,\n    settings,\n    speak,\n    stop,\n    updateSettings,\n  };\n}\n","size_bytes":3750},"client/src/hooks/use-voice-recognition.ts":{"content":"import { useState, useEffect, useRef, useCallback } from \"react\";\nimport { apiRequest } from \"@/lib/queryClient\";\n\ninterface VoiceRecognitionOptions {\n  onTranscript?: (transcript: string) => void;\n  onEnhanced?: (original: string, enhanced: string) => void;\n  onError?: (error: string) => void;\n  onStart?: () => void;\n  onEnd?: () => void;\n  autoEnhance?: boolean;\n  continuous?: boolean;\n}\n\ninterface UseVoiceRecognitionReturn {\n  isListening: boolean;\n  transcript: string;\n  enhancedText: string;\n  startListening: () => void;\n  stopListening: () => void;\n  resetTranscript: () => void;\n  isSupported: boolean;\n  isEnhancing: boolean;\n}\n\nexport function useVoiceRecognition(options: VoiceRecognitionOptions = {}): UseVoiceRecognitionReturn {\n  const {\n    onTranscript,\n    onEnhanced,\n    onError,\n    onStart,\n    onEnd,\n    autoEnhance = true,\n    continuous = true,\n  } = options;\n\n  const [isListening, setIsListening] = useState(false);\n  const [transcript, setTranscript] = useState(\"\");\n  const [enhancedText, setEnhancedText] = useState(\"\");\n  const [isEnhancing, setIsEnhancing] = useState(false);\n  \n  const mediaRecorderRef = useRef<MediaRecorder | null>(null);\n  const audioChunksRef = useRef<Blob[]>([]);\n  const silenceTimeoutRef = useRef<NodeJS.Timeout | null>(null);\n  const shouldBeListeningRef = useRef(false);\n  const accumulatedTranscriptRef = useRef(\"\");\n  const lastSpeechTimeRef = useRef<number>(0);\n  const audioContextRef = useRef<AudioContext | null>(null);\n  const analyserRef = useRef<AnalyserNode | null>(null);\n  const silenceDetectorRef = useRef<NodeJS.Timeout | null>(null);\n  const streamRef = useRef<MediaStream | null>(null);\n\n  // Check if browser supports MediaRecorder\n  const isSupported = typeof window !== \"undefined\" && \n    \"MediaRecorder\" in window && \n    typeof navigator !== \"undefined\" &&\n    !!navigator.mediaDevices && \n    typeof navigator.mediaDevices.getUserMedia === \"function\";\n\n  const enhanceSpeech = useCallback(async (text: string) => {\n    if (!text.trim()) return;\n\n    console.log(\"Enhancing speech:\", text);\n    setIsEnhancing(true);\n    try {\n      const response = await apiRequest(\"POST\", \"/api/voice/enhance\", { text });\n      const result: { original: string; enhanced: string } = await response.json();\n      setEnhancedText(result.enhanced);\n      onEnhanced?.(result.original, result.enhanced);\n    } catch (error: any) {\n      console.error(\"Failed to enhance speech:\", error);\n      onError?.(\"Failed to enhance speech\");\n    } finally {\n      setIsEnhancing(false);\n    }\n  }, [onEnhanced, onError]);\n\n  const transcribeAudio = useCallback(async (audioBlob: Blob) => {\n    try {\n      console.log(\"Sending audio to Groq Whisper for transcription...\");\n      \n      const formData = new FormData();\n      formData.append(\"audio\", audioBlob, \"audio.webm\");\n      \n      const response = await fetch(\"/api/voice/transcribe\", {\n        method: \"POST\",\n        body: formData,\n      });\n\n      if (!response.ok) {\n        throw new Error(\"Transcription failed\");\n      }\n\n      const result = await response.json();\n      const transcribedText = result.text?.trim() || \"\";\n      \n      if (transcribedText) {\n        console.log(\"Whisper transcription:\", transcribedText);\n        accumulatedTranscriptRef.current += transcribedText + \" \";\n        lastSpeechTimeRef.current = Date.now();\n        \n        const currentTranscript = accumulatedTranscriptRef.current.trim();\n        setTranscript(currentTranscript);\n        onTranscript?.(currentTranscript);\n        \n        // Clear existing silence timeout\n        if (silenceTimeoutRef.current) {\n          clearTimeout(silenceTimeoutRef.current);\n        }\n        \n        // Set new silence timeout (5 seconds after last speech)\n        if (autoEnhance && shouldBeListeningRef.current) {\n          console.log(\"Resetting 5-second silence timer\");\n          silenceTimeoutRef.current = setTimeout(() => {\n            console.log(\"5 seconds of silence - rephrasing:\", accumulatedTranscriptRef.current.trim());\n            enhanceSpeech(accumulatedTranscriptRef.current.trim());\n          }, 5000);\n        }\n      }\n    } catch (error: any) {\n      console.error(\"Transcription error:\", error);\n      onError?.(\"Failed to transcribe audio\");\n    }\n  }, [autoEnhance, onTranscript, onError, enhanceSpeech]);\n\n  const detectSilence = useCallback(() => {\n    if (!analyserRef.current || !shouldBeListeningRef.current) return;\n\n    const dataArray = new Uint8Array(analyserRef.current.frequencyBinCount);\n    analyserRef.current.getByteFrequencyData(dataArray);\n    \n    // Calculate average volume\n    const average = dataArray.reduce((a, b) => a + b, 0) / dataArray.length;\n    const isSilent = average < 5; // Threshold for silence\n    \n    if (!isSilent) {\n      lastSpeechTimeRef.current = Date.now();\n    }\n    \n    // Check if we have accumulated audio and it's been silent for 2 seconds\n    const timeSinceSpeech = Date.now() - lastSpeechTimeRef.current;\n    if (timeSinceSpeech > 2000 && audioChunksRef.current.length > 0) {\n      console.log(\"Silence detected after speech - processing audio chunk\");\n      \n      // Stop current recording and process\n      if (mediaRecorderRef.current && mediaRecorderRef.current.state === \"recording\") {\n        mediaRecorderRef.current.stop();\n      }\n    }\n    \n    // Continue monitoring if still listening\n    if (shouldBeListeningRef.current) {\n      silenceDetectorRef.current = setTimeout(detectSilence, 100);\n    }\n  }, []);\n\n  const startListening = useCallback(async () => {\n    if (!isSupported) {\n      onError?.(\"Voice recognition not supported\");\n      return;\n    }\n\n    console.log(\"User clicked start listening\");\n    shouldBeListeningRef.current = true;\n    accumulatedTranscriptRef.current = \"\";\n    setTranscript(\"\");\n    setEnhancedText(\"\");\n    \n    try {\n      // Get microphone access\n      const stream = await navigator.mediaDevices.getUserMedia({ \n        audio: {\n          echoCancellation: true,\n          noiseSuppression: true,\n          autoGainControl: true,\n        } \n      });\n      \n      streamRef.current = stream;\n      \n      // Set up audio analysis for silence detection\n      audioContextRef.current = new AudioContext();\n      analyserRef.current = audioContextRef.current.createAnalyser();\n      const source = audioContextRef.current.createMediaStreamSource(stream);\n      source.connect(analyserRef.current);\n      analyserRef.current.fftSize = 2048;\n      \n      // Start silence detection\n      lastSpeechTimeRef.current = Date.now();\n      detectSilence();\n      \n      // Set up MediaRecorder\n      const mediaRecorder = new MediaRecorder(stream, {\n        mimeType: 'audio/webm',\n      });\n      \n      mediaRecorderRef.current = mediaRecorder;\n      audioChunksRef.current = [];\n      \n      mediaRecorder.ondataavailable = (event) => {\n        if (event.data.size > 0) {\n          audioChunksRef.current.push(event.data);\n        }\n      };\n      \n      mediaRecorder.onstop = async () => {\n        console.log(\"MediaRecorder stopped\");\n        \n        if (audioChunksRef.current.length > 0) {\n          const audioBlob = new Blob(audioChunksRef.current, { type: 'audio/webm' });\n          audioChunksRef.current = [];\n          \n          // Transcribe the audio\n          await transcribeAudio(audioBlob);\n        }\n        \n        // Restart recording if still listening\n        if (shouldBeListeningRef.current && mediaRecorderRef.current) {\n          audioChunksRef.current = [];\n          mediaRecorderRef.current.start();\n          console.log(\"Restarted recording\");\n        }\n      };\n      \n      mediaRecorder.start();\n      setIsListening(true);\n      onStart?.();\n      console.log(\"Groq Whisper voice recognition started\");\n      \n    } catch (error: any) {\n      console.error(\"Failed to start recognition:\", error);\n      onError?.(\"Failed to access microphone\");\n      shouldBeListeningRef.current = false;\n    }\n  }, [isSupported, onStart, onError, detectSilence, transcribeAudio]);\n\n  const stopListening = useCallback(() => {\n    console.log(\"User clicked stop listening\");\n    shouldBeListeningRef.current = false;\n    \n    // Stop silence detector\n    if (silenceDetectorRef.current) {\n      clearTimeout(silenceDetectorRef.current);\n      silenceDetectorRef.current = null;\n    }\n    \n    // Stop media recorder\n    if (mediaRecorderRef.current && mediaRecorderRef.current.state !== \"inactive\") {\n      mediaRecorderRef.current.stop();\n    }\n    \n    // Stop audio stream\n    if (streamRef.current) {\n      streamRef.current.getTracks().forEach(track => track.stop());\n      streamRef.current = null;\n    }\n    \n    // Close audio context\n    if (audioContextRef.current) {\n      audioContextRef.current.close();\n      audioContextRef.current = null;\n    }\n    \n    // Clear silence timeout\n    if (silenceTimeoutRef.current) {\n      clearTimeout(silenceTimeoutRef.current);\n      silenceTimeoutRef.current = null;\n    }\n    \n    // Trigger AI enhancement immediately if there's accumulated text\n    if (autoEnhance && accumulatedTranscriptRef.current.trim()) {\n      console.log(\"User stopped listening - rephrasing now:\", accumulatedTranscriptRef.current.trim());\n      enhanceSpeech(accumulatedTranscriptRef.current.trim());\n    }\n    \n    setIsListening(false);\n    onEnd?.();\n  }, [onEnd, autoEnhance, enhanceSpeech]);\n\n  const resetTranscript = useCallback(() => {\n    setTranscript(\"\");\n    setEnhancedText(\"\");\n    accumulatedTranscriptRef.current = \"\";\n  }, []);\n\n  // Cleanup on unmount\n  useEffect(() => {\n    return () => {\n      shouldBeListeningRef.current = false;\n      \n      if (silenceDetectorRef.current) {\n        clearTimeout(silenceDetectorRef.current);\n      }\n      \n      if (mediaRecorderRef.current && mediaRecorderRef.current.state !== \"inactive\") {\n        mediaRecorderRef.current.stop();\n      }\n      \n      if (streamRef.current) {\n        streamRef.current.getTracks().forEach(track => track.stop());\n      }\n      \n      if (audioContextRef.current) {\n        audioContextRef.current.close();\n      }\n      \n      if (silenceTimeoutRef.current) {\n        clearTimeout(silenceTimeoutRef.current);\n      }\n    };\n  }, []);\n\n  return {\n    isListening,\n    transcript,\n    enhancedText,\n    startListening,\n    stopListening,\n    resetTranscript,\n    isSupported,\n    isEnhancing,\n  };\n}\n","size_bytes":10372},"server/groq-service.ts":{"content":"// GroqCloud AI Service - Migrated from OpenAI\nimport Groq from \"groq-sdk\";\n\n// Initialize Groq client\nconst groq = new Groq({ apiKey: process.env.GROQ_API_KEY });\n\nexport interface SentimentAnalysisResult {\n  sentiment: \"positive\" | \"neutral\" | \"negative\";\n  sentimentScore: number;\n  toxicity: boolean;\n  categories: string[];\n}\n\nexport interface EnhancedSpeechResult {\n  original: string;\n  enhanced: string;\n}\n\nexport type PersonalityStyle = \"Neutral\" | \"Quirky\" | \"Funny\" | \"Sarcastic\" | \"Professional\";\n\nconst PERSONALITY_PROMPTS: Record<PersonalityStyle, string> = {\n  Neutral: \n    \"Rephrase the spoken text to make it sound natural and conversational. \" +\n    \"Remove stutters and filler words (um, uh, like). \" +\n    \"Preserve the original meaning, intent, and tone as closely as possible. \" +\n    \"Make only minimal edits for clarity. \" +\n    \"Output only the rephrased text, nothing else.\",\n  \n  Quirky:\n    \"Rephrase the spoken text in a quirky, playful, and energetic tone. \" +\n    \"Remove stutters and filler words. \" +\n    \"Add exclamation marks and enthusiastic language where appropriate. \" +\n    \"Use fun expressions and upbeat phrasing. \" +\n    \"Keep the core message intact but make it sound more vibrant and playful. \" +\n    \"Output only the rephrased text, nothing else.\",\n  \n  Funny:\n    \"Rephrase the spoken text in a humorous and lighthearted way. \" +\n    \"Remove stutters and filler words. \" +\n    \"Add witty commentary or amusing phrasing where it fits naturally. \" +\n    \"Make it entertaining without changing the main point. \" +\n    \"Output only the rephrased text, nothing else.\",\n  \n  Sarcastic:\n    \"Rephrase the spoken text with a sarcastic, deadpan, and witty tone. \" +\n    \"Remove stutters and filler words. \" +\n    \"Add dry humor and ironic phrasing where appropriate. \" +\n    \"Keep the core message but deliver it with a sarcastic edge. \" +\n    \"Output only the rephrased text, nothing else.\",\n  \n  Professional:\n    \"Rephrase the spoken text in a polished, professional, and articulate manner. \" +\n    \"Remove stutters and filler words. \" +\n    \"Use clear, formal language and proper grammar. \" +\n    \"Maintain professionalism while preserving the original meaning. \" +\n    \"Output only the rephrased text, nothing else.\",\n};\n\nexport async function analyzeChatMessage(message: string): Promise<SentimentAnalysisResult> {\n  try {\n    const response = await groq.chat.completions.create({\n      model: \"llama-3.3-70b-versatile\",\n      messages: [\n        {\n          role: \"system\",\n          content: `You are a sentiment analysis expert for Twitch chat messages. Analyze the sentiment and toxicity of messages.\n          \nRespond with JSON in this exact format:\n{\n  \"sentiment\": \"positive\" | \"neutral\" | \"negative\",\n  \"sentimentScore\": 1-5 (1=very negative, 5=very positive),\n  \"toxicity\": true | false,\n  \"categories\": [\"category1\", \"category2\"] (e.g., [\"friendly\", \"gaming\"] or [\"toxic\", \"spam\"])\n}`,\n        },\n        {\n          role: \"user\",\n          content: `Analyze this Twitch chat message: \"${message}\"`,\n        },\n      ],\n      response_format: { type: \"json_object\" },\n      temperature: 0.3,\n    });\n\n    const result = JSON.parse(response.choices[0].message.content || \"{}\");\n\n    return {\n      sentiment: result.sentiment || \"neutral\",\n      sentimentScore: Math.max(1, Math.min(5, result.sentimentScore || 3)),\n      toxicity: result.toxicity || false,\n      categories: result.categories || [],\n    };\n  } catch (error) {\n    console.error(\"Error analyzing message with Groq:\", error);\n    return {\n      sentiment: \"neutral\",\n      sentimentScore: 3,\n      toxicity: false,\n      categories: [\"error\"],\n    };\n  }\n}\n\nexport async function generateAiResponse(prompt: string, userMessage: string): Promise<string> {\n  try {\n    const response = await groq.chat.completions.create({\n      model: \"llama-3.3-70b-versatile\",\n      messages: [\n        {\n          role: \"system\",\n          content: prompt,\n        },\n        {\n          role: \"user\",\n          content: userMessage,\n        },\n      ],\n      max_tokens: 200,\n      temperature: 0.7,\n    });\n\n    return response.choices[0].message.content || \"Unable to generate response.\";\n  } catch (error) {\n    console.error(\"Error generating AI response:\", error);\n    return \"Sorry, I couldn't process that request.\";\n  }\n}\n\nexport interface DachiStreamSettings {\n  model: string;\n  temperature: number;\n  maxChars: number;\n  energy: string;\n  personality: string;\n  topicAllowlist: string[];\n  topicBlocklist: string[];\n  streamerVoiceOnlyMode: boolean;\n}\n\nexport async function generateDachiStreamResponse(\n  userMessage: string,\n  context: string,\n  settings: DachiStreamSettings\n): Promise<string> {\n  try {\n    // Build system message with guardrails\n    const systemParts: string[] = [];\n\n    // Core personality traits based on selected personality\n    const personalityPrompts: Record<string, string> = {\n      Casual: \"You are DachiDachi, a friendly and relaxed AI chat companion. Respond like you're chatting with friends - keep it chill, casual, and conversational.\",\n      Comedy: \"You are DachiDachi, a witty and humorous AI chat companion. Make jokes, use puns, and keep the vibe light and funny. Don't be afraid to be silly!\",\n      Quirky: \"You are DachiDachi, a unique and playful AI chat companion. Be creative, unexpected, and add fun twists to your responses. Embrace the weird and wonderful!\",\n      Serious: \"You are DachiDachi, a professional and focused AI chat companion. Be direct, informative, and to-the-point. Keep responses clear and helpful.\",\n      Gaming: \"You are DachiDachi, an energetic gamer AI companion. Use gaming references, talk about strategies, and match the competitive gaming vibe. Let's go!\",\n      Professional: \"You are DachiDachi, a polished and business-like AI chat companion. Maintain a professional tone, be articulate, and communicate with clarity.\",\n    };\n\n    const basePersonality = personalityPrompts[settings.personality] || personalityPrompts.Casual;\n    \n    // Modify energy level based on settings\n    let energyModifier = \"\";\n    if (settings.energy === \"High\") {\n      energyModifier = \" Respond with extra energy, excitement, and enthusiasm!\";\n    } else if (settings.energy === \"Low\") {\n      energyModifier = \" Keep your responses brief and calm.\";\n    }\n\n    systemParts.push(basePersonality + energyModifier);\n\n    // Topic guardrails\n    if (settings.topicAllowlist.length > 0) {\n      systemParts.push(\n        `ALLOWED TOPICS: You should mainly discuss ${settings.topicAllowlist.join(\", \")}. ` +\n        `If the conversation drifts to other topics, gently steer it back to these areas.`\n      );\n    }\n\n    if (settings.topicBlocklist.length > 0) {\n      systemParts.push(\n        `BLOCKED TOPICS: NEVER discuss ${settings.topicBlocklist.join(\", \")}. ` +\n        `If asked about these topics, politely decline and suggest talking about something else.`\n      );\n    }\n\n    // Streamer voice-only mode\n    if (settings.streamerVoiceOnlyMode) {\n      systemParts.push(\n        \"STREAMER VOICE-ONLY MODE: Only respond if the context includes recent messages from the streamer. \" +\n        \"If the streamer hasn't spoken recently, output 'SKIP_RESPONSE' instead of a message.\"\n      );\n    }\n\n    // Character limit\n    systemParts.push(\n      `RESPONSE LENGTH: Keep your response under ${settings.maxChars} characters. ` +\n      `Be concise and impactful.`\n    );\n\n    // General guidelines\n    systemParts.push(\n      \"GUIDELINES:\\n\" +\n      \"- Be authentic and conversational\\n\" +\n      \"- Reference chat context when relevant\\n\" +\n      \"- Use the user's personality info to personalize your response\\n\" +\n      \"- Avoid repetitive phrases\\n\" +\n      \"- Don't apologize excessively\\n\" +\n      \"- If you can't help with something, be direct and brief\"\n    );\n\n    const systemMessage = systemParts.join(\"\\n\\n\");\n\n    // Build user message with context\n    const fullUserMessage = context\n      ? `${context}\\n\\n---\\n\\nRESPOND TO: ${userMessage}`\n      : `RESPOND TO: ${userMessage}`;\n\n    const response = await groq.chat.completions.create({\n      model: settings.model,\n      temperature: settings.temperature,\n      messages: [\n        {\n          role: \"system\",\n          content: systemMessage,\n        },\n        {\n          role: \"user\",\n          content: fullUserMessage,\n        },\n      ],\n      max_tokens: Math.ceil(settings.maxChars / 3),\n    });\n\n    const aiResponse = response.choices[0].message.content || \"Unable to generate response.\";\n\n    // Check if AI wants to skip (streamer voice-only mode)\n    if (aiResponse.includes(\"SKIP_RESPONSE\")) {\n      return \"\";\n    }\n\n    // Trim to max characters\n    if (aiResponse.length > settings.maxChars) {\n      return aiResponse.substring(0, settings.maxChars - 3) + \"...\";\n    }\n\n    return aiResponse;\n  } catch (error) {\n    console.error(\"Error generating DachiStream response:\", error);\n    return \"\";\n  }\n}\n\nexport async function cleanupSpeechText(rawText: string): Promise<string> {\n  try {\n    const response = await groq.chat.completions.create({\n      model: \"llama-3.1-8b-instant\",\n      messages: [\n        {\n          role: \"system\",\n          content:\n            \"You are a speech-to-text cleanup assistant. \" +\n            \"Take raw transcribed text and clean it up for chat: fix grammar, remove filler words (um, uh, like), \" +\n            \"correct obvious mistakes, and make it concise. Preserve the original meaning and tone. \" +\n            \"Output only the cleaned text, nothing else.\",\n        },\n        {\n          role: \"user\",\n          content: rawText,\n        },\n      ],\n      max_tokens: 150,\n      temperature: 0.3,\n    });\n\n    return response.choices[0].message.content || rawText;\n  } catch (error) {\n    console.error(\"Error cleaning up speech text:\", error);\n    return rawText;\n  }\n}\n\nexport async function enhanceSpeechForChat(\n  rawText: string, \n  personality: PersonalityStyle = \"Neutral\"\n): Promise<EnhancedSpeechResult> {\n  try {\n    const systemPrompt = PERSONALITY_PROMPTS[personality] || PERSONALITY_PROMPTS.Neutral;\n    \n    const response = await groq.chat.completions.create({\n      model: \"llama-3.3-70b-versatile\",\n      messages: [\n        {\n          role: \"system\",\n          content: systemPrompt,\n        },\n        {\n          role: \"user\",\n          content: rawText,\n        },\n      ],\n      max_tokens: 150,\n      temperature: personality === \"Neutral\" || personality === \"Professional\" ? 0.5 : 0.7,\n    });\n\n    const enhanced = response.choices[0].message.content || rawText;\n\n    return {\n      original: rawText,\n      enhanced: enhanced.trim(),\n    };\n  } catch (error) {\n    console.error(\"Error enhancing speech:\", error);\n    return {\n      original: rawText,\n      enhanced: rawText,\n    };\n  }\n}\n\nexport async function transcribeAudio(audioFile: File): Promise<string> {\n  try {\n    const transcription = await groq.audio.transcriptions.create({\n      file: audioFile,\n      model: \"whisper-large-v3\",\n      language: \"en\",\n      response_format: \"json\",\n      temperature: 0.0,\n    });\n\n    return transcription.text;\n  } catch (error) {\n    console.error(\"Error transcribing audio with Groq Whisper:\", error);\n    throw error;\n  }\n}\n","size_bytes":11258},"client/src/hooks/use-puter-tts.ts":{"content":"import { useState, useCallback, useRef } from \"react\";\n\ndeclare global {\n  interface Window {\n    puter?: {\n      ai: {\n        txt2speech: (\n          text: string,\n          options?: {\n            voice?: string;\n            engine?: \"standard\" | \"neural\" | \"generative\";\n            language?: string;\n          }\n        ) => Promise<{\n          play: () => void;\n          pause: () => void;\n          stop: () => void;\n        }>;\n      };\n    };\n  }\n}\n\n// AWS Polly voices available through Puter.js\nexport interface PuterVoice {\n  id: string;\n  name: string;\n  gender: \"Male\" | \"Female\";\n  language: string;\n  region: string;\n}\n\nexport const PUTER_VOICES: PuterVoice[] = [\n  // US English - Male\n  { id: \"Matthew\", name: \"Matthew\", gender: \"Male\", language: \"en-US\", region: \"US\" },\n  { id: \"Joey\", name: \"Joey\", gender: \"Male\", language: \"en-US\", region: \"US\" },\n  { id: \"Justin\", name: \"Justin\", gender: \"Male\", language: \"en-US\", region: \"US\" },\n  { id: \"Kevin\", name: \"Kevin\", gender: \"Male\", language: \"en-US\", region: \"US\" },\n  { id: \"Stephen\", name: \"Stephen\", gender: \"Male\", language: \"en-US\", region: \"US\" },\n  \n  // US English - Female\n  { id: \"Joanna\", name: \"Joanna\", gender: \"Female\", language: \"en-US\", region: \"US\" },\n  { id: \"Kendra\", name: \"Kendra\", gender: \"Female\", language: \"en-US\", region: \"US\" },\n  { id: \"Kimberly\", name: \"Kimberly\", gender: \"Female\", language: \"en-US\", region: \"US\" },\n  { id: \"Salli\", name: \"Salli\", gender: \"Female\", language: \"en-US\", region: \"US\" },\n  { id: \"Ivy\", name: \"Ivy\", gender: \"Female\", language: \"en-US\", region: \"US\" },\n  { id: \"Ruth\", name: \"Ruth\", gender: \"Female\", language: \"en-US\", region: \"US\" },\n  \n  // British English - Male\n  { id: \"Brian\", name: \"Brian\", gender: \"Male\", language: \"en-GB\", region: \"UK\" },\n  \n  // British English - Female\n  { id: \"Emma\", name: \"Emma\", gender: \"Female\", language: \"en-GB\", region: \"UK\" },\n  { id: \"Amy\", name: \"Amy\", gender: \"Female\", language: \"en-GB\", region: \"UK\" },\n  \n  // Australian English - Male\n  { id: \"Russell\", name: \"Russell\", gender: \"Male\", language: \"en-AU\", region: \"Australia\" },\n  \n  // Australian English - Female\n  { id: \"Nicole\", name: \"Nicole\", gender: \"Female\", language: \"en-AU\", region: \"Australia\" },\n  \n  // Indian English - Female\n  { id: \"Aditi\", name: \"Aditi\", gender: \"Female\", language: \"en-IN\", region: \"India\" },\n  { id: \"Raveena\", name: \"Raveena\", gender: \"Female\", language: \"en-IN\", region: \"India\" },\n];\n\nexport interface PuterTTSSettings {\n  enabled: boolean;\n  voice: string;\n  engine: \"standard\" | \"neural\" | \"generative\";\n  language: string;\n  volume: number; // 0-1\n}\n\nexport function usePuterTTS() {\n  const [isSupported, setIsSupported] = useState(false);\n  const [isSpeaking, setIsSpeaking] = useState(false);\n  const [settings, setSettings] = useState<PuterTTSSettings>({\n    enabled: true,\n    voice: \"Joanna\",\n    engine: \"neural\",\n    language: \"en-US\",\n    volume: 1.0,\n  });\n  \n  const currentAudioRef = useRef<HTMLAudioElement | null>(null);\n\n  // Check if Puter.js is loaded\n  const checkSupport = useCallback(() => {\n    const supported = typeof window.puter?.ai?.txt2speech === \"function\";\n    setIsSupported(supported);\n    return supported;\n  }, []);\n\n  // Speak text using Puter TTS\n  const speak = useCallback(\n    async (text: string) => {\n      if (!settings.enabled) {\n        console.log(\"Puter TTS is disabled\");\n        return;\n      }\n\n      // Check support each time in case script loaded after hook initialization\n      if (!checkSupport()) {\n        console.error(\"Puter.js TTS not available\");\n        return;\n      }\n\n      // Stop any currently playing audio\n      if (currentAudioRef.current) {\n        currentAudioRef.current.pause();\n        currentAudioRef.current = null;\n      }\n\n      // Limit text to 3000 characters (Puter.js limit)\n      const trimmedText = text.substring(0, 3000);\n\n      try {\n        setIsSpeaking(true);\n        console.log(`[Puter TTS] Generating ${settings.engine} audio for:`, trimmedText);\n        \n        const audioStream = await window.puter!.ai.txt2speech(trimmedText, {\n          voice: settings.voice,\n          engine: settings.engine,\n          language: settings.language,\n        });\n\n        // Create audio element for better control\n        const audio = new Audio();\n        // @ts-ignore - Puter returns a playable stream\n        audio.src = audioStream;\n        audio.volume = settings.volume;\n        \n        currentAudioRef.current = audio;\n\n        audio.onended = () => {\n          setIsSpeaking(false);\n          currentAudioRef.current = null;\n          console.log(\"[Puter TTS] Audio playback ended\");\n        };\n\n        audio.onerror = (error) => {\n          console.error(\"[Puter TTS] Audio playback error:\", error);\n          setIsSpeaking(false);\n          currentAudioRef.current = null;\n        };\n\n        await audio.play();\n        console.log(`[Puter TTS] Playing ${settings.engine} audio`);\n      } catch (error) {\n        console.error(\"[Puter TTS] Error:\", error);\n        setIsSpeaking(false);\n      }\n    },\n    [settings, checkSupport]\n  );\n\n  // Stop speaking\n  const stop = useCallback(() => {\n    if (currentAudioRef.current) {\n      currentAudioRef.current.pause();\n      currentAudioRef.current = null;\n      setIsSpeaking(false);\n      console.log(\"[Puter TTS] Stopped\");\n    }\n  }, []);\n\n  // Update settings\n  const updateSettings = useCallback((newSettings: Partial<PuterTTSSettings>) => {\n    setSettings((prev) => ({ ...prev, ...newSettings }));\n  }, []);\n\n  // Initialize support check on first render\n  useState(() => {\n    // Delay check to ensure Puter script has loaded\n    setTimeout(checkSupport, 100);\n  });\n\n  return {\n    isSupported,\n    isSpeaking,\n    settings,\n    speak,\n    stop,\n    updateSettings,\n    voices: PUTER_VOICES,\n  };\n}\n","size_bytes":5823},"client/src/pages/audio-settings.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Label } from \"@/components/ui/label\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Slider } from \"@/components/ui/slider\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient } from \"@/lib/queryClient\";\nimport type { Settings } from \"@shared/schema\";\n\nexport default function AudioSettings() {\n  const { toast } = useToast();\n  \n  const [audioMicMode, setAudioMicMode] = useState(\"muted\");\n  const [audioVoiceSelection, setAudioVoiceSelection] = useState(\"Default\");\n  const [audioAiVoiceActive, setAudioAiVoiceActive] = useState(true);\n  const [audioSpeechCleanup, setAudioSpeechCleanup] = useState(true);\n  const [audioFallbackToTextOnly, setAudioFallbackToTextOnly] = useState(true);\n  const [audioCooldownBetweenReplies, setAudioCooldownBetweenReplies] = useState([5]);\n  const [audioMaxVoiceLength, setAudioMaxVoiceLength] = useState([500]);\n\n  const { data: settings } = useQuery<Settings[]>({\n    queryKey: [\"/api/settings\"],\n  });\n\n  useEffect(() => {\n    const settingsArray = Array.isArray(settings) ? settings : [];\n    const setting = settingsArray[0];\n\n    if (setting) {\n      setAudioMicMode(setting.audioMicMode || \"muted\");\n      setAudioVoiceSelection(setting.audioVoiceSelection || \"Default\");\n      setAudioAiVoiceActive(setting.audioAiVoiceActive ?? true);\n      setAudioSpeechCleanup(setting.audioSpeechCleanup ?? true);\n      setAudioFallbackToTextOnly(setting.audioFallbackToTextOnly ?? true);\n      setAudioCooldownBetweenReplies([setting.audioCooldownBetweenReplies || 5]);\n      setAudioMaxVoiceLength([setting.audioMaxVoiceLength || 500]);\n    }\n  }, [settings]);\n\n  const updateSettingsMutation = useMutation({\n    mutationFn: async (data: Partial<Settings>) => {\n      const settingsArray = Array.isArray(settings) ? settings : [];\n      const settingId = settingsArray[0]?.id;\n\n      if (settingId) {\n        const response = await fetch(`/api/settings/${settingId}`, {\n          method: \"PATCH\",\n          headers: { \"Content-Type\": \"application/json\" },\n          body: JSON.stringify(data),\n        });\n\n        if (!response.ok) {\n          throw new Error(\"Failed to update settings\");\n        }\n\n        return response.json();\n      }\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/settings\"] });\n      toast({\n        title: \"Settings Updated\",\n        description: \"Audio settings have been saved successfully.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Update Failed\",\n        description: \"Failed to update audio settings.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleSaveSettings = () => {\n    updateSettingsMutation.mutate({\n      audioMicMode,\n      audioVoiceSelection,\n      audioAiVoiceActive,\n      audioSpeechCleanup,\n      audioFallbackToTextOnly,\n      audioCooldownBetweenReplies: audioCooldownBetweenReplies[0],\n      audioMaxVoiceLength: audioMaxVoiceLength[0],\n    });\n  };\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      <div>\n        <h1 className=\"text-3xl font-bold mb-2\" data-testid=\"page-title-audio-settings\">Audio Settings</h1>\n        <p className=\"text-muted-foreground\" data-testid=\"page-description-audio-settings\">\n          Configure voice, microphone, and audio features for StreamDachi\n        </p>\n      </div>\n\n      <Card data-testid=\"card-voice-settings\">\n        <CardHeader>\n          <CardTitle className=\"text-lg font-semibold\">Voice & TTS Settings</CardTitle>\n          <CardDescription>Configure AI voice and text-to-speech features</CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-6\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"space-y-0.5\">\n              <Label htmlFor=\"ai-voice-active\">AI Voice Active</Label>\n              <p className=\"text-xs text-muted-foreground\">\n                Enable AI voice responses using Puter.js TTS\n              </p>\n            </div>\n            <Switch\n              id=\"ai-voice-active\"\n              checked={audioAiVoiceActive}\n              onCheckedChange={setAudioAiVoiceActive}\n              data-testid=\"switch-ai-voice-active\"\n            />\n          </div>\n\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"voice-selection\">Voice Selection</Label>\n            <Select value={audioVoiceSelection} onValueChange={setAudioVoiceSelection}>\n              <SelectTrigger id=\"voice-selection\" data-testid=\"select-voice-selection\">\n                <SelectValue placeholder=\"Select voice\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"Default\">Default</SelectItem>\n                <SelectItem value=\"Voice 1\">Voice 1</SelectItem>\n                <SelectItem value=\"Voice 2\">Voice 2</SelectItem>\n                <SelectItem value=\"Voice 3\">Voice 3</SelectItem>\n              </SelectContent>\n            </Select>\n            <p className=\"text-xs text-muted-foreground\">\n              Select a voice for AI text-to-speech (configured on Monitor page)\n            </p>\n          </div>\n\n          <div className=\"space-y-2\">\n            <div className=\"flex justify-between\">\n              <Label>Max Voice Length</Label>\n              <span className=\"text-sm text-muted-foreground\" data-testid=\"text-max-voice-length-value\">\n                {audioMaxVoiceLength[0]} characters\n              </span>\n            </div>\n            <Slider\n              value={audioMaxVoiceLength}\n              onValueChange={setAudioMaxVoiceLength}\n              min={100}\n              max={1000}\n              step={50}\n              data-testid=\"slider-max-voice-length\"\n            />\n            <p className=\"text-xs text-muted-foreground\">\n              Maximum characters for voice synthesis\n            </p>\n          </div>\n        </CardContent>\n      </Card>\n\n      <Card data-testid=\"card-microphone-settings\">\n        <CardHeader>\n          <CardTitle className=\"text-lg font-semibold\">Microphone Settings</CardTitle>\n          <CardDescription>Configure voice recognition and speech input</CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-6\">\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"mic-mode\">Mic Mode</Label>\n            <Select value={audioMicMode} onValueChange={setAudioMicMode}>\n              <SelectTrigger id=\"mic-mode\" data-testid=\"select-mic-mode\">\n                <SelectValue placeholder=\"Select mic mode\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"muted\">Muted</SelectItem>\n                <SelectItem value=\"push-to-talk\">Push to Talk</SelectItem>\n                <SelectItem value=\"continuous\">Continuous</SelectItem>\n              </SelectContent>\n            </Select>\n            <p className=\"text-xs text-muted-foreground\">\n              Control when the microphone is active (managed on Monitor page)\n            </p>\n          </div>\n\n          <div className=\"flex items-center justify-between\">\n            <div className=\"space-y-0.5\">\n              <Label htmlFor=\"speech-cleanup\">Speech Cleanup</Label>\n              <p className=\"text-xs text-muted-foreground\">\n                Automatically clean up and rephrase spoken text with AI\n              </p>\n            </div>\n            <Switch\n              id=\"speech-cleanup\"\n              checked={audioSpeechCleanup}\n              onCheckedChange={setAudioSpeechCleanup}\n              data-testid=\"switch-speech-cleanup\"\n            />\n          </div>\n\n          <div className=\"flex items-center justify-between\">\n            <div className=\"space-y-0.5\">\n              <Label htmlFor=\"fallback-text\">Fallback to Text Only</Label>\n              <p className=\"text-xs text-muted-foreground\">\n                Show text if voice synthesis fails\n              </p>\n            </div>\n            <Switch\n              id=\"fallback-text\"\n              checked={audioFallbackToTextOnly}\n              onCheckedChange={setAudioFallbackToTextOnly}\n              data-testid=\"switch-fallback-text\"\n            />\n          </div>\n\n          <div className=\"space-y-2\">\n            <div className=\"flex justify-between\">\n              <Label>Cooldown Between Replies</Label>\n              <span className=\"text-sm text-muted-foreground\" data-testid=\"text-cooldown-replies-value\">\n                {audioCooldownBetweenReplies[0]}s\n              </span>\n            </div>\n            <Slider\n              value={audioCooldownBetweenReplies}\n              onValueChange={setAudioCooldownBetweenReplies}\n              min={1}\n              max={30}\n              step={1}\n              data-testid=\"slider-cooldown-replies\"\n            />\n            <p className=\"text-xs text-muted-foreground\">\n              Minimum seconds between voice replies\n            </p>\n          </div>\n        </CardContent>\n      </Card>\n\n      <div className=\"flex justify-end\">\n        <Button \n          onClick={handleSaveSettings}\n          disabled={updateSettingsMutation.isPending}\n          data-testid=\"button-save-audio-settings\"\n        >\n          {updateSettingsMutation.isPending ? \"Saving...\" : \"Save Audio Settings\"}\n        </Button>\n      </div>\n    </div>\n  );\n}\n","size_bytes":9612},"client/src/pages/database.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport type { UserProfile, ChatMessage, AiAnalysis } from \"@shared/schema\";\nimport { Search, Download, Users, MessageSquare, Brain } from \"lucide-react\";\n\ninterface UserStats {\n  profile: UserProfile;\n  messageCount: number;\n  lastMessage: string | null;\n  avgSentiment: number | null;\n}\n\nexport default function Database() {\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [roleFilter, setRoleFilter] = useState(\"all\");\n\n  const { data: profiles } = useQuery<UserProfile[]>({\n    queryKey: [\"/api/users/profiles\"],\n  });\n\n  const { data: messages } = useQuery<ChatMessage[]>({\n    queryKey: [\"/api/messages\"],\n  });\n\n  const { data: analyses } = useQuery<AiAnalysis[]>({\n    queryKey: [\"/api/analyses\"],\n  });\n\n  // Calculate user stats\n  const userStats: UserStats[] = (profiles || []).map(profile => {\n    const userMessages = (messages || []).filter(m => m.userId === profile.userId);\n    const messageCount = userMessages.length;\n    const lastMessage = userMessages[0]?.message || null;\n    \n    const userAnalyses = (analyses || [])\n      .filter(a => userMessages.some(m => m.id === a.messageId))\n      .map(a => a.sentimentScore);\n    \n    const avgSentiment = userAnalyses.length > 0\n      ? userAnalyses.reduce((sum, score) => sum + score, 0) / userAnalyses.length\n      : null;\n\n    return { profile, messageCount, lastMessage, avgSentiment };\n  });\n\n  // Filter users\n  const filteredUsers = userStats.filter(stat => {\n    const matchesSearch = stat.profile.username.toLowerCase().includes(searchQuery.toLowerCase());\n    const matchesRole = \n      roleFilter === \"all\" ||\n      (roleFilter === \"vip\" && stat.profile.isVip) ||\n      (roleFilter === \"mod\" && stat.profile.isMod) ||\n      (roleFilter === \"sub\" && stat.profile.isSubscriber);\n    \n    return matchesSearch && matchesRole;\n  });\n\n  const totalUsers = profiles?.length || 0;\n  const totalMessages = messages?.length || 0;\n  const totalAnalyses = analyses?.length || 0;\n\n  const handleExportCSV = () => {\n    const headers = [\"Username\", \"Role\", \"Message Count\", \"Avg Sentiment\", \"Last Seen\"];\n    const rows = filteredUsers.map(stat => [\n      stat.profile.username,\n      getRoleText(stat.profile),\n      stat.messageCount.toString(),\n      stat.avgSentiment?.toFixed(2) || \"N/A\",\n      new Date(stat.profile.lastSeen).toLocaleString(),\n    ]);\n\n    const csv = [headers, ...rows].map(row => row.join(\",\")).join(\"\\n\");\n    const blob = new Blob([csv], { type: \"text/csv\" });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement(\"a\");\n    a.href = url;\n    a.download = `streamdachi-users-${new Date().toISOString().split(\"T\")[0]}.csv`;\n    a.click();\n    URL.revokeObjectURL(url);\n  };\n\n  const getRoleText = (profile: UserProfile): string => {\n    const roles = [];\n    if (profile.isVip) roles.push(\"VIP\");\n    if (profile.isMod) roles.push(\"Mod\");\n    if (profile.isSubscriber) roles.push(\"Sub\");\n    return roles.length > 0 ? roles.join(\", \") : \"Viewer\";\n  };\n\n  const getSentimentBadge = (score: number | null) => {\n    if (score === null) return <Badge variant=\"outline\">No Data</Badge>;\n    if (score >= 4) return <Badge className=\"bg-green-500/20 text-green-400 border-green-500/30\">Positive</Badge>;\n    if (score >= 3) return <Badge className=\"bg-blue-500/20 text-blue-400 border-blue-500/30\">Neutral</Badge>;\n    return <Badge className=\"bg-red-500/20 text-red-400 border-red-500/30\">Negative</Badge>;\n  };\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      <div>\n        <h1 className=\"text-3xl font-bold mb-2\" data-testid=\"page-title-database\">Database Viewer</h1>\n        <p className=\"text-muted-foreground\" data-testid=\"page-description-database\">\n          Browse all users, messages, and AI analysis data\n        </p>\n      </div>\n\n      {/* Stats Cards */}\n      <div className=\"grid gap-4 md:grid-cols-3\">\n        <Card data-testid=\"card-total-users\">\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Total Users</CardTitle>\n            <Users className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\" data-testid=\"text-total-users\">{totalUsers}</div>\n            <p className=\"text-xs text-muted-foreground\">All tracked users</p>\n          </CardContent>\n        </Card>\n\n        <Card data-testid=\"card-total-messages\">\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Total Messages</CardTitle>\n            <MessageSquare className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\" data-testid=\"text-total-messages\">{totalMessages}</div>\n            <p className=\"text-xs text-muted-foreground\">Chat messages logged</p>\n          </CardContent>\n        </Card>\n\n        <Card data-testid=\"card-total-analyses\">\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">AI Analyses</CardTitle>\n            <Brain className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\" data-testid=\"text-total-analyses\">{totalAnalyses}</div>\n            <p className=\"text-xs text-muted-foreground\">Messages analyzed</p>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Search and Filters */}\n      <Card data-testid=\"card-user-database\">\n        <CardHeader>\n          <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n            <div>\n              <CardTitle>User Database</CardTitle>\n              <CardDescription>Search and filter all known users</CardDescription>\n            </div>\n            <Button\n              onClick={handleExportCSV}\n              variant=\"outline\"\n              size=\"sm\"\n              data-testid=\"button-export-csv\"\n            >\n              <Download className=\"h-4 w-4 mr-2\" />\n              Export CSV\n            </Button>\n          </div>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div className=\"flex gap-4 flex-wrap\">\n            <div className=\"flex-1 min-w-[200px]\">\n              <div className=\"relative\">\n                <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                <Input\n                  placeholder=\"Search by username...\"\n                  value={searchQuery}\n                  onChange={(e) => setSearchQuery(e.target.value)}\n                  className=\"pl-9\"\n                  data-testid=\"input-search-users\"\n                />\n              </div>\n            </div>\n            <Select value={roleFilter} onValueChange={setRoleFilter}>\n              <SelectTrigger className=\"w-[180px]\" data-testid=\"select-role-filter\">\n                <SelectValue placeholder=\"Filter by role\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"all\">All Users</SelectItem>\n                <SelectItem value=\"vip\">VIPs Only</SelectItem>\n                <SelectItem value=\"mod\">Mods Only</SelectItem>\n                <SelectItem value=\"sub\">Subs Only</SelectItem>\n              </SelectContent>\n            </Select>\n          </div>\n\n          {/* Users Table */}\n          <div className=\"border rounded-md\">\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead>User</TableHead>\n                  <TableHead>Role</TableHead>\n                  <TableHead>Messages</TableHead>\n                  <TableHead>Sentiment</TableHead>\n                  <TableHead>Last Message</TableHead>\n                  <TableHead>Last Seen</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {filteredUsers.length === 0 ? (\n                  <TableRow>\n                    <TableCell colSpan={6} className=\"text-center text-muted-foreground\">\n                      No users found\n                    </TableCell>\n                  </TableRow>\n                ) : (\n                  filteredUsers.map(stat => (\n                    <TableRow key={stat.profile.id} data-testid={`row-user-${stat.profile.username}`}>\n                      <TableCell>\n                        <div className=\"flex items-center gap-2\">\n                          <Avatar className=\"h-8 w-8\">\n                            <AvatarFallback>{stat.profile.username[0].toUpperCase()}</AvatarFallback>\n                          </Avatar>\n                          <span className=\"font-medium\">{stat.profile.username}</span>\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <div className=\"flex gap-1 flex-wrap\">\n                          {stat.profile.isVip && (\n                            <Badge variant=\"default\" className=\"bg-purple-500/20 text-purple-400 border-purple-500/30\">VIP</Badge>\n                          )}\n                          {stat.profile.isMod && (\n                            <Badge variant=\"default\" className=\"bg-green-500/20 text-green-400 border-green-500/30\">Mod</Badge>\n                          )}\n                          {stat.profile.isSubscriber && (\n                            <Badge variant=\"default\" className=\"bg-blue-500/20 text-blue-400 border-blue-500/30\">Sub</Badge>\n                          )}\n                          {!stat.profile.isVip && !stat.profile.isMod && !stat.profile.isSubscriber && (\n                            <Badge variant=\"outline\">Viewer</Badge>\n                          )}\n                        </div>\n                      </TableCell>\n                      <TableCell data-testid={`text-message-count-${stat.profile.username}`}>\n                        {stat.messageCount}\n                      </TableCell>\n                      <TableCell>\n                        {getSentimentBadge(stat.avgSentiment)}\n                      </TableCell>\n                      <TableCell className=\"max-w-[300px] truncate\" data-testid={`text-last-message-${stat.profile.username}`}>\n                        {stat.lastMessage || <span className=\"text-muted-foreground\">No messages</span>}\n                      </TableCell>\n                      <TableCell data-testid={`text-last-seen-${stat.profile.username}`}>\n                        {new Date(stat.profile.lastSeen).toLocaleString()}\n                      </TableCell>\n                    </TableRow>\n                  ))\n                )}\n              </TableBody>\n            </Table>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":11431},"RUN_LOCALLY.md":{"content":"# Running StreamDachi Locally\n\nThis guide will help you set up and run StreamDachi on your local computer.\n\n---\n\n##  Prerequisites\n\n### System Requirements\n- **Node.js**: Version 18 or higher (recommended: Node 20)\n- **PostgreSQL Database**: Version 12 or higher\n- **npm** or **yarn**: For package management\n- **Git**: To clone the repository\n\n---\n\n##  Required API Keys & Secrets\n\nCreate a `.env` file in the root directory with the following environment variables:\n\n### Essential (Required)\n\n```bash\n# Database Connection\nDATABASE_URL=postgresql://user:password@localhost:5432/streamdachi\n\n# Twitch API (Required for chat integration)\nTWITCH_CLIENT_ID=your_twitch_client_id\nTWITCH_CLIENT_SECRET=your_twitch_client_secret\n\n# Groq AI (Required for AI features)\nGROQ_API_KEY=your_groq_api_key\n\n# Session Security\nSESSION_SECRET=random_secure_string_at_least_32_chars\n```\n\n### Optional (For Enhanced Features)\n\n```bash\n# OpenAI (Legacy/fallback - mostly migrated to Groq)\nOPENAI_API_KEY=sk-your_openai_key\n\n# ElevenLabs (For premium TTS - app uses free Puter.js by default)\nELEVENLABS_API_KEY=your_elevenlabs_key\n\n# Server Port (defaults to 5000 if not set)\nPORT=5000\n```\n\n---\n\n##  Getting API Keys\n\n### Twitch API (Required)\n1. Go to [dev.twitch.tv/console](https://dev.twitch.tv/console)\n2. Click \"Register Your Application\"\n3. Fill in application details:\n   - **Name**: StreamDachi Local\n   - **OAuth Redirect URLs**: `http://localhost:5000/api/auth/twitch/callback`\n   - **Category**: Choose appropriate category\n4. Copy the **Client ID** and **Client Secret**\n\n### Groq API (Required)\n1. Go to [console.groq.com](https://console.groq.com)\n2. Sign up for a free account\n3. Navigate to API Keys section\n4. Create a new API key\n5. Copy the key (it won't be shown again)\n\n**Models Used by StreamDachi:**\n- Llama 3.3 70B Versatile (default)\n- Llama 3.1 8B Instant (voice rephrasing)\n- Mixtral 8x7B, Gemma 2 9B (alternatives)\n\n### OpenAI API (Optional)\n1. Go to [platform.openai.com](https://platform.openai.com)\n2. Sign up or log in\n3. Navigate to API Keys\n4. Create new secret key\n5. Copy and save securely\n\n**Note:** The app has migrated most AI features to Groq, so this is optional.\n\n### ElevenLabs API (Optional)\n1. Go to [elevenlabs.io](https://elevenlabs.io)\n2. Sign up for an account\n3. Get your API key from the profile section\n\n**Note:** StreamDachi uses free unlimited Puter.js TTS by default, so ElevenLabs is completely optional.\n\n---\n\n##  Installation Steps\n\n### 1. Clone the Repository\n```bash\ngit clone <repository-url>\ncd streamdachi\n```\n\n### 2. Install Node.js Dependencies\n```bash\nnpm install\n```\n\nThis will install:\n- **81 production dependencies** including React, Express, TypeScript, Drizzle ORM, PostgreSQL drivers, Twitch integration (tmi.js), Groq SDK, Shadcn UI components, and WebSocket support\n- **15 dev dependencies** including Vite, TypeScript compiler, Tailwind CSS, and build tools\n\n### 3. Set Up PostgreSQL Database\n\n**Option A: Local PostgreSQL**\n\n**macOS:**\n```bash\n# Install PostgreSQL\nbrew install postgresql@14\nbrew services start postgresql@14\n\n# Create database\ncreatedb streamdachi\n```\n\n**Linux (Ubuntu/Debian):**\n```bash\n# Install PostgreSQL\nsudo apt update\nsudo apt install postgresql postgresql-contrib\n\n# Start service\nsudo systemctl start postgresql\nsudo systemctl enable postgresql\n\n# Create database\nsudo -u postgres createdb streamdachi\n\n# Create user (optional)\nsudo -u postgres createuser -P yourusername\n```\n\n**Windows:**\n1. Download PostgreSQL installer from [postgresql.org](https://www.postgresql.org/download/windows/)\n2. Run installer and follow setup wizard\n3. Use pgAdmin or command line to create `streamdachi` database\n\n**Option B: Use Neon Serverless (Recommended)**\n\nThis is what StreamDachi uses on Replit:\n\n1. Sign up at [neon.tech](https://neon.tech)\n2. Create a new project\n3. Create a new database\n4. Copy the connection string\n5. Paste it into your `.env` file as `DATABASE_URL`\n\n### 4. Initialize Database Schema\n\nRun the following command to create all database tables:\n\n```bash\nnpm run db:push\n```\n\nThis creates **10 tables**:\n- `user_profiles` - Twitch user tracking with VIP/mod/subscriber roles\n- `user_insights` - AI-generated personality summaries\n- `chat_messages` - Message history with stream session tracking\n- `ai_analysis` - Sentiment and toxicity analysis results\n- `ai_commands` - Custom AI command definitions\n- `voice_ai_responses` - Voice transcription and AI rephrasing logs\n- `authenticated_users` - OAuth authentication data\n- `raids` - Incoming raid tracking\n- `moderation_actions` - Twitch moderation event logs\n- `settings` - Application configuration\n\n---\n\n##  Running the Application\n\n### Development Mode (Recommended)\n\nStart the development server with hot reload:\n\n```bash\nnpm run dev\n```\n\nThis will:\n- Start Express backend server on port 5000\n- Start Vite development server for frontend\n- Watch for file changes and auto-reload\n- Enable source maps for debugging\n\n**Access the application at:** `http://localhost:5000`\n\n### Production Mode\n\nBuild and run the production version:\n\n```bash\n# Build the application\nnpm run build\n\n# Start production server\nnpm start\n```\n\nProduction mode:\n- Optimized frontend bundle\n- No hot reload\n- Better performance\n- Minified assets\n\n### Other Available Commands\n\n```bash\n# Type checking (no compilation)\nnpm run check\n\n# Database schema synchronization\nnpm run db:push\n```\n\n---\n\n##  Accessing the Application\n\nOnce the server is running:\n\n- **Main Application**: `http://localhost:5000`\n- **WebSocket**: `ws://localhost:5000/ws` (handled automatically by the app)\n- **VIP Shoutout Browser Source**: Navigate to Settings  Browser Source to generate OBS URL\n\n### Application Pages\n\nThe app includes 11 pages:\n\n1. **Dashboard** (`/`) - Overview with clickable stat cards showing daily analytics\n2. **Live Chat** (`/chat`) - Real-time Twitch chat monitoring\n3. **Analytics** (`/analytics`) - User activity charts and sentiment trends\n4. **AI Controls** (`/ai-controls`) - Custom AI command management\n5. **DachiStream** (`/dachistream`) - Stream interaction and AI behavior settings\n6. **VIP Management** (`/vip-management`) - Add/remove VIPs, manage shoutouts\n7. **Raid Management** (`/raid-management`) - Incoming/outgoing raid functionality\n8. **Monitor** (`/monitor`) - Voice AI with hands-free continuous listening\n9. **Audio Settings** (`/audio-settings`) - Voice & TTS configuration\n10. **Database** (`/database`) - Internal data management with CSV export\n11. **Settings** (`/settings`) - General application configuration\n\n---\n\n##  Twitch Authentication\n\nAfter starting the application:\n\n1. Navigate to the Settings page\n2. Click \"Connect to Twitch\" or similar OAuth button\n3. You'll be redirected to Twitch to authorize the application\n4. After authorization, you'll be redirected back to the app\n5. The app will automatically connect to your Twitch chat\n\n**Required Twitch Scopes:**\n- Read chat messages\n- Send chat messages\n- View follower information\n- Manage raids\n- Access user information\n\n---\n\n##  Project Structure\n\n```\nstreamdachi/\n client/                     # Frontend (React + TypeScript)\n    src/\n       pages/             # 11 application pages\n       components/        # Shadcn UI components\n          ui/           # Base UI primitives\n       lib/              # Utilities, React Query setup\n       hooks/            # Custom React hooks\n    index.html\n server/                     # Backend (Express + TypeScript)\n    index.ts               # Main server entry point\n    routes.ts              # API endpoint definitions\n    storage.ts             # Database abstraction layer\n    twitch-client.ts       # Twitch IRC integration\n    twitch-oauth-service.ts # OAuth authentication\n    groq-service.ts        # Groq AI service\n    dachistream-service.ts # Stream interaction engine\n    ai-learning-service.ts # User personality learning\n    vite.ts                # Vite dev server integration\n shared/\n    schema.ts              # Database schema (Drizzle ORM)\n migrations/                # Database migration files\n package.json               # Dependencies and scripts\n drizzle.config.ts          # Database configuration\n vite.config.ts             # Frontend build configuration\n tailwind.config.ts         # Tailwind CSS configuration\n tsconfig.json              # TypeScript configuration\n replit.md                  # Project documentation\n .env                       # Environment variables (create this)\n```\n\n---\n\n##  Troubleshooting\n\n### Database Connection Issues\n\n**Problem:** `Error: DATABASE_URL, ensure the database is provisioned`\n\n**Solution:**\n- Verify PostgreSQL is running: `pg_isready`\n- Check `.env` file exists and contains `DATABASE_URL`\n- Verify connection string format: `postgresql://user:password@host:port/database`\n- Test connection: `psql $DATABASE_URL`\n\n**Problem:** `relation \"table_name\" does not exist`\n\n**Solution:**\n- Run `npm run db:push` to create tables\n- Check database schema: `psql $DATABASE_URL -c \"\\dt\"`\n\n### Twitch Connection Issues\n\n**Problem:** Unable to connect to Twitch chat\n\n**Solution:**\n- Verify `TWITCH_CLIENT_ID` and `TWITCH_CLIENT_SECRET` are correct\n- Check OAuth redirect URI matches: `http://localhost:5000/api/auth/twitch/callback`\n- Complete OAuth flow by visiting `/api/auth/twitch` in your browser\n- Check server logs for authentication errors\n\n**Problem:** `Invalid OAuth token`\n\n**Solution:**\n- Re-authenticate through the Settings page\n- Token may have expired (app has automatic refresh, but check logs)\n\n### AI Features Not Working\n\n**Problem:** AI analysis not generating results\n\n**Solution:**\n- Verify `GROQ_API_KEY` is set correctly in `.env`\n- Check Groq API quota at [console.groq.com](https://console.groq.com)\n- Review server logs for API errors\n- Ensure \"Enable AI Analysis\" is turned on in Settings\n\n**Problem:** `Invalid API key` error\n\n**Solution:**\n- Regenerate API key from Groq console\n- Ensure no extra spaces in `.env` file\n- Restart server after updating `.env`\n\n### Port Already in Use\n\n**Problem:** `Error: listen EADDRINUSE: address already in use :::5000`\n\n**Solution:**\n- Change `PORT` in `.env` file to a different port (e.g., 3000, 8080)\n- Kill process using port 5000:\n  ```bash\n  # macOS/Linux\n  lsof -ti:5000 | xargs kill\n  \n  # Windows\n  netstat -ano | findstr :5000\n  taskkill /PID <PID> /F\n  ```\n\n### WebSocket Connection Issues\n\n**Problem:** Live updates not working, WebSocket errors in console\n\n**Solution:**\n- Ensure server is running on the expected port\n- Check browser console for WebSocket connection errors\n- Verify no proxy/firewall blocking WebSocket connections\n- Try accessing `ws://localhost:5000/ws` directly\n\n### Build Errors\n\n**Problem:** TypeScript compilation errors\n\n**Solution:**\n- Run `npm run check` to see all type errors\n- Ensure all dependencies are installed: `npm install`\n- Clear `node_modules` and reinstall: `rm -rf node_modules && npm install`\n\n**Problem:** Vite build fails\n\n**Solution:**\n- Clear Vite cache: `rm -rf node_modules/.vite`\n- Check for conflicting ports\n- Update Vite if needed: `npm update vite`\n\n---\n\n##  Resource Requirements\n\n**Typical Resource Usage:**\n- **RAM**: ~500-800MB for Node.js process\n- **Disk Space**: ~300MB for `node_modules`, plus database storage\n- **CPU**: Minimal baseline, spikes during AI analysis (Groq API calls)\n- **Network**: Continuous connection to Twitch IRC required for chat functionality\n\n---\n\n##  Differences from Replit Environment\n\nStreamDachi is designed to run identically on Replit and locally. Key differences:\n\n### Environment Variables\n- **Replit**: Automatically provides `REPLIT_DEV_DOMAIN`, `REPLIT_DB_URL`, etc.\n- **Local**: Uses `localhost` fallbacks for all Replit-specific variables\n\n### Database\n- **Replit**: Uses Neon Serverless PostgreSQL (managed)\n- **Local**: You manage your own PostgreSQL instance (or use Neon)\n\n### OAuth Redirect\n- **Replit**: Uses `https://{REPLIT_DEV_DOMAIN}/api/auth/twitch/callback`\n- **Local**: Uses `http://localhost:5000/api/auth/twitch/callback`\n\n### Secrets Management\n- **Replit**: Uses Replit Secrets (encrypted key-value store)\n- **Local**: Uses `.env` file (ensure it's in `.gitignore`)\n\n### Port Configuration\n- **Replit**: Automatically binds to port 5000 and handles HTTPS\n- **Local**: You control the port via `PORT` environment variable\n\n---\n\n##  Security Best Practices\n\n### Local Development\n1. **Never commit `.env` file** - Add it to `.gitignore`\n2. **Use strong SESSION_SECRET** - Generate with: `openssl rand -base64 32`\n3. **Keep API keys secure** - Don't share or expose them\n4. **Use HTTPS in production** - Set up SSL certificates for production deployments\n\n### API Key Rotation\n- Regularly rotate API keys, especially if exposed\n- Use different keys for development and production\n- Monitor API usage for unexpected activity\n\n---\n\n##  Additional Notes\n\n### First Time Setup Checklist\n- [ ] Node.js 18+ installed\n- [ ] PostgreSQL installed and running\n- [ ] `.env` file created with all required variables\n- [ ] Twitch application registered with correct redirect URI\n- [ ] Groq API key obtained\n- [ ] Dependencies installed (`npm install`)\n- [ ] Database schema created (`npm run db:push`)\n- [ ] Server started (`npm run dev`)\n- [ ] Twitch OAuth completed via Settings page\n\n### Development Workflow\n1. Start server: `npm run dev`\n2. Make code changes\n3. Server auto-restarts (backend changes)\n4. Browser auto-reloads (frontend changes)\n5. Test changes in browser\n6. Check server logs for errors\n\n### Useful Development Tools\n- **PostgreSQL GUI**: pgAdmin, TablePlus, or DBeaver for database inspection\n- **API Testing**: Postman or Insomnia for testing API endpoints\n- **WebSocket Testing**: Browser DevTools  Network  WS tab\n- **React DevTools**: Browser extension for React component inspection\n\n---\n\n##  Getting Help\n\nIf you encounter issues not covered in this guide:\n\n1. **Check Server Logs**: Most issues show detailed error messages in terminal\n2. **Check Browser Console**: Frontend errors appear in DevTools console\n3. **Review Documentation**: See `replit.md` for architecture details\n4. **Database Inspection**: Use `psql` or GUI tools to verify schema\n5. **API Key Verification**: Double-check all keys are correctly copied\n\n---\n\n##  Success!\n\nIf everything is set up correctly, you should see:\n-  Server running on `http://localhost:5000`\n-  Database connection established\n-  Twitch connected (after OAuth)\n-  AI learning service started\n-  DachiStream service running\n-  WebSocket server active\n\nNavigate to `http://localhost:5000` and start exploring StreamDachi!\n","size_bytes":15011},"client/src/components/workflow-chart.tsx":{"content":"import { Card } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Clock, MessageSquare, GitBranch, Sparkles, FileText, Volume2, CheckCircle2, Timer } from \"lucide-react\";\n\nexport type WorkflowStage = \n  | \"waiting-pool\" \n  | \"waiting-mic\" \n  | \"collecting-pool\" \n  | \"collecting-mic\" \n  | \"decision\" \n  | \"ai-setup-mic\" \n  | \"ai-setup-pool\" \n  | \"text-response\" \n  | \"voice\" \n  | \"complete\";\n\nexport type StageStatus = \"idle\" | \"active\" | \"error\" | \"waiting-input\" | \"success\";\n\ninterface WorkflowChartProps {\n  currentStage: WorkflowStage;\n  stageStatuses: Record<WorkflowStage, StageStatus>;\n}\n\nconst StageNode = ({ \n  title, \n  icon: Icon, \n  status, \n  isActive,\n  position \n}: { \n  title: string; \n  icon: any; \n  status: StageStatus; \n  isActive: boolean;\n  position: { x: number; y: number };\n}) => {\n  const getStatusColor = () => {\n    if (status === \"active\") return \"bg-green-500/30 border-green-500 shadow-green-500/50\";\n    if (status === \"error\") return \"bg-red-500/30 border-red-500 shadow-red-500/50\";\n    if (status === \"waiting-input\") return \"bg-yellow-500/30 border-yellow-500 shadow-yellow-500/50\";\n    if (status === \"success\") return \"bg-blue-500/30 border-blue-500 shadow-blue-500/50\";\n    return \"bg-card/80 border-border\";\n  };\n\n  const getTextColor = () => {\n    if (status === \"active\") return \"text-green-400\";\n    if (status === \"error\") return \"text-red-400\";\n    if (status === \"waiting-input\") return \"text-yellow-400\";\n    if (status === \"success\") return \"text-blue-400\";\n    return \"text-muted-foreground\";\n  };\n\n  return (\n    <div\n      className=\"absolute\"\n      style={{\n        left: `${position.x}%`,\n        top: `${position.y}%`,\n        transform: 'translate(-50%, -50%)'\n      }}\n    >\n      <div\n        className={`\n          relative p-3 rounded-lg border-2 transition-all duration-300 backdrop-blur-sm\n          ${getStatusColor()}\n          ${isActive ? \"shadow-xl scale-110 ring-2 ring-primary/50\" : \"shadow-md\"}\n        `}\n        data-testid={`workflow-stage-${title.toLowerCase().replace(/\\s+/g, \"-\")}`}\n      >\n        <div className=\"flex flex-col items-center gap-1 min-w-[100px]\">\n          <Icon className={`h-5 w-5 ${getTextColor()}`} />\n          <span className={`text-xs font-medium text-center whitespace-nowrap ${getTextColor()}`}>\n            {title}\n          </span>\n          {status !== \"idle\" && (\n            <Badge variant={status === \"active\" ? \"default\" : \"secondary\"} className=\"text-[10px] px-1 py-0\">\n              {status === \"active\" && \"Active\"}\n              {status === \"error\" && \"Error\"}\n              {status === \"waiting-input\" && \"Waiting\"}\n              {status === \"success\" && \"Done\"}\n            </Badge>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default function WorkflowChart({ currentStage, stageStatuses }: WorkflowChartProps) {\n  // Define circular positions for each stage (percentage-based)\n  const stagePositions = {\n    // Top center - Waiting stages\n    \"waiting-pool\": { x: 35, y: 8 },\n    \"waiting-mic\": { x: 65, y: 8 },\n    \n    // Right side - Collecting stages\n    \"collecting-pool\": { x: 85, y: 30 },\n    \"collecting-mic\": { x: 85, y: 50 },\n    \n    // Bottom right - Decision\n    \"decision\": { x: 75, y: 75 },\n    \n    // Bottom center - AI Setup\n    \"ai-setup-pool\": { x: 50, y: 92 },\n    \"ai-setup-mic\": { x: 25, y: 92 },\n    \n    // Left side - Output stages\n    \"text-response\": { x: 15, y: 70 },\n    \"voice\": { x: 15, y: 50 },\n    \"complete\": { x: 15, y: 30 },\n  };\n\n  return (\n    <Card className=\"p-6\">\n      <div className=\"space-y-4\">\n        <div className=\"text-center\">\n          <h3 className=\"text-lg font-semibold mb-1\">DachiStream Workflow</h3>\n          <p className=\"text-xs text-muted-foreground\">\n            Continuous circular pipeline  Real-time stage tracking\n          </p>\n        </div>\n\n        {/* Circular Workflow Container */}\n        <div className=\"relative w-full\" style={{ paddingTop: '100%' }}>\n          {/* Background circular path visualization */}\n          <svg \n            className=\"absolute inset-0 w-full h-full pointer-events-none\"\n            viewBox=\"0 0 400 400\"\n          >\n            {/* Outer circle guide */}\n            <circle\n              cx=\"200\"\n              cy=\"200\"\n              r=\"160\"\n              fill=\"none\"\n              stroke=\"currentColor\"\n              strokeWidth=\"1\"\n              strokeDasharray=\"4 4\"\n              className=\"text-muted-foreground/20\"\n            />\n            \n            {/* Center circle */}\n            <circle\n              cx=\"200\"\n              cy=\"200\"\n              r=\"50\"\n              fill=\"currentColor\"\n              className=\"text-primary/10\"\n            />\n            \n            {/* Center icon */}\n            <text\n              x=\"200\"\n              y=\"200\"\n              textAnchor=\"middle\"\n              dominantBaseline=\"middle\"\n              className=\"text-primary font-semibold\"\n              fontSize=\"16\"\n            >\n              AI\n            </text>\n            <text\n              x=\"200\"\n              y=\"220\"\n              textAnchor=\"middle\"\n              dominantBaseline=\"middle\"\n              className=\"text-muted-foreground\"\n              fontSize=\"12\"\n            >\n              Cycle\n            </text>\n\n            {/* Connection arrows (circular flow) */}\n            <defs>\n              <marker\n                id=\"arrowhead\"\n                markerWidth=\"10\"\n                markerHeight=\"10\"\n                refX=\"9\"\n                refY=\"3\"\n                orient=\"auto\"\n                className=\"text-primary\"\n              >\n                <polygon points=\"0 0, 10 3, 0 6\" fill=\"currentColor\" className=\"text-primary/60\" />\n              </marker>\n            </defs>\n\n            {/* Flow arrows connecting the stages in a loop */}\n            {/* Top: waiting -> collecting */}\n            <path\n              d=\"M 260 35 Q 300 50 320 100\"\n              fill=\"none\"\n              stroke=\"currentColor\"\n              strokeWidth=\"2\"\n              strokeDasharray=\"4 4\"\n              className=\"text-primary/40\"\n              markerEnd=\"url(#arrowhead)\"\n            />\n            \n            {/* Right: collecting -> decision */}\n            <path\n              d=\"M 340 180 Q 340 220 320 270\"\n              fill=\"none\"\n              stroke=\"currentColor\"\n              strokeWidth=\"2\"\n              strokeDasharray=\"4 4\"\n              className=\"text-primary/40\"\n              markerEnd=\"url(#arrowhead)\"\n            />\n            \n            {/* Bottom: decision -> ai setup */}\n            <path\n              d=\"M 280 310 Q 240 340 180 360\"\n              fill=\"none\"\n              stroke=\"currentColor\"\n              strokeWidth=\"2\"\n              strokeDasharray=\"4 4\"\n              className=\"text-primary/40\"\n              markerEnd=\"url(#arrowhead)\"\n            />\n            \n            {/* Left: ai setup -> output */}\n            <path\n              d=\"M 100 350 Q 60 320 60 260\"\n              fill=\"none\"\n              stroke=\"currentColor\"\n              strokeWidth=\"2\"\n              strokeDasharray=\"4 4\"\n              className=\"text-primary/40\"\n              markerEnd=\"url(#arrowhead)\"\n            />\n            \n            {/* Return: output -> waiting (completing the loop) */}\n            <path\n              d=\"M 70 100 Q 80 60 130 40\"\n              fill=\"none\"\n              stroke=\"currentColor\"\n              strokeWidth=\"2\"\n              strokeDasharray=\"4 4\"\n              className=\"text-primary/40\"\n              markerEnd=\"url(#arrowhead)\"\n            />\n          </svg>\n\n          {/* Stage Nodes */}\n          <StageNode\n            title=\"Pool Wait\"\n            icon={Clock}\n            status={stageStatuses[\"waiting-pool\"]}\n            isActive={currentStage === \"waiting-pool\"}\n            position={stagePositions[\"waiting-pool\"]}\n          />\n          <StageNode\n            title=\"Mic Wait\"\n            icon={Timer}\n            status={stageStatuses[\"waiting-mic\"]}\n            isActive={currentStage === \"waiting-mic\"}\n            position={stagePositions[\"waiting-mic\"]}\n          />\n          <StageNode\n            title=\"Pool Collect\"\n            icon={MessageSquare}\n            status={stageStatuses[\"collecting-pool\"]}\n            isActive={currentStage === \"collecting-pool\"}\n            position={stagePositions[\"collecting-pool\"]}\n          />\n          <StageNode\n            title=\"Mic Input\"\n            icon={Volume2}\n            status={stageStatuses[\"collecting-mic\"]}\n            isActive={currentStage === \"collecting-mic\"}\n            position={stagePositions[\"collecting-mic\"]}\n          />\n          <StageNode\n            title=\"Decision\"\n            icon={GitBranch}\n            status={stageStatuses[\"decision\"]}\n            isActive={currentStage === \"decision\"}\n            position={stagePositions[\"decision\"]}\n          />\n          <StageNode\n            title=\"Pool Context\"\n            icon={Sparkles}\n            status={stageStatuses[\"ai-setup-pool\"]}\n            isActive={currentStage === \"ai-setup-pool\"}\n            position={stagePositions[\"ai-setup-pool\"]}\n          />\n          <StageNode\n            title=\"Mic Rephrase\"\n            icon={Sparkles}\n            status={stageStatuses[\"ai-setup-mic\"]}\n            isActive={currentStage === \"ai-setup-mic\"}\n            position={stagePositions[\"ai-setup-mic\"]}\n          />\n          <StageNode\n            title=\"Text AI\"\n            icon={FileText}\n            status={stageStatuses[\"text-response\"]}\n            isActive={currentStage === \"text-response\"}\n            position={stagePositions[\"text-response\"]}\n          />\n          <StageNode\n            title=\"Voice AI\"\n            icon={Volume2}\n            status={stageStatuses[\"voice\"]}\n            isActive={currentStage === \"voice\"}\n            position={stagePositions[\"voice\"]}\n          />\n          <StageNode\n            title=\"Complete\"\n            icon={CheckCircle2}\n            status={stageStatuses[\"complete\"]}\n            isActive={currentStage === \"complete\"}\n            position={stagePositions[\"complete\"]}\n          />\n        </div>\n\n        {/* Legend */}\n        <div className=\"flex flex-wrap justify-center gap-3 pt-4 border-t\">\n          <div className=\"flex items-center gap-2\">\n            <div className=\"w-3 h-3 rounded-full bg-green-500/30 border border-green-500\"></div>\n            <span className=\"text-xs text-muted-foreground\">Active</span>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <div className=\"w-3 h-3 rounded-full bg-blue-500/30 border border-blue-500\"></div>\n            <span className=\"text-xs text-muted-foreground\">Success</span>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <div className=\"w-3 h-3 rounded-full bg-yellow-500/30 border border-yellow-500\"></div>\n            <span className=\"text-xs text-muted-foreground\">Waiting</span>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <div className=\"w-3 h-3 rounded-full bg-red-500/30 border border-red-500\"></div>\n            <span className=\"text-xs text-muted-foreground\">Error</span>\n          </div>\n        </div>\n      </div>\n    </Card>\n  );\n}\n","size_bytes":11288},"packager-files-readonly/README.md":{"content":"# Replit Packager Files - Complete Snapshot\n\nThis folder contains a complete snapshot of all Replit build, packaging, and dependency files for the StreamDachi project. These files are what Replit uses to build, configure, and run your application.\n\n---\n\n##  Contents Overview\n\n###  Replit Configuration Files\n\n#### `.replit`\n**Purpose:** Main Replit configuration file (TOML format)\n- Defines which language modules to use (`nodejs-20`, `web`, `postgresql-16`)\n- Configures the run command (`npm run dev`)\n- Sets up deployment settings (autoscale, build commands)\n- Defines port mappings for various services\n- Configures workflows (what happens when you click \"Run\")\n- Lists installed agent integrations (OpenAI, Database, WebSocket, Object Storage)\n\n**Key Sections:**\n- `modules` - Language and runtime environments\n- `run` - Command executed when you start the app\n- `deployment` - How the app is built and deployed\n- `ports` - Port forwarding configuration\n- `workflows` - Custom workflow definitions\n- `agent` - AI agent integrations\n\n---\n\n#### `.upm/` folder\n**Purpose:** Universal Package Manager metadata\n- `store.json` - Tracks package file hashes for change detection\n- Helps Replit know when to reinstall dependencies\n- Contains specfile and lockfile hashes for `nodejs-npm`\n\n---\n\n###  Package Management Files\n\n#### `package.json`\n**Purpose:** NPM package manifest\n- Lists all project dependencies (libraries your app needs)\n- Defines npm scripts (`dev`, `build`, `start`, etc.)\n- Specifies project metadata (name, version, type)\n- Controls which Node.js version to use\n\n**Key Information:**\n- `dependencies` - Runtime libraries (Express, React, Drizzle, etc.)\n- `devDependencies` - Development tools (TypeScript, Vite, etc.)\n- `scripts` - Commands you can run with `npm run <name>`\n\n---\n\n#### `package-lock.json`\n**Purpose:** Dependency lock file (DO NOT EDIT MANUALLY)\n- Locks exact versions of every dependency and sub-dependency\n- Ensures reproducible installations across different machines\n- Auto-generated by NPM when you install packages\n- Critical for maintaining consistent builds\n\n**Why It's Important:**\n- Prevents \"works on my machine\" issues\n- Ensures everyone gets the same dependency versions\n- Required for production deployments\n\n---\n\n#### `node_modules/` folder\n**Purpose:** All installed NPM packages (50,000+ files)\n- Contains every library and dependency your project uses\n- Auto-generated from `package.json` + `package-lock.json`\n- Typically NOT committed to Git (regenerated with `npm install`)\n- Includes nested dependencies (dependencies of dependencies)\n\n**Size:** ~200-500MB depending on packages\n**Files:** ~50,000+ individual files across 1,000+ packages\n\n**Note:** This folder can be recreated anytime by running:\n```bash\nnpm install\n```\n\n---\n\n###  Build Configuration Files\n\n#### `vite.config.ts`\n**Purpose:** Vite bundler configuration\n- Configures how your frontend is built and served\n- Sets up React plugin and aliases (`@/`, `@shared/`, `@assets/`)\n- Defines server settings and port\n- Handles module resolution and optimizations\n\n**What Vite Does:**\n- Ultra-fast development server with Hot Module Replacement (HMR)\n- Bundles your TypeScript/React code for production\n- Optimizes assets (images, CSS, etc.)\n\n---\n\n#### `tsconfig.json`\n**Purpose:** TypeScript compiler configuration\n- Defines how TypeScript is compiled to JavaScript\n- Sets up path aliases for imports\n- Configures type checking strictness\n- Specifies target JavaScript version (ES2020)\n\n**Key Settings:**\n- `target` - Which JavaScript version to output\n- `module` - Module system to use (ESNext)\n- `paths` - Import aliases (`@/*`  `./client/src/*`)\n- `strict` - Type checking strictness\n\n---\n\n#### `postcss.config.js`\n**Purpose:** PostCSS configuration (CSS processing)\n- Integrates Tailwind CSS into the build\n- Adds vendor prefixes for browser compatibility\n- Processes CSS during development and production builds\n\n**Used By:** Vite to transform your CSS files\n\n---\n\n#### `tailwind.config.ts`\n**Purpose:** Tailwind CSS framework configuration\n- Defines custom color scheme (purple Twitch aesthetic)\n- Sets up custom animations and utilities\n- Configures which files to scan for Tailwind classes\n- Extends default theme with custom values\n\n**Custom Features:**\n- Dark mode support (`darkMode: [\"class\"]`)\n- Custom color palette (primary, accent, sidebar, etc.)\n- Extended animations (`spin-slow`, `fadeIn`, etc.)\n\n---\n\n###  Database & Component Configuration\n\n#### `drizzle.config.ts`\n**Purpose:** Drizzle ORM configuration\n- Connects to PostgreSQL database via environment variable\n- Defines schema location (`shared/schema.ts`)\n- Configures migration settings\n- Used by `drizzle-kit` for database operations\n\n**Commands It Enables:**\n- `npm run db:push` - Sync schema to database\n- `npm run db:studio` - Open database GUI\n\n---\n\n#### `components.json`\n**Purpose:** Shadcn UI component configuration\n- Tracks installed UI components\n- Defines component aliases and paths\n- Specifies Tailwind and styling setup\n- Used when adding new components with `shadcn-ui add`\n\n**Settings:**\n- `style: \"new-york\"` - Component variant\n- `tailwind.config: \"tailwind.config.ts\"` - Tailwind location\n- `aliases` - Import path mappings\n\n---\n\n###  Version Control\n\n#### `.gitignore`\n**Purpose:** Tells Git which files to ignore\n- Excludes `node_modules/` from version control\n- Ignores build outputs (`dist/`)\n- Skips environment files (`.env`)\n- Prevents committing temporary files\n\n**Why:** Keeps repository clean and fast by excluding generated files\n\n---\n\n##  How These Files Work Together\n\n```\n1. You run: npm install\n    Reads: package.json (what to install)\n    Reads: package-lock.json (exact versions)\n    Creates: node_modules/ (installed packages)\n\n2. You run: npm run dev\n    Reads: package.json (finds \"dev\" script)\n    Executes: vite\n       Reads: vite.config.ts (how to build)\n       Reads: tsconfig.json (TypeScript settings)\n       Reads: postcss.config.js (CSS processing)\n       Reads: tailwind.config.ts (styling)\n    Starts development server\n\n3. Replit reads: .replit\n    Installs modules: nodejs-20, postgresql-16\n    Runs: npm run dev (from \"run\" field)\n    Configures ports and deployment\n    Sets up agent integrations\n\n4. Database operations read: drizzle.config.ts\n    Connects to PostgreSQL using DATABASE_URL\n\n5. Component installations read: components.json\n    Knows where to put new Shadcn components\n```\n\n---\n\n##  File Size Summary\n\n| File/Folder | Approximate Size | Purpose |\n|-------------|-----------------|---------|\n| `node_modules/` | 200-500 MB | Installed packages |\n| `package-lock.json` | 2-5 MB | Dependency lock |\n| `.replit` | 2 KB | Replit config |\n| `package.json` | 5-10 KB | Package manifest |\n| `vite.config.ts` | 1-2 KB | Build config |\n| `tsconfig.json` | 1 KB | TypeScript config |\n| `tailwind.config.ts` | 2-3 KB | Styling config |\n| Other configs | <1 KB each | Various |\n\n**Total:** ~200-500 MB (mostly `node_modules/`)\n\n---\n\n##  What Can You Check With These Files?\n\n **Exact dependency versions** - See every package and version in `package-lock.json`\n **Build configuration** - Review Vite, TypeScript, and Tailwind settings\n **Replit setup** - Understand how your app is deployed and run\n **Installed packages** - Browse `node_modules/` to see what's actually installed\n **Port mappings** - Check which ports are used in `.replit`\n **Database connection** - Review Drizzle configuration\n **Component library** - See which Shadcn components are configured\n\n---\n\n##  Recreating This Environment\n\nIf you wanted to recreate this exact environment elsewhere:\n\n1. Copy these files to a new folder:\n   - `package.json`\n   - `package-lock.json`\n   - All `*.config.ts` and `*.config.js` files\n   - `.gitignore`\n\n2. Run: `npm install`\n   - This regenerates `node_modules/` from the lock file\n\n3. Set environment variables from `.replit`\n   - `DATABASE_URL`, `PORT`, etc.\n\n4. Run: `npm run dev`\n   - Starts the application\n\n**Note:** `.replit` is Replit-specific and won't work outside the Replit environment.\n\n---\n\n##  Snapshot Created\n\n**Date:** November 1, 2025  \n**Project:** StreamDachi - Twitch AI Integration Platform  \n**Node Version:** 20.x  \n**Package Manager:** NPM  \n**Total Files:** ~50,000+ (including all node_modules)\n\n---\n\n##  Important Notes\n\n- **DO NOT EDIT** `package-lock.json` or files in `node_modules/` manually\n- **REGENERATE** `node_modules/` with `npm install` if corrupted\n- **BACKUP** `package.json` and `package-lock.json` before major dependency changes\n- **VERSION CONTROL** Only commit `package.json` and `package-lock.json`, not `node_modules/`\n\n---\n\n##  Common Issues\n\n**Problem:** `node_modules/` is corrupted or missing packages\n**Solution:** Delete `node_modules/` and run `npm install`\n\n**Problem:** Package versions don't match\n**Solution:** Use `npm ci` instead of `npm install` (uses exact lock file versions)\n\n**Problem:** Build fails with missing dependencies\n**Solution:** Check if `package-lock.json` is present and run `npm install`\n\n**Problem:** Vite or TypeScript errors\n**Solution:** Review `vite.config.ts` and `tsconfig.json` for misconfigurations\n\n---\n\n*This README was auto-generated to document the complete Replit packager file snapshot.*\n","size_bytes":9440},"packager-files-readonly/drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","size_bytes":325},"packager-files-readonly/vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n          await import(\"@replit/vite-plugin-dev-banner\").then((m) =>\n            m.devBanner(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","size_bytes":1080},"packager-files-readonly/postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","size_bytes":80},"packager-files-readonly/tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \".5625rem\", /* 9px */\n        md: \".375rem\", /* 6px */\n        sm: \".1875rem\", /* 3px */\n      },\n      colors: {\n        // Flat / base colors (regular buttons)\n        background: \"hsl(var(--background) / <alpha-value>)\",\n        foreground: \"hsl(var(--foreground) / <alpha-value>)\",\n        border: \"hsl(var(--border) / <alpha-value>)\",\n        input: \"hsl(var(--input) / <alpha-value>)\",\n        card: {\n          DEFAULT: \"hsl(var(--card) / <alpha-value>)\",\n          foreground: \"hsl(var(--card-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--card-border) / <alpha-value>)\",\n        },\n        popover: {\n          DEFAULT: \"hsl(var(--popover) / <alpha-value>)\",\n          foreground: \"hsl(var(--popover-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--popover-border) / <alpha-value>)\",\n        },\n        primary: {\n          DEFAULT: \"hsl(var(--primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--primary-foreground) / <alpha-value>)\",\n          border: \"var(--primary-border)\",\n        },\n        secondary: {\n          DEFAULT: \"hsl(var(--secondary) / <alpha-value>)\",\n          foreground: \"hsl(var(--secondary-foreground) / <alpha-value>)\",\n          border: \"var(--secondary-border)\",\n        },\n        muted: {\n          DEFAULT: \"hsl(var(--muted) / <alpha-value>)\",\n          foreground: \"hsl(var(--muted-foreground) / <alpha-value>)\",\n          border: \"var(--muted-border)\",\n        },\n        accent: {\n          DEFAULT: \"hsl(var(--accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--accent-foreground) / <alpha-value>)\",\n          border: \"var(--accent-border)\",\n        },\n        destructive: {\n          DEFAULT: \"hsl(var(--destructive) / <alpha-value>)\",\n          foreground: \"hsl(var(--destructive-foreground) / <alpha-value>)\",\n          border: \"var(--destructive-border)\",\n        },\n        ring: \"hsl(var(--ring) / <alpha-value>)\",\n        chart: {\n          \"1\": \"hsl(var(--chart-1) / <alpha-value>)\",\n          \"2\": \"hsl(var(--chart-2) / <alpha-value>)\",\n          \"3\": \"hsl(var(--chart-3) / <alpha-value>)\",\n          \"4\": \"hsl(var(--chart-4) / <alpha-value>)\",\n          \"5\": \"hsl(var(--chart-5) / <alpha-value>)\",\n        },\n        sidebar: {\n          ring: \"hsl(var(--sidebar-ring) / <alpha-value>)\",\n          DEFAULT: \"hsl(var(--sidebar) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--sidebar-border) / <alpha-value>)\",\n        },\n        \"sidebar-primary\": {\n          DEFAULT: \"hsl(var(--sidebar-primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-primary-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-primary-border)\",\n        },\n        \"sidebar-accent\": {\n          DEFAULT: \"hsl(var(--sidebar-accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-accent-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-accent-border)\"\n        },\n        status: {\n          online: \"rgb(34 197 94)\",\n          away: \"rgb(245 158 11)\",\n          busy: \"rgb(239 68 68)\",\n          offline: \"rgb(156 163 175)\",\n        },\n      },\n      fontFamily: {\n        sans: [\"var(--font-sans)\"],\n        serif: [\"var(--font-serif)\"],\n        mono: [\"var(--font-mono)\"],\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: { height: \"0\" },\n          to: { height: \"var(--radix-accordion-content-height)\" },\n        },\n        \"accordion-up\": {\n          from: { height: \"var(--radix-accordion-content-height)\" },\n          to: { height: \"0\" },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","size_bytes":4050},"shared/schema-sqlite.ts":{"content":"import { sql } from \"drizzle-orm\";\nimport { sqliteTable, text, integer } from \"drizzle-orm/sqlite-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\nimport { relations } from \"drizzle-orm\";\nimport { randomUUID } from 'crypto';\n\n// Helper for UUID generation in SQLite\nconst uuid = () => randomUUID();\n\n// User Profiles Table - Track VIP/Mod/Subscriber status + Personality Profiling\nexport const userProfiles = sqliteTable(\"user_profiles\", {\n  id: text(\"id\").primaryKey().$defaultFn(() => uuid()),\n  userId: text(\"user_id\").notNull().unique(), // Twitch user ID\n  username: text(\"username\").notNull(),\n  isVip: integer(\"is_vip\", { mode: 'boolean' }).notNull().default(false),\n  isMod: integer(\"is_mod\", { mode: 'boolean' }).notNull().default(false),\n  isSubscriber: integer(\"is_subscriber\", { mode: 'boolean' }).notNull().default(false),\n  channelPointsBalance: integer(\"channel_points_balance\").default(0),\n  wasAnonymous: integer(\"was_anonymous\", { mode: 'boolean' }).notNull().default(false),\n  firstSeen: integer(\"first_seen\", { mode: 'timestamp' }).notNull().$defaultFn(() => new Date()),\n  lastSeen: integer(\"last_seen\", { mode: 'timestamp' }).notNull().$defaultFn(() => new Date()),\n  shoutoutLastGiven: integer(\"shoutout_last_given\", { mode: 'timestamp' }),\n  \n  // Personality Tracking (1-10 scale, measured over time by AI)\n  humorLevel: integer(\"humor_level\").default(5),\n  knowledgeLevel: integer(\"knowledge_level\").default(5),\n  bluntnessLevel: integer(\"bluntness_level\").default(5),\n  rudenessLevel: integer(\"rudeness_level\").default(5),\n  \n  // Profile Information (NO PII - usernames, roles, preferences only)\n  timezone: text(\"timezone\"),\n  twitchUrl: text(\"twitch_url\"),\n  previousNames: text(\"previous_names\", { mode: 'json' }).$type<string[]>().default(sql`'[]'`),\n  hobbies: text(\"hobbies\", { mode: 'json' }).$type<string[]>().default(sql`'[]'`),\n  likes: text(\"likes\", { mode: 'json' }).$type<string[]>().default(sql`'[]'`),\n  dislikes: text(\"dislikes\", { mode: 'json' }).$type<string[]>().default(sql`'[]'`),\n  \n  // Social Media & Links (URLs only, no PII)\n  profilePictureUrl: text(\"profile_picture_url\"),\n  socials: text(\"socials\", { mode: 'json' }).$type<Record<string, string>>().default(sql`'{}'`),\n  customLinks: text(\"custom_links\", { mode: 'json' }).$type<Array<{title: string, url: string}>>().default(sql`'[]'`),\n});\n\n// User Insights Table - AI Learning Engine\nexport const userInsights = sqliteTable(\"user_insights\", {\n  userId: text(\"user_id\").primaryKey(),\n  summary: text(\"summary\"),\n  lastUpdated: integer(\"last_updated\", { mode: 'timestamp' }).notNull().$defaultFn(() => new Date()),\n  totalMessages: integer(\"total_messages\").notNull().default(0),\n  recentTags: text(\"recent_tags\", { mode: 'json' }).$type<string[]>().default(sql`'[]'`),\n});\n\n// Chat Messages Table - Enhanced with stream tracking\nexport const chatMessages = sqliteTable(\"chat_messages\", {\n  id: text(\"id\").primaryKey().$defaultFn(() => uuid()),\n  userId: text(\"user_id\"),\n  username: text(\"username\").notNull(),\n  message: text(\"message\").notNull(),\n  channel: text(\"channel\").notNull(),\n  streamId: text(\"stream_id\"),\n  eventType: text(\"event_type\").notNull().default(\"chat\"),\n  timestamp: integer(\"timestamp\", { mode: 'timestamp' }).notNull().$defaultFn(() => new Date()),\n  userColor: text(\"user_color\"),\n  badges: text(\"badges\", { mode: 'json' }).$type<Record<string, string>>(),\n  emotes: text(\"emotes\", { mode: 'json' }),\n  metadata: text(\"metadata\", { mode: 'json' }),\n});\n\n// AI Analysis Table\nexport const aiAnalysis = sqliteTable(\"ai_analysis\", {\n  id: text(\"id\").primaryKey().$defaultFn(() => uuid()),\n  messageId: text(\"message_id\").notNull().references(() => chatMessages.id, { onDelete: \"cascade\" }),\n  sentiment: text(\"sentiment\").notNull(),\n  sentimentScore: integer(\"sentiment_score\").notNull(),\n  toxicity: integer(\"toxicity\", { mode: 'boolean' }).notNull().default(false),\n  categories: text(\"categories\", { mode: 'json' }).$type<string[]>(),\n  timestamp: integer(\"timestamp\", { mode: 'timestamp' }).notNull().$defaultFn(() => new Date()),\n});\n\n// AI Commands Table\nexport const aiCommands = sqliteTable(\"ai_commands\", {\n  id: text(\"id\").primaryKey().$defaultFn(() => uuid()),\n  trigger: text(\"trigger\").notNull().unique(),\n  prompt: text(\"prompt\").notNull(),\n  responseType: text(\"response_type\").notNull(),\n  enabled: integer(\"enabled\", { mode: 'boolean' }).notNull().default(true),\n  usageCount: integer(\"usage_count\").notNull().default(0),\n  createdAt: integer(\"created_at\", { mode: 'timestamp' }).notNull().$defaultFn(() => new Date()),\n});\n\n// Voice AI Responses Table - History of voice transcriptions and AI rephrasing\nexport const voiceAiResponses = sqliteTable(\"voice_ai_responses\", {\n  id: text(\"id\").primaryKey().$defaultFn(() => uuid()),\n  originalText: text(\"original_text\").notNull(),\n  rephrasedText: text(\"rephrased_text\").notNull(),\n  wasSpoken: integer(\"was_spoken\", { mode: 'boolean' }).notNull().default(false),\n  timestamp: integer(\"timestamp\", { mode: 'timestamp' }).notNull().$defaultFn(() => new Date()),\n});\n\n// Authenticated Users Table - OAuth Login\nexport const authenticatedUsers = sqliteTable(\"authenticated_users\", {\n  id: text(\"id\").primaryKey().$defaultFn(() => uuid()),\n  twitchUserId: text(\"twitch_user_id\").notNull().unique(),\n  twitchUsername: text(\"twitch_username\").notNull(),\n  twitchDisplayName: text(\"twitch_display_name\").notNull(),\n  twitchProfileImageUrl: text(\"twitch_profile_image_url\"),\n  twitchEmail: text(\"twitch_email\"),\n  accessToken: text(\"access_token\").notNull(),\n  refreshToken: text(\"refresh_token\"),\n  tokenExpiresAt: integer(\"token_expires_at\", { mode: 'timestamp' }),\n  createdAt: integer(\"created_at\", { mode: 'timestamp' }).notNull().$defaultFn(() => new Date()),\n  updatedAt: integer(\"updated_at\", { mode: 'timestamp' }).notNull().$defaultFn(() => new Date()),\n});\n\n// Raids Table - Track incoming raids\nexport const raids = sqliteTable(\"raids\", {\n  id: text(\"id\").primaryKey().$defaultFn(() => uuid()),\n  fromUserId: text(\"from_user_id\").notNull(),\n  fromUsername: text(\"from_username\").notNull(),\n  fromDisplayName: text(\"from_display_name\").notNull(),\n  viewers: integer(\"viewers\").notNull().default(0),\n  timestamp: integer(\"timestamp\", { mode: 'timestamp' }).notNull().$defaultFn(() => new Date()),\n});\n\n// Moderation Actions Table - Track Twitch mod events\nexport const moderationActions = sqliteTable(\"moderation_actions\", {\n  id: text(\"id\").primaryKey().$defaultFn(() => uuid()),\n  actionType: text(\"action_type\").notNull(),\n  targetUserId: text(\"target_user_id\"),\n  targetUsername: text(\"target_username\").notNull(),\n  moderatorId: text(\"moderator_id\"),\n  moderatorUsername: text(\"moderator_username\"),\n  duration: integer(\"duration\"),\n  reason: text(\"reason\"),\n  messageDeleted: text(\"message_deleted\"),\n  timestamp: integer(\"timestamp\", { mode: 'timestamp' }).notNull().$defaultFn(() => new Date()),\n});\n\n// Settings Table - Enhanced with DachiPool configuration\nexport const settings = sqliteTable(\"settings\", {\n  id: text(\"id\").primaryKey().$defaultFn(() => uuid()),\n  twitchChannel: text(\"twitch_channel\"),\n  twitchUsername: text(\"twitch_username\"),\n  autoModeration: integer(\"auto_moderation\", { mode: 'boolean' }).notNull().default(false),\n  sentimentThreshold: integer(\"sentiment_threshold\").notNull().default(2),\n  enableAiAnalysis: integer(\"enable_ai_analysis\", { mode: 'boolean' }).notNull().default(true),\n  \n  // Browser Source Settings\n  browserSourceEnabled: integer(\"browser_source_enabled\", { mode: 'boolean' }).notNull().default(false),\n  browserSourceToken: text(\"browser_source_token\"),\n  \n  // DachiPool Settings\n  dachipoolEnabled: integer(\"dachipool_enabled\", { mode: 'boolean' }).notNull().default(true),\n  dachipoolMaxChars: integer(\"dachipool_max_chars\").notNull().default(1000),\n  dachipoolEnergy: text(\"dachipool_energy\").notNull().default(\"Balanced\"),\n  dachipoolMode: text(\"dachipool_mode\").notNull().default(\"Auto\"),\n  dachipoolShoutoutCooldownHours: integer(\"dachipool_shoutout_cooldown_hours\").notNull().default(24),\n  dachipoolAiModel: text(\"dachipool_ai_model\").notNull().default(\"llama-3.3-70b-versatile\"),\n  dachipoolAiTemp: integer(\"dachipool_ai_temp\").notNull().default(7),\n  aiPersonality: text(\"ai_personality\").notNull().default(\"Casual\"),\n  autoShoutoutsEnabled: integer(\"auto_shoutouts_enabled\", { mode: 'boolean' }).notNull().default(true),\n  \n  // Audio Settings\n  audioMicMode: text(\"audio_mic_mode\").notNull().default(\"muted\"),\n  audioVoiceSelection: text(\"audio_voice_selection\").default(\"Default\"),\n  audioAiVoiceActive: integer(\"audio_ai_voice_active\", { mode: 'boolean' }).notNull().default(true),\n  audioSpeechCleanup: integer(\"audio_speech_cleanup\", { mode: 'boolean' }).notNull().default(true),\n  audioFallbackToTextOnly: integer(\"audio_fallback_to_text_only\", { mode: 'boolean' }).notNull().default(true),\n  audioCooldownBetweenReplies: integer(\"audio_cooldown_between_replies\").notNull().default(5),\n  audioMaxVoiceLength: integer(\"audio_max_voice_length\").notNull().default(500),\n  \n  // Web Speech API TTS Settings\n  ttsEnabled: integer(\"tts_enabled\", { mode: 'boolean' }).notNull().default(false),\n  ttsVoice: text(\"tts_voice\"),\n  ttsPitch: integer(\"tts_pitch\").notNull().default(10),\n  ttsRate: integer(\"tts_rate\").notNull().default(10),\n  ttsVolume: integer(\"tts_volume\").notNull().default(10),\n  \n  // Voice AI Personality Settings (for Groq rephrasing + Puter.js TTS)\n  voiceAiPersonality: text(\"voice_ai_personality\").notNull().default(\"Neutral\"),\n  voiceAiPitch: integer(\"voice_ai_pitch\").notNull().default(10),\n  voiceAiSpeed: integer(\"voice_ai_speed\").notNull().default(10),\n  \n  // Topic Filters\n  topicAllowlist: text(\"topic_allowlist\", { mode: 'json' }).$type<string[]>().default(sql`'[\"gaming\", \"anime\", \"chatting\"]'`),\n  topicBlocklist: text(\"topic_blocklist\", { mode: 'json' }).$type<string[]>().default(sql`'[\"politics\", \"religion\"]'`),\n  useDatabasePersonalization: integer(\"use_database_personalization\", { mode: 'boolean' }).notNull().default(true),\n  streamerVoiceOnlyMode: integer(\"streamer_voice_only_mode\", { mode: 'boolean' }).notNull().default(false),\n  \n  // DachiStream Settings\n  dachiastreamSelectionStrategy: text(\"dachiastream_selection_strategy\").notNull().default(\"most_active\"),\n  dachiastreamPaused: integer(\"dachiastream_paused\", { mode: 'boolean' }).notNull().default(false),\n  dachiastreamAutoSendToChat: integer(\"dachiastream_auto_send_to_chat\", { mode: 'boolean' }).notNull().default(false),\n  dachiastreamCycleInterval: integer(\"dachiastream_cycle_interval\").notNull().default(15),\n  \n  // Dashboard Settings\n  streamSessionStarted: integer(\"stream_session_started\", { mode: 'timestamp' }),\n  dashboardShowTotalMessages: integer(\"dashboard_show_total_messages\", { mode: 'boolean' }).notNull().default(true),\n  dashboardShowAiAnalyzed: integer(\"dashboard_show_ai_analyzed\", { mode: 'boolean' }).notNull().default(true),\n  dashboardShowActiveUsers: integer(\"dashboard_show_active_users\", { mode: 'boolean' }).notNull().default(true),\n  dashboardShowModActions: integer(\"dashboard_show_mod_actions\", { mode: 'boolean' }).notNull().default(true),\n  \n  updatedAt: integer(\"updated_at\", { mode: 'timestamp' }).notNull().$defaultFn(() => new Date()),\n});\n\n// Relations\nexport const chatMessagesRelations = relations(chatMessages, ({ one }) => ({\n  analysis: one(aiAnalysis, {\n    fields: [chatMessages.id],\n    references: [aiAnalysis.messageId],\n  }),\n}));\n\nexport const aiAnalysisRelations = relations(aiAnalysis, ({ one }) => ({\n  message: one(chatMessages, {\n    fields: [aiAnalysis.messageId],\n    references: [chatMessages.id],\n  }),\n}));\n\n// Insert Schemas (same as PostgreSQL version)\nexport const insertUserProfileSchema = createInsertSchema(userProfiles).omit({\n  id: true,\n  firstSeen: true,\n  lastSeen: true,\n});\n\nexport const insertUserInsightSchema = createInsertSchema(userInsights).omit({\n  lastUpdated: true,\n});\n\nexport const insertChatMessageSchema = createInsertSchema(chatMessages).omit({\n  id: true,\n  timestamp: true,\n});\n\nexport const insertAiAnalysisSchema = createInsertSchema(aiAnalysis).omit({\n  id: true,\n  timestamp: true,\n});\n\nexport const insertAiCommandSchema = createInsertSchema(aiCommands).omit({\n  id: true,\n  usageCount: true,\n  createdAt: true,\n});\n\nexport const insertSettingsSchema = createInsertSchema(settings).omit({\n  id: true,\n  updatedAt: true,\n});\n\nexport const insertVoiceAiResponseSchema = createInsertSchema(voiceAiResponses).omit({\n  id: true,\n  timestamp: true,\n});\n\nexport const insertAuthenticatedUserSchema = createInsertSchema(authenticatedUsers).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertRaidSchema = createInsertSchema(raids).omit({\n  id: true,\n  timestamp: true,\n});\n\nexport const insertModerationActionSchema = createInsertSchema(moderationActions).omit({\n  id: true,\n  timestamp: true,\n});\n\n// Types (same as PostgreSQL version)\nexport type UserProfile = typeof userProfiles.$inferSelect;\nexport type InsertUserProfile = z.infer<typeof insertUserProfileSchema>;\n\nexport type UserInsight = typeof userInsights.$inferSelect;\nexport type InsertUserInsight = z.infer<typeof insertUserInsightSchema>;\n\nexport type ChatMessage = typeof chatMessages.$inferSelect;\nexport type InsertChatMessage = z.infer<typeof insertChatMessageSchema>;\n\nexport type AiAnalysis = typeof aiAnalysis.$inferSelect;\nexport type InsertAiAnalysis = z.infer<typeof insertAiAnalysisSchema>;\n\nexport type AiCommand = typeof aiCommands.$inferSelect;\nexport type InsertAiCommand = z.infer<typeof insertAiCommandSchema>;\n\nexport type Settings = typeof settings.$inferSelect;\nexport type InsertSettings = z.infer<typeof insertSettingsSchema>;\n\nexport type VoiceAiResponse = typeof voiceAiResponses.$inferSelect;\nexport type InsertVoiceAiResponse = z.infer<typeof insertVoiceAiResponseSchema>;\n\nexport type AuthenticatedUser = typeof authenticatedUsers.$inferSelect;\nexport type InsertAuthenticatedUser = z.infer<typeof insertAuthenticatedUserSchema>;\n\nexport type Raid = typeof raids.$inferSelect;\nexport type InsertRaid = z.infer<typeof insertRaidSchema>;\n\nexport type ModerationAction = typeof moderationActions.$inferSelect;\nexport type InsertModerationAction = z.infer<typeof insertModerationActionSchema>;\n\n// Extended types for frontend\nexport type ChatMessageWithAnalysis = ChatMessage & {\n  analysis?: AiAnalysis;\n};\n\nexport type UserProfileWithInsight = UserProfile & {\n  insight?: UserInsight;\n};\n","size_bytes":14497},"run_local.sh":{"content":"#!/bin/bash\n\n# Colors for terminal\nGREEN='\\033[0;32m'\nBLUE='\\033[0;34m'\nRED='\\033[0;31m'\nNC='\\033[0m' # No Color\n\nclear\n\necho \"\"\necho \"  ===================================================\"\necho -e \"    ${GREEN}STREAMDACHI - LOCAL MODE${NC}\"\necho \"  ===================================================\"\necho \"\"\necho \"  Database: SQLite (app.db)\"\necho \"  Server: http://localhost:5000\"\necho \"\"\necho \"  Starting in 2 seconds...\"\necho \"  Press Ctrl+C to cancel\"\necho \"  ===================================================\"\necho \"\"\n\nsleep 2\n\necho -e \"  ${BLUE}[1/2]${NC} Checking dependencies...\"\nif [ ! -d \"node_modules\" ]; then\n    echo \"  Installing packages (this may take a minute)...\"\n    npm install\n    if [ $? -ne 0 ]; then\n        echo \"\"\n        echo -e \"  ${RED}ERROR: npm install failed!${NC}\"\n        echo \"  Make sure Node.js is installed.\"\n        read -p \"  Press Enter to exit...\"\n        exit 1\n    fi\nelse\n    echo \"  Dependencies OK!\"\nfi\n\necho \"\"\necho -e \"  ${BLUE}[2/2]${NC} Starting StreamDachi...\"\necho \"\"\necho \"  ===================================================\"\necho -e \"    ${GREEN}SERVER RUNNING${NC}\"\necho \"  ===================================================\"\necho \"\"\necho \"  Open your browser to: http://localhost:5000\"\necho \"\"\necho \"  Press Ctrl+C to stop the server\"\necho \"  ===================================================\"\necho \"\"\n\nnpx tsx server/index.ts\n\nif [ $? -ne 0 ]; then\n    echo \"\"\n    echo \"  ===================================================\"\n    echo -e \"    ${RED}SERVER STOPPED WITH ERROR${NC}\"\n    echo \"  ===================================================\"\n    echo \"\"\n    read -p \"  Press Enter to exit...\"\n    exit 1\nfi\n\necho \"\"\necho \"  ===================================================\"\necho -e \"    ${GREEN}SERVER STOPPED NORMALLY${NC}\"\necho \"  ===================================================\"\necho \"\"\nread -p \"  Press Enter to exit...\"\n","size_bytes":1904},"QUICK_START.md":{"content":"#  StreamDachi - Quick Start Guide\n\n## Choose Your Mode\n\nStreamDachi works in **two modes** automatically:\n\n###  **Replit (Web) Mode**  You're here now!\n- Runs on Replit with PostgreSQL database\n- Already configured and working\n- No setup needed\n\n###  **Local Mode**  For testing on your computer\n- Runs on your computer with SQLite\n- Perfect for making edits and testing\n- No internet needed for database\n\n---\n\n##  Running Locally (Super Easy!)\n\n### Windows\n\n**Just double-click:**\n```\nSTART_LOCAL.bat\n```\n\nThat's it! The launcher will:\n-  Check if packages are installed\n-  Install them if needed (first time only)\n-  Start the server on `http://localhost:5000`\n-  Show you when it's ready\n\n**Stop the server:** Press `Ctrl+C` in the window\n\n---\n\n### Mac / Linux\n\n**Open Terminal and run:**\n```bash\n./run_local.sh\n```\n\n**First time only:** Make it executable\n```bash\nchmod +x run_local.sh\n./run_local.sh\n```\n\n---\n\n##  What You'll See\n\nWhen you start local mode:\n\n```\n  ===================================================\n    STREAMDACHI - LOCAL MODE\n  ===================================================\n\n  Database: SQLite (app.db)\n  Server: http://localhost:5000\n\n  [1/2] Checking dependencies...\n  Dependencies OK!\n\n  [2/2] Starting StreamDachi...\n\n  ===================================================\n    SERVER RUNNING\n  ===================================================\n\n  Open your browser to: http://localhost:5000\n\n  Press Ctrl+C to stop the server\n  ===================================================\n```\n\n**Now open your browser:** `http://localhost:5000`\n\n---\n\n##  Workflow for Testing Changes\n\n### While Replit is Running:\n\n1. **Download your project** to your computer\n2. **Double-click** `START_LOCAL.bat` (Windows) or run `./run_local.sh` (Mac/Linux)\n3. **Open** `http://localhost:5000` in your browser\n4. **Make edits** to the code on your computer\n5. **Test changes** on your local server\n6. **Upload changes** back to Replit when ready\n\n### Why This Works:\n\n- **Replit stays live** - Your production site keeps running\n- **Local testing** - Test changes without affecting live site\n- **Separate databases** - Local SQLite vs Replit PostgreSQL\n- **Edit safely** - Break things locally without consequences\n\n---\n\n##  File Locations\n\n### Local Mode Creates:\n\n- `app.db` - Your SQLite database (backup this file!)\n- `node_modules/` - Installed packages (don't backup)\n\n### You Can:\n\n- **Backup**: Copy `app.db` to save your data\n- **Reset**: Delete `app.db` to start fresh\n- **Share**: Send `app.db` with project files\n\n---\n\n##  Pro Tips\n\n### First Time Setup\n\n1. **Run once** - Let it install packages (takes ~1 minute)\n2. **Keep window open** - Don't close the terminal\n3. **Browser auto-opens** - Visit `http://localhost:5000`\n\n### Daily Use\n\n1. **Double-click launcher** - Starts instantly\n2. **Edit code** - Changes reload automatically (Vite HMR)\n3. **Ctrl+C** to stop - Always use this to shut down properly\n\n### Troubleshooting\n\n**Port already in use?**\n- Close the old terminal window\n- Or kill the process: `taskkill /F /IM node.exe` (Windows)\n\n**Database error?**\n- Delete `app.db` and restart\n- Check file permissions\n\n**Can't find npm?**\n- Install Node.js from nodejs.org\n- Restart terminal after installing\n\n---\n\n##  Common Scenarios\n\n### Scenario 1: Quick Test\n```\n1. Double-click START_LOCAL.bat\n2. Wait 5 seconds\n3. Open http://localhost:5000\n4. Done!\n```\n\n### Scenario 2: Making Edits\n```\n1. Start local mode\n2. Open code in your editor\n3. Edit files\n4. Browser auto-refreshes (Vite)\n5. Test your changes\n6. Press Ctrl+C when done\n```\n\n### Scenario 3: Testing Before Replit Update\n```\n1. Make changes locally\n2. Test thoroughly\n3. If good: Upload to Replit\n4. If bad: Ctrl+C and try again\n```\n\n---\n\n##  Speed Tips\n\n### Make a Desktop Shortcut (Windows)\n\n1. **Right-click** `START_LOCAL.bat`\n2. **Send to**  Desktop (create shortcut)\n3. **Rename** to \"StreamDachi Local\"\n4. **Double-click** the shortcut anytime!\n\n### Pin to Taskbar (Windows)\n\n1. Create shortcut (above)\n2. Drag shortcut to taskbar\n3. One-click launch!\n\n### Create Alias (Mac/Linux)\n\nAdd to `~/.bashrc` or `~/.zshrc`:\n```bash\nalias streamdachi=\"cd /path/to/StreamDachi && ./run_local.sh\"\n```\n\nNow just type `streamdachi` in terminal!\n\n---\n\n##  Environment Variables\n\nLocal mode needs the same API keys as web mode:\n\n**Create `.env` file in project root:**\n```env\nTWITCH_CLIENT_ID=your_client_id\nTWITCH_CLIENT_SECRET=your_secret\nGROQ_API_KEY=your_groq_key\nSESSION_SECRET=random_string_here\n```\n\n**Get API Keys:**\n- Twitch: https://dev.twitch.tv/console/apps\n- Groq: https://console.groq.com/\n\n---\n\n##  You're Ready!\n\n**Windows:** Double-click `START_LOCAL.bat`\n**Mac/Linux:** Run `./run_local.sh`\n\nOpen `http://localhost:5000` and enjoy StreamDachi!\n\n---\n\n##  Need Help?\n\nCheck these files:\n- `LOCAL_SETUP.md` - Detailed setup guide\n- `README.md` - Project documentation\n\nHappy streaming! \n","size_bytes":4973},"LOCAL_SETUP.md":{"content":"# StreamDachi - Local Mode Setup Guide\n\nStreamDachi now supports **dual-mode operation**: it automatically runs on **PostgreSQL** when on Replit (web mode) and **SQLite** when running locally on your computer (no internet required).\n\n##  How It Works\n\nThe application **automatically detects** which environment it's running in:\n\n- **Replit (Web Mode)**: Uses PostgreSQL/Neon serverless database\n- **Local Mode**: Uses SQLite with `app.db` file (no internet needed)\n\nDetection happens via `process.env.REPLIT` - no manual configuration required!\n\n---\n\n##  Running Locally (Windows)\n\n### Quick Start\n\n1. **Download** all files to your computer\n2. **Double-click** `run_local.bat`\n3. **Open browser** to `http://localhost:5000`\n\n### What Happens\n\nThe batch file will:\n- Install all dependencies (`npm install`)\n- Create `app.db` SQLite database automatically\n- Start the server on port 5000\n- Connect to Twitch using your credentials\n\n---\n\n##  Running Locally (Linux/Mac)\n\n### Quick Start\n\n```bash\n# Make the script executable\nchmod +x run_local.sh\n\n# Run the script\n./run_local.sh\n```\n\n### Manual Start\n\nIf you prefer to run commands manually:\n\n```bash\n# Install dependencies\nnpm install\n\n# Start the server\nnpx tsx server/index.ts\n```\n\nThe server will automatically:\n- Detect local environment\n- Create `app.db` if it doesn't exist\n- Start on `http://localhost:5000`\n\n---\n\n##  Database File\n\n### Location\n- **File**: `app.db` (created in project root)\n- **Type**: SQLite database with WAL mode enabled\n\n### Important Notes\n\n1. **Backup**: Copy `app.db` to backup your data\n2. **Fresh Start**: Delete `app.db` to reset everything\n3. **Portable**: Move `app.db` with your project files\n\n### What's Stored\n\nAll your StreamDachi data:\n- Chat messages and AI analysis\n- User profiles (VIPs, mods, subs)\n- Voice AI responses and transcriptions\n- Settings and configurations\n- Raid history and mod actions\n\n---\n\n##  Switching Between Modes\n\n### Web  Local\n\n1. Download the project\n2. Run `run_local.bat` (Windows) or `run_local.sh` (Linux/Mac)\n3. Fresh SQLite database created automatically\n\n### Local  Web\n\n1. Upload to Replit\n2. Run normally - auto-detects Replit environment\n3. Uses PostgreSQL database automatically\n\n**Note**: Data does NOT sync between modes - they use separate databases.\n\n---\n\n##  Configuration\n\n### No Configuration Needed!\n\nThe dual-mode system automatically:\n- Detects your environment\n- Selects the correct database\n- Uses appropriate connection settings\n\n### Environment Variables (Optional)\n\nLocal mode works without any environment variables. However, you still need:\n\n- `TWITCH_CLIENT_ID` - For Twitch API\n- `TWITCH_CLIENT_SECRET` - For OAuth\n- `GROQ_API_KEY` - For AI features\n- `SESSION_SECRET` - For session security\n\nCreate a `.env` file in the project root:\n\n```env\nTWITCH_CLIENT_ID=your_client_id_here\nTWITCH_CLIENT_SECRET=your_client_secret_here\nGROQ_API_KEY=your_groq_key_here\nSESSION_SECRET=your_random_secret_here\n```\n\n---\n\n##  Features Available Offline\n\nWhen running locally, you can use:\n\n **Full Chat Integration** - Twitch IRC connection\n **AI Analysis** - Groq AI (requires internet for API calls)\n **Voice Recognition** - Browser-based (offline capable)\n **TTS Voice** - Puter.js (requires internet)\n **Database** - SQLite (completely offline)\n **All Dashboard Features** - Analytics, monitoring, settings\n\n---\n\n##  File Structure\n\n```\nStreamDachi/\n app.db              # SQLite database (created automatically)\n run_local.bat       # Windows launcher\n run_local.sh        # Linux/Mac launcher\n server/\n    db-config.ts    # Dual-mode database config\n    db.ts           # Database exports\n    ...\n shared/\n    schema.ts       # PostgreSQL schema\n    schema-sqlite.ts # SQLite schema\n ...\n```\n\n---\n\n##  Troubleshooting\n\n### \"Database connection failed\"\n\n**Replit Mode**: Check DATABASE_URL environment variable\n**Local Mode**: Ensure write permissions in project folder\n\n### \"Port 5000 already in use\"\n\nKill the process using port 5000 or change the port in `server/index.ts`\n\n### \"npm install fails\"\n\nTry:\n```bash\nnpm cache clean --force\nnpm install\n```\n\n### \"App won't start locally\"\n\n1. Check you have Node.js installed (`node --version`)\n2. Ensure all dependencies installed (`npm install`)\n3. Check for error messages in console\n4. Try deleting `app.db` and restarting\n\n---\n\n##  Security Notes\n\n### Local Mode\n\n- **No external database** - All data stored in `app.db`\n- **File permissions** - Secure your `app.db` file\n- **API keys** - Store in `.env` file (don't commit!)\n\n### Web Mode (Replit)\n\n- **Replit Secrets** - Uses built-in secrets management\n- **PostgreSQL** - Hosted securely on Neon\n- **HTTPS** - Automatic SSL encryption\n\n---\n\n##  Tips\n\n1. **Development**: Use Replit for testing with full database features\n2. **Portable Demo**: Use local mode to demo without internet\n3. **Backup**: Copy `app.db` regularly when using local mode\n4. **Performance**: SQLite is faster for single-user scenarios\n\n---\n\n##  Differences Between Modes\n\n| Feature | Web (PostgreSQL) | Local (SQLite) |\n|---------|------------------|----------------|\n| Database Type | PostgreSQL/Neon | SQLite |\n| Internet Required | Yes | Only for APIs |\n| Data Location | Cloud | Local file |\n| Setup Complexity | Automatic | Automatic |\n| Performance | Excellent | Faster (local) |\n| Concurrent Users | Many | Single user |\n| Backup | Replit handles it | Copy app.db |\n\n---\n\n##  FAQ\n\n**Q: Can I use the same database in both modes?**\nA: No - they're separate databases. Export/import not yet implemented.\n\n**Q: Which mode should I use?**\nA: Replit for production, local for development/offline demos.\n\n**Q: Will my data sync?**\nA: No - web and local databases are independent.\n\n**Q: Can I migrate data between modes?**\nA: Not automatically - you'd need to export/import manually.\n\n**Q: Does local mode need internet?**\nA: Yes for Twitch API, Groq AI, and Puter.js TTS. Database works offline.\n\n---\n\n##  Ready to Go!\n\nYour StreamDachi installation now supports both modes:\n\n- **On Replit**: Just run normally (auto-detects)\n- **On Your Computer**: Run `run_local.bat` or `run_local.sh`\n\nEnjoy StreamDachi wherever you are! \n","size_bytes":6344},"server/db-config.ts":{"content":"// Dual-mode database configuration\n// Auto-detects Replit environment and switches between PostgreSQL (web) and SQLite (local)\n\nimport { drizzle as drizzlePg } from 'drizzle-orm/neon-serverless';\nimport { drizzle as drizzleSqlite } from 'drizzle-orm/better-sqlite3';\nimport { Pool, neonConfig } from '@neondatabase/serverless';\nimport Database from 'better-sqlite3';\nimport ws from \"ws\";\nimport * as schemaPg from \"@shared/schema\";\nimport * as schemaSqlite from \"@shared/schema-sqlite\";\nimport path from 'path';\n\n// Detect if running on Replit or locally\nexport const isReplit = !!process.env.REPLIT || !!process.env.REPL_ID;\nexport const isLocal = !isReplit;\n\nconsole.log(` Environment: ${isReplit ? 'Replit (Web Mode)' : 'Local Mode'}`);\n\nlet db: any;\nlet pool: Pool | undefined;\nlet sqliteInstance: Database.Database | undefined;\n\n// Web mode: PostgreSQL with Neon\nif (isReplit) {\n  neonConfig.webSocketConstructor = ws;\n  \n  if (!process.env.DATABASE_URL) {\n    throw new Error(\n      \"DATABASE_URL must be set. Did you forget to provision a database?\",\n    );\n  }\n\n  pool = new Pool({ \n    connectionString: process.env.DATABASE_URL,\n    max: 10,\n    idleTimeoutMillis: 30000,\n    connectionTimeoutMillis: 10000,\n  });\n\n  pool.on('error', (err) => {\n    console.error('Unexpected database error on idle client', err);\n  });\n\n  pool.on('connect', () => {\n    console.log(' PostgreSQL database connection established (Web Mode)');\n  });\n\n  db = drizzlePg({ client: pool, schema: schemaPg });\n}\n\n// Local mode: SQLite with better-sqlite3\nelse {\n  const dbPath = path.join(process.cwd(), 'app.db');\n  console.log(` Using SQLite database at: ${dbPath}`);\n  \n  sqliteInstance = new Database(dbPath);\n  \n  // Enable WAL mode for better concurrent access\n  sqliteInstance.pragma('journal_mode = WAL');\n  \n  console.log(' SQLite database initialized (Local Mode)');\n  \n  db = drizzleSqlite(sqliteInstance, { schema: schemaSqlite });\n}\n\nexport { db, pool, sqliteInstance };\nexport const schema = isReplit ? schemaPg : schemaSqlite;\n","size_bytes":2042}},"version":2}